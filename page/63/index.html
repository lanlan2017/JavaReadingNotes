<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 6.1.0">

<link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
  <link rel="apple-touch-icon" sizes="180x180" href="/JavaReadingNotes/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/JavaReadingNotes/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/JavaReadingNotes/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/JavaReadingNotes/images/logo.svg" color="#222">
  <meta name="google-site-verification" content="_Sly-yzHYmALHXzjFpPWsodMrjBSphw7bfRbMUH80Qc">
  <meta name="msvalidate.01" content="B1CFD346B8DEBBFE0C983C2AF8955531">
  <meta name="baidu-site-verification" content="vkMTwK56xr">

<link rel="stylesheet" href="/JavaReadingNotes/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css" integrity="sha256-DfWjNxDkM94fVBWx1H5BMMp0Zq7luBlV8QRcSES7s+0=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css" integrity="sha256-Vzbj7sDDS/woiFS3uNKo8eIuni59rjyNGtXfstRzStA=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/themes/blue/pace-theme-minimal.css">
  <script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script>

<script class="next-config" data-name="main" type="application/json">{"hostname":"lanlan2017.github.io","root":"/JavaReadingNotes/","images":"/JavaReadingNotes/images","scheme":"Gemini","darkmode":true,"version":"8.11.0","exturl":false,"sidebar":{"position":"right","display":"post","padding":18,"offset":12},"copycode":true,"bookmark":{"enable":true,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":true,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/JavaReadingNotes/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/JavaReadingNotes/js/config.js"></script>

    <meta name="description" content="好好学习，天天向上">
<meta property="og:type" content="website">
<meta property="og:title" content="蓝蓝站点">
<meta property="og:url" content="https://lanlan2017.github.io/JavaReadingNotes/page/63/index.html">
<meta property="og:site_name" content="蓝蓝站点">
<meta property="og:description" content="好好学习，天天向上">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="蓝蓝">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://lanlan2017.github.io/JavaReadingNotes/page/63/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"page/63/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>蓝蓝站点</title>
  

  <script src="/JavaReadingNotes/js/third-party/analytics/baidu-analytics.js"></script>
  <script async src="https://hm.baidu.com/hm.js?dadeb188eb14ccde0b25a19230c429b5"></script>



<link rel="dns-prefetch" href="https://waline-test-lanlan2017.vercel.app">
  <noscript>
    <link rel="stylesheet" href="/JavaReadingNotes/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/JavaReadingNotes/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">蓝蓝站点</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">Java读书笔记</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/JavaReadingNotes/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-dir"><a href="/JavaReadingNotes/dir/" rel="section"><i class="fa fa-sitemap fa-fw"></i>目录</a></li><li class="menu-item menu-item-categories"><a href="/JavaReadingNotes/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-archives"><a href="/JavaReadingNotes/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li><li class="menu-item menu-item-tags"><a href="/JavaReadingNotes/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="蓝蓝"
      src="/JavaReadingNotes/images/avatar.gif">
  <p class="site-author-name" itemprop="name">蓝蓝</p>
  <div class="site-description" itemprop="description">好好学习，天天向上</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/JavaReadingNotes/archives/">
          <span class="site-state-item-count">1871</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/JavaReadingNotes/categories/">
        <span class="site-state-item-count">626</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://lanlan2017.github.io/todo/" title="todo → https:&#x2F;&#x2F;lanlan2017.github.io&#x2F;todo&#x2F;"><i class="fa fa-check-square fa-fw"></i>todo</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://lanlan2017.github.io/links/" title="links → https:&#x2F;&#x2F;lanlan2017.github.io&#x2F;links&#x2F;"><i class="fa fa-link fa-fw"></i>links</a>
      </span>
  </div>
  <div class="cc-license site-overview-item animated" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" class="cc-opacity" rel="noopener" target="_blank"><img src="https://cdn.jsdelivr.net/npm/@creativecommons/vocabulary@2020.11.3/assets/license_badges/small/by_nc_sa.svg" alt="Creative Commons"></a>
  </div>



        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="返回顶部">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="reading-progress-bar"></div>
  <a role="button" class="book-mark-link book-mark-link-fixed"></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://lanlan2017.github.io/JavaReadingNotes/cf091adc/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/JavaReadingNotes/images/avatar.gif">
      <meta itemprop="name" content="蓝蓝">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="蓝蓝站点">
      <meta itemprop="description" content="好好学习，天天向上">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 蓝蓝站点">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/JavaReadingNotes/cf091adc/" class="post-title-link" itemprop="url">13.3.2 定义DAO接口</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-06-23 02:54:13" itemprop="dateCreated datePublished" datetime="2020-06-23T02:54:13+08:00">2020-06-23</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/4-Spring-Mybatis%E4%BC%81%E4%B8%9A%E5%BA%94%E7%94%A8%E5%AE%9E%E6%88%98-%E7%AC%AC2%E7%89%88/" itemprop="url" rel="index"><span itemprop="name">4 Spring+Mybatis企业应用实战(第2版)</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/4-Spring-Mybatis%E4%BC%81%E4%B8%9A%E5%BA%94%E7%94%A8%E5%AE%9E%E6%88%98-%E7%AC%AC2%E7%89%88/%E7%AC%AC13%E7%AB%A0-%E5%AE%9E%E6%88%98%E9%A1%B9%E7%9B%AE%E4%BA%BA%E4%BA%8B%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F/" itemprop="url" rel="index"><span itemprop="name">第13章 实战项目人事管理系统</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/4-Spring-Mybatis%E4%BC%81%E4%B8%9A%E5%BA%94%E7%94%A8%E5%AE%9E%E6%88%98-%E7%AC%AC2%E7%89%88/%E7%AC%AC13%E7%AB%A0-%E5%AE%9E%E6%88%98%E9%A1%B9%E7%9B%AE%E4%BA%BA%E4%BA%8B%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F/13-3-%E5%AE%9E%E7%8E%B0DAO%E6%8C%81%E4%B9%85%E5%B1%82/" itemprop="url" rel="index"><span itemprop="name">13.3 实现DAO持久层</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
    <span class="post-meta-item-icon">
      <i class="far fa-comment"></i>
    </span>
    <span class="post-meta-item-text">Waline：</span>
  
    <a title="waline" href="/JavaReadingNotes/cf091adc/#waline-comments" itemprop="discussionUrl">
      <span class="post-comments-count waline-comment-count" id="/JavaReadingNotes/cf091adc/" data-xid="/JavaReadingNotes/cf091adc/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>30k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>27 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="13-3-2-定义DAO接口"><a href="#13-3-2-定义DAO接口" class="headerlink" title="13.3.2 定义DAO接口"></a>13.3.2 定义DAO接口</h1><h2 id="UserDao接口"><a href="#UserDao接口" class="headerlink" title="UserDao接口"></a>UserDao接口</h2><p>下面是<code>UserDao</code>接口的源代码。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.fkit.hrm.dao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Delete;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Param;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Select;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.SelectProvider;</span><br><span class="line"><span class="keyword">import</span> org.fkit.hrm.dao.provider.UserDynaSqlProvider;</span><br><span class="line"><span class="keyword">import</span> org.fkit.hrm.domain.User;</span><br><span class="line"><span class="comment">// 静态导入</span></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.fkit.hrm.util.common.HrmConstants.USERTABLE;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserDao</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 根据登录名和密码查询员工</span></span><br><span class="line">    <span class="meta">@Select(&quot;select * from &quot; + USERTABLE</span></span><br><span class="line"><span class="meta">            + &quot; where loginname = #&#123;loginname&#125; and password = #&#123;password&#125;&quot;)</span></span><br><span class="line">    User <span class="title function_">selectByLoginnameAndPassword</span><span class="params">(<span class="meta">@Param(&quot;loginname&quot;)</span> String loginname,</span></span><br><span class="line"><span class="params">            <span class="meta">@Param(&quot;password&quot;)</span> String password)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 根据id查询用户</span></span><br><span class="line">    <span class="meta">@Select(&quot;select * from &quot; + USERTABLE + &quot; where ID = #&#123;id&#125;&quot;)</span></span><br><span class="line">    User <span class="title function_">selectById</span><span class="params">(Integer id)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 根据id删除用户</span></span><br><span class="line">    <span class="meta">@Delete(&quot; delete from &quot; + USERTABLE + &quot; where id = #&#123;id&#125; &quot;)</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">deleteById</span><span class="params">(Integer id)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 动态修改用户</span></span><br><span class="line">    <span class="meta">@SelectProvider(</span></span><br><span class="line"><span class="meta">        type = UserDynaSqlProvider.class,</span></span><br><span class="line"><span class="meta">        method = &quot;updateUser&quot;)</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">update</span><span class="params">(User user)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 动态查询</span></span><br><span class="line">    <span class="meta">@SelectProvider(</span></span><br><span class="line"><span class="meta">        type = UserDynaSqlProvider.class,</span></span><br><span class="line"><span class="meta">        method = &quot;selectWhitParam&quot;)</span></span><br><span class="line">    List&lt;User&gt; <span class="title function_">selectByPage</span><span class="params">(Map&lt;String, Object&gt; params)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 根据参数查询用户总数</span></span><br><span class="line">    <span class="meta">@SelectProvider(</span></span><br><span class="line"><span class="meta">        type = UserDynaSqlProvider.class,</span></span><br><span class="line"><span class="meta">        method = &quot;count&quot;)</span></span><br><span class="line">    Integer <span class="title function_">count</span><span class="params">(Map&lt;String, Object&gt; params)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 动态插入用户</span></span><br><span class="line">    <span class="meta">@SelectProvider(</span></span><br><span class="line"><span class="meta">        type = UserDynaSqlProvider.class,</span></span><br><span class="line"><span class="meta">        method = &quot;insertUser&quot;)</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">save</span><span class="params">(User user)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在<code>Userdao</code>接口中使用了动态<code>SQL</code>提供类:<code>UserDynasqlProvider</code>.</p>
<h2 id="UserDynaSqlProvider-java"><a href="#UserDynaSqlProvider-java" class="headerlink" title="UserDynaSqlProvider.java"></a>UserDynaSqlProvider.java</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.fkit.hrm.dao.provider;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.jdbc.SQL;</span><br><span class="line"><span class="keyword">import</span> org.fkit.hrm.domain.User;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.fkit.hrm.util.common.HrmConstants.USERTABLE;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserDynaSqlProvider</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 分页动态查询</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">selectWhitParam</span><span class="params">(Map&lt;String, Object&gt; params)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SQL</span>()</span><br><span class="line">        &#123;</span><br><span class="line">            &#123;</span><br><span class="line">                SELECT(<span class="string">&quot;*&quot;</span>);</span><br><span class="line">                FROM(USERTABLE);</span><br><span class="line">                <span class="keyword">if</span> (params.get(<span class="string">&quot;user&quot;</span>) != <span class="literal">null</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> (User) params.get(<span class="string">&quot;user&quot;</span>);</span><br><span class="line">                    <span class="keyword">if</span> (user.getUsername() != <span class="literal">null</span></span><br><span class="line">                            &amp;&amp; !user.getUsername().equals(<span class="string">&quot;&quot;</span>))</span><br><span class="line">                    &#123;</span><br><span class="line">                        WHERE(<span class="string">&quot;  username LIKE CONCAT (&#x27;%&#x27;,#&#123;user.username&#125;,&#x27;%&#x27;) &quot;</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">if</span> (user.getUserstatus() != <span class="literal">null</span></span><br><span class="line">                            &amp;&amp; !user.getUserstatus().equals(<span class="string">&quot;&quot;</span>))</span><br><span class="line">                    &#123;</span><br><span class="line">                        WHERE(<span class="string">&quot; userstatus LIKE CONCAT (&#x27;%&#x27;,#&#123;user.userstatus&#125;,&#x27;%&#x27;) &quot;</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;.toString();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (params.get(<span class="string">&quot;pageModel&quot;</span>) != <span class="literal">null</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            sql += <span class="string">&quot; limit #&#123;pageModel.firstLimitParam&#125; , #&#123;pageModel.pageSize&#125;  &quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> sql;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 动态查询总数量</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">count</span><span class="params">(Map&lt;String, Object&gt; params)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">SQL</span>()</span><br><span class="line">        &#123;</span><br><span class="line">            &#123;</span><br><span class="line">                SELECT(<span class="string">&quot;count(*)&quot;</span>);</span><br><span class="line">                FROM(USERTABLE);</span><br><span class="line">                <span class="keyword">if</span> (params.get(<span class="string">&quot;user&quot;</span>) != <span class="literal">null</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> (User) params.get(<span class="string">&quot;user&quot;</span>);</span><br><span class="line">                    <span class="keyword">if</span> (user.getUsername() != <span class="literal">null</span></span><br><span class="line">                            &amp;&amp; !user.getUsername().equals(<span class="string">&quot;&quot;</span>))</span><br><span class="line">                    &#123;</span><br><span class="line">                        WHERE(<span class="string">&quot; username LIKE CONCAT (&#x27;%&#x27;,#&#123;user.username&#125;,&#x27;%&#x27;) &quot;</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">if</span> (user.getUserstatus() != <span class="literal">null</span></span><br><span class="line">                            &amp;&amp; !user.getUserstatus().equals(<span class="string">&quot;&quot;</span>))</span><br><span class="line">                    &#123;</span><br><span class="line">                        WHERE(<span class="string">&quot; userstatus LIKE CONCAT (&#x27;%&#x27;,#&#123;user.userstatus&#125;,&#x27;%&#x27;) &quot;</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;.toString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 动态插入</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">insertUser</span><span class="params">(User user)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">SQL</span>()</span><br><span class="line">        &#123;</span><br><span class="line">            &#123;</span><br><span class="line">                INSERT_INTO(USERTABLE);</span><br><span class="line">                <span class="keyword">if</span> (user.getUsername() != <span class="literal">null</span></span><br><span class="line">                        &amp;&amp; !user.getUsername().equals(<span class="string">&quot;&quot;</span>))</span><br><span class="line">                &#123;</span><br><span class="line">                    VALUES(<span class="string">&quot;username&quot;</span>, <span class="string">&quot;#&#123;username&#125;&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (user.getUserstatus() != <span class="literal">null</span></span><br><span class="line">                        &amp;&amp; !user.getUserstatus().equals(<span class="string">&quot;&quot;</span>))</span><br><span class="line">                &#123;</span><br><span class="line">                    VALUES(<span class="string">&quot;userstatus&quot;</span>, <span class="string">&quot;#&#123;userstatus&#125;&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (user.getLoginname() != <span class="literal">null</span></span><br><span class="line">                        &amp;&amp; !user.getLoginname().equals(<span class="string">&quot;&quot;</span>))</span><br><span class="line">                &#123;</span><br><span class="line">                    VALUES(<span class="string">&quot;loginname&quot;</span>, <span class="string">&quot;#&#123;loginname&#125;&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (user.getPassword() != <span class="literal">null</span></span><br><span class="line">                        &amp;&amp; !user.getPassword().equals(<span class="string">&quot;&quot;</span>))</span><br><span class="line">                &#123;</span><br><span class="line">                    VALUES(<span class="string">&quot;password&quot;</span>, <span class="string">&quot;#&#123;password&#125;&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;.toString();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 动态更新</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">updateUser</span><span class="params">(User user)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">SQL</span>()</span><br><span class="line">        &#123;</span><br><span class="line">            &#123;</span><br><span class="line">                UPDATE(USERTABLE);</span><br><span class="line">                <span class="keyword">if</span> (user.getUsername() != <span class="literal">null</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    SET(<span class="string">&quot; username = #&#123;username&#125; &quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (user.getLoginname() != <span class="literal">null</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    SET(<span class="string">&quot; loginname = #&#123;loginname&#125; &quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (user.getPassword() != <span class="literal">null</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    SET(<span class="string">&quot; password = #&#123;password&#125; &quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (user.getUserstatus() != <span class="literal">null</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    SET(<span class="string">&quot; userstatus = #&#123;userstatus&#125; &quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (user.getCreateDate() != <span class="literal">null</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    SET(<span class="string">&quot; create_date = #&#123;createDate&#125; &quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                WHERE(<span class="string">&quot; id = #&#123;id&#125; &quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;.toString();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>通过上面的<code>DAO</code>接口完成数据库的操作,这种简单的实现较之传统的<code>JDBC</code>持久化访问方便。</p>
<h2 id="DeptDao接口"><a href="#DeptDao接口" class="headerlink" title="DeptDao接口"></a>DeptDao接口</h2><p>下面是<code>DeptDao</code>接口的源代码:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.fkit.hrm.dao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Delete;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Select;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.SelectProvider;</span><br><span class="line"><span class="keyword">import</span> org.fkit.hrm.dao.provider.DeptDynaSqlProvider;</span><br><span class="line"><span class="keyword">import</span> org.fkit.hrm.domain.Dept;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.fkit.hrm.util.common.HrmConstants.DEPTTABLE;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">DeptDao</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 动态查询</span></span><br><span class="line">    <span class="meta">@SelectProvider(</span></span><br><span class="line"><span class="meta">        type = DeptDynaSqlProvider.class,</span></span><br><span class="line"><span class="meta">        method = &quot;selectWhitParam&quot;)</span></span><br><span class="line">    List&lt;Dept&gt; <span class="title function_">selectByPage</span><span class="params">(Map&lt;String, Object&gt; params)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SelectProvider(</span></span><br><span class="line"><span class="meta">        type = DeptDynaSqlProvider.class,</span></span><br><span class="line"><span class="meta">        method = &quot;count&quot;)</span></span><br><span class="line">    Integer <span class="title function_">count</span><span class="params">(Map&lt;String, Object&gt; params)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Select(&quot;select * from &quot; + DEPTTABLE + &quot; &quot;)</span></span><br><span class="line">    List&lt;Dept&gt; <span class="title function_">selectAllDept</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Select(&quot;select * from &quot; + DEPTTABLE + &quot; where ID = #&#123;id&#125;&quot;)</span></span><br><span class="line">    Dept <span class="title function_">selectById</span><span class="params">(<span class="type">int</span> id)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 根据id删除部门</span></span><br><span class="line">    <span class="meta">@Delete(&quot; delete from &quot; + DEPTTABLE + &quot; where id = #&#123;id&#125; &quot;)</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">deleteById</span><span class="params">(Integer id)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 动态插入部门</span></span><br><span class="line">    <span class="meta">@SelectProvider(</span></span><br><span class="line"><span class="meta">        type = DeptDynaSqlProvider.class,</span></span><br><span class="line"><span class="meta">        method = &quot;insertDept&quot;)</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">save</span><span class="params">(Dept dept)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 动态修改用户</span></span><br><span class="line">    <span class="meta">@SelectProvider(</span></span><br><span class="line"><span class="meta">        type = DeptDynaSqlProvider.class,</span></span><br><span class="line"><span class="meta">        method = &quot;updateDept&quot;)</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">update</span><span class="params">(Dept dept)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="JobDao接口"><a href="#JobDao接口" class="headerlink" title="JobDao接口"></a>JobDao接口</h2><p>下面是<code>JobDao</code>接口的源代码。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.fkit.hrm.dao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Delete;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Select;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.SelectProvider;</span><br><span class="line"><span class="keyword">import</span> org.fkit.hrm.dao.provider.JobDynaSqlProvider;</span><br><span class="line"><span class="keyword">import</span> org.fkit.hrm.domain.Job;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.fkit.hrm.util.common.HrmConstants.JOBTABLE;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">JobDao</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="meta">@Select(&quot;select * from &quot; + JOBTABLE + &quot; where ID = #&#123;id&#125;&quot;)</span></span><br><span class="line">    Job <span class="title function_">selectById</span><span class="params">(<span class="type">int</span> id)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Select(&quot;select * from &quot; + JOBTABLE + &quot; &quot;)</span></span><br><span class="line">    List&lt;Job&gt; <span class="title function_">selectAllJob</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 动态查询</span></span><br><span class="line">    <span class="meta">@SelectProvider(</span></span><br><span class="line"><span class="meta">        type = JobDynaSqlProvider.class,</span></span><br><span class="line"><span class="meta">        method = &quot;selectWhitParam&quot;)</span></span><br><span class="line">    List&lt;Job&gt; <span class="title function_">selectByPage</span><span class="params">(Map&lt;String, Object&gt; params)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SelectProvider(</span></span><br><span class="line"><span class="meta">        type = JobDynaSqlProvider.class,</span></span><br><span class="line"><span class="meta">        method = &quot;count&quot;)</span></span><br><span class="line">    Integer <span class="title function_">count</span><span class="params">(Map&lt;String, Object&gt; params)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 根据id删除部门</span></span><br><span class="line">    <span class="meta">@Delete(&quot; delete from &quot; + JOBTABLE + &quot; where id = #&#123;id&#125; &quot;)</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">deleteById</span><span class="params">(Integer id)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 动态插入部门</span></span><br><span class="line">    <span class="meta">@SelectProvider(</span></span><br><span class="line"><span class="meta">        type = JobDynaSqlProvider.class,</span></span><br><span class="line"><span class="meta">        method = &quot;insertJob&quot;)</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">save</span><span class="params">(Job job)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 动态修改用户</span></span><br><span class="line">    <span class="meta">@SelectProvider(</span></span><br><span class="line"><span class="meta">        type = JobDynaSqlProvider.class,</span></span><br><span class="line"><span class="meta">        method = &quot;updateJob&quot;)</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">update</span><span class="params">(Job job)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在<code>JobDao</code>接口中使用了动态<code>SQL</code>提供类<code>JobDynaSqlProvider</code>。</p>
<h2 id="JobDynaSqlProvider-java"><a href="#JobDynaSqlProvider-java" class="headerlink" title="JobDynaSqlProvider.java"></a>JobDynaSqlProvider.java</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.fkit.hrm.dao.provider;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.jdbc.SQL;</span><br><span class="line"><span class="keyword">import</span> org.fkit.hrm.domain.Job;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.fkit.hrm.util.common.HrmConstants.JOBTABLE;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JobDynaSqlProvider</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 分页动态查询</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">selectWhitParam</span><span class="params">(Map&lt;String, Object&gt; params)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SQL</span>()</span><br><span class="line">        &#123;</span><br><span class="line">            &#123;</span><br><span class="line">                SELECT(<span class="string">&quot;*&quot;</span>);</span><br><span class="line">                FROM(JOBTABLE);</span><br><span class="line">                <span class="keyword">if</span> (params.get(<span class="string">&quot;job&quot;</span>) != <span class="literal">null</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="type">Job</span> <span class="variable">job</span> <span class="operator">=</span> (Job) params.get(<span class="string">&quot;job&quot;</span>);</span><br><span class="line">                    <span class="keyword">if</span> (job.getName() != <span class="literal">null</span> &amp;&amp; !job.getName().equals(<span class="string">&quot;&quot;</span>))</span><br><span class="line">                    &#123;</span><br><span class="line">                        WHERE(<span class="string">&quot;  name LIKE CONCAT (&#x27;%&#x27;,#&#123;job.name&#125;,&#x27;%&#x27;) &quot;</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;.toString();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (params.get(<span class="string">&quot;pageModel&quot;</span>) != <span class="literal">null</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            sql += <span class="string">&quot; limit #&#123;pageModel.firstLimitParam&#125; , #&#123;pageModel.pageSize&#125;  &quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> sql;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 动态查询总数量</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">count</span><span class="params">(Map&lt;String, Object&gt; params)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">SQL</span>()</span><br><span class="line">        &#123;</span><br><span class="line">            &#123;</span><br><span class="line">                SELECT(<span class="string">&quot;count(*)&quot;</span>);</span><br><span class="line">                FROM(JOBTABLE);</span><br><span class="line">                <span class="keyword">if</span> (params.get(<span class="string">&quot;job&quot;</span>) != <span class="literal">null</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="type">Job</span> <span class="variable">job</span> <span class="operator">=</span> (Job) params.get(<span class="string">&quot;job&quot;</span>);</span><br><span class="line">                    <span class="keyword">if</span> (job.getName() != <span class="literal">null</span> &amp;&amp; !job.getName().equals(<span class="string">&quot;&quot;</span>))</span><br><span class="line">                    &#123;</span><br><span class="line">                        WHERE(<span class="string">&quot;  name LIKE CONCAT (&#x27;%&#x27;,#&#123;job.name&#125;,&#x27;%&#x27;) &quot;</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;.toString();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 动态插入</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">insertJob</span><span class="params">(Job job)</span></span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">SQL</span>()</span><br><span class="line">        &#123;</span><br><span class="line">            &#123;</span><br><span class="line">                INSERT_INTO(JOBTABLE);</span><br><span class="line">                <span class="keyword">if</span> (job.getName() != <span class="literal">null</span> &amp;&amp; !job.getName().equals(<span class="string">&quot;&quot;</span>))</span><br><span class="line">                &#123;</span><br><span class="line">                    VALUES(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;#&#123;name&#125;&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (job.getRemark() != <span class="literal">null</span> &amp;&amp; !job.getRemark().equals(<span class="string">&quot;&quot;</span>))</span><br><span class="line">                &#123;</span><br><span class="line">                    VALUES(<span class="string">&quot;remark&quot;</span>, <span class="string">&quot;#&#123;remark&#125;&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;.toString();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 动态更新</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">updateJob</span><span class="params">(Job job)</span></span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">SQL</span>()</span><br><span class="line">        &#123;</span><br><span class="line">            &#123;</span><br><span class="line">                UPDATE(JOBTABLE);</span><br><span class="line">                <span class="keyword">if</span> (job.getName() != <span class="literal">null</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    SET(<span class="string">&quot; name = #&#123;name&#125; &quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (job.getRemark() != <span class="literal">null</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    SET(<span class="string">&quot; remark = #&#123;remark&#125; &quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                WHERE(<span class="string">&quot; id = #&#123;id&#125; &quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;.toString();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="EmployeeDao-java"><a href="#EmployeeDao-java" class="headerlink" title="EmployeeDao.java"></a>EmployeeDao.java</h2><p>下面是<code>EmployeeDao</code>接口的源代码。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.fkit.hrm.dao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Delete;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.One;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Result;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Results;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Select;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.SelectProvider;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.mapping.FetchType;</span><br><span class="line"><span class="keyword">import</span> org.fkit.hrm.dao.provider.EmployeeDynaSqlProvider;</span><br><span class="line"><span class="keyword">import</span> org.fkit.hrm.domain.Employee;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.fkit.hrm.util.common.HrmConstants.EMPLOYEETABLE;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">EmployeeDao</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 根据参数查询员工总数</span></span><br><span class="line">    <span class="meta">@SelectProvider(</span></span><br><span class="line"><span class="meta">        type = EmployeeDynaSqlProvider.class,</span></span><br><span class="line"><span class="meta">        method = &quot;count&quot;)</span></span><br><span class="line">    Integer <span class="title function_">count</span><span class="params">(Map&lt;String, Object&gt; params)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 根据参数动态查询员工</span></span><br><span class="line">    <span class="meta">@SelectProvider(</span></span><br><span class="line"><span class="meta">        type = EmployeeDynaSqlProvider.class,</span></span><br><span class="line"><span class="meta">        method = &quot;selectWhitParam&quot;)</span></span><br><span class="line">    <span class="meta">@Results(</span></span><br><span class="line"><span class="meta">    &#123;@Result(</span></span><br><span class="line"><span class="meta">        id = true,</span></span><br><span class="line"><span class="meta">        column = &quot;id&quot;,</span></span><br><span class="line"><span class="meta">        property = &quot;id&quot;),</span></span><br><span class="line"><span class="meta">            @Result(</span></span><br><span class="line"><span class="meta">                column = &quot;CARD_ID&quot;,</span></span><br><span class="line"><span class="meta">                property = &quot;cardId&quot;),</span></span><br><span class="line"><span class="meta">            @Result(</span></span><br><span class="line"><span class="meta">                column = &quot;POST_CODE&quot;,</span></span><br><span class="line"><span class="meta">                property = &quot;postCode&quot;),</span></span><br><span class="line"><span class="meta">            @Result(</span></span><br><span class="line"><span class="meta">                column = &quot;QQ_NUM&quot;,</span></span><br><span class="line"><span class="meta">                property = &quot;qqNum&quot;),</span></span><br><span class="line"><span class="meta">            @Result(</span></span><br><span class="line"><span class="meta">                column = &quot;BIRTHDAY&quot;,</span></span><br><span class="line"><span class="meta">                property = &quot;birthday&quot;,</span></span><br><span class="line"><span class="meta">                javaType = java.util.Date.class),</span></span><br><span class="line"><span class="meta">            @Result(</span></span><br><span class="line"><span class="meta">                column = &quot;CREATE_DATE&quot;,</span></span><br><span class="line"><span class="meta">                property = &quot;createDate&quot;,</span></span><br><span class="line"><span class="meta">                javaType = java.util.Date.class),</span></span><br><span class="line"><span class="meta">            @Result(</span></span><br><span class="line"><span class="meta">                column = &quot;DEPT_ID&quot;,</span></span><br><span class="line"><span class="meta">                property = &quot;dept&quot;,</span></span><br><span class="line"><span class="meta">                one = @One(</span></span><br><span class="line"><span class="meta">                    select = &quot;org.fkit.hrm.dao.DeptDao.selectById&quot;,</span></span><br><span class="line"><span class="meta">                    fetchType = FetchType.EAGER)),</span></span><br><span class="line"><span class="meta">            @Result(</span></span><br><span class="line"><span class="meta">                column = &quot;JOB_ID&quot;,</span></span><br><span class="line"><span class="meta">                property = &quot;job&quot;,</span></span><br><span class="line"><span class="meta">                one = @One(</span></span><br><span class="line"><span class="meta">                    select = &quot;org.fkit.hrm.dao.JobDao.selectById&quot;,</span></span><br><span class="line"><span class="meta">                    fetchType = FetchType.EAGER))&#125;)</span></span><br><span class="line">    List&lt;Employee&gt; <span class="title function_">selectByPage</span><span class="params">(Map&lt;String, Object&gt; params)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 动态插入员工</span></span><br><span class="line">    <span class="meta">@SelectProvider(</span></span><br><span class="line"><span class="meta">        type = EmployeeDynaSqlProvider.class,</span></span><br><span class="line"><span class="meta">        method = &quot;insertEmployee&quot;)</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">save</span><span class="params">(Employee employee)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 根据id删除员工</span></span><br><span class="line">    <span class="meta">@Delete(&quot; delete from &quot; + EMPLOYEETABLE + &quot; where id = #&#123;id&#125; &quot;)</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">deleteById</span><span class="params">(Integer id)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 根据id查询员工</span></span><br><span class="line">    <span class="meta">@Select(&quot;select * from &quot; + EMPLOYEETABLE + &quot; where ID = #&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="meta">@Results(</span></span><br><span class="line"><span class="meta">    &#123;@Result(</span></span><br><span class="line"><span class="meta">        id = true,</span></span><br><span class="line"><span class="meta">        column = &quot;id&quot;,</span></span><br><span class="line"><span class="meta">        property = &quot;id&quot;),</span></span><br><span class="line"><span class="meta">            @Result(</span></span><br><span class="line"><span class="meta">                column = &quot;CARD_ID&quot;,</span></span><br><span class="line"><span class="meta">                property = &quot;cardId&quot;),</span></span><br><span class="line"><span class="meta">            @Result(</span></span><br><span class="line"><span class="meta">                column = &quot;POST_CODE&quot;,</span></span><br><span class="line"><span class="meta">                property = &quot;postCode&quot;),</span></span><br><span class="line"><span class="meta">            @Result(</span></span><br><span class="line"><span class="meta">                column = &quot;QQ_NUM&quot;,</span></span><br><span class="line"><span class="meta">                property = &quot;qqNum&quot;),</span></span><br><span class="line"><span class="meta">            @Result(</span></span><br><span class="line"><span class="meta">                column = &quot;BIRTHDAY&quot;,</span></span><br><span class="line"><span class="meta">                property = &quot;birthday&quot;,</span></span><br><span class="line"><span class="meta">                javaType = java.util.Date.class),</span></span><br><span class="line"><span class="meta">            @Result(</span></span><br><span class="line"><span class="meta">                column = &quot;CREATE_DATE&quot;,</span></span><br><span class="line"><span class="meta">                property = &quot;createDate&quot;,</span></span><br><span class="line"><span class="meta">                javaType = java.util.Date.class),</span></span><br><span class="line"><span class="meta">            @Result(</span></span><br><span class="line"><span class="meta">                column = &quot;DEPT_ID&quot;,</span></span><br><span class="line"><span class="meta">                property = &quot;dept&quot;,</span></span><br><span class="line"><span class="meta">                one = @One(</span></span><br><span class="line"><span class="meta">                    select = &quot;org.fkit.hrm.dao.DeptDao.selectById&quot;,</span></span><br><span class="line"><span class="meta">                    fetchType = FetchType.EAGER)),</span></span><br><span class="line"><span class="meta">            @Result(</span></span><br><span class="line"><span class="meta">                column = &quot;JOB_ID&quot;,</span></span><br><span class="line"><span class="meta">                property = &quot;job&quot;,</span></span><br><span class="line"><span class="meta">                one = @One(</span></span><br><span class="line"><span class="meta">                    select = &quot;org.fkit.hrm.dao.JobDao.selectById&quot;,</span></span><br><span class="line"><span class="meta">                    fetchType = FetchType.EAGER))&#125;)</span></span><br><span class="line">    Employee <span class="title function_">selectById</span><span class="params">(Integer id)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 动态修改员工</span></span><br><span class="line">    <span class="meta">@SelectProvider(</span></span><br><span class="line"><span class="meta">        type = EmployeeDynaSqlProvider.class,</span></span><br><span class="line"><span class="meta">        method = &quot;updateEmployee&quot;)</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">update</span><span class="params">(Employee employee)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在<code>EmployeeDao</code>接口中使用了动态SQL提供类<code>EmployeeDynaSqlProvider</code>。</p>
<h2 id="EmployeeDynaSqlProvider-java"><a href="#EmployeeDynaSqlProvider-java" class="headerlink" title="EmployeeDynaSqlProvider.java"></a>EmployeeDynaSqlProvider.java</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.fkit.hrm.dao.provider;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.jdbc.SQL;</span><br><span class="line"><span class="keyword">import</span> org.fkit.hrm.domain.Employee;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.fkit.hrm.util.common.HrmConstants.EMPLOYEETABLE;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EmployeeDynaSqlProvider</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 分页动态查询</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">selectWhitParam</span><span class="params">(Map&lt;String, Object&gt; params)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SQL</span>()</span><br><span class="line">        &#123;</span><br><span class="line">            &#123;</span><br><span class="line">                SELECT(<span class="string">&quot;*&quot;</span>);</span><br><span class="line">                FROM(EMPLOYEETABLE);</span><br><span class="line">                <span class="keyword">if</span> (params.get(<span class="string">&quot;employee&quot;</span>) != <span class="literal">null</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="type">Employee</span> <span class="variable">employee</span> <span class="operator">=</span> (Employee) params.get(<span class="string">&quot;employee&quot;</span>);</span><br><span class="line">                    <span class="keyword">if</span> (employee.getDept() != <span class="literal">null</span></span><br><span class="line">                            &amp;&amp; employee.getDept().getId() != <span class="literal">null</span></span><br><span class="line">                            &amp;&amp; employee.getDept().getId() != <span class="number">0</span>)</span><br><span class="line">                    &#123;</span><br><span class="line">                        WHERE(<span class="string">&quot; DEPT_ID = #&#123;employee.dept.id&#125; &quot;</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">if</span> (employee.getJob() != <span class="literal">null</span></span><br><span class="line">                            &amp;&amp; employee.getJob().getId() != <span class="literal">null</span></span><br><span class="line">                            &amp;&amp; employee.getJob().getId() != <span class="number">0</span>)</span><br><span class="line">                    &#123;</span><br><span class="line">                        WHERE(<span class="string">&quot; JOB_ID = #&#123;employee.job.id&#125; &quot;</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">if</span> (employee.getName() != <span class="literal">null</span></span><br><span class="line">                            &amp;&amp; !employee.getName().equals(<span class="string">&quot;&quot;</span>))</span><br><span class="line">                    &#123;</span><br><span class="line">                        WHERE(<span class="string">&quot;  NAME LIKE CONCAT (&#x27;%&#x27;,#&#123;employee.name&#125;,&#x27;%&#x27;) &quot;</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">if</span> (employee.getPhone() != <span class="literal">null</span></span><br><span class="line">                            &amp;&amp; !employee.getPhone().equals(<span class="string">&quot;&quot;</span>))</span><br><span class="line">                    &#123;</span><br><span class="line">                        WHERE(<span class="string">&quot; phone LIKE CONCAT (&#x27;%&#x27;,#&#123;employee.phone&#125;,&#x27;%&#x27;) &quot;</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">if</span> (employee.getCardId() != <span class="literal">null</span></span><br><span class="line">                            &amp;&amp; !employee.getCardId().equals(<span class="string">&quot;&quot;</span>))</span><br><span class="line">                    &#123;</span><br><span class="line">                        WHERE(<span class="string">&quot; card_id LIKE CONCAT (&#x27;%&#x27;,#&#123;employee.cardId&#125;,&#x27;%&#x27;) &quot;</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">if</span> (employee.getSex() != <span class="literal">null</span> &amp;&amp; employee.getSex() != <span class="number">0</span>)</span><br><span class="line">                    &#123;</span><br><span class="line">                        WHERE(<span class="string">&quot;sex = #&#123;employee.sex&#125;&quot;</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;.toString();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (params.get(<span class="string">&quot;pageModel&quot;</span>) != <span class="literal">null</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            sql += <span class="string">&quot; limit #&#123;pageModel.firstLimitParam&#125; , #&#123;pageModel.pageSize&#125;  &quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> sql;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 动态查询总数量</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">count</span><span class="params">(Map&lt;String, Object&gt; params)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">SQL</span>()</span><br><span class="line">        &#123;</span><br><span class="line">            &#123;</span><br><span class="line">                SELECT(<span class="string">&quot;count(*)&quot;</span>);</span><br><span class="line">                FROM(EMPLOYEETABLE);</span><br><span class="line">                <span class="keyword">if</span> (params.get(<span class="string">&quot;employee&quot;</span>) != <span class="literal">null</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="type">Employee</span> <span class="variable">employee</span> <span class="operator">=</span> (Employee) params.get(<span class="string">&quot;employee&quot;</span>);</span><br><span class="line">                    <span class="keyword">if</span> (employee.getDept() != <span class="literal">null</span></span><br><span class="line">                            &amp;&amp; employee.getDept().getId() != <span class="literal">null</span></span><br><span class="line">                            &amp;&amp; employee.getDept().getId() != <span class="number">0</span>)</span><br><span class="line">                    &#123;</span><br><span class="line">                        WHERE(<span class="string">&quot; DEPT_ID = #&#123;employee.dept.id&#125; &quot;</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">if</span> (employee.getJob() != <span class="literal">null</span></span><br><span class="line">                            &amp;&amp; employee.getJob().getId() != <span class="literal">null</span></span><br><span class="line">                            &amp;&amp; employee.getJob().getId() != <span class="number">0</span>)</span><br><span class="line">                    &#123;</span><br><span class="line">                        WHERE(<span class="string">&quot; JOB_ID = #&#123;employee.job.id&#125; &quot;</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">if</span> (employee.getName() != <span class="literal">null</span></span><br><span class="line">                            &amp;&amp; !employee.getName().equals(<span class="string">&quot;&quot;</span>))</span><br><span class="line">                    &#123;</span><br><span class="line">                        WHERE(<span class="string">&quot;  NAME LIKE CONCAT (&#x27;%&#x27;,#&#123;employee.name&#125;,&#x27;%&#x27;) &quot;</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">if</span> (employee.getPhone() != <span class="literal">null</span></span><br><span class="line">                            &amp;&amp; !employee.getPhone().equals(<span class="string">&quot;&quot;</span>))</span><br><span class="line">                    &#123;</span><br><span class="line">                        WHERE(<span class="string">&quot; phone LIKE CONCAT (&#x27;%&#x27;,#&#123;employee.phone&#125;,&#x27;%&#x27;) &quot;</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">if</span> (employee.getCardId() != <span class="literal">null</span></span><br><span class="line">                            &amp;&amp; !employee.getCardId().equals(<span class="string">&quot;&quot;</span>))</span><br><span class="line">                    &#123;</span><br><span class="line">                        WHERE(<span class="string">&quot; card_id LIKE CONCAT (&#x27;%&#x27;,#&#123;employee.cardId&#125;,&#x27;%&#x27;) &quot;</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">if</span> (employee.getSex() != <span class="literal">null</span> &amp;&amp; employee.getSex() != <span class="number">0</span>)</span><br><span class="line">                    &#123;</span><br><span class="line">                        WHERE(<span class="string">&quot;sex = #&#123;employee.sex&#125;&quot;</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;.toString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 动态插入</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">insertEmployee</span><span class="params">(Employee employee)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">SQL</span>()</span><br><span class="line">        &#123;</span><br><span class="line">            &#123;</span><br><span class="line">                INSERT_INTO(EMPLOYEETABLE);</span><br><span class="line">                <span class="keyword">if</span> (employee.getName() != <span class="literal">null</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    VALUES(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;#&#123;name&#125;&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (employee.getCardId() != <span class="literal">null</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    VALUES(<span class="string">&quot;card_id&quot;</span>, <span class="string">&quot;#&#123;cardId&#125;&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (employee.getAddress() != <span class="literal">null</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    VALUES(<span class="string">&quot;address&quot;</span>, <span class="string">&quot;#&#123;address&#125;&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (employee.getPostCode() != <span class="literal">null</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    VALUES(<span class="string">&quot;post_code&quot;</span>, <span class="string">&quot;#&#123;postCode&#125;&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (employee.getTel() != <span class="literal">null</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    VALUES(<span class="string">&quot;tel&quot;</span>, <span class="string">&quot;#&#123;tel&#125;&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (employee.getPhone() != <span class="literal">null</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    VALUES(<span class="string">&quot;phone&quot;</span>, <span class="string">&quot;#&#123;phone&#125;&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (employee.getQqNum() != <span class="literal">null</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    VALUES(<span class="string">&quot;qq_num&quot;</span>, <span class="string">&quot;#&#123;qqNum&#125;&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (employee.getEmail() != <span class="literal">null</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    VALUES(<span class="string">&quot;email&quot;</span>, <span class="string">&quot;#&#123;email&#125;&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (employee.getSex() != <span class="literal">null</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    VALUES(<span class="string">&quot;sex&quot;</span>, <span class="string">&quot;#&#123;sex&#125;&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (employee.getParty() != <span class="literal">null</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    VALUES(<span class="string">&quot;party&quot;</span>, <span class="string">&quot;#&#123;party&#125;&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (employee.getBirthday() != <span class="literal">null</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    VALUES(<span class="string">&quot;birthday&quot;</span>, <span class="string">&quot;#&#123;birthday&#125;&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (employee.getRace() != <span class="literal">null</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    VALUES(<span class="string">&quot;race&quot;</span>, <span class="string">&quot;#&#123;race&#125;&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (employee.getEducation() != <span class="literal">null</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    VALUES(<span class="string">&quot;education&quot;</span>, <span class="string">&quot;#&#123;education&#125;&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (employee.getSpeciality() != <span class="literal">null</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    VALUES(<span class="string">&quot;speciality&quot;</span>, <span class="string">&quot;#&#123;speciality&#125;&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (employee.getHobby() != <span class="literal">null</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    VALUES(<span class="string">&quot;hobby&quot;</span>, <span class="string">&quot;#&#123;hobby&#125;&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (employee.getRemark() != <span class="literal">null</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    VALUES(<span class="string">&quot;remark&quot;</span>, <span class="string">&quot;#&#123;remark&#125;&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (employee.getCreateDate() != <span class="literal">null</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    VALUES(<span class="string">&quot;create_Date&quot;</span>, <span class="string">&quot;#&#123;createDate&#125;&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (employee.getDept() != <span class="literal">null</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    VALUES(<span class="string">&quot;dept_id&quot;</span>, <span class="string">&quot;#&#123;dept.id&#125;&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (employee.getJob() != <span class="literal">null</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    VALUES(<span class="string">&quot;job_id&quot;</span>, <span class="string">&quot;#&#123;job.id&#125;&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;.toString();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 动态更新</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">updateEmployee</span><span class="params">(Employee employee)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">SQL</span>()</span><br><span class="line">        &#123;</span><br><span class="line">            &#123;</span><br><span class="line">                UPDATE(EMPLOYEETABLE);</span><br><span class="line">                <span class="keyword">if</span> (employee.getName() != <span class="literal">null</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    SET(<span class="string">&quot; name = #&#123;name&#125; &quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (employee.getCardId() != <span class="literal">null</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    SET(<span class="string">&quot; card_id = #&#123;cardId&#125; &quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (employee.getAddress() != <span class="literal">null</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    SET(<span class="string">&quot; address = #&#123;address&#125; &quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (employee.getPostCode() != <span class="literal">null</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    SET(<span class="string">&quot; post_code = #&#123;postCode&#125; &quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (employee.getTel() != <span class="literal">null</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    SET(<span class="string">&quot; tel = #&#123;tel&#125; &quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (employee.getPhone() != <span class="literal">null</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    SET(<span class="string">&quot; phone = #&#123;phone&#125; &quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (employee.getQqNum() != <span class="literal">null</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    SET(<span class="string">&quot; qq_num = #&#123;qqNum&#125; &quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (employee.getEmail() != <span class="literal">null</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    SET(<span class="string">&quot; email = #&#123;email&#125; &quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (employee.getSex() != <span class="literal">null</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    SET(<span class="string">&quot; sex = #&#123;sex&#125; &quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (employee.getParty() != <span class="literal">null</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    SET(<span class="string">&quot; party = #&#123;party&#125; &quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (employee.getBirthday() != <span class="literal">null</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    SET(<span class="string">&quot; birthday = #&#123;birthday&#125; &quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (employee.getRace() != <span class="literal">null</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    SET(<span class="string">&quot; race = #&#123;race&#125; &quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (employee.getEducation() != <span class="literal">null</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    SET(<span class="string">&quot; education = #&#123;education&#125; &quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (employee.getSpeciality() != <span class="literal">null</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    SET(<span class="string">&quot; speciality = #&#123;speciality&#125; &quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (employee.getHobby() != <span class="literal">null</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    SET(<span class="string">&quot; hobby = #&#123;hobby&#125; &quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (employee.getRemark() != <span class="literal">null</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    SET(<span class="string">&quot; remark = #&#123;remark&#125; &quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (employee.getCreateDate() != <span class="literal">null</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    SET(<span class="string">&quot; create_Date = #&#123;createDate&#125; &quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (employee.getDept() != <span class="literal">null</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    SET(<span class="string">&quot; dept_id = #&#123;dept.id&#125; &quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (employee.getJob() != <span class="literal">null</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    SET(<span class="string">&quot; job_id = #&#123;job.id&#125; &quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                WHERE(<span class="string">&quot; id = #&#123;id&#125; &quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;.toString();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="NoticeDao接口"><a href="#NoticeDao接口" class="headerlink" title="NoticeDao接口"></a>NoticeDao接口</h2><p>下面是<code>NoticeDao</code>接口的源代码。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.fkit.hrm.dao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.*;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.mapping.FetchType;</span><br><span class="line"><span class="keyword">import</span> org.fkit.hrm.dao.provider.NoticeDynaSqlProvider;</span><br><span class="line"><span class="keyword">import</span> org.fkit.hrm.domain.Notice;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.fkit.hrm.util.common.HrmConstants.NOTICETABLE;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">NoticeDao</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 动态查询</span></span><br><span class="line">    <span class="meta">@SelectProvider(</span></span><br><span class="line"><span class="meta">        type = NoticeDynaSqlProvider.class,</span></span><br><span class="line"><span class="meta">        method = &quot;selectWhitParam&quot;</span></span><br><span class="line"><span class="meta">    )</span></span><br><span class="line">    <span class="meta">@Results(&#123;</span></span><br><span class="line"><span class="meta">        @Result(</span></span><br><span class="line"><span class="meta">            id = true,</span></span><br><span class="line"><span class="meta">            column = &quot;id&quot;,</span></span><br><span class="line"><span class="meta">            property = &quot;id&quot;),</span></span><br><span class="line"><span class="meta">        @Result(</span></span><br><span class="line"><span class="meta">            column = &quot;CREATE_DATE&quot;,</span></span><br><span class="line"><span class="meta">            property = &quot;createDate&quot;,</span></span><br><span class="line"><span class="meta">            javaType = java.util.Date.class),</span></span><br><span class="line"><span class="meta">        @Result(</span></span><br><span class="line"><span class="meta">            column = &quot;USER_ID&quot;,</span></span><br><span class="line"><span class="meta">            property = &quot;user&quot;,</span></span><br><span class="line"><span class="meta">            one = @One(</span></span><br><span class="line"><span class="meta">                select = &quot;org.fkit.hrm.dao.UserDao.selectById&quot;,</span></span><br><span class="line"><span class="meta">                fetchType = FetchType.EAGER)</span></span><br><span class="line"><span class="meta">        )</span></span><br><span class="line"><span class="meta">     &#125;)</span></span><br><span class="line">    List&lt;Notice&gt; <span class="title function_">selectByPage</span><span class="params">(Map&lt;String, Object&gt; params)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SelectProvider(</span></span><br><span class="line"><span class="meta">        type = NoticeDynaSqlProvider.class,</span></span><br><span class="line"><span class="meta">        method = &quot;count&quot;)</span></span><br><span class="line">    Integer <span class="title function_">count</span><span class="params">(Map&lt;String, Object&gt; params)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Select(&quot;select * from &quot; + NOTICETABLE + &quot; where ID = #&#123;id&#125;&quot;)</span></span><br><span class="line">    Notice <span class="title function_">selectById</span><span class="params">(<span class="type">int</span> id)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 根据id删除公告</span></span><br><span class="line">    <span class="meta">@Delete(&quot; delete from &quot; + NOTICETABLE + &quot; where id = #&#123;id&#125; &quot;)</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">deleteById</span><span class="params">(Integer id)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 动态插入公告</span></span><br><span class="line">    <span class="meta">@SelectProvider(</span></span><br><span class="line"><span class="meta">        type = NoticeDynaSqlProvider.class,</span></span><br><span class="line"><span class="meta">        method = &quot;insertNotice&quot;)</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">save</span><span class="params">(Notice notice)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 动态修改公告</span></span><br><span class="line">    <span class="meta">@SelectProvider(</span></span><br><span class="line"><span class="meta">        type = NoticeDynaSqlProvider.class,</span></span><br><span class="line"><span class="meta">        method = &quot;updateNotice&quot;)</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">update</span><span class="params">(Notice notice)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在<code>Noticedao</code>接口中使用了动态<code>SQL</code>提供类<code>NoticeDynaSqlProvider</code>：</p>
<h2 id="NoticeDynaSqlProvider-java"><a href="#NoticeDynaSqlProvider-java" class="headerlink" title="NoticeDynaSqlProvider.java"></a>NoticeDynaSqlProvider.java</h2><p>下面是<code>DocumentDao</code>接口的源代码。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.fkit.hrm.dao.provider;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.jdbc.SQL;</span><br><span class="line"><span class="keyword">import</span> org.fkit.hrm.domain.Notice;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.fkit.hrm.util.common.HrmConstants.NOTICETABLE;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">NoticeDynaSqlProvider</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 分页动态查询</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">selectWhitParam</span><span class="params">(Map&lt;String, Object&gt; params)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SQL</span>()</span><br><span class="line">        &#123;</span><br><span class="line">            &#123;</span><br><span class="line">                SELECT(<span class="string">&quot;*&quot;</span>);</span><br><span class="line">                FROM(NOTICETABLE);</span><br><span class="line">                <span class="keyword">if</span> (params.get(<span class="string">&quot;notice&quot;</span>) != <span class="literal">null</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="type">Notice</span> <span class="variable">notice</span> <span class="operator">=</span> (Notice) params.get(<span class="string">&quot;notice&quot;</span>);</span><br><span class="line">                    <span class="keyword">if</span> (notice.getTitle() != <span class="literal">null</span></span><br><span class="line">                            &amp;&amp; !notice.getTitle().equals(<span class="string">&quot;&quot;</span>))</span><br><span class="line">                    &#123;</span><br><span class="line">                        WHERE(<span class="string">&quot;  title LIKE CONCAT (&#x27;%&#x27;,#&#123;notice.title&#125;,&#x27;%&#x27;) &quot;</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">if</span> (notice.getContent() != <span class="literal">null</span></span><br><span class="line">                            &amp;&amp; !notice.getContent().equals(<span class="string">&quot;&quot;</span>))</span><br><span class="line">                    &#123;</span><br><span class="line">                        WHERE(<span class="string">&quot;  content LIKE CONCAT (&#x27;%&#x27;,#&#123;notice.content&#125;,&#x27;%&#x27;) &quot;</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;.toString();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (params.get(<span class="string">&quot;pageModel&quot;</span>) != <span class="literal">null</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            sql += <span class="string">&quot; limit #&#123;pageModel.firstLimitParam&#125; , #&#123;pageModel.pageSize&#125;  &quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> sql;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 动态查询总数量</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">count</span><span class="params">(Map&lt;String, Object&gt; params)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">SQL</span>()</span><br><span class="line">        &#123;</span><br><span class="line">            &#123;</span><br><span class="line">                SELECT(<span class="string">&quot;count(*)&quot;</span>);</span><br><span class="line">                FROM(NOTICETABLE);</span><br><span class="line">                <span class="keyword">if</span> (params.get(<span class="string">&quot;notice&quot;</span>) != <span class="literal">null</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="type">Notice</span> <span class="variable">notice</span> <span class="operator">=</span> (Notice) params.get(<span class="string">&quot;notice&quot;</span>);</span><br><span class="line">                    <span class="keyword">if</span> (notice.getTitle() != <span class="literal">null</span></span><br><span class="line">                            &amp;&amp; !notice.getTitle().equals(<span class="string">&quot;&quot;</span>))</span><br><span class="line">                    &#123;</span><br><span class="line">                        WHERE(<span class="string">&quot;  title LIKE CONCAT (&#x27;%&#x27;,#&#123;notice.title&#125;,&#x27;%&#x27;) &quot;</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">if</span> (notice.getContent() != <span class="literal">null</span></span><br><span class="line">                            &amp;&amp; !notice.getContent().equals(<span class="string">&quot;&quot;</span>))</span><br><span class="line">                    &#123;</span><br><span class="line">                        WHERE(<span class="string">&quot;  content LIKE CONCAT (&#x27;%&#x27;,#&#123;notice.content&#125;,&#x27;%&#x27;) &quot;</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;.toString();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 动态插入</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">insertNotice</span><span class="params">(Notice notice)</span></span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">SQL</span>()</span><br><span class="line">        &#123;</span><br><span class="line">            &#123;</span><br><span class="line">                INSERT_INTO(NOTICETABLE);</span><br><span class="line">                <span class="keyword">if</span> (notice.getTitle() != <span class="literal">null</span> &amp;&amp; !notice.getTitle().equals(<span class="string">&quot;&quot;</span>))</span><br><span class="line">                &#123;</span><br><span class="line">                    VALUES(<span class="string">&quot;title&quot;</span>, <span class="string">&quot;#&#123;title&#125;&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (notice.getContent() != <span class="literal">null</span></span><br><span class="line">                        &amp;&amp; !notice.getContent().equals(<span class="string">&quot;&quot;</span>))</span><br><span class="line">                &#123;</span><br><span class="line">                    VALUES(<span class="string">&quot;content&quot;</span>, <span class="string">&quot;#&#123;content&#125;&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (notice.getUser() != <span class="literal">null</span></span><br><span class="line">                        &amp;&amp; notice.getUser().getId() != <span class="literal">null</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    VALUES(<span class="string">&quot;user_id&quot;</span>, <span class="string">&quot;#&#123;user.id&#125;&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;.toString();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 动态更新</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">updateNotice</span><span class="params">(Notice notice)</span></span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">SQL</span>()</span><br><span class="line">        &#123;</span><br><span class="line">            &#123;</span><br><span class="line">                UPDATE(NOTICETABLE);</span><br><span class="line">                <span class="keyword">if</span> (notice.getTitle() != <span class="literal">null</span> &amp;&amp; !notice.getTitle().equals(<span class="string">&quot;&quot;</span>))</span><br><span class="line">                &#123;</span><br><span class="line">                    SET(<span class="string">&quot; title = #&#123;title&#125; &quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (notice.getContent() != <span class="literal">null</span></span><br><span class="line">                        &amp;&amp; !notice.getContent().equals(<span class="string">&quot;&quot;</span>))</span><br><span class="line">                &#123;</span><br><span class="line">                    SET(<span class="string">&quot; content = #&#123;content&#125; &quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (notice.getUser() != <span class="literal">null</span></span><br><span class="line">                        &amp;&amp; notice.getUser().getId() != <span class="literal">null</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    SET(<span class="string">&quot; user_id = #&#123;user.id&#125; &quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                WHERE(<span class="string">&quot; id = #&#123;id&#125; &quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;.toString();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="DocumentDao接口"><a href="#DocumentDao接口" class="headerlink" title="DocumentDao接口"></a>DocumentDao接口</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.fkit.hrm.dao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.*;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.mapping.FetchType;</span><br><span class="line"><span class="keyword">import</span> org.fkit.hrm.dao.provider.DocumentDynaSqlProvider;</span><br><span class="line"><span class="keyword">import</span> org.fkit.hrm.domain.Document;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.fkit.hrm.util.common.HrmConstants.DOCUMENTTABLE;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">DocumentDao</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 动态查询</span></span><br><span class="line">    <span class="meta">@SelectProvider(</span></span><br><span class="line"><span class="meta">        type = DocumentDynaSqlProvider.class,</span></span><br><span class="line"><span class="meta">        method = &quot;selectWhitParam&quot;</span></span><br><span class="line"><span class="meta">    )</span></span><br><span class="line">    <span class="meta">@Results(</span></span><br><span class="line"><span class="meta">        &#123;@Result(</span></span><br><span class="line"><span class="meta">            id = true,</span></span><br><span class="line"><span class="meta">            column = &quot;id&quot;,</span></span><br><span class="line"><span class="meta">            property = &quot;id&quot;</span></span><br><span class="line"><span class="meta">        ), @Result(</span></span><br><span class="line"><span class="meta">            column = &quot;CREATE_DATE&quot;,</span></span><br><span class="line"><span class="meta">            property = &quot;createDate&quot;,</span></span><br><span class="line"><span class="meta">            javaType = java.util.Date.class</span></span><br><span class="line"><span class="meta">        ), @Result(</span></span><br><span class="line"><span class="meta">            column = &quot;USER_ID&quot;,</span></span><br><span class="line"><span class="meta">            property = &quot;user&quot;,</span></span><br><span class="line"><span class="meta">            one = @One(</span></span><br><span class="line"><span class="meta">                select = &quot;org.fkit.hrm.dao.UserDao.selectById&quot;,</span></span><br><span class="line"><span class="meta">                fetchType = FetchType.EAGER</span></span><br><span class="line"><span class="meta">            )</span></span><br><span class="line"><span class="meta">        )&#125;</span></span><br><span class="line"><span class="meta">    )</span></span><br><span class="line">    List&lt;Document&gt; <span class="title function_">selectByPage</span><span class="params">(Map&lt;String, Object&gt; params)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SelectProvider(</span></span><br><span class="line"><span class="meta">        type = DocumentDynaSqlProvider.class,</span></span><br><span class="line"><span class="meta">        method = &quot;count&quot;</span></span><br><span class="line"><span class="meta">    )</span></span><br><span class="line">    Integer <span class="title function_">count</span><span class="params">(Map&lt;String, Object&gt; params)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 动态插入文档</span></span><br><span class="line">    <span class="meta">@SelectProvider(</span></span><br><span class="line"><span class="meta">        type = DocumentDynaSqlProvider.class,</span></span><br><span class="line"><span class="meta">        method = &quot;insertDocument&quot;</span></span><br><span class="line"><span class="meta">    )</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">save</span><span class="params">(Document document)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Select(&quot;select * from &quot; + DOCUMENTTABLE + &quot; where ID = #&#123;id&#125;&quot;)</span></span><br><span class="line">    Document <span class="title function_">selectById</span><span class="params">(<span class="type">int</span> id)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 根据id删除文档</span></span><br><span class="line">    <span class="meta">@Delete(&quot; delete from &quot; + DOCUMENTTABLE + &quot; where id = #&#123;id&#125; &quot;)</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">deleteById</span><span class="params">(Integer id)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 动态修改文档</span></span><br><span class="line">    <span class="meta">@SelectProvider(</span></span><br><span class="line"><span class="meta">        type = DocumentDynaSqlProvider.class,</span></span><br><span class="line"><span class="meta">        method = &quot;updateDocument&quot;</span></span><br><span class="line"><span class="meta">    )</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">update</span><span class="params">(Document document)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在<code>DocumentDao</code>接口中使用了动态SQL提供类<code>DocumentDynaSqlProvider</code></p>
<h2 id="DocumentDynaSqlProvider-java"><a href="#DocumentDynaSqlProvider-java" class="headerlink" title="DocumentDynaSqlProvider.java"></a>DocumentDynaSqlProvider.java</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.fkit.hrm.dao.provider;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.jdbc.SQL;</span><br><span class="line"><span class="keyword">import</span> org.fkit.hrm.domain.Document;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.fkit.hrm.util.common.HrmConstants.DOCUMENTTABLE;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DocumentDynaSqlProvider</span>&#123;</span><br><span class="line">    <span class="comment">// 分页动态查询</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">selectWhitParam</span><span class="params">(Map&lt;String, Object&gt; params)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SQL</span>()&#123;</span><br><span class="line">            &#123;</span><br><span class="line">                SELECT(<span class="string">&quot;*&quot;</span>);</span><br><span class="line">                FROM(DOCUMENTTABLE);</span><br><span class="line">                <span class="keyword">if</span>(params.get(<span class="string">&quot;document&quot;</span>) != <span class="literal">null</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="type">Document</span> <span class="variable">document</span> <span class="operator">=</span> (Document) params.get(<span class="string">&quot;document&quot;</span>);</span><br><span class="line">                    <span class="keyword">if</span>(document.getTitle() != <span class="literal">null</span> &amp;&amp; !document.getTitle().equals(<span class="string">&quot;&quot;</span>))</span><br><span class="line">                    &#123;</span><br><span class="line">                        WHERE(<span class="string">&quot;  title LIKE CONCAT (&#x27;%&#x27;,#&#123;document.title&#125;,&#x27;%&#x27;) &quot;</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;.toString();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(params.get(<span class="string">&quot;pageModel&quot;</span>) != <span class="literal">null</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            sql += <span class="string">&quot; limit #&#123;pageModel.firstLimitParam&#125; , #&#123;pageModel.pageSize&#125;  &quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> sql;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 动态查询总数量</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">count</span><span class="params">(Map&lt;String, Object&gt; params)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">SQL</span>()&#123;</span><br><span class="line">            &#123;</span><br><span class="line">                SELECT(<span class="string">&quot;count(*)&quot;</span>);</span><br><span class="line">                FROM(DOCUMENTTABLE);</span><br><span class="line">                <span class="keyword">if</span>(params.get(<span class="string">&quot;document&quot;</span>) != <span class="literal">null</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="type">Document</span> <span class="variable">document</span> <span class="operator">=</span> (Document) params.get(<span class="string">&quot;document&quot;</span>);</span><br><span class="line">                    <span class="keyword">if</span>(document.getTitle() != <span class="literal">null</span> &amp;&amp; !document.getTitle().equals(<span class="string">&quot;&quot;</span>))</span><br><span class="line">                    &#123;</span><br><span class="line">                        WHERE(<span class="string">&quot;  title LIKE CONCAT (&#x27;%&#x27;,#&#123;document.title&#125;,&#x27;%&#x27;) &quot;</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;.toString();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 动态插入</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">insertDocument</span><span class="params">(Document document)</span></span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">SQL</span>()&#123;</span><br><span class="line">            &#123;</span><br><span class="line">                INSERT_INTO(DOCUMENTTABLE);</span><br><span class="line">                <span class="keyword">if</span>(document.getTitle() != <span class="literal">null</span> &amp;&amp; !document.getTitle().equals(<span class="string">&quot;&quot;</span>))</span><br><span class="line">                &#123;</span><br><span class="line">                    VALUES(<span class="string">&quot;title&quot;</span>, <span class="string">&quot;#&#123;title&#125;&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span>(document.getFileName() != <span class="literal">null</span> &amp;&amp; !document.getFileName().equals(<span class="string">&quot;&quot;</span>))</span><br><span class="line">                &#123;</span><br><span class="line">                    VALUES(<span class="string">&quot;filename&quot;</span>, <span class="string">&quot;#&#123;fileName&#125;&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span>(document.getRemark() != <span class="literal">null</span> &amp;&amp; !document.getRemark().equals(<span class="string">&quot;&quot;</span>))</span><br><span class="line">                &#123;</span><br><span class="line">                    VALUES(<span class="string">&quot;remark&quot;</span>, <span class="string">&quot;#&#123;remark&#125;&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span>(document.getUser() != <span class="literal">null</span> &amp;&amp; document.getUser().getId() != <span class="literal">null</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    VALUES(<span class="string">&quot;user_id&quot;</span>, <span class="string">&quot;#&#123;user.id&#125;&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;.toString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 动态更新</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">updateDocument</span><span class="params">(Document document)</span></span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">SQL</span>()&#123;</span><br><span class="line">            &#123;</span><br><span class="line">                UPDATE(DOCUMENTTABLE);</span><br><span class="line">                <span class="keyword">if</span>(document.getTitle() != <span class="literal">null</span> &amp;&amp; !document.getTitle().equals(<span class="string">&quot;&quot;</span>))</span><br><span class="line">                &#123;</span><br><span class="line">                    SET(<span class="string">&quot; title = #&#123;title&#125; &quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span>(document.getFileName() != <span class="literal">null</span> &amp;&amp; !document.getFileName().equals(<span class="string">&quot;&quot;</span>))</span><br><span class="line">                &#123;</span><br><span class="line">                    SET(<span class="string">&quot; filename = #&#123;fileName&#125; &quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span>(document.getRemark() != <span class="literal">null</span> &amp;&amp; !document.getRemark().equals(<span class="string">&quot;&quot;</span>))</span><br><span class="line">                &#123;</span><br><span class="line">                    SET(<span class="string">&quot;remark = #&#123;remark&#125;&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span>(document.getUser() != <span class="literal">null</span> &amp;&amp; document.getUser().getId() != <span class="literal">null</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    SET(<span class="string">&quot;user_id = #&#123;user.id&#125;&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                WHERE(<span class="string">&quot; id = #&#123;id&#125; &quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;.toString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://lanlan2017.github.io/JavaReadingNotes/f23fe08c/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/JavaReadingNotes/images/avatar.gif">
      <meta itemprop="name" content="蓝蓝">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="蓝蓝站点">
      <meta itemprop="description" content="好好学习，天天向上">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 蓝蓝站点">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/JavaReadingNotes/f23fe08c/" class="post-title-link" itemprop="url">2.15 本章小结</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2020-06-21 06:44:55 / 修改时间：06:47:38" itemprop="dateCreated datePublished" datetime="2020-06-21T06:44:55+08:00">2020-06-21</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/2-%E8%BD%BB%E9%87%8F%E7%BA%A7Java-EE%E4%BC%81%E4%B8%9A%E5%BA%94%E7%94%A8%E5%AE%9E%E6%88%98-%E7%AC%AC5%E7%89%88/" itemprop="url" rel="index"><span itemprop="name">2 轻量级Java EE企业应用实战(第5版)</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/2-%E8%BD%BB%E9%87%8F%E7%BA%A7Java-EE%E4%BC%81%E4%B8%9A%E5%BA%94%E7%94%A8%E5%AE%9E%E6%88%98-%E7%AC%AC5%E7%89%88/%E7%AC%AC2%E7%AB%A0-JSP-Servlet%E5%8F%8A%E7%9B%B8%E5%85%B3%E6%8A%80%E6%9C%AF%E8%AF%A6%E8%A7%A3/" itemprop="url" rel="index"><span itemprop="name">第2章 JSP Servlet及相关技术详解</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/2-%E8%BD%BB%E9%87%8F%E7%BA%A7Java-EE%E4%BC%81%E4%B8%9A%E5%BA%94%E7%94%A8%E5%AE%9E%E6%88%98-%E7%AC%AC5%E7%89%88/%E7%AC%AC2%E7%AB%A0-JSP-Servlet%E5%8F%8A%E7%9B%B8%E5%85%B3%E6%8A%80%E6%9C%AF%E8%AF%A6%E8%A7%A3/2-15-%E6%9C%AC%E7%AB%A0%E5%B0%8F%E7%BB%93/" itemprop="url" rel="index"><span itemprop="name">2.15 本章小结</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
    <span class="post-meta-item-icon">
      <i class="far fa-comment"></i>
    </span>
    <span class="post-meta-item-text">Waline：</span>
  
    <a title="waline" href="/JavaReadingNotes/f23fe08c/#waline-comments" itemprop="discussionUrl">
      <span class="post-comments-count waline-comment-count" id="/JavaReadingNotes/f23fe08c/" data-xid="/JavaReadingNotes/f23fe08c/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>488</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>1 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="2-15-本章小结"><a href="#2-15-本章小结" class="headerlink" title="2.15 本章小结"></a>2.15 本章小结</h1><ul>
<li>本章系统介绍了<code>JavaWeb</code>编程的相关知识:<code>JSP</code>、<code>Servlet</code>、<code>Listener</code>、<code>Filter</code>等。</li>
<li>本章覆盖了<code>JSP</code>所有知识点,包括<code>JSP</code>的3个编译指令、7个动作指令、9个内置对象。</li>
<li>详细介绍了<code>JavaWeb</code>编程所涉及的<code>Servlet</code>、<code>Listener</code>和<code>Filter</code>的使用。</li>
<li>还详细介绍了<code>JSP2</code>自定义标签库开发步骤及标签库的用法,包括简单标签、带属性标签和迭代器标签等。</li>
<li>本章也全面讲解了<code>JSP2</code>所攴持的配置<code>JSP</code>属性、表达式语言和<code>TagFile</code>标签支持等内容。</li>
<li>除此之外,还重点介绍了<code>Servlet3</code>新规范带来的巨大改变:<code>Servlet</code>、<code>Listener</code>、<code>Filter</code>不需要通过<code>web.xml</code>进行配置,只需通过注解修饰即可。</li>
<li><code>Servlet3</code>带来的<code>web</code>模块支持、改进的<code>ServletApi</code>都给<code>web</code>开发带来很大方便,值得掌握。</li>
<li>本书最后还介绍了<code>Servlet3.1</code>的非阻塞<code>IO</code>支持和<code>Tomcat8.5</code>提供的<code>WebSocket</code>,尤其是<code>WebSocket</code>,必将在未来的<code>Web</code>开发中大放异彩</li>
<li>本章内容是轻量级<code>Java EE</code>和经典<code>Java EE</code>都需要的表现层技术,因此非常重要。</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://lanlan2017.github.io/JavaReadingNotes/c5f258e0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/JavaReadingNotes/images/avatar.gif">
      <meta itemprop="name" content="蓝蓝">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="蓝蓝站点">
      <meta itemprop="description" content="好好学习，天天向上">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 蓝蓝站点">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/JavaReadingNotes/c5f258e0/" class="post-title-link" itemprop="url">2.14 Tomcat8.5的WebSocket支持</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2020-06-21 05:39:26 / 修改时间：06:47:38" itemprop="dateCreated datePublished" datetime="2020-06-21T05:39:26+08:00">2020-06-21</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/2-%E8%BD%BB%E9%87%8F%E7%BA%A7Java-EE%E4%BC%81%E4%B8%9A%E5%BA%94%E7%94%A8%E5%AE%9E%E6%88%98-%E7%AC%AC5%E7%89%88/" itemprop="url" rel="index"><span itemprop="name">2 轻量级Java EE企业应用实战(第5版)</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/2-%E8%BD%BB%E9%87%8F%E7%BA%A7Java-EE%E4%BC%81%E4%B8%9A%E5%BA%94%E7%94%A8%E5%AE%9E%E6%88%98-%E7%AC%AC5%E7%89%88/%E7%AC%AC2%E7%AB%A0-JSP-Servlet%E5%8F%8A%E7%9B%B8%E5%85%B3%E6%8A%80%E6%9C%AF%E8%AF%A6%E8%A7%A3/" itemprop="url" rel="index"><span itemprop="name">第2章 JSP Servlet及相关技术详解</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/2-%E8%BD%BB%E9%87%8F%E7%BA%A7Java-EE%E4%BC%81%E4%B8%9A%E5%BA%94%E7%94%A8%E5%AE%9E%E6%88%98-%E7%AC%AC5%E7%89%88/%E7%AC%AC2%E7%AB%A0-JSP-Servlet%E5%8F%8A%E7%9B%B8%E5%85%B3%E6%8A%80%E6%9C%AF%E8%AF%A6%E8%A7%A3/2-14-Tomcat8-5%E7%9A%84WebSocket%E6%94%AF%E6%8C%81/" itemprop="url" rel="index"><span itemprop="name">2.14 Tomcat8.5的WebSocket支持</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
    <span class="post-meta-item-icon">
      <i class="far fa-comment"></i>
    </span>
    <span class="post-meta-item-text">Waline：</span>
  
    <a title="waline" href="/JavaReadingNotes/c5f258e0/#waline-comments" itemprop="discussionUrl">
      <span class="post-comments-count waline-comment-count" id="/JavaReadingNotes/c5f258e0/" data-xid="/JavaReadingNotes/c5f258e0/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>7.3k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>7 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="2-14-Tomcat8-5的WebSocket支持"><a href="#2-14-Tomcat8-5的WebSocket支持" class="headerlink" title="2.14 Tomcat8.5的WebSocket支持"></a>2.14 Tomcat8.5的WebSocket支持</h1><p>严格来说,<code>WebSocket</code>并不属于<code>JavaWeb</code>相关规范,<code>WebSocket</code>属于<code>HTML5</code>规范的一部分,<code>WebSocket</code>允许通过<code>JavaScript</code>建立与远程服务器的连接,从而允许远程服务器将数据推送给浏览器。<br>通过使用<code>WebSocket</code>,可以构建出实时性要求比较高的应用,比如<strong>在线游戏</strong>、<strong>在线证券</strong>、<strong>设备监控</strong>、<strong>新闻在线播报</strong>等,只要服务器端有了新数据,<strong>服务端就可以直接将数据推送给浏览器,让浏览器显示最新的状态</strong>。<br><code>WebSocket</code>规范已经相当成熟,而且各种主流浏览器(如<code>Firefox</code>、<code>Chrome</code>、<code>Safari</code>、<code>Opera</code>等)都已经支持<code>WebSocket</code>技术,<code>Java EE</code>规范则提供了<code>WebSocket</code>服务端规范,而<code>Tomcat8.5</code>则对该规范提供了优秀的实现。</p>
<h2 id="开发WebSocket服务端的方式"><a href="#开发WebSocket服务端的方式" class="headerlink" title="开发WebSocket服务端的方式"></a>开发WebSocket服务端的方式</h2><p>使用<code>Tomcat8.5</code>开发<code>WebSocket</code>服务端非常简单,大致有如下两种方式:</p>
<ul>
<li>使用注解方式开发,被<code>@ServerEndpoint</code>修饰的<code>Java</code>类即可作为<code>WebSocket</code>服务端。</li>
<li>继承<code>Endpoint</code>基类实现<code>WebSocket</code>服务端</li>
</ul>
<p>由于使用注解方式开发不仅开发简单,而且是目前的主流方式,因此本书将介绍使用注解方式进行开发。<br>与开发<code>Servlet</code>一样,<code>Servlet</code>并不需要处理底层并发、网络通信等通用的底层细节——因为<code>Servlet</code>处于<code>Web</code>服务器中运行,<code>Web</code>服务器为<code>Servlet</code>处理了底层的并发、网络通信等;开发<code>WebSocket</code>服务端同样需要位于<code>web</code>服务器中运行,因此此处开发的<code>WebSocket</code>同样无须处理并发、网络通信等细节。<br>开发被<code>@ServerEndpoint</code>修饰的<code>Java</code>类之后,该类中还可以定义如下方法:</p>
<ul>
<li>被<code>@OnOpen</code>修饰的方法:当客户端与该<code>WebSocket</code>服务端建立连接时激发该方法。</li>
<li>被<code>@OnClose</code>修饰的方法:当客户端与该<code>WebSocket</code>服务端断开连接时激发该方法</li>
<li>被<code>@OnMessage</code>修饰的方法:当<code>WebSocket</code>服务端收到客户端消息时激发该方法。</li>
<li>被<code>@OnError</code>修饰的方法:当客户端与该<code>WebSocket</code>服务端连接出现错误时激发该方法。</li>
</ul>
<h1 id="多人实时聊天程序"><a href="#多人实时聊天程序" class="headerlink" title="多人实时聊天程序"></a>多人实时聊天程序</h1><h2 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h2><p>下面将基于<code>WebSocket</code>开发一个多人实时聊天的程序,该程序的思路很简单:</p>
<ul>
<li>在这个程序中,每个客户所用的浏览器都与服务器建立一个<code>WebSocket</code>,从而保持实时连接,这样客户端的浏览器可以随时把数据发送到服务器端;</li>
<li>当服务器收到任何一个浏览器发送来的消息之后,将该消息依次向每个客户端浏览器发送一遍。</li>
</ul>
<p>图2.54显示了基于<code>WebSocket</code>的多人实时聊天示意图<br><img data-src="https://raw.githubusercontent.com/lanlan2017/images/master/LightweightJavaEEEnterpriseApplicationCombat(5thEdition)/Chapter2/2.14/1.png"></p>
<h2 id="步骤"><a href="#步骤" class="headerlink" title="步骤"></a>步骤</h2><p>为了实现图2.54所示的示意图,按如下步骤开发<code>WebSocket</code>服务端程序即可:</p>
<ol>
<li>定义<code>@OnOpen</code>修饰的方法,每当客户端连接进来时激发该方法,程序使用集合保存所有连接进来的客户端。</li>
<li>定义<code>@OnMessage</code>修饰的方法,每当该服务端收到客户端消息时激发该方法,服务端收到消息之后遍历保存客户端的集合,并将消息逐个发给所有客户端。</li>
<li>定义<code>@OnClose</code>修饰的方法,每当客户端断开与该服务端连接时激发该方法,程序将该客户端从集合中删除。</li>
</ol>
<h1 id="程序示例"><a href="#程序示例" class="headerlink" title="程序示例"></a>程序示例</h1><h2 id="项目结构"><a href="#项目结构" class="headerlink" title="项目结构"></a>项目结构</h2><pre>
E:\workspacne_JDK8Tomcat8.5\WebSocket
├─src\
│ └─lee\
│   └─ChatEntpoint.java
└─WebContent\
  ├─chat.html
  ├─META-INF\
  │ └─MANIFEST.MF
  └─WEB-INF\
    ├─lib\
    └─web.xml
</pre>
<h2 id="ChatEntpoint-java"><a href="#ChatEntpoint-java" class="headerlink" title="ChatEntpoint.java"></a>ChatEntpoint.java</h2><p>下面程序就是基于<code>WebSocket</code>实现多人实时聊天的服务器程序。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> lee;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.CopyOnWriteArraySet;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.atomic.AtomicInteger;</span><br><span class="line"><span class="keyword">import</span> javax.websocket.*;</span><br><span class="line"><span class="keyword">import</span> javax.websocket.server.*;</span><br><span class="line"></span><br><span class="line"><span class="meta">@ServerEndpoint(value = &quot;/websocket/chat&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ChatEntpoint</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">GUEST_PREFIX</span> <span class="operator">=</span> <span class="string">&quot;访客&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">AtomicInteger</span> <span class="variable">connectionIds</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AtomicInteger</span>(<span class="number">0</span>);</span><br><span class="line">    <span class="comment">// 定义一个集合，用于保存所有接入的WebSocket客户端</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Set&lt;ChatEntpoint&gt; clientSet = <span class="keyword">new</span> <span class="title class_">CopyOnWriteArraySet</span>&lt;&gt;();</span><br><span class="line">    <span class="comment">// 定义一个成员变量，记录WebSocket客户端的聊天昵称</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String nickname;</span><br><span class="line">    <span class="comment">// 定义一个成员变量，记录与WebSocket之间的会话</span></span><br><span class="line">    <span class="keyword">private</span> Session session;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ChatEntpoint</span><span class="params">()</span> &#123;</span><br><span class="line">        nickname = GUEST_PREFIX + connectionIds.getAndIncrement();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 当客户端连接进来时自动激发该方法</span></span><br><span class="line">    <span class="meta">@OnOpen</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">start</span><span class="params">(Session session)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.session = session;</span><br><span class="line">        <span class="comment">// 将WebSocket客户端会话添加到集合中</span></span><br><span class="line">        clientSet.add(<span class="built_in">this</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> String.format(<span class="string">&quot;【%s %s】&quot;</span>, nickname, <span class="string">&quot;加入了聊天室！&quot;</span>);</span><br><span class="line">        <span class="comment">// 发送消息</span></span><br><span class="line">        broadcast(message);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 当客户端断开连接时自动激发该方法</span></span><br><span class="line">    <span class="meta">@OnClose</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">end</span><span class="params">()</span> &#123;</span><br><span class="line">        clientSet.remove(<span class="built_in">this</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> String.format(<span class="string">&quot;【%s %s】&quot;</span>, nickname, <span class="string">&quot;离开了聊天室！&quot;</span>);</span><br><span class="line">        <span class="comment">// 发送消息</span></span><br><span class="line">        broadcast(message);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 每当收到客户端消息时自动激发该方法</span></span><br><span class="line">    <span class="meta">@OnMessage</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">incoming</span><span class="params">(String message)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">filteredMessage</span> <span class="operator">=</span> String.format(<span class="string">&quot;%s: %s&quot;</span>, nickname, filter(message));</span><br><span class="line">        <span class="comment">// 发送消息</span></span><br><span class="line">        broadcast(filteredMessage);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 当客户端通信出现错误时，激发该方法</span></span><br><span class="line">    <span class="meta">@OnError</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onError</span><span class="params">(Throwable t)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;WebSocket服务端错误 &quot;</span> + t);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 实现广播消息的工具方法</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">broadcast</span><span class="params">(String msg)</span> &#123;</span><br><span class="line">        <span class="comment">// 遍历服务器关联的所有客户端</span></span><br><span class="line">        <span class="keyword">for</span> (ChatEntpoint client : clientSet) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">synchronized</span> (client) &#123;</span><br><span class="line">                    <span class="comment">// 发送消息</span></span><br><span class="line">                    client.session.getBasicRemote().sendText(msg);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;聊天错误，向客户端 &quot;</span> + client + <span class="string">&quot; 发送消息出现错误。&quot;</span>);</span><br><span class="line">                clientSet.remove(client);</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    client.session.close();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (IOException e1) &#123;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> String.format(<span class="string">&quot;【%s %s】&quot;</span>, client.nickname, <span class="string">&quot;已经被断开了连接。&quot;</span>);</span><br><span class="line">                broadcast(message);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 定义一个工具方法，用于对字符串中的HTML字符标签进行转义</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String <span class="title function_">filter</span><span class="params">(String message)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (message == <span class="literal">null</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">char</span> content[] = <span class="keyword">new</span> <span class="title class_">char</span>[message.length()];</span><br><span class="line">        message.getChars(<span class="number">0</span>, message.length(), content, <span class="number">0</span>);</span><br><span class="line">        <span class="type">StringBuilder</span> <span class="variable">result</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>(content.length + <span class="number">50</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; content.length; i++) &#123;</span><br><span class="line">            <span class="comment">// 控制对尖括号等特殊字符进行转义</span></span><br><span class="line">            <span class="keyword">switch</span> (content[i]) &#123;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">&#x27;&lt;&#x27;</span>:</span><br><span class="line">                    result.append(<span class="string">&quot;&amp;lt;&quot;</span>);</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">&#x27;&gt;&#x27;</span>:</span><br><span class="line">                    result.append(<span class="string">&quot;&amp;gt;&quot;</span>);</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">&#x27;&amp;&#x27;</span>:</span><br><span class="line">                    result.append(<span class="string">&quot;&amp;amp;&quot;</span>);</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">&#x27;&quot;&#x27;</span>:</span><br><span class="line">                    result.append(<span class="string">&quot;&amp;quot;&quot;</span>);</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">default</span>:</span><br><span class="line">                    result.append(content[i]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> (result.toString());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上面的<code>ChatEntpoint</code>主要就是实现了<code>@OnOpen</code>、<code>@OnClose</code>、<code>@OnMessage</code>和<code>@OnError</code>这4个注解修饰的方法。<br>需要说明的是,该<code>ChatEntpoint</code>类并不是真正的<code>WebSocket</code>服务端,它只实现了<code>WebSocket</code>服务端的核心功能,<code>Tomcat</code>会调用它的方法作为<code>WebSocket</code>服务端。因此,<code>Tomcat</code>会为每个<code>WebSocket</code>客户端创建一个<code>ChatEntpoint</code>对象,也就是说,有一个<code>WebSocket</code>客户端,程序就有一个<code>ChatEntpoint</code>对象。所以上面程序中<code>clientSet</code>集合保存了多个<code>ChatEntpoint</code>对象,其中每个<code>ChatEndpoint</code>对象对应一个<code>WebSocket</code>客户端。<br>编译<code>ChatEntpoint</code>类,并将生成的<code>class</code>文件放在<code>Web</code>应用的<code>WEB-NF/Classes</code>目录下,该<code>ChatEntpoint</code>即可作为<code>WebSocket</code>服务端使用。<br>上面<code>ChatEntpoint</code>类用到了<code>WebSocket API</code>规范的相关注解,因此读者需要将<code>Tomcat</code>的<code>lib</code>目录下的<code>websocket-api.jar</code>添加到<code>CLASSPATH</code>环境变量下。</p>
<h2 id="chat-html"><a href="#chat-html" class="headerlink" title="chat.html"></a>chat.html</h2><p>接下来使用<code>JavaScript</code>开发<code>WebSocket</code>客户端。此处<code>WebSocket</code>客户端使用一个简单的<code>HTML</code>页面即可</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;author&quot;</span> <span class="attr">content</span>=<span class="string">&quot;Yeeku.H.Lee(CrazyIt.org)&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;Content-Type&quot;</span> <span class="attr">content</span>=<span class="string">&quot;text/html; charset=UTF-8&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span> 使用WebSocket通信 <span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 创建WebSocket对象</span></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">var</span> webSocket = <span class="keyword">new</span> <span class="title class_">WebSocket</span>(<span class="string">&quot;ws://127.0.0.1:8888/WebSocket/websocket/chat&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">var</span> sendMsg = <span class="keyword">function</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="language-javascript">        &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">var</span> inputElement = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;msg&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">            <span class="comment">// 发送消息</span></span></span><br><span class="line"><span class="language-javascript">            webSocket.<span class="title function_">send</span>(inputElement.<span class="property">value</span>);</span></span><br><span class="line"><span class="language-javascript">            <span class="comment">// 清空单行文本框</span></span></span><br><span class="line"><span class="language-javascript">            inputElement.<span class="property">value</span> = <span class="string">&quot;&quot;</span>;</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">var</span> send = <span class="keyword">function</span>(<span class="params">event</span>)</span></span><br><span class="line"><span class="language-javascript">        &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">if</span> (event.<span class="property">keyCode</span> == <span class="number">13</span>)</span></span><br><span class="line"><span class="language-javascript">            &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="title function_">sendMsg</span>();</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;;</span></span><br><span class="line"><span class="language-javascript">        webSocket.<span class="property">onopen</span> = <span class="keyword">function</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="language-javascript">        &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="comment">// 为onmessage事件绑定监听器，接收消息</span></span></span><br><span class="line"><span class="language-javascript">            webSocket.<span class="property">onmessage</span>= <span class="keyword">function</span>(<span class="params">event</span>)</span></span><br><span class="line"><span class="language-javascript">            &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">var</span> show = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;show&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">                <span class="comment">// 接收、并显示消息</span></span></span><br><span class="line"><span class="language-javascript">                show.<span class="property">innerHTML</span> += event.<span class="property">data</span> + <span class="string">&quot;&lt;br/&gt;&quot;</span>;</span></span><br><span class="line"><span class="language-javascript">                show.<span class="property">scrollTop</span> = show.<span class="property">scrollHeight</span>;</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;msg&#x27;</span>).<span class="property">onkeydown</span> = send;</span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;sendBn&#x27;</span>).<span class="property">onclick</span> = sendMsg;</span></span><br><span class="line"><span class="language-javascript">        &#125;;</span></span><br><span class="line"><span class="language-javascript">        webSocket.<span class="property">onclose</span> = <span class="keyword">function</span> (<span class="params"></span>)</span></span><br><span class="line"><span class="language-javascript">        &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;msg&#x27;</span>).<span class="property">onkeydown</span> = <span class="literal">null</span>;</span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;sendBn&#x27;</span>).<span class="property">onclick</span> = <span class="literal">null</span>;</span></span><br><span class="line"><span class="language-javascript">            <span class="title class_">Console</span>.<span class="title function_">log</span>(<span class="string">&#x27;WebSocket已经被关闭。&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">        &#125;;</span></span><br><span class="line"><span class="language-javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;width:600px;height:240px;</span></span></span><br><span class="line"><span class="string"><span class="tag">    overflow-y:auto;border:1px solid #333;&quot;</span> <span class="attr">id</span>=<span class="string">&quot;show&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">size</span>=<span class="string">&quot;80&quot;</span> <span class="attr">id</span>=<span class="string">&quot;msg&quot;</span> <span class="attr">name</span>=<span class="string">&quot;msg&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;输入聊天内容&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">value</span>=<span class="string">&quot;发送&quot;</span> <span class="attr">id</span>=<span class="string">&quot;sendBn&quot;</span> <span class="attr">name</span>=<span class="string">&quot;sendBn&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>上面程序中代码:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> webSocket = <span class="keyword">new</span> <span class="title class_">WebSocket</span>(<span class="string">&quot;ws://127.0.0.1:8888/WebSocket/websocket/chat&quot;</span>);</span><br></pre></td></tr></table></figure>
<p>创建了一个<code>WebSocket</code>对象(<code>WebSocket</code>是<code>HTML5</code>规范新增的类)创建对象时指定<code>WebSocket</code>服务端的地址。一旦程序得到了<code>WebSocket</code>对象,接下来程序即可调用<code>WebSocket</code>的<code>send()</code>方法向服务器发送消息。<br>除此之外,还可以为<code>WebSocket</code>绑定如下三个事件处理函数:</p>
<ul>
<li><code>onopen</code>:当<code>WebSocket</code>客户端与服务端建立连接时自动激发该事件处理函数。</li>
<li><code>onclose</code>:当<code>WebSocket</code>客户端与服务端关闭连接时自动激发该事件处理函数。</li>
<li><code>onmessage</code>:当<code>WebSocket</code>客户端收到服务端消息时自动激发该事件处理函数。</li>
</ul>
<p><code>WebSocket</code>肯定会成为<code>Web</code>应用开发的主流技术,这种技术颠覆了传统<code>Web</code>应用请求响应架构模型,它可以让服务端与浏览器建立实时通信的<code>Socket</code>,因此具有广泛的用途。为了使用<code>WebSocket</code>,还需要<code>JavaScript</code>编程知识,关于<code>JavaScript</code>和<code>WebSocket</code>相关知识,请参考《疯狂HTML5&#x2F;CSS3&#x2F;JavaScript讲义》</p>
<h2 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h2><p>首先启动<code>ChatEntpoint</code>所在的<code>web</code>应用,使用多个浏览器登录<code>chat.html</code>页面聊天即可看到如图2.55所示的聊天效果。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost:8080/WebSocket/chat.html</span><br></pre></td></tr></table></figure>
<p><img data-src="https://raw.githubusercontent.com/lanlan2017/images/master/LightweightJavaEEEnterpriseApplicationCombat(5thEdition)/Chapter2/2.14/2.png"></p>
<!-- LightweightJavaEEEnterpriseApplicationCombat(5thEdition)/Chapter2/2.14/2 -->

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://lanlan2017.github.io/JavaReadingNotes/8dcbd8d1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/JavaReadingNotes/images/avatar.gif">
      <meta itemprop="name" content="蓝蓝">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="蓝蓝站点">
      <meta itemprop="description" content="好好学习，天天向上">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 蓝蓝站点">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/JavaReadingNotes/8dcbd8d1/" class="post-title-link" itemprop="url">2.13 Servlet3.1新增的非阻塞式IO</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2020-06-21 05:16:30 / 修改时间：06:47:38" itemprop="dateCreated datePublished" datetime="2020-06-21T05:16:30+08:00">2020-06-21</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/2-%E8%BD%BB%E9%87%8F%E7%BA%A7Java-EE%E4%BC%81%E4%B8%9A%E5%BA%94%E7%94%A8%E5%AE%9E%E6%88%98-%E7%AC%AC5%E7%89%88/" itemprop="url" rel="index"><span itemprop="name">2 轻量级Java EE企业应用实战(第5版)</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/2-%E8%BD%BB%E9%87%8F%E7%BA%A7Java-EE%E4%BC%81%E4%B8%9A%E5%BA%94%E7%94%A8%E5%AE%9E%E6%88%98-%E7%AC%AC5%E7%89%88/%E7%AC%AC2%E7%AB%A0-JSP-Servlet%E5%8F%8A%E7%9B%B8%E5%85%B3%E6%8A%80%E6%9C%AF%E8%AF%A6%E8%A7%A3/" itemprop="url" rel="index"><span itemprop="name">第2章 JSP Servlet及相关技术详解</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/2-%E8%BD%BB%E9%87%8F%E7%BA%A7Java-EE%E4%BC%81%E4%B8%9A%E5%BA%94%E7%94%A8%E5%AE%9E%E6%88%98-%E7%AC%AC5%E7%89%88/%E7%AC%AC2%E7%AB%A0-JSP-Servlet%E5%8F%8A%E7%9B%B8%E5%85%B3%E6%8A%80%E6%9C%AF%E8%AF%A6%E8%A7%A3/2-13-Servlet3-1%E6%96%B0%E5%A2%9E%E7%9A%84%E9%9D%9E%E9%98%BB%E5%A1%9E%E5%BC%8FIO/" itemprop="url" rel="index"><span itemprop="name">2.13 Servlet3.1新增的非阻塞式IO</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
    <span class="post-meta-item-icon">
      <i class="far fa-comment"></i>
    </span>
    <span class="post-meta-item-text">Waline：</span>
  
    <a title="waline" href="/JavaReadingNotes/8dcbd8d1/#waline-comments" itemprop="discussionUrl">
      <span class="post-comments-count waline-comment-count" id="/JavaReadingNotes/8dcbd8d1/" data-xid="/JavaReadingNotes/8dcbd8d1/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>3.8k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>3 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="2-13-Servlet3-1新增的非阻塞式IO"><a href="#2-13-Servlet3-1新增的非阻塞式IO" class="headerlink" title="2.13 Servlet3.1新增的非阻塞式IO"></a>2.13 Servlet3.1新增的非阻塞式IO</h1><p>最新的<code>Java EE 7</code>已经发布,伴随<code>Java EE 7</code>一起发布了<code>Servlet3.1</code>,<code>Servlet3.1</code>引入了少数新特性。<code>Servlet3.1</code>新特性包括强制更改<code>sessionId</code>(由<code>HttpServletRequest</code>的<code>changeSessionId()</code>方法提供)、非阻塞<code>IO</code>等。尤其是<code>Servlet3.1</code>提供的非阻塞IO进行输入、输出,可以更好地提升性能。<br><code>Servlet</code>底层的<code>IO</code>是通过如下两个<code>IO</code>流来支持的。</p>
<ul>
<li><code>ServletInputStream</code>:<code>Servlet</code>用于读取数据的输入流。</li>
<li><code>ServletOutputStream</code>:<code>Servlet</code>用于输出数据的输出流。</li>
</ul>
<p>以<code>Servlet</code>读取数据为例,传统的读取方式采用阻塞式<code>IO</code>——当<code>Servlet</code>读取浏览器提交的数据时,如果数据暂时不可用,或数据没有读取完成,<code>Servlet</code>当前所在线程将会被阻塞,无法继续向下执行。</p>
<h2 id="ReadListener"><a href="#ReadListener" class="headerlink" title="ReadListener"></a>ReadListener</h2><p>从<code>Servlet3.1</code>开始,<code>ServletInputStream</code>新增了一个<code>setReadListener(ReadListener readListener)</code>方法,该方法允许以非阻塞<code>IO</code>读取数据,实现<code>ReadListener</code>监听器需要实现如下三个方法</p>
<ul>
<li><code>onAllDataRead()</code>:当所有数据读取完成时激发该方法。</li>
<li><code>onDataAvailable()</code>:当有数据可用时激发该方法</li>
<li><code>onError(Throwable t)</code>:读取数据出现错误时激发该方法。</li>
</ul>
<p>类似地,<code>ServletOuputStream</code>也提供了<code>setWriterListenerer(WriteListener writeListener)</code>方法,通过这种方式,可以让<code>ServletOuputStream</code>以非阻塞<code>IO</code>进行输出</p>
<h2 id="Servlet中使用非阻塞IO步骤"><a href="#Servlet中使用非阻塞IO步骤" class="headerlink" title="Servlet中使用非阻塞IO步骤"></a>Servlet中使用非阻塞IO步骤</h2><p>在<code>Servlet</code>中使用非阻塞<code>IO</code>非常简单,主要按如下步骤进行即可:</p>
<ul>
<li>调用<code>ServletRequest</code>的<code>startAsync()</code>方法开启异步模式</li>
<li>通过<code>ServletRequest</code>获取<code>ServletInputStream</code>,并为<code>ServletInputStream</code>设置监听器(<code>ReadListener</code>实现类)。</li>
<li>实现<code>ReadListener</code>接口来实现监听器,在该监听器的方法中以非阻塞方式读取数据。</li>
</ul>
<h1 id="程序示例"><a href="#程序示例" class="headerlink" title="程序示例"></a>程序示例</h1><h2 id="项目结构"><a href="#项目结构" class="headerlink" title="项目结构"></a>项目结构</h2><pre>
G:\Desktop\随书源码\轻量级Java EE企业应用实战(第5版)\codes\02\2.13\servlet31
├─async.jsp
├─form.html
└─WEB-INF\
  ├─build.xml
  ├─classes\
  │ └─lee\
  │   ├─AsyncServlet.class
  │   └─MyReadListener.class
  ├─lib\
  ├─src\
  │ └─lee\
  │   ├─AsyncServlet.java
  │   └─MyReadListener.java
  └─web.xml
</pre>
<p>下面的<code>Servlet</code>负责处理表单页面提交的数据,但该<code>Servlet</code>并未使用传统的、阻塞<code>IO</code>来读取客户端数据,而是采用非阻塞<code>IO</code>进行读取。下面是该<code>Servlet</code>的代码。</p>
<h2 id="AsyncServlet-java"><a href="#AsyncServlet-java" class="headerlink" title="AsyncServlet.java"></a>AsyncServlet.java</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> lee;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.*;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.*;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.*;</span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"></span><br><span class="line"><span class="meta">@WebServlet(urlPatterns = &quot;/async&quot;, asyncSupported = true)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AsyncServlet</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">service</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> IOException, ServletException &#123;</span><br><span class="line">        response.setContentType(<span class="string">&quot;text/html;charset=GBK&quot;</span>);</span><br><span class="line">        <span class="type">PrintWriter</span> <span class="variable">out</span> <span class="operator">=</span> response.getWriter();</span><br><span class="line">        out.println(<span class="string">&quot;&lt;title&gt;非阻塞IO示例&lt;/title&gt;&quot;</span>);</span><br><span class="line">        out.println(<span class="string">&quot;进入Servlet的时间：&quot;</span> + <span class="keyword">new</span> <span class="title class_">java</span>.util.Date() + <span class="string">&quot;.&lt;br/&gt;&quot;</span>);</span><br><span class="line">        <span class="comment">// 创建AsyncContext，开始异步调用</span></span><br><span class="line">        <span class="type">AsyncContext</span> <span class="variable">context</span> <span class="operator">=</span> request.startAsync();</span><br><span class="line">        <span class="comment">// 设置异步调用的超时时长</span></span><br><span class="line">        context.setTimeout(<span class="number">60</span> * <span class="number">1000</span>);</span><br><span class="line">        <span class="type">ServletInputStream</span> <span class="variable">input</span> <span class="operator">=</span> request.getInputStream();</span><br><span class="line">        <span class="comment">// 为输入流注册监听器</span></span><br><span class="line">        input.setReadListener(<span class="keyword">new</span> <span class="title class_">MyReadListener</span>(input, context));</span><br><span class="line">        out.println(<span class="string">&quot;结束Servlet的时间：&quot;</span> + <span class="keyword">new</span> <span class="title class_">java</span>.util.Date() + <span class="string">&quot;.&lt;br/&gt;&quot;</span>);</span><br><span class="line">        out.flush();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上面程序调用<code>request</code>的<code>startAsync()</code>方法开启异步调用之后,程序中粗体字代码为<code>Servlet</code>输入流注册了一个监听器,这样就无须在该<code>Servlet</code>中使用阻塞<code>IO</code>来获取数据了。而是改为由<code>MyReadListener</code>负责读取数据,这样<code>Servlet</code>就可以继续向下执行,不会因为<code>IO</code>阻塞线程。<br><code>MyReadListener</code>需要实现<code>Readlistener</code>接口,并重写它的三个方法。</p>
<h2 id="MyReadListener-java"><a href="#MyReadListener-java" class="headerlink" title="MyReadListener.java"></a>MyReadListener.java</h2><p>下面是<code>MyReadListener</code>的代码。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> lee;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.*;</span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyReadListener</span> <span class="keyword">implements</span> <span class="title class_">ReadListener</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> ServletInputStream input;</span><br><span class="line">    <span class="keyword">private</span> AsyncContext context;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MyReadListener</span><span class="params">(ServletInputStream input, AsyncContext context)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.input = input;</span><br><span class="line">        <span class="built_in">this</span>.context = context;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onDataAvailable</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;数据可用！！&quot;</span>);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 暂停5秒，模拟读取数据是一个耗时操作。</span></span><br><span class="line">            Thread.sleep(<span class="number">5000</span>);</span><br><span class="line">            <span class="type">StringBuilder</span> <span class="variable">sb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">            <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> -<span class="number">1</span>;</span><br><span class="line">            <span class="type">byte</span>[] buff = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">1024</span>];</span><br><span class="line">            <span class="comment">// 采用原始IO方式读取浏览器向Servlet提交的数据</span></span><br><span class="line">            <span class="keyword">while</span> (input.isReady() &amp;&amp; (len = input.read(buff)) &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="type">String</span> <span class="variable">data</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(buff, <span class="number">0</span>, len);</span><br><span class="line">                sb.append(data);</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(sb);</span><br><span class="line">            <span class="comment">// 将数据设置为request范围的属性</span></span><br><span class="line">            context.getRequest().setAttribute(<span class="string">&quot;info&quot;</span>, sb.toString());</span><br><span class="line">            <span class="comment">// 转发到视图页面</span></span><br><span class="line">            context.dispatch(<span class="string">&quot;/async.jsp&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception ex) &#123;</span><br><span class="line">            ex.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onAllDataRead</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;数据读取完成&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onError</span><span class="params">(Throwable t)</span> &#123;</span><br><span class="line">        t.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上面程序中<code>MyReadListener</code>的<code>onDataAvailable()</code>方法先暂停线程5秒,用于模拟耗时操作,接下来程序使用普通<code>IO</code>流读取浏览器提交的数据。<br>如果程序直接让<code>Servlet</code>读取浏览器提交的数据,那么该<code>Servlet</code>就需要阻塞5秒,不能继续向下执行;改为使用非阻塞IO进行读取,虽然读取数据的<code>IO</code>操作需要5秒,但它不会阻塞<code>Servlet</code>执行,因此可以提升<code>Servlet</code>的性能。<br>程序使用一个简单的表单向该<code>Servlet</code>提交请求,该表单内包含了请求数据。提交的表单效果如图2.53所示。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://lanlan2017.github.io/JavaReadingNotes/b4bd5cab/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/JavaReadingNotes/images/avatar.gif">
      <meta itemprop="name" content="蓝蓝">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="蓝蓝站点">
      <meta itemprop="description" content="好好学习，天天向上">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 蓝蓝站点">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/JavaReadingNotes/b4bd5cab/" class="post-title-link" itemprop="url">2.12.4 改进的Servlet API</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2020-06-21 03:20:14 / 修改时间：06:47:38" itemprop="dateCreated datePublished" datetime="2020-06-21T03:20:14+08:00">2020-06-21</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/2-%E8%BD%BB%E9%87%8F%E7%BA%A7Java-EE%E4%BC%81%E4%B8%9A%E5%BA%94%E7%94%A8%E5%AE%9E%E6%88%98-%E7%AC%AC5%E7%89%88/" itemprop="url" rel="index"><span itemprop="name">2 轻量级Java EE企业应用实战(第5版)</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/2-%E8%BD%BB%E9%87%8F%E7%BA%A7Java-EE%E4%BC%81%E4%B8%9A%E5%BA%94%E7%94%A8%E5%AE%9E%E6%88%98-%E7%AC%AC5%E7%89%88/%E7%AC%AC2%E7%AB%A0-JSP-Servlet%E5%8F%8A%E7%9B%B8%E5%85%B3%E6%8A%80%E6%9C%AF%E8%AF%A6%E8%A7%A3/" itemprop="url" rel="index"><span itemprop="name">第2章 JSP Servlet及相关技术详解</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/2-%E8%BD%BB%E9%87%8F%E7%BA%A7Java-EE%E4%BC%81%E4%B8%9A%E5%BA%94%E7%94%A8%E5%AE%9E%E6%88%98-%E7%AC%AC5%E7%89%88/%E7%AC%AC2%E7%AB%A0-JSP-Servlet%E5%8F%8A%E7%9B%B8%E5%85%B3%E6%8A%80%E6%9C%AF%E8%AF%A6%E8%A7%A3/2-12-Servlet3%E6%96%B0%E7%89%B9%E6%80%A7/" itemprop="url" rel="index"><span itemprop="name">2.12 Servlet3新特性</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
    <span class="post-meta-item-icon">
      <i class="far fa-comment"></i>
    </span>
    <span class="post-meta-item-text">Waline：</span>
  
    <a title="waline" href="/JavaReadingNotes/b4bd5cab/#waline-comments" itemprop="discussionUrl">
      <span class="post-comments-count waline-comment-count" id="/JavaReadingNotes/b4bd5cab/" data-xid="/JavaReadingNotes/b4bd5cab/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>4.2k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>4 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="2-12-4-改进的Servlet-API"><a href="#2-12-4-改进的Servlet-API" class="headerlink" title="2.12.4 改进的Servlet API"></a>2.12.4 改进的Servlet API</h1><p><code>Servlet3</code>还有一个改变是改进了部分<code>API</code>,这种改进很好地简化了<code>Java Web</code>开发。其中两个较大的改进是</p>
<ul>
<li><code>HttpServletRequest</code>增加了对文件上传的支持。</li>
<li><code>ServletContext</code>允许通过编程的方式动态注册<code>Servlet</code>、<code>Filter</code></li>
</ul>
<h2 id="HttpServletRequest文件上传方法"><a href="#HttpServletRequest文件上传方法" class="headerlink" title="HttpServletRequest文件上传方法"></a>HttpServletRequest文件上传方法</h2><p><code>HttpServletRequest</code>提供了如下两个方法来处理<strong>文件上传</strong>。</p>
<ul>
<li><code>Part getPart(String name)</code>:根据名称来获取文件上传域。</li>
<li><code>Collection&lt;Part&gt; getParms()</code>:获取所有的文件上传域</li>
</ul>
<h2 id="通过Part类对象来访问文件信息-将文件写入服务器"><a href="#通过Part类对象来访问文件信息-将文件写入服务器" class="headerlink" title="通过Part类对象来访问文件信息 将文件写入服务器"></a>通过Part类对象来访问文件信息 将文件写入服务器</h2><p>上面两个方法的返回值都涉及一个<code>API</code>:<code>Part</code>,每个<code>Part</code>对象对应于一个文件上传域,该对象提供了大量方法来访问上传文件的文件类型、大小、输入流等,并提供了一个<code>write(String file)</code>方法将上传文件写入服务器磁盘。</p>
<h2 id="HTML文件域"><a href="#HTML文件域" class="headerlink" title="HTML文件域"></a>HTML文件域</h2><p>为了向服务器上传文件,需要在表单里使用<code>&lt;input type=&quot;file&quot;&gt;</code>文件域,这个文件域会在<code>HTML</code>页面上产生一个单行文本框和一个“浏览”按钮,浏览者可通过该按钮选择需要上传的文件。</p>
<h2 id="需要设置HTML-form元素的enctype属性"><a href="#需要设置HTML-form元素的enctype属性" class="headerlink" title="需要设置HTML form元素的enctype属性"></a>需要设置HTML form元素的enctype属性</h2><p>除此之外,上传文件一定要为表单域设置<code>enctype</code>属性。</p>
<ul>
<li><code>application/x-www-form-urlencoded</code>:这是默认的编码方式,它只处理表单域里的<code>value</code>属性值,采用这种编码方式的表单会将表单域的值处理成<code>URL</code>编码方式。</li>
<li><code>multipart/form-data</code>:这种编码方式会以二进制流的方式来处理表单数据,这种编码方式会把文件域指定文件的内容也封装到请求参数里。</li>
<li><code>text/plain</code>:这种编码方式当表单的<code>action</code>属性为<code>mailto:URL</code>的形式时比较方便,这种方式主要适用于直接通过表单发送邮件的方式。</li>
</ul>
<p>如果将<code>enctype</code>设置为<code>application/x-www-form-urlencoded</code>,或不设置<code>enctype</code>属性,提交表单时只会发送文件域的文本框里的字符串,也就是浏览者所选择文件的绝对路径,对服务器获取该文件在客户端上的绝对路径没有任何作用,因为服务器不可能访问客户机的文件系统。</p>
<h2 id="upload-jsp"><a href="#upload-jsp" class="headerlink" title="upload.jsp"></a>upload.jsp</h2><p>下面定义了一个文件上传的页面。</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page contentType=<span class="string">&quot;text/html; charset=GBK&quot;</span> language=<span class="string">&quot;java&quot;</span> errorPage=<span class="string">&quot;&quot;</span> %&gt;</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt; 文件上传 &lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;form method=<span class="string">&quot;post&quot;</span> action=<span class="string">&quot;upload&quot;</span> enctype=<span class="string">&quot;multipart/form-data&quot;</span>&gt;</span><br><span class="line">    文件名：&lt;input type=<span class="string">&quot;text&quot;</span> id=<span class="string">&quot;name&quot;</span> name=<span class="string">&quot;name&quot;</span> /&gt;&lt;br/&gt;</span><br><span class="line">    选择文件：&lt;input type=<span class="string">&quot;file&quot;</span> id=<span class="string">&quot;file&quot;</span> name=<span class="string">&quot;file&quot;</span> /&gt;&lt;br/&gt;</span><br><span class="line">    &lt;input type=<span class="string">&quot;submit&quot;</span> value=<span class="string">&quot;上传&quot;</span> /&gt;&lt;br/&gt;</span><br><span class="line">&lt;/form&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<p>上面的页面中的表单需要设置<code>enctype=&quot;multipart/form-data&quot;</code>,这表明该表单可用于上传文件。<br>上面的表单中定义了两个表单域:</p>
<ul>
<li>一个普通的文本框,它将生成普通请求参数;</li>
<li>一个文件上传域,它用于上传文件。</li>
</ul>
<p>对于传统的文件上传需要借助于<code>common-fileupload</code>等工具,处理起来极为复杂,借助于<code>Servlet3</code>的<code>API</code>,处理文件上传将变得十分简单。看下面的<code>Servlet</code>类代码</p>
<h2 id="UploadServlet-java"><a href="#UploadServlet-java" class="headerlink" title="UploadServlet.java"></a>UploadServlet.java</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> lee;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.*;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.*;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.*;</span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="meta">@WebServlet(name = &quot;upload&quot;, urlPatterns = &#123; &quot;/upload&quot; &#125;)</span></span><br><span class="line"><span class="meta">@MultipartConfig</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UploadServlet</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">service</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> IOException, ServletException &#123;</span><br><span class="line">        response.setContentType(<span class="string">&quot;text/html;charset=GBK&quot;</span>);</span><br><span class="line">        <span class="type">PrintWriter</span> <span class="variable">out</span> <span class="operator">=</span> response.getWriter();</span><br><span class="line">        request.setCharacterEncoding(<span class="string">&quot;GBK&quot;</span>);</span><br><span class="line">        <span class="comment">// 获取普通请求参数</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">        out.println(<span class="string">&quot;普通的name参数为：&quot;</span> + name + <span class="string">&quot;&lt;br/&gt;&quot;</span>);</span><br><span class="line">        <span class="comment">// 获取文件上传域</span></span><br><span class="line">        <span class="type">Part</span> <span class="variable">part</span> <span class="operator">=</span> request.getPart(<span class="string">&quot;file&quot;</span>);</span><br><span class="line">        <span class="comment">// 获取上传文件的文件类型</span></span><br><span class="line">        out.println(<span class="string">&quot;上传文件的类型为：&quot;</span> + part.getContentType() + <span class="string">&quot;&lt;br/&gt;&quot;</span>);</span><br><span class="line">        <span class="comment">// 获取上传文件的大小。</span></span><br><span class="line">        out.println(<span class="string">&quot;上传文件的大小为：&quot;</span> + part.getSize() + <span class="string">&quot;&lt;br/&gt;&quot;</span>);</span><br><span class="line">        <span class="comment">// 获取该文件上传域的Header Name</span></span><br><span class="line">        Collection&lt;String&gt; headerNames = part.getHeaderNames();</span><br><span class="line">        <span class="comment">// 遍历文件上传域的Header Name、Value</span></span><br><span class="line">        <span class="keyword">for</span> (String headerName : headerNames) &#123;</span><br><span class="line">            out.println(headerName + <span class="string">&quot;---&gt;&quot;</span> + part.getHeader(headerName) + <span class="string">&quot;&lt;br/&gt;&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 获取包含原始文件名的字符串</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">fileNameInfo</span> <span class="operator">=</span> part.getHeader(<span class="string">&quot;content-disposition&quot;</span>);</span><br><span class="line">        <span class="comment">// 提取上传文件的原始文件名</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">fileName</span> <span class="operator">=</span> fileNameInfo.substring(fileNameInfo.indexOf(<span class="string">&quot;filename=\&quot;&quot;</span>) + <span class="number">10</span>, fileNameInfo.length() - <span class="number">1</span>);</span><br><span class="line">        <span class="comment">// 将上传的文件写入服务器</span></span><br><span class="line">        part.write(getServletContext().getRealPath(<span class="string">&quot;/uploadFiles&quot;</span>) + <span class="string">&quot;/&quot;</span> + fileName); <span class="comment">// ①</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上面<code>Servlet</code>使用了<code>@MultipartConfig</code>注解修饰,处理文件上传的<code>Servlet</code>应该使用该注解修饰。接下来该<code>Servlet</code>中<code>HttpServletrequest</code>就可通过<code>getPart( String name)</code>方法来获取文件上传域——就像获取普通请求参数一样。</p>
<h3 id="web-xml中配置"><a href="#web-xml中配置" class="headerlink" title="web.xml中配置"></a>web.xml中配置</h3><p>与<code>Servlet</code>所有注解相似的是,<code>Servlet</code>为<code>@MultipartConfig</code>提供了相似的配置元素,同样可以通过在<code>&lt;servlet&gt;</code>元素中添加<code>&lt;multipart-config/&gt;</code>子元素来达到相同的效果<br>获取了上传文件对应的<code>Part</code>之后,可以非常简单地将文件写入服务器磁盘,如上面的①号代码所示。当然也可以通过<code>Part</code>获取所上传文件的文件类型、文件大小等各种详细信息。<br>例如选择一个<code>*.png</code>图片,然后单击上传将可看到如图2.52所示的页面。</p>
<p>上面的<code>Servlet</code>中将会把上传的文件保存到<code>Web</code>应用的根路径下的<code>uploadFiles</code>目录下,因此读者还应该在<code>Web</code>应用的根路径下创建<code>uploadFiles</code>目录</p>
<h2 id="避免上传的文件同名"><a href="#避免上传的文件同名" class="headerlink" title="避免上传的文件同名"></a>避免上传的文件同名</h2><p>上面<code>Servlet</code>上传时保存的文件名直接使用了上传文件的原始文件名,在实际项目中一般不会这么做,因为可能多个用户可能上传同名的文件,这样将导致后面用户上传的文件覆盖前面用户上传的文件。在实际项目中可借助于<code>java.util.UUID</code>工具类生成文件名。</p>
<h1 id="动态注册Servlet-Filter"><a href="#动态注册Servlet-Filter" class="headerlink" title="动态注册Servlet Filter"></a>动态注册Servlet Filter</h1><p><code>ServletContext</code>则提供了如下方法来动态地注册<code>Servet</code>、<code>Filter</code>,并允许动态设置<code>Web</code>应用的初始化参数。</p>
<ul>
<li>多个重载的<code>addServlet()</code>方法:动态地注册<code>ServletE</code></li>
<li>多个重载的<code>addFilter()</code>方法:动态地注册<code>Filter</code></li>
<li>多个重载的<code>addListener()</code>方法:动态地注册<code>Listener</code></li>
<li><code>setInitParameter(String name, String value)</code>方法:为<code>Web</code>应用设置初始化参数。</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://lanlan2017.github.io/JavaReadingNotes/b4a521e9/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/JavaReadingNotes/images/avatar.gif">
      <meta itemprop="name" content="蓝蓝">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="蓝蓝站点">
      <meta itemprop="description" content="好好学习，天天向上">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 蓝蓝站点">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/JavaReadingNotes/b4a521e9/" class="post-title-link" itemprop="url">2.12.3 Servlet3提供的异步处理</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2020-06-21 02:56:48 / 修改时间：06:47:38" itemprop="dateCreated datePublished" datetime="2020-06-21T02:56:48+08:00">2020-06-21</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/2-%E8%BD%BB%E9%87%8F%E7%BA%A7Java-EE%E4%BC%81%E4%B8%9A%E5%BA%94%E7%94%A8%E5%AE%9E%E6%88%98-%E7%AC%AC5%E7%89%88/" itemprop="url" rel="index"><span itemprop="name">2 轻量级Java EE企业应用实战(第5版)</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/2-%E8%BD%BB%E9%87%8F%E7%BA%A7Java-EE%E4%BC%81%E4%B8%9A%E5%BA%94%E7%94%A8%E5%AE%9E%E6%88%98-%E7%AC%AC5%E7%89%88/%E7%AC%AC2%E7%AB%A0-JSP-Servlet%E5%8F%8A%E7%9B%B8%E5%85%B3%E6%8A%80%E6%9C%AF%E8%AF%A6%E8%A7%A3/" itemprop="url" rel="index"><span itemprop="name">第2章 JSP Servlet及相关技术详解</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/2-%E8%BD%BB%E9%87%8F%E7%BA%A7Java-EE%E4%BC%81%E4%B8%9A%E5%BA%94%E7%94%A8%E5%AE%9E%E6%88%98-%E7%AC%AC5%E7%89%88/%E7%AC%AC2%E7%AB%A0-JSP-Servlet%E5%8F%8A%E7%9B%B8%E5%85%B3%E6%8A%80%E6%9C%AF%E8%AF%A6%E8%A7%A3/2-12-Servlet3%E6%96%B0%E7%89%B9%E6%80%A7/" itemprop="url" rel="index"><span itemprop="name">2.12 Servlet3新特性</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
    <span class="post-meta-item-icon">
      <i class="far fa-comment"></i>
    </span>
    <span class="post-meta-item-text">Waline：</span>
  
    <a title="waline" href="/JavaReadingNotes/b4a521e9/#waline-comments" itemprop="discussionUrl">
      <span class="post-comments-count waline-comment-count" id="/JavaReadingNotes/b4a521e9/" data-xid="/JavaReadingNotes/b4a521e9/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>5.8k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>5 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="2-12-3-Servlet3提供的异步处理"><a href="#2-12-3-Servlet3提供的异步处理" class="headerlink" title="2.12.3 Servlet3提供的异步处理"></a>2.12.3 Servlet3提供的异步处理</h1><p>在以前的<code>Servlet</code>规范中,如果<code>Servlet</code>作为控制器调用了一个耗时的业务方法,那么<code>Servlet</code>必须等到业务方法完全返回之后才会生成响应,这将使得<code>Servlet</code>对业务方法的调用变成一种阻塞式的调用,因此效率比较低。<br><code>Servlet3</code>规范引入了异步处理来解决这个问题,异步处理允许<code>Servlet</code>重新发起一条新线程去调用耗时的业务方法,这样就可避免等待。</p>
<h2 id="AsyncContext"><a href="#AsyncContext" class="headerlink" title="AsyncContext"></a>AsyncContext</h2><p><code>Servlet3</code>的异步处理是通过<code>AsyncContext</code>类来处理的,<code>Servlet</code>可通过<code>ServletRequest</code>的如下两个方开启异步调用、创建<code>AsyncContext</code>对象。</p>
<ul>
<li><code>AsyncContext startAsync()</code></li>
<li><code>AsyncContext startAsync(ServletRequest, ServletResponse)</code></li>
</ul>
<p>重复调用上面的方法将得到同一个<code>AsyncContext</code>对象。<code>AsyncContext</code>对象代表异步处理的上下文,它提供了一些工具方法,可完成设置异步调用的超时时长,<code>dispatch</code>用于请求、启动后台线程、获取<code>request</code>、<code>response</code>对象等功能</p>
<h1 id="程序示例"><a href="#程序示例" class="headerlink" title="程序示例"></a>程序示例</h1><h2 id="项目结构"><a href="#项目结构" class="headerlink" title="项目结构"></a>项目结构</h2><pre>
G:\Desktop\随书源码\轻量级Java EE企业应用实战(第5版)\codes\02\2.12\servlet3
├─async.jsp
├─upload.jsp
├─uploadFiles\
│ └─疯狂iOS讲义（上）—立体图.png
└─WEB-INF\
  ├─build.xml
  ├─classes\
  │ └─lee\
  │   ├─AsyncServlet.class
  │   ├─GetBooksTarget.class
  │   ├─MyAsyncListener.class
  │   └─UploadServlet.class
  ├─lib\
  │ ├─crazyit.jar
  │ ├─jstl.jar
  │ ├─leegang.jar
  │ └─standard.jar
  ├─src\
  │ └─lee\
  │   ├─AsyncServlet.java
  │   ├─GetBooksTarget.java
  │   ├─MyAsyncListener.java
  │   └─UploadServlet.java
  └─web.xml
</pre>
<h2 id="AsyncServlet-java"><a href="#AsyncServlet-java" class="headerlink" title="AsyncServlet.java"></a>AsyncServlet.java</h2><p>下面是一个进行异步处理的<code>Servlet</code>类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> lee;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.*;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.*;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.*;</span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="meta">@WebServlet(urlPatterns = &quot;/async&quot;, asyncSupported = true)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AsyncServlet</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> IOException, ServletException &#123;</span><br><span class="line">        response.setContentType(<span class="string">&quot;text/html;charset=GBK&quot;</span>);</span><br><span class="line">        <span class="type">PrintWriter</span> <span class="variable">out</span> <span class="operator">=</span> response.getWriter();</span><br><span class="line">        out.println(<span class="string">&quot;&lt;title&gt;异步调用示例&lt;/title&gt;&quot;</span>);</span><br><span class="line">        out.println(<span class="string">&quot;进入Servlet的时间：&quot;</span> + <span class="keyword">new</span> <span class="title class_">java</span>.util.Date() + <span class="string">&quot;.&lt;br/&gt;&quot;</span>);</span><br><span class="line">        <span class="comment">// 创建AsyncContext，开始异步调用</span></span><br><span class="line">        <span class="type">AsyncContext</span> <span class="variable">actx</span> <span class="operator">=</span> request.startAsync();</span><br><span class="line">        <span class="comment">// 设置异步调用的超时时长</span></span><br><span class="line">        actx.setTimeout(<span class="number">60</span> * <span class="number">1000</span>);</span><br><span class="line">        <span class="comment">// 启动异步调用的线程，该线程以异步方式执行</span></span><br><span class="line">        actx.start(<span class="keyword">new</span> <span class="title class_">GetBooksTarget</span>(actx));</span><br><span class="line">        out.println(<span class="string">&quot;结束Servlet的时间：&quot;</span> + <span class="keyword">new</span> <span class="title class_">java</span>.util.Date() + <span class="string">&quot;.&lt;br/&gt;&quot;</span>);</span><br><span class="line">        out.flush();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上面的<code>Servlet</code>类中代码:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建AsyncContext，开始异步调用</span></span><br><span class="line"><span class="type">AsyncContext</span> <span class="variable">actx</span> <span class="operator">=</span> request.startAsync();</span><br><span class="line"><span class="comment">// 设置异步调用的超时时长</span></span><br><span class="line">actx.setTimeout(<span class="number">60</span> * <span class="number">1000</span>);</span><br><span class="line"><span class="comment">// 启动异步调用的线程，该线程以异步方式执行</span></span><br><span class="line">actx.start(<span class="keyword">new</span> <span class="title class_">GetBooksTarget</span>(actx));</span><br></pre></td></tr></table></figure>
<p>创建了<code>AsyncContext</code>对象,并通过该对象以异步方式启动了一条后台线程。该线程执行体模拟调用耗时的业务方法.</p>
<h2 id="GetBooksTarget-java"><a href="#GetBooksTarget-java" class="headerlink" title="GetBooksTarget.java"></a>GetBooksTarget.java</h2><p>下面是线程执行体的代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> lee;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.*;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.*;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.*;</span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GetBooksTarget</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">AsyncContext</span> <span class="variable">actx</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">GetBooksTarget</span><span class="params">(AsyncContext actx)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.actx = actx;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 等待5秒钟，以模拟业务方法的执行</span></span><br><span class="line">            Thread.sleep(<span class="number">5</span> * <span class="number">1000</span>);</span><br><span class="line">            <span class="type">ServletRequest</span> <span class="variable">request</span> <span class="operator">=</span> actx.getRequest();</span><br><span class="line">            List&lt;String&gt; books = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;String&gt;();</span><br><span class="line">            books.add(<span class="string">&quot;疯狂Java讲义&quot;</span>);</span><br><span class="line">            books.add(<span class="string">&quot;轻量级Java EE企业应用实战&quot;</span>);</span><br><span class="line">            books.add(<span class="string">&quot;疯狂前端开发讲义&quot;</span>);</span><br><span class="line">            request.setAttribute(<span class="string">&quot;books&quot;</span>, books);</span><br><span class="line">            actx.dispatch(<span class="string">&quot;/async.jsp&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>该线程执行体内让线程暂停5秒来模拟调用耗时的业务方法,最后调用<code>AsyncContext</code>的<code>dispatch</code>方法把请求<code>dispatch</code>到指定<code>JSP</code>页面.</p>
<h2 id="async-jsp"><a href="#async-jsp" class="headerlink" title="async.jsp"></a>async.jsp</h2><p>被异步请求<code>dispatch</code>的目标页面需要指定<code>session=&quot;false&quot;</code>“,表明该页面不会重新创建<code>session</code>。下面是<code>async.jsp</code>页面的代码。</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page contentType=<span class="string">&quot;text/html; charset=GBK&quot;</span> language=<span class="string">&quot;java&quot;</span></span><br><span class="line">    session=<span class="string">&quot;false&quot;</span>%&gt;</span><br><span class="line">&lt;%@ taglib prefix=<span class="string">&quot;c&quot;</span> uri=<span class="string">&quot;http://java.sun.com/jsp/jstl/core&quot;</span> %&gt;</span><br><span class="line">&lt;ul&gt;</span><br><span class="line">&lt;c:forEach items=<span class="string">&quot;$&#123;books&#125;&quot;</span> <span class="keyword">var</span>=<span class="string">&quot;book&quot;</span>&gt;</span><br><span class="line">    &lt;li&gt;$&#123;book&#125;&lt;/li&gt;</span><br><span class="line">&lt;/c:forEach&gt;</span><br><span class="line">&lt;/ul&gt;</span><br><span class="line">&lt;%out.println(<span class="string">&quot;业务调用结束的时间：&quot;</span> + <span class="keyword">new</span> <span class="title class_">java</span>.util.Date());</span><br><span class="line"><span class="keyword">if</span> (request.isAsyncStarted()) &#123;</span><br><span class="line">    <span class="comment">// 完成异步调用</span></span><br><span class="line">    request.getAsyncContext().complete();</span><br><span class="line">&#125;%&gt;</span><br></pre></td></tr></table></figure>
<p>上面的页面只是一个普通<code>JSP</code>页面,只是使用了<code>JSTL</code>标签库来迭代输出<code>books</code>集合,因此读者需要将<code>JSTL</code>的两个<code>JAR</code>包复制到<code>Web</code>应用的<code>WEB-INF\lib</code>路径下。</p>
<h2 id="为Servlet开启异步调用"><a href="#为Servlet开启异步调用" class="headerlink" title="为Servlet开启异步调用"></a>为Servlet开启异步调用</h2><p>对于希望启用异步调用的<code>Servlet</code>而言,开发者必须显式指定开启异步调用,为<code>Servlet</code>开启异步调用有两种方式。</p>
<ol>
<li>为<code>@WebServlet</code>指定<code>asyncSupported=true</code>属性</li>
<li>在<code>web.xml</code>文件的<code>&lt;servlet&gt;</code>元素中增加<code>&lt;async-supported&gt;</code>子元素</li>
</ol>
<h2 id="web-xml"><a href="#web-xml" class="headerlink" title="web.xml"></a>web.xml</h2><p>例如,希望开启上面<code>Servlet</code>的异步调用可通过如下配置片段:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">servlet</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>async<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>lee.AsyncServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">async-supported</span>&gt;</span>true<span class="tag">&lt;/<span class="name">async-supported</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>async<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/async<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>对于支持异步调用的<code>Servlet</code>来说,当<code>Servlet</code>以异步方式启用新线程之后,该<code>Servlet</code>的执行不会被阻塞,该<code>Servlet</code>将可以向客户端浏览器生成响应——当新线程执行完成后,新线程生成的响应再次被送往客户端浏览器。<br>通过浏览器访问上面的<code>Servlet</code>将看到如图2.51所示的页面</p>
<h2 id="异步监听器"><a href="#异步监听器" class="headerlink" title="异步监听器"></a>异步监听器</h2><p>当<code>Servlet</code>启用异步调用的线程之后,该线程的执行过程对开发者是透明的。但在有些情况下,开发者需要了解该异步线程的执行细节,并针对特定的执行结果进行针对性处理,这可借助于<code>Servlet3</code>提供的异步监听器来实现。<br>异步监听器需要实现<code>AsyncListener</code>接口,实现该接口的监听器类需要实现如下4个方法。</p>
<ul>
<li><code>onStartAsync(AsyncEvent even)</code>:当异步调用开始时触发该方法。</li>
<li><code>onComplete(AsyncEvent even)</code>:当异步调用完成时触发该方法。</li>
<li><code>onError(AsyncEvent even)</code>:当异步调用出错时触发该方法。</li>
<li><code>onTimeout(AsyncEvent even)</code>:当异步调用超时时触发该方法。</li>
</ul>
<h2 id="MyAsyncListener-java"><a href="#MyAsyncListener-java" class="headerlink" title="MyAsyncListener.java"></a>MyAsyncListener.java</h2><p>接下来为上面的异步调用定义如下监听器类。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> lee;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.*;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.*;</span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyAsyncListener</span> <span class="keyword">implements</span> <span class="title class_">AsyncListener</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onComplete</span><span class="params">(AsyncEvent event)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;------异步调用完成------&quot;</span> + <span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onError</span><span class="params">(AsyncEvent event)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onStartAsync</span><span class="params">(AsyncEvent event)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;------异步调用开始------&quot;</span> + <span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onTimeout</span><span class="params">(AsyncEvent event)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上面实现的异步监听器类只实现了<code>onStartAsync</code>、<code>onComplete</code>两个方法,表明该监听器只能监听异步调用开始、异步调用完成两个事件。</p>
<h2 id="给AsyncContext注册异步监听器"><a href="#给AsyncContext注册异步监听器" class="headerlink" title="给AsyncContext注册异步监听器"></a>给AsyncContext注册异步监听器</h2><p>提供了异步监听器之后,还需要通过<code>AsyncContext</code>来注册监听器,调用该对象的<code>addListener()</code>方法即可注册监听器。例如,在上面的<code>Servlet</code>中增加如下代码即可注册监听器:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">AsyncContext actx=request.startAsync();</span><br><span class="line"><span class="comment">//为该异步调用注册监听器</span></span><br><span class="line">actx.addListener(<span class="keyword">new</span> <span class="title class_">MyAsyncListener</span>());</span><br></pre></td></tr></table></figure>
<p>为异步调用注册了监听器之后,接下来的异步调用过程将会不断地触发该监听器的不同方法。<br>虽然上面的<code>MyAsyncListener</code>监听器类可以监听异步调用开始、异步调用完成两个事件,但从实际运行的结果来看,它并不能监听到异步调用开始事件,这可能是因为注册该监听器时异步调用已经开始了的缘故。<br>需要指出的是,虽然上面介绍的例子都是基于<code>Servlet</code>的,但由于<code>Filter</code>与<code>Servlet</code>具有很大的相似性,因此<code>Servlet3</code>规范完全支持在<code>Filter</code>中使用异步调用。在<code>Filter</code>中进行异步调用与在<code>Servlet</code>中进行异步调用的效果完全相似,故此处不再赘述。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://lanlan2017.github.io/JavaReadingNotes/986ab7fd/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/JavaReadingNotes/images/avatar.gif">
      <meta itemprop="name" content="蓝蓝">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="蓝蓝站点">
      <meta itemprop="description" content="好好学习，天天向上">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 蓝蓝站点">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/JavaReadingNotes/986ab7fd/" class="post-title-link" itemprop="url">2.12.2 Servlet3的Web模块支持</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2020-06-21 02:30:35 / 修改时间：06:47:38" itemprop="dateCreated datePublished" datetime="2020-06-21T02:30:35+08:00">2020-06-21</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/2-%E8%BD%BB%E9%87%8F%E7%BA%A7Java-EE%E4%BC%81%E4%B8%9A%E5%BA%94%E7%94%A8%E5%AE%9E%E6%88%98-%E7%AC%AC5%E7%89%88/" itemprop="url" rel="index"><span itemprop="name">2 轻量级Java EE企业应用实战(第5版)</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/2-%E8%BD%BB%E9%87%8F%E7%BA%A7Java-EE%E4%BC%81%E4%B8%9A%E5%BA%94%E7%94%A8%E5%AE%9E%E6%88%98-%E7%AC%AC5%E7%89%88/%E7%AC%AC2%E7%AB%A0-JSP-Servlet%E5%8F%8A%E7%9B%B8%E5%85%B3%E6%8A%80%E6%9C%AF%E8%AF%A6%E8%A7%A3/" itemprop="url" rel="index"><span itemprop="name">第2章 JSP Servlet及相关技术详解</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/2-%E8%BD%BB%E9%87%8F%E7%BA%A7Java-EE%E4%BC%81%E4%B8%9A%E5%BA%94%E7%94%A8%E5%AE%9E%E6%88%98-%E7%AC%AC5%E7%89%88/%E7%AC%AC2%E7%AB%A0-JSP-Servlet%E5%8F%8A%E7%9B%B8%E5%85%B3%E6%8A%80%E6%9C%AF%E8%AF%A6%E8%A7%A3/2-12-Servlet3%E6%96%B0%E7%89%B9%E6%80%A7/" itemprop="url" rel="index"><span itemprop="name">2.12 Servlet3新特性</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
    <span class="post-meta-item-icon">
      <i class="far fa-comment"></i>
    </span>
    <span class="post-meta-item-text">Waline：</span>
  
    <a title="waline" href="/JavaReadingNotes/986ab7fd/#waline-comments" itemprop="discussionUrl">
      <span class="post-comments-count waline-comment-count" id="/JavaReadingNotes/986ab7fd/" data-xid="/JavaReadingNotes/986ab7fd/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>3.6k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>3 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="2-12-2-Servlet3的Web模块支持"><a href="#2-12-2-Servlet3的Web模块支持" class="headerlink" title="2.12.2 Servlet3的Web模块支持"></a>2.12.2 Servlet3的Web模块支持</h1><p><code>Servlet3</code>为模块化开发提供了良好的支持,<code>Servlet3</code>规范不再要求所有<code>web</code>组件(如<code>Servlet</code>、<code>ListenerFilter</code>等)都部署在<code>web.xml</code>文件中,而是允许采用“<code>web</code>模块”来部署、管理它们。</p>
<h2 id="Web模块结构"><a href="#Web模块结构" class="headerlink" title="Web模块结构"></a>Web模块结构</h2><p><code>Web</code>模块通常对应于一个<code>JAR</code>包,这个<code>JAR</code>包有如下文件结构:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;webModule&gt;.jar——这是Web模块的JAR包,可以改变</span><br><span class="line">├─META-INF</span><br><span class="line">│    └─web-fragment.xml</span><br><span class="line">└─Web模块所用的类文件、资源文件等</span><br></pre></td></tr></table></figure>
<h3 id="web模块部署描述符"><a href="#web模块部署描述符" class="headerlink" title="web模块部署描述符"></a>web模块部署描述符</h3><p>从上面的文件结构可以看出,<code>Web</code>模块与普通<code>JAR</code>的最大区别在于需要在<code>META-INF</code>目录下添加个<code>web-fragment.xml</code>文件,这个文件也被称为<code>web</code>模块部署描述符。</p>
<p><code>web-fragment.xml</code>文件与<code>web.xml</code>文件的作用、文档结构都基本相似,因为它们都用于部署、管理各种<code>web</code>组件。只是<code>web-fragment.xml</code>用于部署、管理<code>web</code>模块而已,但<code>web-fragment.xml</code>文件可以多指定如下两个元素:</p>
<ol>
<li><code>&lt;name&gt;</code>:用于指定该<code>Web</code>模块的名称</li>
<li><code>&lt;ordering&gt;</code>:用于指定加载该<code>Web</code>模块的相对顺序。</li>
</ol>
<p>上面<code>&lt;ordering&gt;</code>元素用于指定加载当前<code>web</code>模块的相对顺序,该元素的内部结构如图2.49所示。<br><img data-src="https://raw.githubusercontent.com/lanlan2017/images/master/LightweightJavaEEEnterpriseApplicationCombat5thEdition/chapter2/2.12.2/1.png"></p>
<!-- LightweightJavaEEEnterpriseApplicationCombat5thEdition/chapter2/2.12.2/1 -->
<h1 id="程序示例"><a href="#程序示例" class="headerlink" title="程序示例"></a>程序示例</h1><h2 id="crazyit模块"><a href="#crazyit模块" class="headerlink" title="crazyit模块"></a>crazyit模块</h2><p>下面开发第一个<code>Web</code>模块,该<code>web</code>模块内只定义了一个简单的<code>ServletContextListner</code>,该<code>Web</code>模块对应的<code>web-fragment.xml</code>文件如下。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-fragment</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://xmlns.jcp.org/xml/ns/javaee&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://xmlns.jcp.org/xml/ns/javaee  </span></span></span><br><span class="line"><span class="string"><span class="tag">    http://xmlns.jcp.org/xml/ns/javaee/web-fragment_3_1.xsd&quot;</span> <span class="attr">version</span>=<span class="string">&quot;3.1&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 指定该Web模块的唯一标识 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>crazyit<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">listener</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">listener-class</span>&gt;</span>lee.CrazyitListener<span class="tag">&lt;/<span class="name">listener-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">listener</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ordering</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 用配置该Web模块必须位于哪些模块之前加载 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">before</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 用于指定位于其他所有模块之前加载 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">others</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">before</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">ordering</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">web-fragment</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>上面的<code>web</code>模块部署描述文件的根元素是<code>&lt;web-fragment&gt;</code><br>代码:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span>crazyit<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>指定该<code>Web</code>模块的名称是<code>crazyit</code>,接下来代码:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ordering</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 用配置该Web模块必须位于哪些模块之前加载 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">before</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 用于指定位于其他所有模块之前加载 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">others</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">before</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ordering</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>指定该<code>web</code>模块将在其他所有<code>web</code>模块之前加载.</p>
<h2 id="leegang模块"><a href="#leegang模块" class="headerlink" title="leegang模块"></a>leegang模块</h2><p>接下来再开发一个<code>web</code>模块,接下来的<code>Web</code>模块同样只定义了一个<code>ServletContextListener</code>,该<code>Web</code>模块对应的<code>web-Fragment.xm</code>文件如下。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;GBK&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-fragment</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://xmlns.jcp.org/xml/ns/javaee&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://xmlns.jcp.org/xml/ns/javaee  </span></span></span><br><span class="line"><span class="string"><span class="tag">    http://xmlns.jcp.org/xml/ns/javaee/web-fragment_3_1.xsd&quot;</span> <span class="attr">version</span>=<span class="string">&quot;3.1&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 指定该Web模块的唯一标识 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>leegang<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 配置Listener --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">listener</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">listener-class</span>&gt;</span>lee.LeegangListener<span class="tag">&lt;/<span class="name">listener-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">listener</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ordering</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 用配置该Web模块必须位于哪些模块之后加载 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">after</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 此处可用多个name元素列出该模块必须位于这些模块之后加载 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">name</span>&gt;</span>crazyit<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">after</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">ordering</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">web-fragment</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>将这两个<code>Web</code>模块打包成<code>JAR</code>包,<code>Web</code>模块<code>JAR</code>包的内部结构如图2.50所示。<br>将这两个<code>Web</code>模块对应的<code>JAR</code>包复制到任意<code>Web</code>应用的<code>WEB</code>Ⅰ<code>NF/lib</code>目录下,启动<code>Web</code>应用,将可以看到两个<code>Web</code>模块被加载:先加载<code>crazyit</code>模块,再加载<code>leegang</code>模块。</p>
<h2 id="web-xml中指定Web模块加载的绝对顺序"><a href="#web-xml中指定Web模块加载的绝对顺序" class="headerlink" title="web.xml中指定Web模块加载的绝对顺序"></a>web.xml中指定Web模块加载的绝对顺序</h2><p><code>Web</code>应用除了可按<code>web-fragment.xml</code>文件中指定的加载顺序来加载<code>Web</code>模块之外,还可以通过<code>web.xml</code>文件指定各<code>Web</code>模块加载的绝对顺序。在<code>web.xml</code>文件中指定的加载顺序将会覆盖<code>Web</code>模块中<code>web-fragment.xml</code>文件所指定的加载顺序.<br>假如在<code>Web</code>应用的<code>web.xml</code>文件中增加如下配置片段:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;GBK&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://xmlns.jcp.org/xml/ns/javaee&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://xmlns.jcp.org/xml/ns/javaee</span></span></span><br><span class="line"><span class="string"><span class="tag">    http://xmlns.jcp.org/xml/ns/javaee/web-app_3_1.xsd&quot;</span> <span class="attr">version</span>=<span class="string">&quot;3.1&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">absolute-ordering</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 指定Web模块按如下顺序加载  --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>leegang<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>crazyit<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">absolute-ordering</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>上面的配置片段指定了先加载<code>leegang</code>模块,后加载<code>crazyit</code>模块,如果重新启动该<code>Web</code>应用,将可看到<code>leegang</code>模块被优先加载</p>
<h1 id="Web模块化开发的优点"><a href="#Web模块化开发的优点" class="headerlink" title="Web模块化开发的优点"></a>Web模块化开发的优点</h1><p><code>Servlet3</code>的<code>web</code>模块支持为模块化开发、框架使用提供了巨大的方便,例如需要在<code>web</code>应用中使用<code>web</code>框架,这就只要将该框架的<code>JAR</code>包复制到<code>Web</code>应用中即可。因为这个<code>JAR</code>包的<code>META-NF</code>目录下可以通过<code>web-fragment.xml</code>文件来配置该框架所需的<code>Servlet</code>、<code>Listener</code>、<code>Filter</code>等,从而避免修改<code>Web</code>应用的<code>web.xml</code>文件。<code>Web</code>模块支持对于模块化开发也有很大的帮助,开发者可以将不同模块的<code>web</code>组件部署在不同的<code>web-fragment.xml</code>文件中,从而避免所有模块的配置、部署信息都写在<code>web.xml</code>文件中,这对以后的升级、维护将更加方便。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://lanlan2017.github.io/JavaReadingNotes/92ec5e0b/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/JavaReadingNotes/images/avatar.gif">
      <meta itemprop="name" content="蓝蓝">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="蓝蓝站点">
      <meta itemprop="description" content="好好学习，天天向上">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 蓝蓝站点">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/JavaReadingNotes/92ec5e0b/" class="post-title-link" itemprop="url">2.12 Servlet3新特性 2.12.1 Servlet3的注解</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2020-06-21 02:24:21 / 修改时间：06:47:38" itemprop="dateCreated datePublished" datetime="2020-06-21T02:24:21+08:00">2020-06-21</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/2-%E8%BD%BB%E9%87%8F%E7%BA%A7Java-EE%E4%BC%81%E4%B8%9A%E5%BA%94%E7%94%A8%E5%AE%9E%E6%88%98-%E7%AC%AC5%E7%89%88/" itemprop="url" rel="index"><span itemprop="name">2 轻量级Java EE企业应用实战(第5版)</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/2-%E8%BD%BB%E9%87%8F%E7%BA%A7Java-EE%E4%BC%81%E4%B8%9A%E5%BA%94%E7%94%A8%E5%AE%9E%E6%88%98-%E7%AC%AC5%E7%89%88/%E7%AC%AC2%E7%AB%A0-JSP-Servlet%E5%8F%8A%E7%9B%B8%E5%85%B3%E6%8A%80%E6%9C%AF%E8%AF%A6%E8%A7%A3/" itemprop="url" rel="index"><span itemprop="name">第2章 JSP Servlet及相关技术详解</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/2-%E8%BD%BB%E9%87%8F%E7%BA%A7Java-EE%E4%BC%81%E4%B8%9A%E5%BA%94%E7%94%A8%E5%AE%9E%E6%88%98-%E7%AC%AC5%E7%89%88/%E7%AC%AC2%E7%AB%A0-JSP-Servlet%E5%8F%8A%E7%9B%B8%E5%85%B3%E6%8A%80%E6%9C%AF%E8%AF%A6%E8%A7%A3/2-12-Servlet3%E6%96%B0%E7%89%B9%E6%80%A7/" itemprop="url" rel="index"><span itemprop="name">2.12 Servlet3新特性</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
    <span class="post-meta-item-icon">
      <i class="far fa-comment"></i>
    </span>
    <span class="post-meta-item-text">Waline：</span>
  
    <a title="waline" href="/JavaReadingNotes/92ec5e0b/#waline-comments" itemprop="discussionUrl">
      <span class="post-comments-count waline-comment-count" id="/JavaReadingNotes/92ec5e0b/" data-xid="/JavaReadingNotes/92ec5e0b/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>905</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>1 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="2-12-Servlet3新特性"><a href="#2-12-Servlet3新特性" class="headerlink" title="2.12 Servlet3新特性"></a>2.12 Servlet3新特性</h1><p>伴随<code>Java EE6</code>一起发布的<code>Servlet 3</code>规范是<code>Servlet</code>规范历史上最重要的变革之一,它的许多特性都极大地简化了<code>JavaWeb</code>应用的开发,例如前面介绍开发<code>Servlet</code>、<code>Listener</code>、<code>Filter</code>时所使用的注解。这些变革必将带给广大<code>Java</code>开发人员巨大的便利,大大加快<code>JavaWeb</code>应用的开发效率。</p>
<h1 id="2-12-1-Servlet3的注解"><a href="#2-12-1-Servlet3的注解" class="headerlink" title="2.12.1 Servlet3的注解"></a>2.12.1 Servlet3的注解</h1><p><code>Servlet3</code>的一个显著改变是“顺应”了潮流,抛弃了采用<code>web.xml</code>配置<code>Servlet</code>、<code>Filter</code>、<code>Listener</code>的烦琐步骤,允许开发人员使用注解修饰它们,从而进行部署。</p>
<h2 id="Servlet-3注解"><a href="#Servlet-3注解" class="headerlink" title="Servlet 3注解"></a>Servlet 3注解</h2><p><code>Servlet3</code>规范在<code>javax.servlet.annotation</code>包下提供了如下注解。</p>
<ul>
<li><code>@WebServlet</code>:用于修饰一个<code>Servlet</code>类,用于部署<code>Servlet</code>类。</li>
<li><code>@WebInitParam</code>:用于与<code>@WebServlet</code>或<code>@WebFilter</code>一起使用,为<code>Servlet</code>、<code>Filter</code>配置参数</li>
<li><code>@WebListener</code>:用于修饰<code>Listener</code>类,用于部署<code>Listener</code>类。</li>
<li><code>@WebFilter</code>:用于修饰<code>Filter</code>类,用于部署<code>Filter</code>类。</li>
<li><code>@MultipartConfig</code>:用于修饰<code>Servlet</code>,指定该<code>Servlet</code>将会负责处理<code>multipart/form-data</code>类型的求(主要用于文件上传)。</li>
<li><code>@ServletSecurity</code>:这是一个与<code>JAAS</code>有关的注解,修饰<code>Servlet</code>指定该<code>Servlet</code>的安全与授权控制</li>
<li><code>@HttpConstraint</code>:用于与<code>@ServletSecurity</code>一起使用,用于指定该<code>Servlet</code>的安全与授权控制。</li>
<li><code>@HttpMethodConstraint</code>:用于与<code>@ServletSecurity</code>一起使用,用于指定该<code>Servlet</code>的安全与授权控</li>
</ul>
<p>上面这些注解有一些已经在前面有了详细的介绍,此处不再赘述。<code>@MultipartConfig</code>的用法将会在2124节有更详细的说明。至于上面三个与<code>JAAS</code>相关的注解,由于本书并没有涉及<code>JAAS</code>方面的内容,因此请参考本书姊妹篇《经典Java EE企业应用实战》的相关章节。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://lanlan2017.github.io/JavaReadingNotes/60a6119e/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/JavaReadingNotes/images/avatar.gif">
      <meta itemprop="name" content="蓝蓝">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="蓝蓝站点">
      <meta itemprop="description" content="好好学习，天天向上">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 蓝蓝站点">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/JavaReadingNotes/60a6119e/" class="post-title-link" itemprop="url">2.11.3 Tag File支持</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2020-06-10 07:14:09 / 修改时间：08:12:30" itemprop="dateCreated datePublished" datetime="2020-06-10T07:14:09+08:00">2020-06-10</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/2-%E8%BD%BB%E9%87%8F%E7%BA%A7Java-EE%E4%BC%81%E4%B8%9A%E5%BA%94%E7%94%A8%E5%AE%9E%E6%88%98-%E7%AC%AC5%E7%89%88/" itemprop="url" rel="index"><span itemprop="name">2 轻量级Java EE企业应用实战(第5版)</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/2-%E8%BD%BB%E9%87%8F%E7%BA%A7Java-EE%E4%BC%81%E4%B8%9A%E5%BA%94%E7%94%A8%E5%AE%9E%E6%88%98-%E7%AC%AC5%E7%89%88/%E7%AC%AC2%E7%AB%A0-JSP-Servlet%E5%8F%8A%E7%9B%B8%E5%85%B3%E6%8A%80%E6%9C%AF%E8%AF%A6%E8%A7%A3/" itemprop="url" rel="index"><span itemprop="name">第2章 JSP Servlet及相关技术详解</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/2-%E8%BD%BB%E9%87%8F%E7%BA%A7Java-EE%E4%BC%81%E4%B8%9A%E5%BA%94%E7%94%A8%E5%AE%9E%E6%88%98-%E7%AC%AC5%E7%89%88/%E7%AC%AC2%E7%AB%A0-JSP-Servlet%E5%8F%8A%E7%9B%B8%E5%85%B3%E6%8A%80%E6%9C%AF%E8%AF%A6%E8%A7%A3/2-11-JSP2%E7%89%B9%E6%80%A7/" itemprop="url" rel="index"><span itemprop="name">2.11 JSP2特性</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
    <span class="post-meta-item-icon">
      <i class="far fa-comment"></i>
    </span>
    <span class="post-meta-item-text">Waline：</span>
  
    <a title="waline" href="/JavaReadingNotes/60a6119e/#waline-comments" itemprop="discussionUrl">
      <span class="post-comments-count waline-comment-count" id="/JavaReadingNotes/60a6119e/" data-xid="/JavaReadingNotes/60a6119e/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>3.5k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>3 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="2-11-3-Tag-File支持"><a href="#2-11-3-Tag-File支持" class="headerlink" title="2.11.3 Tag File支持"></a>2.11.3 Tag File支持</h1><p><code>Tag File</code>是自定义标签的简化用法,<strong>使用<code>Tag File</code>可以无须定义标签处理类和标签库文件,但仍然可以在<code>JP</code>页面中使用自定义标签</strong>。</p>
<h2 id="Tag-File建立一个迭代器标签"><a href="#Tag-File建立一个迭代器标签" class="headerlink" title="Tag File建立一个迭代器标签"></a>Tag File建立一个迭代器标签</h2><p>下面以<code>Tag File</code>建立一个迭代器标签,其步骤如下。</p>
<h3 id="建立Tag文件"><a href="#建立Tag文件" class="headerlink" title="建立Tag文件"></a>建立Tag文件</h3><p>在<code>JSP</code>所支持<code>Tag File</code>规范下,<code>Tag File</code>代理了标签处理类,它的格式类似于<code>JSP</code>文件。可以这样理解:如同<code>JSP</code>可以代替<code>Servlet</code>作为表现层一样,<code>Tag File</code>则可以代替标签处理类。<br><code>Tag File</code>具有以下5个编译指令。</p>
<ul>
<li><code>taglib</code>:作用与<code>JSP</code>文件中的<code>taglib</code>指令效果相同,用于导入其他标签库。</li>
<li><code>include</code>:作用与<code>JsP</code>文件中的<code>include</code>指令效果相同,用于导入其他<code>JSP</code>或静态页面</li>
<li><code>tag</code>:作用类似于<code>JsP</code>文件中的<code>page</code>指令,有<code>pageEncoding</code>、<code>body-content</code>等属性,用于设置页面编码等属性。</li>
<li><code>attribute</code>:用于设置自定义标签的属性,类似于自定义标签处理类中的标签属性</li>
<li><code>variable</code>:用于设置自定义标签的变量,这些变量将传给<code>JSP</code>页面使用。</li>
</ul>
<h4 id="iterator-tag"><a href="#iterator-tag" class="headerlink" title="iterator.tag"></a>iterator.tag</h4><p>下面是迭代器标签的<code>Tag File</code>,这个<code>Tag File</code>的语法与<code>JSP</code>语法非常相似</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ tag pageEncoding=<span class="string">&quot;UTF-8&quot;</span> <span class="keyword">import</span>=<span class="string">&quot;java.util.List&quot;</span>%&gt;</span><br><span class="line">&lt;!-- 定义了四个标签属性 --&gt;</span><br><span class="line">&lt;%@ attribute name=<span class="string">&quot;bgColor&quot;</span> %&gt;</span><br><span class="line">&lt;%@ attribute name=<span class="string">&quot;cellColor&quot;</span> %&gt;</span><br><span class="line">&lt;%@ attribute name=<span class="string">&quot;title&quot;</span> %&gt;</span><br><span class="line">&lt;%@ attribute name=<span class="string">&quot;bean&quot;</span> %&gt;</span><br><span class="line">&lt;table border=<span class="string">&quot;1&quot;</span> bgcolor=<span class="string">&quot;$&#123;bgColor&#125;&quot;</span>&gt;</span><br><span class="line">&lt;tr&gt;</span><br><span class="line">    &lt;td&gt;&lt;b&gt;$&#123;title&#125;&lt;/b&gt;&lt;/td&gt;</span><br><span class="line">&lt;/tr&gt;</span><br><span class="line">&lt;%List&lt;String&gt; list = (List&lt;String&gt;)</span><br><span class="line">    request.getAttribute(<span class="string">&quot;a&quot;</span>);</span><br><span class="line"><span class="comment">// 遍历输出list集合的元素</span></span><br><span class="line"><span class="keyword">for</span> (Object ele : list)&#123;%&gt;</span><br><span class="line">    &lt;tr&gt;</span><br><span class="line">        &lt;td bgcolor=<span class="string">&quot;$&#123;cellColor&#125;&quot;</span>&gt;</span><br><span class="line">        &lt;%=ele%&gt;</span><br><span class="line">        &lt;/td&gt;</span><br><span class="line">    &lt;/tr&gt;</span><br><span class="line">&lt;%&#125;%&gt;</span><br><span class="line">&lt;/table&gt;</span><br></pre></td></tr></table></figure>
<h4 id="Tag-File只生成HTML片段"><a href="#Tag-File只生成HTML片段" class="headerlink" title="Tag File只生成HTML片段"></a>Tag File只生成HTML片段</h4><p>上面的页面代码中的粗体字代码就是<code>Tag File</code>的核心代码,可能细心的读者会发现上面的<code>Tag File</code>并不会输出完整的<code>HTML</code>页面,它只包含一个<code>table</code>元素,即只有一个表格,这是正确的。<br>回忆自定义标签的作用:通过简单的标签在页面上生成一个内容片段。同理,这个<code>Tag File</code>也只负责生成一个页面片段,所以它并不需要输出完整的<code>HTML</code>页面。<br><code>Tag File</code>的命名必须遵守如下规则:<code>tagName.tag</code>。即<code>Tag File</code>的主文件名就是标签名,文件名后缀必须是<code>.tag</code>。<br>将该文件存在<code>web</code>应用的某个路径下,这个路径相当于标签库的<code>URI</code>名。这里将其放在<code>/WEB-INF/tags</code>下,即此处标签库路径为<code>/WEB-INF/tags</code></p>
<h3 id="先导入标签库-再使用标签"><a href="#先导入标签库-再使用标签" class="headerlink" title="先导入标签库 再使用标签"></a>先导入标签库 再使用标签</h3><p>在页面中使用自定义标签时,需要先导入标签库,再使用标签。使用<code>Tag File</code>标签与普通自定义标签的用法完全相同,只是在导入标签库时存在一些差异。由于此时的标签库没有<code>URI</code>,只有标签库路径。因此导入标签时,使用如下语法格式</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ taglib prefix=<span class="string">&quot;tagPrefix&quot;</span> tagdir=<span class="string">&quot;path&quot;</span> %&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li><code>prefix</code>与之前的<code>taglib</code>指令的<code>prefix</code>属性完全相同,用于确定标签前缀;</li>
<li><code>tagdir</code>标签库路径下存放很多<code>TagFile</code>,每个<code>TagFile</code>对应一个标签。</li>
</ul>
<h4 id="useTagFile-jsp"><a href="#useTagFile-jsp" class="headerlink" title="useTagFile.jsp"></a>useTagFile.jsp</h4><p>下面是使用<code>Tag File</code>标签的<code>JSP</code>页面代码。</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page contentType=<span class="string">&quot;text/html; charset=UTF-8&quot;</span> language=<span class="string">&quot;java&quot;</span> errorPage=<span class="string">&quot;&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;java.util.*&quot;</span> %&gt;</span><br><span class="line">&lt;%@ taglib prefix=<span class="string">&quot;tags&quot;</span> tagdir=<span class="string">&quot;/WEB-INF/tags&quot;</span> %&gt;</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt;迭代器tag file&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;h2&gt;迭代器tag file&lt;/h2&gt;</span><br><span class="line">    &lt;%</span><br><span class="line">    <span class="comment">// 创建集合对象，用于测试Tag File所定义的标签</span></span><br><span class="line">    List&lt;String&gt; a = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;String&gt;();</span><br><span class="line">    a.add(<span class="string">&quot;疯狂Java讲义&quot;</span>);</span><br><span class="line">    a.add(<span class="string">&quot;轻量级Java EE企业应用实战&quot;</span>);</span><br><span class="line">    a.add(<span class="string">&quot;疯狂前端开发讲义&quot;</span>);</span><br><span class="line">    <span class="comment">// 将集合对象放入页面范围</span></span><br><span class="line">    request.setAttribute(<span class="string">&quot;a&quot;</span> , a);</span><br><span class="line">    %&gt;</span><br><span class="line">    &lt;h3&gt;使用自定义标签&lt;/h3&gt;</span><br><span class="line">    &lt;tags:iterator bgColor=<span class="string">&quot;#99dd99&quot;</span> cellColor=<span class="string">&quot;#9999cc&quot;</span></span><br><span class="line">        title=<span class="string">&quot;迭代器标签&quot;</span> bean=<span class="string">&quot;a&quot;</span> /&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<p>从上面的代码可以看出,在<code>JSP</code>页面中使用<code>Tag File</code>标签也很简单。在该<code>JSP</code>页面中,使用了如下代码导入标签：</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ taglib prefix=<span class="string">&quot;tags&quot;</span> tagdir=<span class="string">&quot;/WEB-INF/tags&quot;</span> %&gt;</span><br></pre></td></tr></table></figure>
<p>即以<code>tags</code>开头的标签,使用<code>/WEB-INF/tags</code>路径下的标签文件处理。<br>在<code>JSP</code>页面中则使用如下代码来使用标签:</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;tags:iterator bgColor=<span class="string">&quot;#99dd99&quot;</span> cellColor=<span class="string">&quot;#9999cc&quot;</span></span><br><span class="line">    title=<span class="string">&quot;迭代器标签&quot;</span> bean=<span class="string">&quot;a&quot;</span> /&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li><code>tags</code>表明该标签使用<code>/WEB-INf/tags</code>路径下的<code>TagFile</code>来处理标签;</li>
<li><code>iterator</code>是标签名,即使用<code>/WEB-INf/tags</code>路径下的<code>iterator.tag</code>文件负责处理该标签。</li>
</ul>
<p><code>useTagFile.jsp</code>页面最终的执行效果如图2.48所示。</p>
<p><code>Tag File</code>是自定义标签的简化。事实上,就如同<code>JSP</code>文件会编译成<code>Servlet</code>一样,<code>TagFile</code>也会编译成标签处理类,自定义标签的后台依然由标签处理类完成,而这个过程由容器完成。<br>打开<code>Tomcat</code>的<code>work\Catalina\localhost\jsp2\org\apache\jsp\tag\web</code>路径,即可看到<code>iterator_tag.java</code>、<code>iterator_tag.class</code>两个文件,这两个文件就是<code>Tag File</code>所对应的标签处理类。<br>通过查看<code>iterator_tag.java</code>文件的内容不难发现,<code>Tag File</code>中只有如下几个内置对象。</p>
<ul>
<li><code>request</code>:与<code>JSP</code>脚本中的<code>request</code>对象对应。</li>
<li><code>response</code>:与<code>JSP</code>脚本中的<code>response</code>对象对应。</li>
<li><code>session</code>:与<code>JSP</code>脚本中的<code>session</code>对象对应</li>
<li><code>application</code>:与<code>JSP</code>脚本中的<code>application</code>对象对应。</li>
<li><code>config</code>:与<code>JSP</code>脚本中的<code>config</code>对象对应</li>
<li><code>out</code>:与<code>JSP</code>脚本中的<code>out</code>对象对应</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://lanlan2017.github.io/JavaReadingNotes/bec1bedb/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/JavaReadingNotes/images/avatar.gif">
      <meta itemprop="name" content="蓝蓝">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="蓝蓝站点">
      <meta itemprop="description" content="好好学习，天天向上">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 蓝蓝站点">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/JavaReadingNotes/bec1bedb/" class="post-title-link" itemprop="url">2.11.2 表达式语言</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2020-06-10 06:29:14 / 修改时间：08:12:30" itemprop="dateCreated datePublished" datetime="2020-06-10T06:29:14+08:00">2020-06-10</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/2-%E8%BD%BB%E9%87%8F%E7%BA%A7Java-EE%E4%BC%81%E4%B8%9A%E5%BA%94%E7%94%A8%E5%AE%9E%E6%88%98-%E7%AC%AC5%E7%89%88/" itemprop="url" rel="index"><span itemprop="name">2 轻量级Java EE企业应用实战(第5版)</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/2-%E8%BD%BB%E9%87%8F%E7%BA%A7Java-EE%E4%BC%81%E4%B8%9A%E5%BA%94%E7%94%A8%E5%AE%9E%E6%88%98-%E7%AC%AC5%E7%89%88/%E7%AC%AC2%E7%AB%A0-JSP-Servlet%E5%8F%8A%E7%9B%B8%E5%85%B3%E6%8A%80%E6%9C%AF%E8%AF%A6%E8%A7%A3/" itemprop="url" rel="index"><span itemprop="name">第2章 JSP Servlet及相关技术详解</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/2-%E8%BD%BB%E9%87%8F%E7%BA%A7Java-EE%E4%BC%81%E4%B8%9A%E5%BA%94%E7%94%A8%E5%AE%9E%E6%88%98-%E7%AC%AC5%E7%89%88/%E7%AC%AC2%E7%AB%A0-JSP-Servlet%E5%8F%8A%E7%9B%B8%E5%85%B3%E6%8A%80%E6%9C%AF%E8%AF%A6%E8%A7%A3/2-11-JSP2%E7%89%B9%E6%80%A7/" itemprop="url" rel="index"><span itemprop="name">2.11 JSP2特性</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
    <span class="post-meta-item-icon">
      <i class="far fa-comment"></i>
    </span>
    <span class="post-meta-item-text">Waline：</span>
  
    <a title="waline" href="/JavaReadingNotes/bec1bedb/#waline-comments" itemprop="discussionUrl">
      <span class="post-comments-count waline-comment-count" id="/JavaReadingNotes/bec1bedb/" data-xid="/JavaReadingNotes/bec1bedb/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>13k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>12 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="2-11-2-表达式语言"><a href="#2-11-2-表达式语言" class="headerlink" title="2.11.2 表达式语言"></a>2.11.2 表达式语言</h1><p>表达式语言(<code>Expression Language</code>)是一种简化的数据访问方式。使用表达式语言可以方便地访问<code>JSP</code>的隐含对象和<code>JavaBeans</code>组件,在<code>JSP2</code>规范中,建议尽量使用表达式语言使<code>JSP</code>文件的格式一致,避免使用<code>JSP</code>小脚本。<br>表达式语言可用于简化<code>JSP</code>页面的开发,允许美工设计人员使用表达式语言的语法获取业务逻辑组件传过来的变量值。<br>表达式语言是<code>JSP2</code>的一个重要特性,它并不是一种通用的程序语言,而仅仅是一种数据访问语言,可以方便地访问应用程序数据,建议避免使用<code>JSP</code>小脚本。实际上,<code>Servlet3.1</code>规范再次强化了表达式语言的功能.</p>
<h2 id="表达式语法格式"><a href="#表达式语法格式" class="headerlink" title="表达式语法格式"></a>表达式语法格式</h2><p>表达式语言的语法格式是:</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$&#123;expression&#125;</span><br></pre></td></tr></table></figure>

<h2 id="1-表达式语言支持的算术运算符和逻辑运算符"><a href="#1-表达式语言支持的算术运算符和逻辑运算符" class="headerlink" title="1. 表达式语言支持的算术运算符和逻辑运算符"></a>1. 表达式语言支持的算术运算符和逻辑运算符</h2><p>表达式语言支持的算术运算符和逻辑运算符非常多,所有在<code>Java</code>语言里支持的算术运算符,表达式语言都可以使用;甚至<code>Java</code>语言不支持的一些算术运算符和逻辑运算符,表达式语言也支持。</p>
<h3 id="JSP-表达式-中使用算术运算符"><a href="#JSP-表达式-中使用算术运算符" class="headerlink" title="JSP 表达式 中使用算术运算符"></a>JSP 表达式 中使用算术运算符</h3><h4 id="arithmeticOperator-jsp"><a href="#arithmeticOperator-jsp" class="headerlink" title="arithmeticOperator.jsp"></a>arithmeticOperator.jsp</h4><p>下面的<code>JSP</code>页面示范了在表达式语言中使用<strong>算术运算符</strong>。</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page contentType=<span class="string">&quot;text/html; charset=GBK&quot;</span> language=<span class="string">&quot;java&quot;</span> errorPage=<span class="string">&quot;&quot;</span> %&gt;</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt; 表达式语言 - 算术运算符 &lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;h2&gt;表达式语言 - 算术运算符&lt;/h2&gt;&lt;hr/&gt;</span><br><span class="line">    &lt;table border=<span class="string">&quot;1&quot;</span> bgcolor=<span class="string">&quot;#aaaadd&quot;</span>&gt;</span><br><span class="line">        &lt;tr&gt;</span><br><span class="line">            &lt;td&gt;&lt;b&gt;表达式语言&lt;/b&gt;&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;&lt;b&gt;计算结果&lt;/b&gt;&lt;/td&gt;</span><br><span class="line">        &lt;/tr&gt;</span><br><span class="line">        &lt;!-- 直接输出常量 --&gt;</span><br><span class="line">        &lt;tr&gt;</span><br><span class="line">            &lt;td&gt;\$&#123;<span class="number">1</span>&#125;&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;$&#123;<span class="number">1</span>&#125;&lt;/td&gt;</span><br><span class="line">        &lt;/tr&gt;</span><br><span class="line">        &lt;!-- 计算加法 --&gt;</span><br><span class="line">        &lt;tr&gt;</span><br><span class="line">            &lt;td&gt;\$&#123;<span class="number">1.2</span> + <span class="number">2.3</span>&#125;&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;$&#123;<span class="number">1.2</span> + <span class="number">2.3</span>&#125;&lt;/td&gt;</span><br><span class="line">        &lt;/tr&gt;</span><br><span class="line">        &lt;!-- 计算加法 --&gt;</span><br><span class="line">        &lt;tr&gt;</span><br><span class="line">            &lt;td&gt;\$&#123;<span class="number">1.2E4</span> + <span class="number">1.4</span>&#125;&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;$&#123;<span class="number">1.2E4</span> + <span class="number">1.4</span>&#125;&lt;/td&gt;</span><br><span class="line">        &lt;/tr&gt;</span><br><span class="line">        &lt;!-- 计算减法 --&gt;</span><br><span class="line">        &lt;tr&gt;</span><br><span class="line">            &lt;td&gt;\$&#123;-<span class="number">4</span> - <span class="number">2</span>&#125;&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;$&#123;-<span class="number">4</span> - <span class="number">2</span>&#125;&lt;/td&gt;</span><br><span class="line">        &lt;/tr&gt;</span><br><span class="line">        &lt;!-- 计算乘法 --&gt;</span><br><span class="line">        &lt;tr&gt;</span><br><span class="line">            &lt;td&gt;\$&#123;<span class="number">21</span> * <span class="number">2</span>&#125;&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;$&#123;<span class="number">21</span> * <span class="number">2</span>&#125;&lt;/td&gt;</span><br><span class="line">        &lt;/tr&gt;</span><br><span class="line">        &lt;!-- 计算除法 --&gt;</span><br><span class="line">        &lt;tr&gt;</span><br><span class="line">            &lt;td&gt;\$&#123;<span class="number">3</span>/<span class="number">4</span>&#125;&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;$&#123;<span class="number">3</span>/<span class="number">4</span>&#125;&lt;/td&gt;</span><br><span class="line">        &lt;/tr&gt;</span><br><span class="line">        &lt;!-- 计算除法 --&gt;</span><br><span class="line">        &lt;tr&gt;</span><br><span class="line">            &lt;td&gt;\$&#123;<span class="number">3</span> div <span class="number">4</span>&#125;&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;$&#123;<span class="number">3</span> div <span class="number">4</span>&#125;&lt;/td&gt;</span><br><span class="line">        &lt;/tr&gt;</span><br><span class="line">        &lt;!-- 计算除法 --&gt;</span><br><span class="line">        &lt;tr&gt;</span><br><span class="line">            &lt;td&gt;\$&#123;<span class="number">3</span>/<span class="number">0</span>&#125;&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;$&#123;<span class="number">3</span>/<span class="number">0</span>&#125;&lt;/td&gt;</span><br><span class="line">        &lt;/tr&gt;</span><br><span class="line">        &lt;!-- 计算求余 --&gt;</span><br><span class="line">        &lt;tr&gt;</span><br><span class="line">            &lt;td&gt;\$&#123;<span class="number">10</span>%<span class="number">4</span>&#125;&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;$&#123;<span class="number">10</span>%<span class="number">4</span>&#125;&lt;/td&gt;</span><br><span class="line">        &lt;/tr&gt;</span><br><span class="line">        &lt;!-- 计算求余 --&gt;</span><br><span class="line">        &lt;tr&gt;</span><br><span class="line">            &lt;td&gt;\$&#123;<span class="number">10</span> mod <span class="number">4</span>&#125;&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;$&#123;<span class="number">10</span> mod <span class="number">4</span>&#125;&lt;/td&gt;</span><br><span class="line">        &lt;/tr&gt;</span><br><span class="line">        &lt;!-- 计算三目运算符 --&gt;</span><br><span class="line">        &lt;tr&gt;</span><br><span class="line">            &lt;td&gt;\$&#123;(<span class="number">1</span>==<span class="number">2</span>) ? <span class="number">3</span> : <span class="number">4</span>&#125;&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;$&#123;(<span class="number">1</span>==<span class="number">2</span>) ? <span class="number">3</span> : <span class="number">4</span>&#125;&lt;/td&gt;</span><br><span class="line">        &lt;/tr&gt;</span><br><span class="line">    &lt;/table&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<p>上面的页面中示范了表达式语言所支持的加、减、乘、除、求余等<strong>算术运算符</strong>的功能,读者可能也发现了表达式语言还支持<code>div</code>、<code>mod</code>等运算符。而且<strong>表达式语言把所有数值都当成浮点数处理</strong>,所以3&#x2F;0的实质是3.0&#x2F;0.0,得到的结果应该是<code>Infinity</code>.</p>
<h4 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h4><p>浏览<code>arithmeticOperator.jsp</code>页面,将看到如图2.46所示的效果。</p>
<p>如果需要在支持表达式语言的页面中正常输出“<code>$</code>”符号,则在“<code>$</code>”符号前加转义字符“<code>\</code>”,否则系统以为“<code>$</code>”是表达式语言的特殊标记</p>
<h3 id="JSP-表达式-中使用逻辑运算符"><a href="#JSP-表达式-中使用逻辑运算符" class="headerlink" title="JSP 表达式 中使用逻辑运算符"></a>JSP 表达式 中使用逻辑运算符</h3><p>也可以在表达式语言中使用<strong>逻辑运算符</strong>,如下面的<code>JSP</code>页面所示。</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page contentType=<span class="string">&quot;text/html; charset=UTF-8&quot;</span> language=<span class="string">&quot;java&quot;</span> errorPage=<span class="string">&quot;&quot;</span> %&gt;</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt; 表达式语言 - 逻辑运算符 &lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;h2&gt;表达式语言 - 逻辑运算符&lt;/h2&gt;&lt;hr/&gt;</span><br><span class="line">    数字之间的比较：</span><br><span class="line">    &lt;table border=<span class="string">&quot;1&quot;</span> bgcolor=<span class="string">&quot;#aaaadd&quot;</span>&gt;</span><br><span class="line">        &lt;tr&gt;</span><br><span class="line">            &lt;td&gt;&lt;b&gt;表达式语言&lt;/b&gt;&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;&lt;b&gt;计算结果&lt;/b&gt;&lt;/td&gt;</span><br><span class="line">        &lt;/tr&gt;</span><br><span class="line">        &lt;!-- 直接比较两个数字 --&gt;</span><br><span class="line">        &lt;tr&gt;</span><br><span class="line">            &lt;td&gt;\$&#123;<span class="number">1</span> &amp;lt; <span class="number">2</span>&#125;&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;$&#123;<span class="number">1</span> &lt; <span class="number">2</span>&#125;&lt;/td&gt;</span><br><span class="line">        &lt;/tr&gt;</span><br><span class="line">        &lt;!-- 使用lt比较运算符 --&gt;</span><br><span class="line">        &lt;tr&gt;</span><br><span class="line">            &lt;td&gt;\$&#123;<span class="number">1</span> lt <span class="number">2</span>&#125;&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;$&#123;<span class="number">1</span> lt <span class="number">2</span>&#125;&lt;/td&gt;</span><br><span class="line">        &lt;/tr&gt;</span><br><span class="line">        &lt;!-- 使用&gt;比较运算符 --&gt;</span><br><span class="line">        &lt;tr&gt;</span><br><span class="line">            &lt;td&gt;\$&#123;<span class="number">1</span> &amp;gt; (<span class="number">4</span>/<span class="number">2</span>)&#125;&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;$&#123;<span class="number">1</span> &gt; (<span class="number">4</span>/<span class="number">2</span>)&#125;&lt;/td&gt;</span><br><span class="line">        &lt;/tr&gt;</span><br><span class="line">        &lt;!-- 使用gt比较运算符 --&gt;</span><br><span class="line">        &lt;tr&gt;</span><br><span class="line">            &lt;td&gt;\$&#123;<span class="number">1</span> gt (<span class="number">4</span>/<span class="number">2</span>)&#125;&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;$&#123;<span class="number">1</span> gt (<span class="number">4</span>/<span class="number">2</span>)&#125;&lt;/td&gt;</span><br><span class="line">        &lt;/tr&gt;</span><br><span class="line">        &lt;!-- 使用&gt;=比较运算符 --&gt;</span><br><span class="line">        &lt;tr&gt;</span><br><span class="line">            &lt;td&gt;\$&#123;<span class="number">4.0</span> &amp;gt= <span class="number">3</span>&#125;&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;$&#123;<span class="number">4.0</span> &gt;= <span class="number">3</span>&#125;&lt;/td&gt;</span><br><span class="line">        &lt;/tr&gt;</span><br><span class="line">        &lt;!-- 使用ge比较运算符 --&gt;</span><br><span class="line">        &lt;tr&gt;</span><br><span class="line">            &lt;td&gt;\$&#123;<span class="number">4.0</span> ge <span class="number">3</span>&#125;&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;$&#123;<span class="number">4.0</span> ge <span class="number">3</span>&#125;&lt;/td&gt;</span><br><span class="line">        &lt;/tr&gt;</span><br><span class="line">        &lt;!-- 使用&lt;=比较运算符 --&gt;</span><br><span class="line">        &lt;tr&gt;</span><br><span class="line">            &lt;td&gt;\$&#123;<span class="number">4</span> &amp;lt;= <span class="number">3</span>&#125;&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;$&#123;<span class="number">4</span> &lt;= <span class="number">3</span>&#125;&lt;/td&gt;</span><br><span class="line">        &lt;/tr&gt;</span><br><span class="line">        &lt;!-- 使用le比较运算符 --&gt;</span><br><span class="line">        &lt;tr&gt;</span><br><span class="line">            &lt;td&gt;\$&#123;<span class="number">4</span> le <span class="number">3</span>&#125;&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;$&#123;<span class="number">4</span> le <span class="number">3</span>&#125;&lt;/td&gt;</span><br><span class="line">        &lt;/tr&gt;</span><br><span class="line">        &lt;!-- 使用==比较运算符 --&gt;</span><br><span class="line">        &lt;tr&gt;</span><br><span class="line">            &lt;td&gt;\$&#123;<span class="number">100.0</span> == <span class="number">100</span>&#125;&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;$&#123;<span class="number">100.0</span> == <span class="number">100</span>&#125;&lt;/td&gt;</span><br><span class="line">        &lt;/tr&gt;</span><br><span class="line">        &lt;!-- 使用eq比较运算符 --&gt;</span><br><span class="line">        &lt;tr&gt;</span><br><span class="line">            &lt;td&gt;\$&#123;<span class="number">100.0</span> eq <span class="number">100</span>&#125;&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;$&#123;<span class="number">100.0</span> eq <span class="number">100</span>&#125;&lt;/td&gt;</span><br><span class="line">        &lt;/tr&gt;</span><br><span class="line">        &lt;!-- 使用!=比较运算符 --&gt;</span><br><span class="line">        &lt;tr&gt;</span><br><span class="line">            &lt;td&gt;\$&#123;(<span class="number">10</span>*<span class="number">10</span>) != <span class="number">100</span>&#125;&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;$&#123;(<span class="number">10</span>*<span class="number">10</span>) != <span class="number">100</span>&#125;&lt;/td&gt;</span><br><span class="line">        &lt;/tr&gt;</span><br><span class="line">        &lt;!--  先执行运算，再进行比较运算，使用ne比较运算符--&gt;</span><br><span class="line">        &lt;tr&gt;</span><br><span class="line">            &lt;td&gt;\$&#123;(<span class="number">10</span>*<span class="number">10</span>) ne <span class="number">100</span>&#125;&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;$&#123;(<span class="number">10</span>*<span class="number">10</span>) ne <span class="number">100</span>&#125;&lt;/td&gt;</span><br><span class="line">        &lt;/tr&gt;</span><br><span class="line">    &lt;/table&gt;</span><br><span class="line">    字符之间的比较：</span><br><span class="line">    &lt;table border=<span class="string">&quot;1&quot;</span> bgcolor=<span class="string">&quot;#aaaadd&quot;</span>&gt;</span><br><span class="line">        &lt;tr&gt;</span><br><span class="line">            &lt;td&gt;&lt;b&gt;表达式语言&lt;/b&gt;&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;&lt;b&gt;计算结果&lt;/b&gt;&lt;/td&gt;</span><br><span class="line">        &lt;/tr&gt;</span><br><span class="line">        &lt;tr&gt;</span><br><span class="line">            &lt;td&gt;\$&#123;<span class="string">&#x27;a&#x27;</span> &amp;lt; <span class="string">&#x27;b&#x27;</span>&#125;&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;$&#123;<span class="string">&#x27;a&#x27;</span> &lt; <span class="string">&#x27;b&#x27;</span>&#125;&lt;/td&gt;</span><br><span class="line">        &lt;/tr&gt;</span><br><span class="line">        &lt;tr&gt;</span><br><span class="line">            &lt;td&gt;\$&#123;<span class="string">&#x27;hip&#x27;</span> &amp;gt; <span class="string">&#x27;hit&#x27;</span>&#125;&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;$&#123;<span class="string">&#x27;hip&#x27;</span> &gt; <span class="string">&#x27;hit&#x27;</span>&#125;&lt;/td&gt;</span><br><span class="line">        &lt;/tr&gt;</span><br><span class="line">        &lt;tr&gt;</span><br><span class="line">            &lt;td&gt;\$&#123;<span class="string">&#x27;4&#x27;</span> &amp;gt; <span class="number">3</span>&#125;&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;$&#123;<span class="string">&#x27;4&#x27;</span> &gt; <span class="number">3</span>&#125;&lt;/td&gt;</span><br><span class="line">        &lt;/tr&gt;</span><br><span class="line">    &lt;/table&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<p>从上面程序的粗体字代码中可以看出:<br>表达式语言不仅可在数字与数字之间比较,还可在字符与字符之间比较,字符串的比较是根据其对应<code>Unicode</code>值来比较大小的。</p>
<h2 id="2-表达式语言的内置对象"><a href="#2-表达式语言的内置对象" class="headerlink" title="2. 表达式语言的内置对象"></a>2. 表达式语言的内置对象</h2><p>使用表达式语言可以直接获取请求参数值,可以获取页面中<code>JavaBean</code>的指定属性值,获取请求头及获取<code>page</code>、<code>request</code>、<code>session</code>和<code>application</code>范围的属性值等,这些都得益于表达式语言的内置对象。</p>
<h3 id="JSP表达式的11个内置对象"><a href="#JSP表达式的11个内置对象" class="headerlink" title="JSP表达式的11个内置对象"></a>JSP表达式的11个内置对象</h3><p>表达式语言包含如下11个内置对象</p>
<ol>
<li><code>pageContext</code>:代表该页面的<code>pageContext</code>对象,与<code>JSP</code>的<code>pageContext</code>内置对象相同。</li>
<li><code>pageScope</code>:用于获取<code>page</code>范围的属性值。</li>
<li><code>requestScope</code>:用于获取<code>request</code>范围的属性值。</li>
<li><code>sessionScope</code>:用于获取<code>session</code>范围的属性值。</li>
<li><code>applicationScope</code>:用于获取<code>application</code>范围的属性值。</li>
<li><code>param</code>:用于获取请求的参数值</li>
<li><code>paramValues</code>:用于获取请求的参数值,与<code>param</code>的区别在于,该对象用于获取属性值为数组的属性值。</li>
<li><code>header</code>:用于获取请求头的属性值。</li>
<li><code>headerValues</code>:用于获取请求头的属性值,与<code>header</code>的区别在于,该对象用于获取属性值为数组的属性值。</li>
<li><code>initParam</code>:用于获取请求<code>Web</code>应用的初始化参数</li>
<li><code>cookie</code>:用于获取指定的<code>Cookie</code>值。</li>
</ol>
<h3 id="implicit-objects-jsp"><a href="#implicit-objects-jsp" class="headerlink" title="implicit-objects.jsp"></a>implicit-objects.jsp</h3><p>下面的<code>JSP</code>页面示范了如何使用表达式语言的内置对象的方法。</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page contentType=<span class="string">&quot;text/html; charset=UTF-8&quot;</span> language=<span class="string">&quot;java&quot;</span> errorPage=<span class="string">&quot;&quot;</span> %&gt;</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt; 表达式语言 - 内置对象 &lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;h2&gt;表达式语言 - 内置对象&lt;/h2&gt;</span><br><span class="line">    请输入你的名字：</span><br><span class="line">    &lt;!-- 通过表单提交请求参数 --&gt;</span><br><span class="line">    &lt;form action=<span class="string">&quot;implicit-objects.jsp&quot;</span> method=<span class="string">&quot;post&quot;</span>&gt;</span><br><span class="line">        &lt;!-- 通过$&#123;param[<span class="string">&#x27;name&#x27;</span>]&#125; 获取请求参数 --&gt;</span><br><span class="line">        你的名字 = &lt;input type=<span class="string">&quot;text&quot;</span> name=<span class="string">&quot;name&quot;</span> value=<span class="string">&quot;$&#123;param[&#x27;name&#x27;]&#125;&quot;</span>/&gt;</span><br><span class="line">        &lt;input type=<span class="string">&quot;submit&quot;</span> value=<span class="string">&#x27;提交&#x27;</span>/&gt;</span><br><span class="line">    &lt;/form&gt;&lt;br/&gt;</span><br><span class="line">    &lt;% session.setAttribute(<span class="string">&quot;user&quot;</span> , <span class="string">&quot;abc&quot;</span>);</span><br><span class="line">    <span class="comment">// 下面三行代码添加Cookie</span></span><br><span class="line">    <span class="type">Cookie</span> <span class="variable">c</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Cookie</span>(<span class="string">&quot;name&quot;</span> , <span class="string">&quot;yeeku&quot;</span>);</span><br><span class="line">    c.setMaxAge(<span class="number">24</span> * <span class="number">3600</span>);</span><br><span class="line">    response.addCookie(c);</span><br><span class="line">    %&gt;</span><br><span class="line">    &lt;table border=<span class="string">&quot;1&quot;</span> width=<span class="string">&quot;660&quot;</span> bgcolor=<span class="string">&quot;#aaaadd&quot;</span>&gt;</span><br><span class="line">        &lt;tr&gt;</span><br><span class="line">            &lt;td width=<span class="string">&quot;170&quot;</span>&gt;&lt;b&gt;功能&lt;/b&gt;&lt;/td&gt;</span><br><span class="line">            &lt;td width=<span class="string">&quot;200&quot;</span>&gt;&lt;b&gt;表达式语言&lt;/b&gt;&lt;/td&gt;</span><br><span class="line">            &lt;td width=<span class="string">&quot;300&quot;</span>&gt;&lt;b&gt;计算结果&lt;/b&gt;&lt;/td&gt;</span><br><span class="line">        &lt;tr&gt;</span><br><span class="line">            &lt;!-- 使用两种方式获取请求参数值 --&gt;</span><br><span class="line">            &lt;td&gt;取得请求参数值&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;\$&#123;param.name&#125;&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;$&#123;param.name&#125;&amp;nbsp;&lt;/td&gt;</span><br><span class="line">        &lt;/tr&gt;</span><br><span class="line">        &lt;tr&gt;</span><br><span class="line">            &lt;td&gt;取得请求参数值&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;\$&#123;param[<span class="string">&quot;name&quot;</span>]&#125;&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;$&#123;param[<span class="string">&quot;name&quot;</span>]&#125;&amp;nbsp;&lt;/td&gt;</span><br><span class="line">        &lt;/tr&gt;</span><br><span class="line">        &lt;tr&gt;</span><br><span class="line">            &lt;!-- 使用两种方式获取指定请求头信息 --&gt;</span><br><span class="line">            &lt;td&gt;取得请求头的值&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;\$&#123;header.host&#125;&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;$&#123;header.host&#125;&lt;/td&gt;</span><br><span class="line">        &lt;/tr&gt;</span><br><span class="line">        &lt;tr&gt;</span><br><span class="line">            &lt;td&gt;取得请求头的值&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;\$&#123;header[<span class="string">&quot;accept&quot;</span>]&#125;&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;$&#123;header[<span class="string">&quot;accept&quot;</span>]&#125;&lt;/td&gt;</span><br><span class="line">        &lt;/tr&gt;</span><br><span class="line">        &lt;!-- 获取Web应用的初始化参数值 --&gt;</span><br><span class="line">        &lt;tr&gt;</span><br><span class="line">            &lt;td&gt;取得初始化参数值&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;\$&#123;initParam[<span class="string">&quot;author&quot;</span>]&#125;&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;$&#123;initParam[<span class="string">&quot;author&quot;</span>]&#125;&lt;/td&gt;</span><br><span class="line">        &lt;/tr&gt;</span><br><span class="line">        &lt;!-- 获取session返回的属性值 --&gt;</span><br><span class="line">        &lt;tr&gt;</span><br><span class="line">            &lt;td&gt;取得session的属性值&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;\$&#123;sessionScope[<span class="string">&quot;user&quot;</span>]&#125;&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;$&#123;sessionScope[<span class="string">&quot;user&quot;</span>]&#125;&lt;/td&gt;</span><br><span class="line">        &lt;/tr&gt;</span><br><span class="line">        &lt;!-- 获取指定Cookie的值 --&gt;</span><br><span class="line">        &lt;tr&gt;</span><br><span class="line">            &lt;td&gt;取得指定Cookie的值&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;\$&#123;cookie[<span class="string">&quot;name&quot;</span>].value&#125;&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;$&#123;cookie[<span class="string">&quot;name&quot;</span>].value&#125;&lt;/td&gt;</span><br><span class="line">        &lt;/tr&gt;</span><br><span class="line">    &lt;/table&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<p>浏览上面页面,并通过页面中表单来提交请求,将看到如图2.47所示的效果。</p>
<h2 id="3-表达式语言的自定义函数"><a href="#3-表达式语言的自定义函数" class="headerlink" title="3. 表达式语言的自定义函数"></a>3. 表达式语言的自定义函数</h2><p>表达式语言除了可以使用基本的运算符外,还可以使用自定义函数。通过自定义函数,能够大大加强表达式语言的功能。自定义函数的开发步骤非常类似于标签的开发步骤,定义方式也几乎一样。区别在于自定义标签直接在页面上生成输出,而自定义函数则需要在表达式语言中使用。<br>函数功能大大扩充了<code>EL</code>的功能,<code>EL</code>本身只是一种数据访问语言,因此它不支持调用方法。如果需要在<code>EL</code>中进行更复杂的处理,就可以通过函数来完成。**函数的本质是:提供一种语法允许在<code>EL</code>中调用某个类的<mark>静态方法</mark>**。</p>
<h3 id="表达式语言中自定义函数的步骤"><a href="#表达式语言中自定义函数的步骤" class="headerlink" title="表达式语言中自定义函数的步骤"></a>表达式语言中自定义函数的步骤</h3><p>下面介绍表达式语言中自定义函数的开发步骤。</p>
<h4 id="开发函数处理类"><a href="#开发函数处理类" class="headerlink" title="开发函数处理类"></a>开发函数处理类</h4><p>函数处理类就是普通类,这个普通类中包含若干个静态方法,每个静态方法都可定义成一个函数。实际上这个步骤也是可省略的,完全可以直接使用<code>JDK</code>或其他项目提供的类,只要这个类包含静态方法即可.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> lee;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Functions</span> &#123;</span><br><span class="line">    <span class="comment">// 对字符串进行反转</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">reverse</span><span class="params">(String text)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">StringBuffer</span>(text).reverse().toString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 统计字符串的个数</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">countChar</span><span class="params">(String text)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> text.length();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>完全可以直接使用<code>JDK</code>或其他项目提供的类作为函数处理类,只要这个类包含静态方法即可。</p>
<h4 id="使用标签库定义函数"><a href="#使用标签库定义函数" class="headerlink" title="使用标签库定义函数"></a>使用标签库定义函数</h4><p>定义函数的方法与定义标签的方法大致相似。</p>
<ul>
<li>在<code>&lt;taglib&gt;</code>元素下增加<code>&lt;tag&gt;</code>元素用于定义自定义标签;</li>
<li>在<code>&lt;taglib&gt;</code>元素下增加<code>&lt;function&gt;</code>元素则用于定义自定义函数。每个<code>&lt;function&gt;</code>素只要三个子元素即可。<ul>
<li><code>name</code>:指定自定义函数的函数名</li>
<li><code>function-class</code>:指定自定义函数的处理类。</li>
<li><code>function-signature</code>:指定自定义函数对应的方法。</li>
</ul>
</li>
</ul>
<p>下面的标签库定义(<code>TLD</code>)文件将上面的<code>Functions.java</code>类中所包含的两个方法定义成两个函数</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">taglib</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://java.sun.com/xml/ns/j2ee&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://java.sun.com/xml/ns/j2ee </span></span></span><br><span class="line"><span class="string"><span class="tag">    web-jsptaglibrary_2_0.xsd&quot;</span> <span class="attr">version</span>=<span class="string">&quot;2.0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tlib-version</span>&gt;</span>1.0<span class="tag">&lt;/<span class="name">tlib-version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">short-name</span>&gt;</span>crazyit<span class="tag">&lt;/<span class="name">short-name</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 定义该标签库的URI --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">uri</span>&gt;</span>http://www.crazyit.org/tags<span class="tag">&lt;/<span class="name">uri</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 定义第一个函数 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">function</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 定义函数名:reverse --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>reverse<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 定义函数的处理类 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">function-class</span>&gt;</span>lee.Functions<span class="tag">&lt;/<span class="name">function-class</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 定义函数的实现方法--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">function-signature</span>&gt;</span></span><br><span class="line">            java.lang.String reverse(java.lang.String)<span class="tag">&lt;/<span class="name">function-signature</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">function</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 定义第二个函数: countChar --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">function</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 定义函数名:countChar --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>countChar<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 定义函数的处理类 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">function-class</span>&gt;</span>lee.Functions<span class="tag">&lt;/<span class="name">function-class</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 定义函数的实现方法--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">function-signature</span>&gt;</span>int countChar(java.lang.String)</span><br><span class="line">            <span class="tag">&lt;/<span class="name">function-signature</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">function</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">taglib</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>上面的粗体字代码定义了两个函数,不难发现其实定义函数比定义自定义标签更简单,<strong>因为自定义函数只需配置三个子元素即可,变化更少</strong>。</p>
<h4 id="在JSP页面的EL中使用函数"><a href="#在JSP页面的EL中使用函数" class="headerlink" title="在JSP页面的EL中使用函数"></a>在JSP页面的EL中使用函数</h4><p>一样需要先导入标签库,然后再使用函数。下面是使用函数的<code>JSP</code>页面代码。</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page contentType=<span class="string">&quot;text/html; charset=UTF-8&quot;</span> language=<span class="string">&quot;java&quot;</span> errorPage=<span class="string">&quot;&quot;</span> %&gt;</span><br><span class="line">&lt;%@ taglib prefix=<span class="string">&quot;crazyit&quot;</span> uri=<span class="string">&quot;http://www.crazyit.org/tags&quot;</span>%&gt;</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt; <span class="keyword">new</span> <span class="title class_">document</span> &lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;h2&gt;表达式语言 - 自定义函数&lt;/h2&gt;&lt;hr/&gt;</span><br><span class="line">    请输入一个字符串：</span><br><span class="line">    &lt;form action=<span class="string">&quot;useFunctions.jsp&quot;</span> method=<span class="string">&quot;post&quot;</span>&gt;</span><br><span class="line">        字符串 = &lt;input type=<span class="string">&quot;text&quot;</span> name=<span class="string">&quot;name&quot;</span> value=<span class="string">&quot;$&#123;param[&#x27;name&#x27;]&#125;&quot;</span>&gt;</span><br><span class="line">        &lt;input type=<span class="string">&quot;submit&quot;</span>  value=<span class="string">&quot;提交&quot;</span>&gt;</span><br><span class="line">    &lt;/form&gt;</span><br><span class="line">    &lt;table border=<span class="string">&quot;1&quot;</span> bgcolor=<span class="string">&quot;aaaadd&quot;</span>&gt;</span><br><span class="line">        &lt;tr&gt;</span><br><span class="line">        &lt;td&gt;&lt;b&gt;表达式语言&lt;/b&gt;&lt;/td&gt;</span><br><span class="line">        &lt;td&gt;&lt;b&gt;计算结果&lt;/b&gt;&lt;/td&gt;</span><br><span class="line">        &lt;tr&gt;</span><br><span class="line">        &lt;tr&gt;</span><br><span class="line">            &lt;td&gt;\$&#123;param[<span class="string">&quot;name&quot;</span>]&#125;&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;$&#123;param[<span class="string">&quot;name&quot;</span>]&#125;&amp;nbsp;&lt;/td&gt;</span><br><span class="line">        &lt;/tr&gt;</span><br><span class="line">        &lt;!--  使用reverse函数--&gt;</span><br><span class="line">        &lt;tr&gt;</span><br><span class="line">            &lt;td&gt;\$&#123;crazyit:reverse(param[<span class="string">&quot;name&quot;</span>])&#125;&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;$&#123;crazyit:reverse(param[<span class="string">&quot;name&quot;</span>])&#125;&amp;nbsp;&lt;/td&gt;</span><br><span class="line">        &lt;/tr&gt;</span><br><span class="line">        &lt;tr&gt;</span><br><span class="line">            &lt;td&gt;\$&#123;crazyit:reverse(crazyit:reverse(param[<span class="string">&quot;name&quot;</span>]))&#125;&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;$&#123;crazyit:reverse(crazyit:reverse(param[<span class="string">&quot;name&quot;</span>]))&#125;&amp;nbsp;&lt;/td&gt;</span><br><span class="line">        &lt;/tr&gt;</span><br><span class="line">        &lt;!-- 使用countChar函数 --&gt;</span><br><span class="line">        &lt;tr&gt;</span><br><span class="line">            &lt;td&gt;\$&#123;crazyit:countChar(param[<span class="string">&quot;name&quot;</span>])&#125;&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;$&#123;crazyit:countChar(param[<span class="string">&quot;name&quot;</span>])&#125;&amp;nbsp;&lt;/td&gt;</span><br><span class="line">        &lt;/tr&gt;</span><br><span class="line">    &lt;/table&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<p>如上面程序中粗体字代码所示,导入标签库定义文件后(实质上也是函数库定义文件),就可以在表达式语言中使用函数定义库文件里定义的各函数了。<br>通过上面的介绍不难发现自定义函数的实质:就是将指定<code>Java</code>类的静态方法暴露成可以在<code>EL</code>中使用的函数,所以可以定义成函数的方法必须用<code>public static</code>修饰。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/JavaReadingNotes/page/62/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/JavaReadingNotes/">1</a><span class="space">&hellip;</span><a class="page-number" href="/JavaReadingNotes/page/62/">62</a><span class="page-number current">63</span><a class="page-number" href="/JavaReadingNotes/page/64/">64</a><span class="space">&hellip;</span><a class="page-number" href="/JavaReadingNotes/page/188/">188</a><a class="extend next" rel="next" href="/JavaReadingNotes/page/64/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 2018 – 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">蓝蓝</span>
</div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
      <span>站点总字数：</span>
    <span title="站点总字数">5.8m</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span>站点阅读时长 &asymp;</span>
    <span title="站点阅读时长">88:07</span>
  </span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@next-theme/pjax@0.5.0/pjax.min.js" integrity="sha256-3NkoLDrmHLTYj7csHIZSr0MHAFTXth7Ua/DDt4MRUAg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js" integrity="sha256-yt2kYMy0w8AbtF89WXb2P1rfjcP/HTHLT7097U8Y5b8=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/lozad@1.16.0/dist/lozad.min.js" integrity="sha256-mOFREFhqmHeQbXpK2lp4nA3qooVgACfh88fpJftLBbc=" crossorigin="anonymous"></script>
<script src="/JavaReadingNotes/js/comments.js"></script><script src="/JavaReadingNotes/js/utils.js"></script><script src="/JavaReadingNotes/js/motion.js"></script><script src="/JavaReadingNotes/js/next-boot.js"></script><script src="/JavaReadingNotes/js/bookmark.js"></script><script src="/JavaReadingNotes/js/pjax.js"></script>

  
<script src="https://cdn.jsdelivr.net/npm/hexo-generator-searchdb@1.4.0/dist/search.js" integrity="sha256-vXZMYLEqsROAXkEw93GGIvaB2ab+QW6w3+1ahD9nXXA=" crossorigin="anonymous"></script>
<script src="/JavaReadingNotes/js/third-party/search/local-search.js"></script>



  <script src="/JavaReadingNotes/js/third-party/fancybox.js"></script>

  <script src="/JavaReadingNotes/js/third-party/pace.js"></script>

  




  

  <script class="next-config" data-name="enableMath" type="application/json">false</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"none","js":{"url":"https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js","integrity":"sha256-r+3itOMtGGjap0x+10hu6jW/gZCzxHsoKrOd7gyRSGY="}}</script>
<script src="/JavaReadingNotes/js/third-party/math/mathjax.js"></script>


  <script src="https://cdn.jsdelivr.net/npm/quicklink@2.2.0/dist/quicklink.umd.js" integrity="sha256-4kQf9z5ntdQrzsBC3YSHnEz02Z9C1UeW/E9OgnvlzSY=" crossorigin="anonymous"></script>
  <script class="next-config" data-name="quicklink" type="application/json">{"enable":true,"home":true,"archive":true,"delay":true,"timeout":3000,"priority":true,"url":"https://lanlan2017.github.io/JavaReadingNotes/page/63/"}</script>
  <script src="/JavaReadingNotes/js/third-party/quicklink.js"></script>
<script class="next-config" data-name="waline" type="application/json">{"lang":null,"enable":true,"serverURL":"https://waline-test-lanlan2017.vercel.app","placeholder":"填写邮箱可接收回复通知 填写个人网址可为您引流","avatar":"mm","pageSize":10,"visitor":false,"comment_count":true,"requiredFields":[],"meta":["nick","mail","link"],"libUrl":"https://cdn.jsdelivr.net/npm/@waline/client/dist/Waline.min.js","el":"#waline-comments","path":"/JavaReadingNotes/page/63/"}</script>
<script>
document.addEventListener('page:loaded', () => {
  NexT.utils.loadComments(CONFIG.waline.el).then(() => 
    NexT.utils.getScript(CONFIG.waline.libUrl, { condition: window.Waline })
  ).then(() => {
    new Waline(CONFIG.waline);
  });
});
</script>
</body>
</html>
