<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)">
<meta name="generator" content="Hexo 5.4.0">

<link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
  <link rel="apple-touch-icon" sizes="180x180" href="/JavaReadingNotes/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/JavaReadingNotes/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/JavaReadingNotes/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/JavaReadingNotes/images/logo.svg" color="#222">
  <meta name="google-site-verification" content="_Sly-yzHYmALHXzjFpPWsodMrjBSphw7bfRbMUH80Qc">
  <meta name="msvalidate.01" content="B1CFD346B8DEBBFE0C983C2AF8955531">
  <meta name="baidu-site-verification" content="vkMTwK56xr">

<link rel="stylesheet" href="/JavaReadingNotes/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css" integrity="sha256-mUZM63G8m73Mcidfrv5E+Y61y7a12O5mW4ezU3bxqW4=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css" integrity="sha256-Vzbj7sDDS/woiFS3uNKo8eIuni59rjyNGtXfstRzStA=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/themes/blue/pace-theme-minimal.css">
  <script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script>

<script class="next-config" data-name="main" type="application/json">{"hostname":"lanlan2017.github.io","root":"/JavaReadingNotes/","images":"/JavaReadingNotes/images","scheme":"Gemini","darkmode":true,"version":"8.8.2","exturl":false,"sidebar":{"position":"right","display":"post","padding":18,"offset":12},"copycode":true,"bookmark":{"enable":true,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":true,"pangu":true,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/JavaReadingNotes/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/JavaReadingNotes/js/config.js"></script>
<meta name="description" content="好好学习，天天向上">
<meta property="og:type" content="website">
<meta property="og:title" content="蓝蓝站点">
<meta property="og:url" content="https://lanlan2017.github.io/JavaReadingNotes/page/158/index.html">
<meta property="og:site_name" content="蓝蓝站点">
<meta property="og:description" content="好好学习，天天向上">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="蓝蓝">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://lanlan2017.github.io/JavaReadingNotes/page/158/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"page/158/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>蓝蓝站点</title>
  

  <script src="/JavaReadingNotes/js/third-party/analytics/baidu-analytics.js"></script>
  <script async src="https://hm.baidu.com/hm.js?dadeb188eb14ccde0b25a19230c429b5"></script>


<link rel="dns-prefetch" href="https://waline-test-lanlan2017.vercel.app">
  <noscript>
    <link rel="stylesheet" href="/JavaReadingNotes/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/JavaReadingNotes/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">蓝蓝站点</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">Java读书笔记</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home"><a href="/JavaReadingNotes/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li>
        <li class="menu-item menu-item-dir"><a href="/JavaReadingNotes/dir/" rel="section"><i class="fa fa-sitemap fa-fw"></i>目录</a></li>
        <li class="menu-item menu-item-categories"><a href="/JavaReadingNotes/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li>
        <li class="menu-item menu-item-archives"><a href="/JavaReadingNotes/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li>
        <li class="menu-item menu-item-tags"><a href="/JavaReadingNotes/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="蓝蓝"
      src="/JavaReadingNotes/images/avatar.gif">
  <p class="site-author-name" itemprop="name">蓝蓝</p>
  <div class="site-description" itemprop="description">好好学习，天天向上</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/JavaReadingNotes/archives/">
          <span class="site-state-item-count">1871</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/JavaReadingNotes/categories/">
        <span class="site-state-item-count">626</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://lanlan2017.github.io/todo/" title="todo → https:&#x2F;&#x2F;lanlan2017.github.io&#x2F;todo&#x2F;"><i class="fa fa-check-square fa-fw"></i>todo</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://lanlan2017.github.io/links/" title="links → https:&#x2F;&#x2F;lanlan2017.github.io&#x2F;links&#x2F;"><i class="fa fa-link fa-fw"></i>links</a>
      </span>
  </div>
  <div class="cc-license site-overview-item animated" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" class="cc-opacity" rel="noopener" target="_blank"><img src="https://cdn.jsdelivr.net/npm/@creativecommons/vocabulary@2020.11.3/assets/license_badges/small/by_nc_sa.svg" alt="Creative Commons"></a>
  </div>



        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="返回顶部">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="reading-progress-bar"></div>
  <a role="button" class="book-mark-link book-mark-link-fixed"></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://lanlan2017.github.io/JavaReadingNotes/744e7229/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/JavaReadingNotes/images/avatar.gif">
      <meta itemprop="name" content="蓝蓝">
      <meta itemprop="description" content="好好学习，天天向上">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="蓝蓝站点">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/JavaReadingNotes/744e7229/" class="post-title-link" itemprop="url">13.7 事务处理 13.7.1 事务的概念和MySQL事务支持</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-07-05 19:01:01" itemprop="dateCreated datePublished" datetime="2019-07-05T19:01:01+08:00">2019-07-05</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2020-02-07 01:34:56" itemprop="dateModified" datetime="2020-02-07T01:34:56+08:00">2020-02-07</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/1-%E7%96%AF%E7%8B%82Java%E8%AE%B2%E4%B9%89-%E7%AC%AC4%E7%89%88/" itemprop="url" rel="index"><span itemprop="name">1 疯狂Java讲义 (第4版)</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/1-%E7%96%AF%E7%8B%82Java%E8%AE%B2%E4%B9%89-%E7%AC%AC4%E7%89%88/%E7%AC%AC13%E7%AB%A0-MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%8EJDBC%E7%BC%96%E7%A8%8B/" itemprop="url" rel="index"><span itemprop="name">第13章 MySQL数据库与JDBC编程</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/1-%E7%96%AF%E7%8B%82Java%E8%AE%B2%E4%B9%89-%E7%AC%AC4%E7%89%88/%E7%AC%AC13%E7%AB%A0-MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%8EJDBC%E7%BC%96%E7%A8%8B/13-7-%E4%BA%8B%E5%8A%A1%E5%A4%84%E7%90%86/" itemprop="url" rel="index"><span itemprop="name">13.7 事务处理</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
    <span class="post-meta-item-icon">
      <i class="far fa-comment"></i>
    </span>
    <span class="post-meta-item-text">Waline：</span>
  
    <a title="waline" href="/JavaReadingNotes/744e7229/#waline-comments" itemprop="discussionUrl">
      <span class="post-comments-count waline-comment-count" id="/JavaReadingNotes/744e7229/" data-xid="/JavaReadingNotes/744e7229/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>2.2k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>2 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="13-7-事务处理"><a href="#13-7-事务处理" class="headerlink" title="13.7 事务处理"></a>13.7 事务处理</h1><p>对于任何数据库应用而言,事务都是非常重要的,事务是保证底层数据完整的重要手段,没有事务支持的数据库应用,那将非常脆弱</p>
<h1 id="13-7-1-事务的概念和MySQL事务支持"><a href="#13-7-1-事务的概念和MySQL事务支持" class="headerlink" title="13.7.1 事务的概念和MySQL事务支持"></a>13.7.1 事务的概念和MySQL事务支持</h1><p><strong>事务是由一步或几步数据库操作序列组成的逻辑执行单元</strong>,<strong>这系列操作要么全部执行,要么全部放弃执行</strong>。</p>
<p>程序和事务是两个不同的概念。一般而言,一段程序中可能包含多个事务。</p>
<h2 id="事务的4个特性"><a href="#事务的4个特性" class="headerlink" title="事务的4个特性"></a>事务的4个特性</h2><p>事务具备4个特性:</p>
<ul>
<li>原子性( <code>Atomicity)</code>，</li>
<li>一致性( <code>Consistency)</code>，</li>
<li>隔离性( <code>Isolation)</code>，</li>
<li>持续性( <code>Durability)</code>。</li>
</ul>
<p>这4个特性也简称为<code>ACID</code>性</p>
<h3 id="原子性"><a href="#原子性" class="headerlink" title="原子性"></a>原子性</h3><p>原子性( <code>Atomicity)</code>:<strong>事务是应用中最小的执行单位</strong>,<strong>事务是应用中不可再分的最小逻辑执行体</strong>。</p>
<h3 id="一致性"><a href="#一致性" class="headerlink" title="一致性"></a>一致性</h3><p>一致性( <code>Consistency)</code>:<strong>事务执行的结果,必须使数据库从一个一致性状态,变到另一个一致性状态</strong>。当数据库只包含事务成功提交的结果时,数据库处于一致性状态。如果系统运行发生中断,某个事务尚未完成而被迫中断,而该未完成的事务对数据库所做的修改已被写入数据库此时,数据库就处于一种不正确的状态。比如银行在两个账户之间转账:从A账户向B账户转入1000元,系统先减少A账户的1000元,然后再为B账户增加1000元。如果全部执行成功,数据库处于一致性状态;如果仅减少A账户金额,而没有增加B账户的金额,则数据库就处于不一致性状态;因此,<strong>一致性是通过原子性来保证的</strong>。</p>
<h3 id="隔离性"><a href="#隔离性" class="headerlink" title="隔离性"></a>隔离性</h3><p>隔离性( <code>Isolation)</code>:各个事务的执行互不干扰,任意一个事务的内部操作对其他并发的事务都是隔离的。也就是说,<strong>并发执行的事务之间不能看到对方的中间状态,并发执行的事务之间不能互相影响</strong>。</p>
<h3 id="持续性"><a href="#持续性" class="headerlink" title="持续性"></a>持续性</h3><p>持续性( <code>Durability)</code>:持续性也称为持久性( <code>Persistence)</code>,<strong>指事务一旦提交,对数据所做的任何改变都要记录到永久存储器中</strong>,通常就是保存进物理数据库。</p>
<h2 id="事务语句组成"><a href="#事务语句组成" class="headerlink" title="事务语句组成"></a>事务语句组成</h2><p>数据库的事务由下列语句组成。</p>
<ul>
<li>一组<code>DML</code>语句,经过这组<code>DML</code>语句修改后的数据将保持较好的一致性。(<code>DML指的是:insert,update,delete这三条SQL语句)</code></li>
<li>一条<code>DDL</code>语句。(<code>DDL</code>指的是<code>create</code>,<code>alter</code>,<code>drop</code>,<code>truncate</code>等语句)</li>
<li>一条<code>DCL</code>语句。(<code>DCL</code>指的是:<code>grant</code>等语句)</li>
</ul>
<p><strong>注意</strong><br>事务中的<code>DDL</code>和<code>DCL</code>语句最多只能有一条,因为<code>DDL</code>和<code>DCL</code>语句都会导致事务立即提交。</p>
<h2 id="提交"><a href="#提交" class="headerlink" title="提交"></a>提交</h2><p>当事务所包含的全部数据库操作都成功执行后,应该提交( <code>commit)</code>事务,使这些修改永久生效。<br>事务提交有两种方式:<code>显式提交</code>和<code>自动提交</code>。</p>
<ul>
<li>显式提交:使用<code>commit</code>时.</li>
<li>自动提交:执行<code>DDL</code>或<code>DCL</code>语句,或者程序正常退出时。</li>
</ul>
<h2 id="回滚"><a href="#回滚" class="headerlink" title="回滚"></a>回滚</h2><p>当事务所包含的任意一个数据库操作执行失败后,应该回滚(<code>rollback)</code>事务,使该事务中所做的修改全部失效。事务回滚有两种方式:<code>显式回滚</code>和<code>自动回滚</code>。</p>
<ul>
<li>显式回滚:使用<code>rollback</code>。</li>
<li>自动回滚:系统错误或者强行退出。</li>
</ul>
<h2 id="如何开启-关闭事务"><a href="#如何开启-关闭事务" class="headerlink" title="如何开启 关闭事务"></a>如何开启 关闭事务</h2><p><strong><code>MySQL</code>默认关闭事务</strong>(即打开自动提交),在默认情况下,用户在<code>MySQL</code>控制台输入一条<code>DML</code>语句,这条<code>DML</code>语句将会立即保存到数据库里。为了开启<code>MySQL</code>的事务支持,可以显式调用如下命令:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SET</span> AUTOCOMMIT<span class="operator">=</span>&#123;<span class="number">0</span><span class="operator">|</span><span class="number">1</span>&#125; #<span class="number">0</span>为关闭自动提交,即开启事务</span><br></pre></td></tr></table></figure>
<p>注意:自动提交和开启事务恰好相反,如果<strong>开启自动提交就是关闭事务</strong>;<strong>关闭自动提交就是开启事务</strong>。</p>
<h2 id="临时开启事务"><a href="#临时开启事务" class="headerlink" title="临时开启事务"></a>临时开启事务</h2><p>除此之外,如果不想关闭整个命令行窗口的自动提交,而只是想临时性地开始事务,则可以使用<code>MySQL</code>提供的<code>start transaction</code>或<code>begin</code>两个命令,它们都表示临时性地开始一次事务,处于<code>starttransaction</code>或<code>begin</code>后的<code>DML</code>语句不会立即生效,除非使用<code>commit</code>显式提交事务,或者执行<code>DDL</code>、<code>DCL</code>语者来隐式提交事务。如下<code>SQL</code>代码将不会对数据库有任何影响。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">begin</span>;</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> student_table <span class="keyword">values</span>(<span class="keyword">null</span>,<span class="string">&#x27;xx&#x27;</span>,<span class="number">1</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> student_table <span class="keyword">values</span>(<span class="keyword">null</span>,<span class="string">&#x27;yy&#x27;</span>,<span class="number">1</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> student_table <span class="keyword">values</span>(<span class="keyword">null</span>,<span class="string">&#x27;zz&#x27;</span>,<span class="number">2</span>);</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> student_table; #①</span><br><span class="line"><span class="keyword">rollback</span>;</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> student_table; #②</span><br></pre></td></tr></table></figure>
<p>执行上面<code>SQL</code>语句中的第①条查询语句将会看到刚刚插入的3条记录,如果打开<code>MySQL</code>的其他命令行窗口将看不到这3条记录—这正体现了<code>事务的隔离性</code>。<br>接着程序<code>rollback</code>了事务中的全部修改,执行第②条查询语句时将看到数据库又恢复到事务开始前的状态。</p>
<p>对于提交,不管是显式提交还是隐式提交,都会结束当前事务;<br>对于回滚,不管是显式回滚还是隐式回滚,都会结束当前事务。</p>
<h2 id="保存点"><a href="#保存点" class="headerlink" title="保存点"></a>保存点</h2><p>除此之外, <code>MySQL</code>还提供了<code>savepoint</code>来设置事务的中间点,通过使用<code>savepoint</code>设置事务的中间点可以让事务回滚到指定中间点,而不是回滚全部事务。如下<code>SQL</code>语句设置了一个中间点:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">savepoint</span> a;</span><br></pre></td></tr></table></figure>
<p>一旦设置了中间点后,就可以使用<code>rollback</code>回滚到指定中间点,回滚到指定中间点的代码如下:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">rollback</span> <span class="keyword">to</span> a;</span><br></pre></td></tr></table></figure>
<p>注意:<br>普通的提交、回滚都会结束当前事务,<br>但<strong>回滚到指定中间点因为依然处于事务之中,所以不会结束当前事务</strong>.</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://lanlan2017.github.io/JavaReadingNotes/57b34ebb/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/JavaReadingNotes/images/avatar.gif">
      <meta itemprop="name" content="蓝蓝">
      <meta itemprop="description" content="好好学习，天天向上">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="蓝蓝站点">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/JavaReadingNotes/57b34ebb/" class="post-title-link" itemprop="url">13.6.3 离线RowSe的查询分页</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-07-05 18:46:16" itemprop="dateCreated datePublished" datetime="2019-07-05T18:46:16+08:00">2019-07-05</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2020-02-07 01:34:56" itemprop="dateModified" datetime="2020-02-07T01:34:56+08:00">2020-02-07</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/1-%E7%96%AF%E7%8B%82Java%E8%AE%B2%E4%B9%89-%E7%AC%AC4%E7%89%88/" itemprop="url" rel="index"><span itemprop="name">1 疯狂Java讲义 (第4版)</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/1-%E7%96%AF%E7%8B%82Java%E8%AE%B2%E4%B9%89-%E7%AC%AC4%E7%89%88/%E7%AC%AC13%E7%AB%A0-MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%8EJDBC%E7%BC%96%E7%A8%8B/" itemprop="url" rel="index"><span itemprop="name">第13章 MySQL数据库与JDBC编程</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/1-%E7%96%AF%E7%8B%82Java%E8%AE%B2%E4%B9%89-%E7%AC%AC4%E7%89%88/%E7%AC%AC13%E7%AB%A0-MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%8EJDBC%E7%BC%96%E7%A8%8B/13-6-Java7%E7%9A%84RowSet1-1/" itemprop="url" rel="index"><span itemprop="name">13.6 Java7的RowSet1.1</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
    <span class="post-meta-item-icon">
      <i class="far fa-comment"></i>
    </span>
    <span class="post-meta-item-text">Waline：</span>
  
    <a title="waline" href="/JavaReadingNotes/57b34ebb/#waline-comments" itemprop="discussionUrl">
      <span class="post-comments-count waline-comment-count" id="/JavaReadingNotes/57b34ebb/" data-xid="/JavaReadingNotes/57b34ebb/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>2.3k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>2 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="13-6-3-离线RowSet的查询分页"><a href="#13-6-3-离线RowSet的查询分页" class="headerlink" title="13.6.3 离线RowSet的查询分页"></a>13.6.3 离线RowSet的查询分页</h1><p>由于<code>CachedRowSet</code>会将数据记录直接装载到内存中,因此如果<code>SQL</code>查询返回的记录过大<code>CachedRowSet</code>将会占用大量的内存,在某些极端的情况下,它甚至会直接导致内存溢出。<br>为了解决该问题, <code>CachedRowSet</code>提供了分页功能。所谓分页功能就是一次只装载<code>Resultset</code>里的某几条记录,这样就可以避免<code>CachedRowSet</code>占用内存过大的问题。<br><code>CachedSet</code>提供了如下方法来控制分页。</p>
<table>
<thead>
<tr>
<th align="left">方法</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>populate(Resultset rs, int startRow)</code></td>
<td align="left">使用给定的<code>Resultset</code>装填<code>RowSet</code>,从<code>Resultset</code>的第<code>startRow</code>条记录开始装填。</td>
</tr>
<tr>
<td align="left"><code>setPageSize(int pageSize)</code></td>
<td align="left">设置<code>CachedRowSet</code>每次返回多少条记录。</td>
</tr>
<tr>
<td align="left"><code>previousPage()</code></td>
<td align="left">在底层<code>Resultset</code>可用的情况下,让<code>CachedSet</code>读取上一页记录。</td>
</tr>
<tr>
<td align="left"><code>nextPage()</code></td>
<td align="left">在底层<code>Resultset</code>可用的情况下,让<code>CachedRowSet</code>读取下一页记录。</td>
</tr>
</tbody></table>
<p>下面程序示范了<code>CachedRowSet</code>的分页支持。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.sql.*;</span><br><span class="line"><span class="keyword">import</span> javax.sql.*;</span><br><span class="line"><span class="keyword">import</span> javax.sql.rowset.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CachedRowSetPage</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String driver;</span><br><span class="line">    <span class="keyword">private</span> String url;</span><br><span class="line">    <span class="keyword">private</span> String user;</span><br><span class="line">    <span class="keyword">private</span> String pass;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">initParam</span><span class="params">(String paramFile)</span> <span class="keyword">throws</span> Exception</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// 使用Properties类来加载属性文件</span></span><br><span class="line">        Properties props = <span class="keyword">new</span> Properties();</span><br><span class="line">        props.load(<span class="keyword">new</span> FileInputStream(paramFile));</span><br><span class="line">        driver = props.getProperty(<span class="string">&quot;driver&quot;</span>);</span><br><span class="line">        url = props.getProperty(<span class="string">&quot;url&quot;</span>);</span><br><span class="line">        user = props.getProperty(<span class="string">&quot;user&quot;</span>);</span><br><span class="line">        pass = props.getProperty(<span class="string">&quot;pass&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> CachedRowSet <span class="title">query</span><span class="params">(String sql, <span class="keyword">int</span> pageSize, <span class="keyword">int</span> page)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> Exception</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// 1.加载驱动</span></span><br><span class="line">        Class.forName(driver);</span><br><span class="line">        <span class="keyword">try</span> (</span><br><span class="line">                <span class="comment">// 2.获取数据库连接</span></span><br><span class="line">                Connection conn = DriverManager.getConnection(url, user, pass);</span><br><span class="line">                <span class="comment">// 3.创建Statement对象</span></span><br><span class="line">                Statement stmt = conn.createStatement();</span><br><span class="line">                <span class="comment">// 4.使用Statement对象执行SQL语句</span></span><br><span class="line">                ResultSet rs = stmt.executeQuery(sql))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// 使用RowSetProvider创建RowSetFactory</span></span><br><span class="line">            RowSetFactory factory = RowSetProvider.newFactory();</span><br><span class="line">            <span class="comment">// 创建默认的CachedRowSet实例</span></span><br><span class="line">            CachedRowSet cachedRs = factory.createCachedRowSet();</span><br><span class="line">            <span class="comment">// 设置每页显示pageSize条记录</span></span><br><span class="line">            cachedRs.setPageSize(pageSize);</span><br><span class="line">            <span class="comment">// 使用ResultSet装填RowSet，设置从第几条记录开始</span></span><br><span class="line">            cachedRs.populate(rs, (page - <span class="number">1</span>) * pageSize + <span class="number">1</span>);</span><br><span class="line">            <span class="keyword">return</span> cachedRs;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        CachedRowSetPage cp = <span class="keyword">new</span> CachedRowSetPage();</span><br><span class="line">        cp.initParam(<span class="string">&quot;mysql.ini&quot;</span>);</span><br><span class="line">        CachedRowSet rs = cp.query(<span class="string">&quot;select * from student_table&quot;</span>, <span class="number">3</span>, <span class="number">2</span>); <span class="comment">// ①</span></span><br><span class="line">        <span class="comment">// 向后滚动结果集</span></span><br><span class="line">        <span class="keyword">while</span> (rs.next())</span><br><span class="line">        &#123;</span><br><span class="line">            System.out.println(rs.getString(<span class="number">1</span>) + <span class="string">&quot;\t&quot;</span> + rs.getString(<span class="number">2</span>) + <span class="string">&quot;\t&quot;</span></span><br><span class="line">                    + rs.getString(<span class="number">3</span>));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>CachedRowSet</code>实现分页的关键代码如下:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 设置每页显示pageSize条记录</span></span><br><span class="line">cachedRs.setPageSize(pageSize);</span><br><span class="line"><span class="comment">// 使用ResultSet装填RowSet，设置从第几条记录开始</span></span><br><span class="line">cachedRs.populate(rs, (page - <span class="number">1</span>) * pageSize + <span class="number">1</span>);</span><br></pre></td></tr></table></figure>
<p>程序中①号代码显示要査询第2页的记录,每页显示3条记录。运行上面程序,可以看到程序只会显示从第4行到第6行的记录,这就实现了分页。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://lanlan2017.github.io/JavaReadingNotes/e16aaec2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/JavaReadingNotes/images/avatar.gif">
      <meta itemprop="name" content="蓝蓝">
      <meta itemprop="description" content="好好学习，天天向上">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="蓝蓝站点">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/JavaReadingNotes/e16aaec2/" class="post-title-link" itemprop="url">13.6.2 离线RowSet</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-07-05 15:40:16" itemprop="dateCreated datePublished" datetime="2019-07-05T15:40:16+08:00">2019-07-05</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2020-02-07 01:34:56" itemprop="dateModified" datetime="2020-02-07T01:34:56+08:00">2020-02-07</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/1-%E7%96%AF%E7%8B%82Java%E8%AE%B2%E4%B9%89-%E7%AC%AC4%E7%89%88/" itemprop="url" rel="index"><span itemprop="name">1 疯狂Java讲义 (第4版)</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/1-%E7%96%AF%E7%8B%82Java%E8%AE%B2%E4%B9%89-%E7%AC%AC4%E7%89%88/%E7%AC%AC13%E7%AB%A0-MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%8EJDBC%E7%BC%96%E7%A8%8B/" itemprop="url" rel="index"><span itemprop="name">第13章 MySQL数据库与JDBC编程</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/1-%E7%96%AF%E7%8B%82Java%E8%AE%B2%E4%B9%89-%E7%AC%AC4%E7%89%88/%E7%AC%AC13%E7%AB%A0-MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%8EJDBC%E7%BC%96%E7%A8%8B/13-6-Java7%E7%9A%84RowSet1-1/" itemprop="url" rel="index"><span itemprop="name">13.6 Java7的RowSet1.1</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
    <span class="post-meta-item-icon">
      <i class="far fa-comment"></i>
    </span>
    <span class="post-meta-item-text">Waline：</span>
  
    <a title="waline" href="/JavaReadingNotes/e16aaec2/#waline-comments" itemprop="discussionUrl">
      <span class="post-comments-count waline-comment-count" id="/JavaReadingNotes/e16aaec2/" data-xid="/JavaReadingNotes/e16aaec2/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>2.8k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>3 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="13-6-2-离线RowSet"><a href="#13-6-2-离线RowSet" class="headerlink" title="13.6.2 离线RowSet"></a>13.6.2 离线RowSet</h1><p>在使用<code>ResultSet</code>的时代,程序查询得到<code>ResultSet</code>之后必须立即读取或处理它对应的记录,否则旦<code>Connection</code>关闭,再去通过<code>ResultSet</code>读取记录就会引发异常。在这种模式下,<code>JDBC</code>编程十分痛苦.<br>假设应用程序架构被分为两层:数据访问层和视图显示层,当应用程序在数据访问层查询得到<code>ResultSet</code>之后,对<code>ResultSet</code>的处理有如下两种常见方式。</p>
<ul>
<li><p>1.使用迭代访问<code>ResultSet</code>里的记录,并将这些记录转换成<code>Java Bean</code>,再将多个<code>Java Bean</code>封装成个<code>List</code>集合,也就是完成”<code>ResultSet</code>到<code>Java Bean</code>集合”的转换。转换完成后可以关闭<code>Connection</code>等资源,然后将<code>Java bean</code>集合传到视图显示层,视图显示层可以显示查询得到的数据。</p>
</li>
<li><p>2.直接将<code>ResultSet</code>传到视图显示层——这要求当视图显示层显示数据时,底层<code>Connection</code>必须直处于打开状态,否则<code>ResultSet</code>无法读取记录。</p>
</li>
<li><p>第一种方式比较安全,但编程十分烦琐;</p>
</li>
<li><p>第二种方式则需要<code>Connection</code>一直处于打开状态,这不仅不安全,而且对程序性能也有较大的影响。</p>
</li>
</ul>
<p>通过使用离线<code>RowSet</code>可以十分”优雅”地处理上面的问题,离线<code>RowSet</code>会直接将底层数据读入内存中,封装成<code>RowSet</code>对象,而<code>RowSet</code>对象则完全可以当成<code>Java Bean</code>来使用。因此不仅安全,而且编程十分简单。<code>CachedRowSet</code>是所有离线<code>RowSet</code>的父接口,因此下面以<code>CachedRowSet</code>为例进行介绍。看下面程序。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.sql.*;</span><br><span class="line"><span class="keyword">import</span> javax.sql.*;</span><br><span class="line"><span class="keyword">import</span> javax.sql.rowset.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CachedRowSetTest</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String driver;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String url;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String user;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String pass;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">initParam</span><span class="params">(String paramFile)</span> <span class="keyword">throws</span> Exception</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// 使用Properties类来加载属性文件</span></span><br><span class="line">        Properties props = <span class="keyword">new</span> Properties();</span><br><span class="line">        props.load(<span class="keyword">new</span> FileInputStream(paramFile));</span><br><span class="line">        driver = props.getProperty(<span class="string">&quot;driver&quot;</span>);</span><br><span class="line">        url = props.getProperty(<span class="string">&quot;url&quot;</span>);</span><br><span class="line">        user = props.getProperty(<span class="string">&quot;user&quot;</span>);</span><br><span class="line">        pass = props.getProperty(<span class="string">&quot;pass&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> CachedRowSet <span class="title">query</span><span class="params">(String sql)</span> <span class="keyword">throws</span> Exception</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// 1.加载驱动</span></span><br><span class="line">        Class.forName(driver);</span><br><span class="line">        <span class="comment">// 2.获取数据库连接</span></span><br><span class="line">        Connection conn = DriverManager.getConnection(url, user, pass);</span><br><span class="line">        Statement stmt = conn.createStatement();</span><br><span class="line">        ResultSet rs = stmt.executeQuery(sql);</span><br><span class="line">        <span class="comment">// 3.使用RowSetProvider创建RowSetFactory</span></span><br><span class="line">        RowSetFactory factory = RowSetProvider.newFactory();</span><br><span class="line">        <span class="comment">// 4.创建默认的CachedRowSet实例</span></span><br><span class="line">        CachedRowSet cachedRs = factory.createCachedRowSet();</span><br><span class="line">        <span class="comment">// 5.使用ResultSet装填RowSet</span></span><br><span class="line">        cachedRs.populate(rs); <span class="comment">// ①</span></span><br><span class="line">        <span class="comment">// 关闭资源</span></span><br><span class="line">        rs.close();</span><br><span class="line">        stmt.close();</span><br><span class="line">        conn.close();</span><br><span class="line">        <span class="keyword">return</span> cachedRs;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        CachedRowSetTest ct = <span class="keyword">new</span> CachedRowSetTest();</span><br><span class="line">        ct.initParam(<span class="string">&quot;mysql.ini&quot;</span>);</span><br><span class="line">        CachedRowSet rs = ct.query(<span class="string">&quot;select * from student_table&quot;</span>);</span><br><span class="line">        rs.afterLast();</span><br><span class="line">        <span class="comment">// 向前滚动结果集</span></span><br><span class="line">        <span class="keyword">while</span> (rs.previous())</span><br><span class="line">        &#123;</span><br><span class="line">            System.out.println(rs.getString(<span class="number">1</span>) + <span class="string">&quot;\t&quot;</span> + rs.getString(<span class="number">2</span>) + <span class="string">&quot;\t&quot;</span></span><br><span class="line">                    + rs.getString(<span class="number">3</span>));</span><br><span class="line">            <span class="keyword">if</span> (rs.getInt(<span class="string">&quot;student_id&quot;</span>) == <span class="number">3</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// 修改指定记录行</span></span><br><span class="line">                rs.updateString(<span class="string">&quot;student_name&quot;</span>, <span class="string">&quot;孙悟空&quot;</span>);</span><br><span class="line">                rs.updateRow();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 重新获取数据库连接</span></span><br><span class="line">        Connection conn = DriverManager.getConnection(url, user, pass);</span><br><span class="line">        conn.setAutoCommit(<span class="keyword">false</span>);</span><br><span class="line">        <span class="comment">// 把对RowSet所做的修改同步到底层数据库</span></span><br><span class="line">        rs.acceptChanges(conn);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上面程序中的①号代码调用了<code>RowSet</code>的<code>populate(ResultSet rs)</code>方法来包装给定的<code>ResultSet</code>,接下来的粗体字代码关闭了<code>ResultSet</code>、 <code>Statement</code>、 <code>Connection</code>等数据库资源。如果程序直接返回<code>ResultSet</code>,那么这个<code>ResultSet</code>无法使用:这是因为底层的<code>Connection</code>已经关闭了;但程序返回的是<code>CachedRowSet</code>,它是一个离线<code>RowSet</code>,因此程序依然可以读取、修改<code>RowSet</code>中的记录。</p>
<p>运行该程序,可以看到在<code>Connection</code>关闭的情况下,程序依然可以读取、修改<code>RowSet</code>里的记录.<br>为了将程序对离线<code>RowSet</code>所做的修改同步到底层数据库,程序在调用<code>RowSet</code>的<code>acceptChanges()</code>方法时必须传入<code>Connection</code>.</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://lanlan2017.github.io/JavaReadingNotes/ac209c79/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/JavaReadingNotes/images/avatar.gif">
      <meta itemprop="name" content="蓝蓝">
      <meta itemprop="description" content="好好学习，天天向上">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="蓝蓝站点">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/JavaReadingNotes/ac209c79/" class="post-title-link" itemprop="url">13.6 Java7的RowSet1.1 13.6.1 Java 7新增的RowSetFactory与RowSet</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-07-05 14:01:11" itemprop="dateCreated datePublished" datetime="2019-07-05T14:01:11+08:00">2019-07-05</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2020-02-07 01:34:56" itemprop="dateModified" datetime="2020-02-07T01:34:56+08:00">2020-02-07</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/1-%E7%96%AF%E7%8B%82Java%E8%AE%B2%E4%B9%89-%E7%AC%AC4%E7%89%88/" itemprop="url" rel="index"><span itemprop="name">1 疯狂Java讲义 (第4版)</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/1-%E7%96%AF%E7%8B%82Java%E8%AE%B2%E4%B9%89-%E7%AC%AC4%E7%89%88/%E7%AC%AC13%E7%AB%A0-MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%8EJDBC%E7%BC%96%E7%A8%8B/" itemprop="url" rel="index"><span itemprop="name">第13章 MySQL数据库与JDBC编程</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/1-%E7%96%AF%E7%8B%82Java%E8%AE%B2%E4%B9%89-%E7%AC%AC4%E7%89%88/%E7%AC%AC13%E7%AB%A0-MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%8EJDBC%E7%BC%96%E7%A8%8B/13-6-Java7%E7%9A%84RowSet1-1/" itemprop="url" rel="index"><span itemprop="name">13.6 Java7的RowSet1.1</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
    <span class="post-meta-item-icon">
      <i class="far fa-comment"></i>
    </span>
    <span class="post-meta-item-text">Waline：</span>
  
    <a title="waline" href="/JavaReadingNotes/ac209c79/#waline-comments" itemprop="discussionUrl">
      <span class="post-comments-count waline-comment-count" id="/JavaReadingNotes/ac209c79/" data-xid="/JavaReadingNotes/ac209c79/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>5.6k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>5 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="13-6-Java7的RowSet1-1"><a href="#13-6-Java7的RowSet1-1" class="headerlink" title="13.6 Java7的RowSet1.1"></a>13.6 Java7的RowSet1.1</h1><p><code>RowSet</code>接口继承了<code>ResultSet</code>接口, <code>RowSet</code>接口下包含<code>JdbcRowSet</code>、 <code>CachedRowSet</code>、 <code>FilteredRowSet</code>、<code>JoinRowset</code>和<code>WebRowSet</code>常用子接口。除了<code>JdbcRowSet</code>需要保持与数据库的连接之外,其余4个子接口都是离线的<code>RowSet</code>,无须保持与数据库的连接。<br><strong>与<code>ResultSet</code>相比, <code>RowSet</code>默认是<code>可滚动</code>、<code>可更新</code>、<code>可序列化</code>的结果集,而且作为<code>JavaBean</code>使用,因此能方便地在网络上传输,用于同步两端的数据</strong>。对于离线<code>RowSet</code>而言,程序在创建<code>RowSet</code>时已把数据从底层数据库读取到了内存,因此可以充分利用计算机的内存,从而降低数据库服务器的负载,提高程序性能。<br>图13.22显示了<code>RowSet</code>规范的接口类图。<br><img data-src="https://image-1257720033.cos.ap-shanghai.myqcloud.com/blog/readbooknote/fangkuangJavaJiangYi3/13/5.png" alt="这里有一张图片"><br><code>CachedRowSet</code>及其子接口都代表了离线<code>RowSet</code>,它们都不需要底层数据库连接。</p>
<h2 id="13-6-1-Java-7新增的RowSetFactory与RowSet"><a href="#13-6-1-Java-7新增的RowSetFactory与RowSet" class="headerlink" title="13.6.1 Java 7新增的RowSetFactory与RowSet"></a>13.6.1 Java 7新增的RowSetFactory与RowSet</h2><p>在<code>Java 6.0</code>以前, <code>RowSet</code>及其5个子接口都已经存在了,但在实际编程中的应用一直并不广泛,这是因为<code>Java</code>公开<code>API</code>并没有为<code>RowSet</code>及其各子接口提供实现类,而且也没有提供公开的方法来创建<code>RowSet</code>及其各子接口的实例。<br>实际上,<code>Java6.0</code>已经在<code>com.sun.rowset</code>包下提供了<code>JdbcRowSetlmpl</code>、 <code>CachedRowSetlmpl</code>、<code>WebRowSetlmpl</code>、 <code>FilteredRowSetlmpl</code>和<code>JoinRowSetlmpl</code>五个实现类,它们代表了各种<code>RowSet</code>接口的实现类<br>以<code>JdbcRowSet</code>为例,在<code>Java 6.0</code>及以前的版本中,如果程序需要使用<code>JdbcRowSet</code>,则必须通过调用<code>JdbcRowSetlmpl</code>的构造器来创建<code>JdbcRowSet</code>实例, <code>JdbcRowSetlmpl</code>提供了如下常用构造器.</p>
<table>
<thead>
<tr>
<th align="left">方法</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>JdbcRowSetlmpl()</code></td>
<td align="left">创建一个默认的<code>JdbcRowSetlmpl</code>对象。</td>
</tr>
<tr>
<td align="left"><code>JdbcRowSetImpl(Connection conn)</code></td>
<td align="left">以给定的<code>Connection</code>对象作为数据库连接来创建<code>JdbcRowSetlmpl</code>对象。</td>
</tr>
<tr>
<td align="left"><code>JdbcRowSetlmpl(ResultSet rs)</code></td>
<td align="left">创建包装<code>ResultSet</code>对象的<code>JdbcRowSetlmpl</code>对象.</td>
</tr>
</tbody></table>
<p>除此之外, <code>RowSet</code>接口中定义了如下常用方法。</p>
<table>
<thead>
<tr>
<th align="left">方法</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>setUrl(String ur)</code></td>
<td align="left">设置该 <code>RowSet</code>要访问的数据库的<code>URL</code></td>
</tr>
<tr>
<td align="left"><code>setUsername(String name)</code></td>
<td align="left">设置该<code>RowSet</code>要访问的数据库的用户名。</td>
</tr>
<tr>
<td align="left"><code>setPassword(String password)</code></td>
<td align="left">设置该<code>RowSet</code>要访问的数据库的密码。</td>
</tr>
<tr>
<td align="left"><code>setCommand(String sql)</code></td>
<td align="left">设置使用该<code>sql</code>语句的查询结果来装填该<code>RowSet</code>。</td>
</tr>
<tr>
<td align="left"><code>execute()</code></td>
<td align="left">执行查询</td>
</tr>
<tr>
<td align="left"><code>populate(ResultSet rs)</code></td>
<td align="left">让该<code>RowSet</code>直接包装给定的 <code>ResultSet</code>对象.</td>
</tr>
<tr>
<td align="left">通过<code>JdbcRowSet</code>的构造器和上面几个方法不难看出,为<code>JdbcRowSet</code>装填数据有如下两种方式。</td>
<td align="left"></td>
</tr>
</tbody></table>
<ul>
<li>1.创建<code>JdbcRowSetlmpl</code>时,直接传入<code>ResultSet</code>对象。</li>
<li>2.使用<code>execute()</code>方法来执行<code>SQL</code>査询,用查询返回的数据来装填<code>RowSet</code>.</li>
</ul>
<p>对于第二种方式来说,如果创建<code>JdbcRowSetlmpl</code>时已经传入了<code>Connection</code>参数,则只要先调用<code>setCommand(String sql)</code>指定<code>SQL</code>查询语句,接下来就可调用<code>execute()</code>方法执行查询了。如果创建<code>JdbcRowSetlmpl</code>时没有传入<code>Connection</code>参数,则先要为<code>JdbcRowSet</code>设置数据库的<code>URL</code>、用户名、密码等连接信息<br>下面程序通过<code>JdbcRowSetlmpl</code>示范了使用<code>JdbcRowSet</code>的<code>可滚动</code>、<code>可修改</code>特性.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.sql.*;</span><br><span class="line"><span class="keyword">import</span> javax.sql.rowset.*;</span><br><span class="line"><span class="keyword">import</span> com.sun.rowset.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JdbcRowSetTest</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String driver;</span><br><span class="line">    <span class="keyword">private</span> String url;</span><br><span class="line">    <span class="keyword">private</span> String user;</span><br><span class="line">    <span class="keyword">private</span> String pass;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">initParam</span><span class="params">(String paramFile)</span> <span class="keyword">throws</span> Exception</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// 使用Properties类来加载属性文件</span></span><br><span class="line">        Properties props = <span class="keyword">new</span> Properties();</span><br><span class="line">        props.load(<span class="keyword">new</span> FileInputStream(paramFile));</span><br><span class="line">        driver = props.getProperty(<span class="string">&quot;driver&quot;</span>);</span><br><span class="line">        url = props.getProperty(<span class="string">&quot;url&quot;</span>);</span><br><span class="line">        user = props.getProperty(<span class="string">&quot;user&quot;</span>);</span><br><span class="line">        pass = props.getProperty(<span class="string">&quot;pass&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">(String sql)</span> <span class="keyword">throws</span> Exception</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// .加载驱动</span></span><br><span class="line">        Class.forName(driver);</span><br><span class="line">        <span class="keyword">try</span> (</span><br><span class="line">                <span class="comment">// 2.获取数据库连接</span></span><br><span class="line">                Connection conn = DriverManager.getConnection(url, user, pass);</span><br><span class="line">                <span class="comment">// 3.创建JdbcRowSetImpl对象</span></span><br><span class="line">                JdbcRowSet jdbcRs = <span class="keyword">new</span> JdbcRowSetImpl(conn)) <span class="comment">// ①</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// 设置SQL查询语句</span></span><br><span class="line">            jdbcRs.setCommand(sql);</span><br><span class="line">            <span class="comment">// 执行查询</span></span><br><span class="line">            jdbcRs.execute();</span><br><span class="line">            <span class="comment">// 记录指针移动到最后一行</span></span><br><span class="line">            jdbcRs.afterLast();</span><br><span class="line">            <span class="comment">// 向前滚动结果集</span></span><br><span class="line">            <span class="keyword">while</span> (jdbcRs.previous())</span><br><span class="line">            &#123;</span><br><span class="line">                System.out.println(jdbcRs.getString(<span class="number">1</span>) + <span class="string">&quot;\t&quot;</span></span><br><span class="line">                        + jdbcRs.getString(<span class="number">2</span>) + <span class="string">&quot;\t&quot;</span> + jdbcRs.getString(<span class="number">3</span>));</span><br><span class="line">                <span class="keyword">if</span> (jdbcRs.getInt(<span class="string">&quot;student_id&quot;</span>) == <span class="number">3</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="comment">// 修改指定记录行</span></span><br><span class="line">                    jdbcRs.updateString(<span class="string">&quot;student_name&quot;</span>, <span class="string">&quot;孙悟空&quot;</span>);</span><br><span class="line">                    <span class="comment">// 更新该行记录</span></span><br><span class="line">                    jdbcRs.updateRow();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        JdbcRowSetTest jt = <span class="keyword">new</span> JdbcRowSetTest();</span><br><span class="line">        jt.initParam(<span class="string">&quot;mysql.ini&quot;</span>);</span><br><span class="line">        jt.update(<span class="string">&quot;select * from student_table&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上面程序中①号代码创建一个<code>JdbcRowSetlmpl</code>实例,这就是一个<code>JdbcRowSet</code>对象。接下来的代码则示范了<code>JdbcSet</code>的<code>可滚动</code>、<code>可修改</code>的特性。<br>编译该程序,编译器将会在①号代码处发出警告: <code>JdbcRowSetlmpl</code>是内部专用AP,可能会在未来发行版中删除。这就是直接使用<code>JdbcRowSetImpl</code>的代价.<br>需要说明的是,使用<code>JdbcRowSetlmpl</code>除了编译器会发出警告之外,还有如下坏处。</p>
<ul>
<li>程序直接与<code>JdbcRowSetlmpl</code>实现类耦合,不利于后期的升级、扩展。</li>
<li><code>JdbcRowSetlmpl</code>实现类不是一个公开的<code>API</code>,未来可能被删除。</li>
</ul>
<p>正是因为上面两个原因,所以在<code>Java 6.0</code>时代, <code>RowSet</code>并未得到广泛应用。<code>Java 7</code>新增了<code>RowSetProvider</code>类和<code>Row SetFactory</code>接口,其中<code>RowSetProvider</code>负责创建<code>RowSetFactory</code>,而<code>RowSetFactory</code>则提供了如下方法来创建<code>RowSet</code>实例。</p>
<table>
<thead>
<tr>
<th align="left">方法</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>CachedRowSet createCachedRowSet()</code></td>
<td align="left">创建一个默认的<code>CachedRowSet</code></td>
</tr>
<tr>
<td align="left"><code>FilteredRowSet createFilteredRowSet()</code></td>
<td align="left">创建一个默认的<code>FilteredRowSet</code></td>
</tr>
<tr>
<td align="left"><code>JdbcRowSet createJdbcRowSet()</code></td>
<td align="left">创建一个默认的<code>JdbcRowSet</code></td>
</tr>
<tr>
<td align="left"><code>JoinRowSet createJoinRowSet()</code></td>
<td align="left">创建一个默认的<code>JoinRowSet</code></td>
</tr>
<tr>
<td align="left"><code>WebRowSet createWebRowSet()</code></td>
<td align="left">创建一个默认的<code>WebRowSet</code></td>
</tr>
</tbody></table>
<p>通过使用<code>RowSetFactory</code>,就可以把应用程序与<code>RowSet</code>实现类分离开,避免直接使用<code>JdbcRowSetlmpl</code>等非公开的<code>API</code>,也更有利于后期的升级、扩展。<br>下面程序使用<code>RowSetFactory</code>来创建<code>JdbcRowSet</code>实例。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.sql.*;</span><br><span class="line"><span class="keyword">import</span> javax.sql.rowset.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RowSetFactoryTest</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String driver;</span><br><span class="line">    <span class="keyword">private</span> String url;</span><br><span class="line">    <span class="keyword">private</span> String user;</span><br><span class="line">    <span class="keyword">private</span> String pass;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">initParam</span><span class="params">(String paramFile)</span> <span class="keyword">throws</span> Exception</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// 使用Properties类来加载属性文件</span></span><br><span class="line">        Properties props = <span class="keyword">new</span> Properties();</span><br><span class="line">        props.load(<span class="keyword">new</span> FileInputStream(paramFile));</span><br><span class="line">        driver = props.getProperty(<span class="string">&quot;driver&quot;</span>);</span><br><span class="line">        url = props.getProperty(<span class="string">&quot;url&quot;</span>);</span><br><span class="line">        user = props.getProperty(<span class="string">&quot;user&quot;</span>);</span><br><span class="line">        pass = props.getProperty(<span class="string">&quot;pass&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">(String sql)</span> <span class="keyword">throws</span> Exception</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// 1.加载驱动</span></span><br><span class="line">        Class.forName(driver);</span><br><span class="line">        <span class="comment">// 2.使用RowSetProvider创建RowSetFactory</span></span><br><span class="line">        RowSetFactory factory = RowSetProvider.newFactory();</span><br><span class="line">        <span class="keyword">try</span> (</span><br><span class="line">                <span class="comment">// 3.使用RowSetFactory创建默认的JdbcRowSet实例</span></span><br><span class="line">                JdbcRowSet jdbcRowSet = factory.createJdbcRowSet())</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// 4.设置必要的连接信息</span></span><br><span class="line">            jdbcRowSet.setUrl(url);</span><br><span class="line">            jdbcRowSet.setUsername(user);</span><br><span class="line">            jdbcRowSet.setPassword(pass);</span><br><span class="line">            <span class="comment">// 设置SQL查询语句</span></span><br><span class="line">            jdbcRowSet.setCommand(sql);</span><br><span class="line">            <span class="comment">// 执行查询</span></span><br><span class="line">            jdbcRowSet.execute();</span><br><span class="line">            jdbcRowSet.afterLast();</span><br><span class="line">            <span class="comment">// 向前滚动结果集</span></span><br><span class="line">            <span class="keyword">while</span> (jdbcRowSet.previous())</span><br><span class="line">            &#123;</span><br><span class="line">                System.out.println(jdbcRowSet.getString(<span class="number">1</span>) + <span class="string">&quot;\t&quot;</span></span><br><span class="line">                        + jdbcRowSet.getString(<span class="number">2</span>) + <span class="string">&quot;\t&quot;</span> + jdbcRowSet.getString(<span class="number">3</span>));</span><br><span class="line">                <span class="keyword">if</span> (jdbcRowSet.getInt(<span class="string">&quot;student_id&quot;</span>) == <span class="number">3</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="comment">// 修改指定记录行</span></span><br><span class="line">                    jdbcRowSet.updateString(<span class="string">&quot;student_name&quot;</span>, <span class="string">&quot;孙悟空&quot;</span>);</span><br><span class="line">                    jdbcRowSet.updateRow();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        RowSetFactoryTest jt = <span class="keyword">new</span> RowSetFactoryTest();</span><br><span class="line">        jt.initParam(<span class="string">&quot;mysql.ini&quot;</span>);</span><br><span class="line">        jt.update(<span class="string">&quot;select * from student_table&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上面程序中使用了<code>RowSetFactory</code>来创建<code>JdbcRowSet</code>对象,这就避免了与<code>JabcRowSetlmpl</code>实现类耦合。由于通过这种方式创建的<code>JdbcRowSet</code>还没有传入<code>Connection</code>参数,因此程序还需调用<code>setUrl()</code>、 <code>setUsername()</code>、 <code>setPassword()</code>等方法来设置数据库连接信息编译、运行该程序,编译器不会发出任何警告,程序运行结果也一切正常。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://lanlan2017.github.io/JavaReadingNotes/91cc195c/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/JavaReadingNotes/images/avatar.gif">
      <meta itemprop="name" content="蓝蓝">
      <meta itemprop="description" content="好好学习，天天向上">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="蓝蓝站点">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/JavaReadingNotes/91cc195c/" class="post-title-link" itemprop="url">13.5.3 使用ResultsetMetaData分析结果集</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-07-05 13:23:27" itemprop="dateCreated datePublished" datetime="2019-07-05T13:23:27+08:00">2019-07-05</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2020-02-07 01:34:56" itemprop="dateModified" datetime="2020-02-07T01:34:56+08:00">2020-02-07</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/1-%E7%96%AF%E7%8B%82Java%E8%AE%B2%E4%B9%89-%E7%AC%AC4%E7%89%88/" itemprop="url" rel="index"><span itemprop="name">1 疯狂Java讲义 (第4版)</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/1-%E7%96%AF%E7%8B%82Java%E8%AE%B2%E4%B9%89-%E7%AC%AC4%E7%89%88/%E7%AC%AC13%E7%AB%A0-MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%8EJDBC%E7%BC%96%E7%A8%8B/" itemprop="url" rel="index"><span itemprop="name">第13章 MySQL数据库与JDBC编程</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/1-%E7%96%AF%E7%8B%82Java%E8%AE%B2%E4%B9%89-%E7%AC%AC4%E7%89%88/%E7%AC%AC13%E7%AB%A0-MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%8EJDBC%E7%BC%96%E7%A8%8B/13-5-%E7%AE%A1%E7%90%86%E7%BB%93%E6%9E%9C%E9%9B%86/" itemprop="url" rel="index"><span itemprop="name">13.5 管理结果集</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
    <span class="post-meta-item-icon">
      <i class="far fa-comment"></i>
    </span>
    <span class="post-meta-item-text">Waline：</span>
  
    <a title="waline" href="/JavaReadingNotes/91cc195c/#waline-comments" itemprop="discussionUrl">
      <span class="post-comments-count waline-comment-count" id="/JavaReadingNotes/91cc195c/" data-xid="/JavaReadingNotes/91cc195c/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>3.6k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>3 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="13-5-3-使用ResultSetMetaData分析结果集"><a href="#13-5-3-使用ResultSetMetaData分析结果集" class="headerlink" title="13.5.3 使用ResultSetMetaData分析结果集"></a>13.5.3 使用ResultSetMetaData分析结果集</h1><p>当执行<code>SQL</code>査询后可以通过移动记录指针来遍历<code>ResultSet</code>的每条记录,但程序可能不清楚该<code>ResultSet</code>里包含哪些数据列,以及每个数据列的数据类型,那么可以通过<code>ResultSetMetaData</code>来获取关于<code>ResultSet</code>的描述信息。<br><code>MetaData</code>的意思是元数据,即描述其他数据的数据,因此<code>ResultSetMetaData</code>封装了描述<code>ResultSet</code>对象的数据;后面还要介绍的<code>Database Meta Data</code>则封装了描述<code>Database</code>的数据<br><code>ResultSet</code>里包含一个<code>getMetaData()</code>方法,该方法返回该<code>ResultSet</code>对应的<code>ResultSetMetaData</code>对象旦获得了<code>ResultSetMetaData</code>对象,就可通过<code>ResultSetMetaData</code>提供的大量方法来返回<code>ResultSet</code>的描述信息。常用的方法有如下三个。</p>
<ul>
<li><code>int getColumnCount()</code>:返回该<code>ResultSet</code>的列数量。</li>
<li><code>String getColumnName(int column)</code>:返回指定索引的列名。</li>
<li><code>int getType(int column)</code>:返回指定索引的列类型。</li>
</ul>
<p>下面是一个简单的查询执行器,当用户在文本框内输入合法的查询语句并执行成功后,下面的表格将会显示查询结果。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.awt.*;</span><br><span class="line"><span class="keyword">import</span> java.awt.event.*;</span><br><span class="line"><span class="keyword">import</span> javax.swing.*;</span><br><span class="line"><span class="keyword">import</span> javax.swing.table.*;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.sql.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">QueryExecutor</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    JFrame jf = <span class="keyword">new</span> JFrame(<span class="string">&quot;查询执行器&quot;</span>);</span><br><span class="line">    <span class="keyword">private</span> JScrollPane scrollPane;</span><br><span class="line">    <span class="keyword">private</span> JButton execBn = <span class="keyword">new</span> JButton(<span class="string">&quot;查询&quot;</span>);</span><br><span class="line">    <span class="comment">// 用于输入查询语句的文本框</span></span><br><span class="line">    <span class="keyword">private</span> JTextField sqlField = <span class="keyword">new</span> JTextField(<span class="number">45</span>);</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Connection conn;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Statement stmt;</span><br><span class="line">    <span class="comment">// 采用静态初始化块来初始化Connection、Statement对象</span></span><br><span class="line">    <span class="keyword">static</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">try</span></span><br><span class="line">        &#123;</span><br><span class="line">            Properties props = <span class="keyword">new</span> Properties();</span><br><span class="line">            props.load(<span class="keyword">new</span> FileInputStream(<span class="string">&quot;mysql.ini&quot;</span>));</span><br><span class="line">            String drivers = props.getProperty(<span class="string">&quot;driver&quot;</span>);</span><br><span class="line">            String url = props.getProperty(<span class="string">&quot;url&quot;</span>);</span><br><span class="line">            String username = props.getProperty(<span class="string">&quot;user&quot;</span>);</span><br><span class="line">            String password = props.getProperty(<span class="string">&quot;pass&quot;</span>);</span><br><span class="line">            <span class="comment">// 1。加载数据库驱动</span></span><br><span class="line">            Class.forName(drivers);</span><br><span class="line">            <span class="comment">// 2.取得数据库连接</span></span><br><span class="line">            conn = DriverManager.getConnection(url, username, password);</span><br><span class="line">            <span class="comment">// 3.通过连接创建Statement对象</span></span><br><span class="line">            stmt = conn.createStatement();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e)</span><br><span class="line">        &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// --------初始化界面的方法---------</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        JPanel top = <span class="keyword">new</span> JPanel();</span><br><span class="line">        top.add(<span class="keyword">new</span> JLabel(<span class="string">&quot;输入查询语句：&quot;</span>));</span><br><span class="line">        top.add(sqlField);</span><br><span class="line">        top.add(execBn);</span><br><span class="line">        <span class="comment">// 为执行按钮、单行文本框添加事件监听器</span></span><br><span class="line">        execBn.addActionListener(<span class="keyword">new</span> ExceListener());</span><br><span class="line">        sqlField.addActionListener(<span class="keyword">new</span> ExceListener());</span><br><span class="line">        jf.add(top, BorderLayout.NORTH);</span><br><span class="line">        jf.setSize(<span class="number">680</span>, <span class="number">480</span>);</span><br><span class="line">        jf.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);</span><br><span class="line">        jf.setVisible(<span class="keyword">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 定义监听器</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">ExceListener</span> <span class="keyword">implements</span> <span class="title">ActionListener</span></span></span><br><span class="line"><span class="class">    </span>&#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">actionPerformed</span><span class="params">(ActionEvent evt)</span></span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="comment">// 删除原来的JTable(JTable使用scrollPane来包装)</span></span><br><span class="line">            <span class="keyword">if</span> (scrollPane != <span class="keyword">null</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                jf.remove(scrollPane);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">try</span> (</span><br><span class="line">                    <span class="comment">// 根据用户输入的SQL执行查询</span></span><br><span class="line">                    ResultSet rs = stmt.executeQuery(sqlField.getText()))</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// 取出ResultSet的MetaData</span></span><br><span class="line">                ResultSetMetaData resultSetMetaData = rs.getMetaData();</span><br><span class="line">                Vector&lt;String&gt; columnNames = <span class="keyword">new</span> Vector&lt;&gt;();</span><br><span class="line">                Vector&lt;Vector&lt;String&gt;&gt; data = <span class="keyword">new</span> Vector&lt;&gt;();</span><br><span class="line">                <span class="comment">// 把ResultSet的所有列名添加到Vector里</span></span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; resultSetMetaData.getColumnCount(); i++)</span><br><span class="line">                &#123;</span><br><span class="line">                    columnNames.add(resultSetMetaData.getColumnName(i + <span class="number">1</span>));</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// 把ResultSet的所有记录添加到Vector里</span></span><br><span class="line">                <span class="keyword">while</span> (rs.next())</span><br><span class="line">                &#123;</span><br><span class="line">                    Vector&lt;String&gt; v = <span class="keyword">new</span> Vector&lt;&gt;();</span><br><span class="line">                    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>, length = resultSetMetaData</span><br><span class="line">                            .getColumnCount(); i &lt; length; i++)</span><br><span class="line">                    &#123;</span><br><span class="line">                        v.add(rs.getString(i + <span class="number">1</span>));</span><br><span class="line">                    &#125;</span><br><span class="line">                    data.add(v);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// 创建新的JTable</span></span><br><span class="line">                JTable table = <span class="keyword">new</span> JTable(data, columnNames);</span><br><span class="line">                scrollPane = <span class="keyword">new</span> JScrollPane(table);</span><br><span class="line">                <span class="comment">// 添加新的Table</span></span><br><span class="line">                jf.add(scrollPane);</span><br><span class="line">                <span class="comment">// 更新主窗口</span></span><br><span class="line">                jf.validate();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e)</span><br><span class="line">            &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">new</span> QueryExecutor().init();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在上面的程序中使用<code>ResultSetMetaData</code>查询<code>ResultSet</code>包含多少列,并把所有数据列的列名添加到一个<code>Vector</code>里,然后把<code>ResultSet</code>里的所有数据添加到另一个<code>Vector</code>里,并使用这两个<code>Vector</code>来创建新的<code>TableModel</code>,再利用该<code>TableMode</code>生成一个新的<code>JTable</code>,最后将该<code>JTable</code>显示出来。<br>运行上面程序,在文本框中输入<code>select * from student_table</code>然后点击查询,会看到如图13.21所示的窗口。</p>
<p><strong>注意:</strong><br>虽然<code>ResultSetMetaData</code>可以准确地分析出<code>ResultSet</code>里包含多少列,以及每列的列名、数据类型等,但使用<code>ResultSetMetaData</code>需要一定的系统开销,因此如果在编程过程中已经知道<code>ResultSet</code>里包含多少列,以及每列的列名、类型等信息,就没有必要使用<code>ResultSetMetaData</code>来分析该<code>ResultSet</code>对象了。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://lanlan2017.github.io/JavaReadingNotes/baee47ce/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/JavaReadingNotes/images/avatar.gif">
      <meta itemprop="name" content="蓝蓝">
      <meta itemprop="description" content="好好学习，天天向上">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="蓝蓝站点">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/JavaReadingNotes/baee47ce/" class="post-title-link" itemprop="url">13.5.2 处理Blob类型数据</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-07-05 11:30:15" itemprop="dateCreated datePublished" datetime="2019-07-05T11:30:15+08:00">2019-07-05</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2020-02-07 01:34:56" itemprop="dateModified" datetime="2020-02-07T01:34:56+08:00">2020-02-07</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/1-%E7%96%AF%E7%8B%82Java%E8%AE%B2%E4%B9%89-%E7%AC%AC4%E7%89%88/" itemprop="url" rel="index"><span itemprop="name">1 疯狂Java讲义 (第4版)</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/1-%E7%96%AF%E7%8B%82Java%E8%AE%B2%E4%B9%89-%E7%AC%AC4%E7%89%88/%E7%AC%AC13%E7%AB%A0-MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%8EJDBC%E7%BC%96%E7%A8%8B/" itemprop="url" rel="index"><span itemprop="name">第13章 MySQL数据库与JDBC编程</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/1-%E7%96%AF%E7%8B%82Java%E8%AE%B2%E4%B9%89-%E7%AC%AC4%E7%89%88/%E7%AC%AC13%E7%AB%A0-MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%8EJDBC%E7%BC%96%E7%A8%8B/13-5-%E7%AE%A1%E7%90%86%E7%BB%93%E6%9E%9C%E9%9B%86/" itemprop="url" rel="index"><span itemprop="name">13.5 管理结果集</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
    <span class="post-meta-item-icon">
      <i class="far fa-comment"></i>
    </span>
    <span class="post-meta-item-text">Waline：</span>
  
    <a title="waline" href="/JavaReadingNotes/baee47ce/#waline-comments" itemprop="discussionUrl">
      <span class="post-comments-count waline-comment-count" id="/JavaReadingNotes/baee47ce/" data-xid="/JavaReadingNotes/baee47ce/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>7.8k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>7 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="13-5-2-处理Blob类型数据"><a href="#13-5-2-处理Blob类型数据" class="headerlink" title="13.5.2 处理Blob类型数据"></a>13.5.2 处理Blob类型数据</h1><p><code>Blob(Binary Long Object)</code>是二进制长对象的意思,<code>Blob</code>列通常用于存储大文件,典型的<code>Blob</code>内容是一张图片或一个声音文件,由于它们的特殊性,必须使用特殊的方式来存储。使用<code>Blob</code>列可以把图片、声音等文件的二进制数据保存在数据库里,并可以从数据库里恢复指定文件。<br>如果需要将图片插入数据库,显然不能直接通过普通的<code>SQL</code>语句来完成,因为有一个关键的问题: <code>Blob</code>常量无法表示。所以将<code>Blob</code>数据插入数据库需要使用<code>PreparedStatement</code>,该对象有一个方法:<code>setBinaryStream(int parameterIndex, InputStream x)</code>,该方法可以为指定参数传入二进制输入流,从而可以实现将<code>Blob</code>数据保存到数据库的功能。<br>当需要从<code>ResultSet</code>里取出<code>Blob</code>数据时,可以调用<code>ResultSet</code>的<code>getBlob( int columnIndex)</code>方法,该方法将返回一个<code>Blob</code>对象,<code>Blob</code>对象提供了<code>getBinaryStream()</code>方法来获取该<code>Blob</code>数据的输入流,也可以使用<code>Blb</code>对象提供的<code>getBytes()</code>方法直接取出该<code>Blob</code>对象封装的二进制数据。<br>为了把图片放入数据库,本程序先使用如下<code>SQL</code>语句来建立一个数据表。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> img_table</span><br><span class="line">(</span><br><span class="line">    img_id <span class="type">int</span> auto_increment <span class="keyword">primary</span> key,</span><br><span class="line">    img_name <span class="type">varchar</span>(<span class="number">255</span>),</span><br><span class="line">    img_data mediumblob</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p>上面<code>SQL</code>语句中的<code>img_data</code>列使用<code>mediumblob</code>类型,而是<code>blob</code>类型。因为<code>MySQL</code>数据库里的<code>blob</code>类型最多只能存储<code>64KB</code>内容,这可能不够满足实际用途。所以使用<code>mediumblob</code>类型,该类型的数据列可以存储<code>16MB</code>内容.<br>下面程序可以实现图片”上传”——实际上就是将图片保存到数据库,并在右边的列表框中显示图片的名字,<br>当用户双击列表框中的图片名时,左边窗口将显示该图片—实质就是根据选中的<code>ID</code>从数据库里查找图片,并将其显示出来。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.sql.*;</span><br><span class="line"><span class="keyword">import</span> javax.swing.*;</span><br><span class="line"><span class="keyword">import</span> java.awt.*;</span><br><span class="line"><span class="keyword">import</span> java.awt.event.*;</span><br><span class="line"><span class="keyword">import</span> java.util.Properties;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> javax.swing.filechooser.FileFilter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BlobTest</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    JFrame jf = <span class="keyword">new</span> JFrame(<span class="string">&quot;图片管理程序&quot;</span>);</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Connection conn;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> PreparedStatement insert;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> PreparedStatement query;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> PreparedStatement queryAll;</span><br><span class="line">    <span class="comment">// 定义一个DefaultListModel对象</span></span><br><span class="line">    <span class="keyword">private</span> DefaultListModel&lt;ImageHolder&gt; imageModel = <span class="keyword">new</span> DefaultListModel&lt;&gt;();</span><br><span class="line">    <span class="keyword">private</span> JList&lt;ImageHolder&gt; imageList = <span class="keyword">new</span> JList&lt;&gt;(imageModel);</span><br><span class="line">    <span class="keyword">private</span> JTextField filePath = <span class="keyword">new</span> JTextField(<span class="number">26</span>);</span><br><span class="line">    <span class="keyword">private</span> JButton browserBn = <span class="keyword">new</span> JButton(<span class="string">&quot;...&quot;</span>);</span><br><span class="line">    <span class="keyword">private</span> JButton uploadBn = <span class="keyword">new</span> JButton(<span class="string">&quot;上传&quot;</span>);</span><br><span class="line">    <span class="keyword">private</span> JLabel imageLabel = <span class="keyword">new</span> JLabel();</span><br><span class="line">    <span class="comment">// 以当前路径创建文件选择器</span></span><br><span class="line">    JFileChooser chooser = <span class="keyword">new</span> JFileChooser(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">    <span class="comment">// 创建文件过滤器</span></span><br><span class="line">    ExtensionFileFilter filter = <span class="keyword">new</span> ExtensionFileFilter();</span><br><span class="line">    <span class="keyword">static</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">try</span></span><br><span class="line">        &#123;</span><br><span class="line">            Properties props = <span class="keyword">new</span> Properties();</span><br><span class="line">            props.load(<span class="keyword">new</span> FileInputStream(<span class="string">&quot;mysql.ini&quot;</span>));</span><br><span class="line">            String driver = props.getProperty(<span class="string">&quot;driver&quot;</span>);</span><br><span class="line">            String url = props.getProperty(<span class="string">&quot;url&quot;</span>);</span><br><span class="line">            String user = props.getProperty(<span class="string">&quot;user&quot;</span>);</span><br><span class="line">            String pass = props.getProperty(<span class="string">&quot;pass&quot;</span>);</span><br><span class="line">            <span class="comment">// 1.加载数据库驱动</span></span><br><span class="line">            Class.forName(driver);</span><br><span class="line">            <span class="comment">// 2.获取数据库连接</span></span><br><span class="line">            conn = DriverManager.getConnection(url, user, pass);</span><br><span class="line">            <span class="comment">// 3.创建执行插入的PreparedStatement对象，</span></span><br><span class="line">            <span class="comment">// 该对象执行插入后可以返回自动生成的主键</span></span><br><span class="line">            insert = conn.prepareStatement(</span><br><span class="line">                    <span class="string">&quot;insert into img_table&quot;</span> + <span class="string">&quot; values(null,?,?)&quot;</span>,</span><br><span class="line">                    Statement.RETURN_GENERATED_KEYS);</span><br><span class="line">            <span class="comment">// 创建两个PreparedStatement对象，用于查询指定图片，查询所有图片</span></span><br><span class="line">            query = conn.prepareStatement(</span><br><span class="line">                    <span class="string">&quot;select img_data from img_table&quot;</span> + <span class="string">&quot; where img_id=?&quot;</span>);</span><br><span class="line">            queryAll = conn.prepareStatement(</span><br><span class="line">                    <span class="string">&quot;select img_id, &quot;</span> + <span class="string">&quot; img_name from img_table&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e)</span><br><span class="line">        &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> <span class="keyword">throws</span> SQLException</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// -------初始化文件选择器--------</span></span><br><span class="line">        filter.addExtension(<span class="string">&quot;jpg&quot;</span>);</span><br><span class="line">        filter.addExtension(<span class="string">&quot;jpeg&quot;</span>);</span><br><span class="line">        filter.addExtension(<span class="string">&quot;gif&quot;</span>);</span><br><span class="line">        filter.addExtension(<span class="string">&quot;png&quot;</span>);</span><br><span class="line">        filter.setDescription(<span class="string">&quot;图片文件(*.jpg,*.jpeg,*.gif,*.png)&quot;</span>);</span><br><span class="line">        chooser.addChoosableFileFilter(filter);</span><br><span class="line">        <span class="comment">// 禁止“文件类型”下拉列表中显示“所有文件”选项。</span></span><br><span class="line">        chooser.setAcceptAllFileFilterUsed(<span class="keyword">false</span>);</span><br><span class="line">        <span class="comment">// ---------初始化程序界面---------</span></span><br><span class="line">        fillListModel();</span><br><span class="line">        filePath.setEditable(<span class="keyword">false</span>);</span><br><span class="line">        <span class="comment">// 只能单选</span></span><br><span class="line">        imageList.setSelectionMode(ListSelectionModel.SINGLE_SELECTION);</span><br><span class="line">        JPanel jp = <span class="keyword">new</span> JPanel();</span><br><span class="line">        jp.add(filePath);</span><br><span class="line">        jp.add(browserBn);</span><br><span class="line">        browserBn.addActionListener(event -&gt;</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// 显示文件对话框</span></span><br><span class="line">            <span class="keyword">int</span> result = chooser.showDialog(jf, <span class="string">&quot;浏览图片文件上传&quot;</span>);</span><br><span class="line">            <span class="comment">// 如果用户选择了APPROVE（赞同）按钮，即打开，保存等效按钮</span></span><br><span class="line">            <span class="keyword">if</span> (result == JFileChooser.APPROVE_OPTION)</span><br><span class="line">            &#123;</span><br><span class="line">                filePath.setText(chooser.getSelectedFile().getPath());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        jp.add(uploadBn);</span><br><span class="line">        uploadBn.addActionListener(avt -&gt;</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// 如果上传文件的文本框有内容</span></span><br><span class="line">            <span class="keyword">if</span> (filePath.getText().trim().length() &gt; <span class="number">0</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// 将指定文件保存到数据库</span></span><br><span class="line">                upload(filePath.getText());</span><br><span class="line">                <span class="comment">// 清空文本框内容</span></span><br><span class="line">                filePath.setText(<span class="string">&quot;&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        JPanel left = <span class="keyword">new</span> JPanel();</span><br><span class="line">        left.setLayout(<span class="keyword">new</span> BorderLayout());</span><br><span class="line">        left.add(<span class="keyword">new</span> JScrollPane(imageLabel), BorderLayout.CENTER);</span><br><span class="line">        left.add(jp, BorderLayout.SOUTH);</span><br><span class="line">        jf.add(left);</span><br><span class="line">        imageList.setFixedCellWidth(<span class="number">160</span>);</span><br><span class="line">        jf.add(<span class="keyword">new</span> JScrollPane(imageList), BorderLayout.EAST);</span><br><span class="line">        imageList.addMouseListener(<span class="keyword">new</span> MouseAdapter()</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">mouseClicked</span><span class="params">(MouseEvent e)</span></span></span><br><span class="line"><span class="function">            </span>&#123;</span><br><span class="line">                <span class="comment">// 如果鼠标双击</span></span><br><span class="line">                <span class="keyword">if</span> (e.getClickCount() &gt;= <span class="number">2</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="comment">// 取出选中的List项</span></span><br><span class="line">                    ImageHolder cur = (ImageHolder) imageList</span><br><span class="line">                            .getSelectedValue();</span><br><span class="line">                    <span class="keyword">try</span></span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="comment">// 显示选中项对应的Image</span></span><br><span class="line">                        showImage(cur.getId());</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (SQLException sqle)</span><br><span class="line">                    &#123;</span><br><span class="line">                        sqle.printStackTrace();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        jf.setSize(<span class="number">620</span>, <span class="number">400</span>);</span><br><span class="line">        jf.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);</span><br><span class="line">        jf.setVisible(<span class="keyword">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ----------查找img_table填充ListModel----------</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">fillListModel</span><span class="params">()</span> <span class="keyword">throws</span> SQLException</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> (</span><br><span class="line">                <span class="comment">// 执行查询</span></span><br><span class="line">                ResultSet rs = queryAll.executeQuery())</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// 先清除所有元素</span></span><br><span class="line">            imageModel.clear();</span><br><span class="line">            <span class="comment">// 把查询的全部记录添加到ListModel中</span></span><br><span class="line">            <span class="keyword">while</span> (rs.next())</span><br><span class="line">            &#123;</span><br><span class="line">                imageModel.addElement(</span><br><span class="line">                        <span class="keyword">new</span> ImageHolder(rs.getInt(<span class="number">1</span>), rs.getString(<span class="number">2</span>)));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ---------将指定图片放入数据库---------</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">upload</span><span class="params">(String fileName)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// 截取文件名</span></span><br><span class="line">        String imageName = fileName.substring(fileName.lastIndexOf(<span class="string">&#x27;\\&#x27;</span>) + <span class="number">1</span>,</span><br><span class="line">                fileName.lastIndexOf(<span class="string">&#x27;.&#x27;</span>));</span><br><span class="line">        File f = <span class="keyword">new</span> File(fileName);</span><br><span class="line">        <span class="keyword">try</span> (InputStream is = <span class="keyword">new</span> FileInputStream(f))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// 设置图片名参数</span></span><br><span class="line">            insert.setString(<span class="number">1</span>, imageName);</span><br><span class="line">            <span class="comment">// 设置二进制流参数</span></span><br><span class="line">            insert.setBinaryStream(<span class="number">2</span>, is, (<span class="keyword">int</span>) f.length());</span><br><span class="line">            <span class="keyword">int</span> affect = insert.executeUpdate();</span><br><span class="line">            <span class="keyword">if</span> (affect == <span class="number">1</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// 重新更新ListModel，将会让JList显示最新的图片列表</span></span><br><span class="line">                fillListModel();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e)</span><br><span class="line">        &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ---------根据图片ID来显示图片----------</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">showImage</span><span class="params">(<span class="keyword">int</span> id)</span> <span class="keyword">throws</span> SQLException</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// 设置参数</span></span><br><span class="line">        query.setInt(<span class="number">1</span>, id);</span><br><span class="line">        <span class="keyword">try</span> (</span><br><span class="line">                <span class="comment">// 执行查询</span></span><br><span class="line">                ResultSet rs = query.executeQuery())</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (rs.next())</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// 取出Blob列</span></span><br><span class="line">                Blob imgBlob = rs.getBlob(<span class="number">1</span>);</span><br><span class="line">                <span class="comment">// 取出Blob列里的数据</span></span><br><span class="line">                ImageIcon icon = <span class="keyword">new</span> ImageIcon(</span><br><span class="line">                        imgBlob.getBytes(<span class="number">1L</span>, (<span class="keyword">int</span>) imgBlob.length()));</span><br><span class="line">                imageLabel.setIcon(icon);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> SQLException</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">new</span> BlobTest().init();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 创建FileFilter的子类，用以实现文件过滤功能</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ExtensionFileFilter</span> <span class="keyword">extends</span> <span class="title">FileFilter</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String description = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> ArrayList&lt;String&gt; extensions = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    <span class="comment">// 自定义方法，用于添加文件扩展名</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addExtension</span><span class="params">(String extension)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!extension.startsWith(<span class="string">&quot;.&quot;</span>))</span><br><span class="line">        &#123;</span><br><span class="line">            extension = <span class="string">&quot;.&quot;</span> + extension;</span><br><span class="line">            extensions.add(extension.toLowerCase());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 用于设置该文件过滤器的描述文本</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setDescription</span><span class="params">(String aDescription)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        description = aDescription;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 继承FileFilter类必须实现的抽象方法，返回该文件过滤器的描述文本</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getDescription</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> description;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 继承FileFilter类必须实现的抽象方法，判断该文件过滤器是否接受该文件</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">accept</span><span class="params">(File f)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// 如果该文件是路径，接受该文件</span></span><br><span class="line">        <span class="keyword">if</span> (f.isDirectory())</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        <span class="comment">// 将文件名转为小写（全部转为小写后比较，用于忽略文件名大小写）</span></span><br><span class="line">        String name = f.getName().toLowerCase();</span><br><span class="line">        <span class="comment">// 遍历所有可接受的扩展名，如果扩展名相同，该文件就可接受。</span></span><br><span class="line">        <span class="keyword">for</span> (String extension : extensions)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (name.endsWith(extension))</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 创建一个ImageHolder类，用于封装图片名、图片ID</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ImageHolder</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">// 封装图片的ID</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line">    <span class="comment">// 封装图片的图片名字</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ImageHolder</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ImageHolder</span><span class="params">(<span class="keyword">int</span> id, String name)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// id的setter和getter方法</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(<span class="keyword">int</span> id)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getId</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.id;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// name的setter和getter方法</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 重写toString方法，返回图片名</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>下面是一个简单的查询执行器,当用户在文本框内输入合法的查询语句并执行成功后,下面的表格将会显示查询结果。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://lanlan2017.github.io/JavaReadingNotes/28ac401c/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/JavaReadingNotes/images/avatar.gif">
      <meta itemprop="name" content="蓝蓝">
      <meta itemprop="description" content="好好学习，天天向上">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="蓝蓝站点">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/JavaReadingNotes/28ac401c/" class="post-title-link" itemprop="url">13.5 管理结果集 13.5.1 可滚动,可更新的结果集</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-07-04 23:45:51" itemprop="dateCreated datePublished" datetime="2019-07-04T23:45:51+08:00">2019-07-04</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2020-02-07 01:34:56" itemprop="dateModified" datetime="2020-02-07T01:34:56+08:00">2020-02-07</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/1-%E7%96%AF%E7%8B%82Java%E8%AE%B2%E4%B9%89-%E7%AC%AC4%E7%89%88/" itemprop="url" rel="index"><span itemprop="name">1 疯狂Java讲义 (第4版)</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/1-%E7%96%AF%E7%8B%82Java%E8%AE%B2%E4%B9%89-%E7%AC%AC4%E7%89%88/%E7%AC%AC13%E7%AB%A0-MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%8EJDBC%E7%BC%96%E7%A8%8B/" itemprop="url" rel="index"><span itemprop="name">第13章 MySQL数据库与JDBC编程</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/1-%E7%96%AF%E7%8B%82Java%E8%AE%B2%E4%B9%89-%E7%AC%AC4%E7%89%88/%E7%AC%AC13%E7%AB%A0-MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%8EJDBC%E7%BC%96%E7%A8%8B/13-5-%E7%AE%A1%E7%90%86%E7%BB%93%E6%9E%9C%E9%9B%86/" itemprop="url" rel="index"><span itemprop="name">13.5 管理结果集</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
    <span class="post-meta-item-icon">
      <i class="far fa-comment"></i>
    </span>
    <span class="post-meta-item-text">Waline：</span>
  
    <a title="waline" href="/JavaReadingNotes/28ac401c/#waline-comments" itemprop="discussionUrl">
      <span class="post-comments-count waline-comment-count" id="/JavaReadingNotes/28ac401c/" data-xid="/JavaReadingNotes/28ac401c/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>3.4k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>3 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="13-5-管理结果集"><a href="#13-5-管理结果集" class="headerlink" title="13.5 管理结果集"></a>13.5 管理结果集</h1><p><code>JDBC</code>使用<code>ResultSet</code>来封装执行查询得到的查询结果,然后通过移动<code>ResultSet</code>的记录指针来取出结果集的内容。除此之外,<code>JDBC</code>还允许通过<code>ResultSet</code>来更新记录,并提供了<code>ResultSetMetaData</code>来获得<code>ResultSet</code>对象的相关信息。</p>
<h1 id="13-5-1-可滚动-可更新的结果集"><a href="#13-5-1-可滚动-可更新的结果集" class="headerlink" title="13.5.1 可滚动,可更新的结果集"></a>13.5.1 可滚动,可更新的结果集</h1><p>前面提到, <code>ResultSet</code>定位记录指针的方法有<code>absolute()</code>、 <code>previous()</code>等方法,但前面程序自始至终都只用了<code>next()</code>方法来移动记录指针,实际上也可以使用<code>absolute()</code>、 <code>previous()</code>、 <code>last()</code>等方法来移动记录指针。</p>
<p>可以使用<code>absolute()</code>、 <code>previous()</code>、 <code>afterLast()</code>等方法自由移动记录指针的<code>ResultSet()</code>被称为可滚动的结果集。</p>
<h2 id="Java-5以后-ResultSet-默认可滚动"><a href="#Java-5以后-ResultSet-默认可滚动" class="headerlink" title="Java 5以后 ResultSet 默认可滚动"></a>Java 5以后 ResultSet 默认可滚动</h2><p>在<code>JDK1.4</code>以前,默认打开的<code>ResultSet</code>是不可滚动的,必须在创建<code>Statement</code>或<code>PreparedStatement</code>时传入额外的参数。<strong>从<code>Java 5.0</code>以后,默认打开的<code>ResultSet</code>就是可滚动的,无须传入额外的参数</strong>.</p>
<p>以默认方式打开的<code>ResultSet</code>是不可更新的,如果希望创建可更新的<code>ResultSet</code>,则必须在创建<code>Statement</code>或<code>PreparedStatement</code>时传入额外的参数。</p>
<p><code>Connection</code>在创建<code>Statement</code>或<code>PreparedStatement</code>时还可额外传入如下两个参数。</p>
<ul>
<li><code>resultSetType</code>:控制<code>ResultSet</code>的类型,该参数可以取如下三个值。<ul>
<li><code>ResultSet.TYPE_FOWARD_ONLY</code>:该常量控制记录指针只能向前移动。这是<code>JDK 1.4</code>以前的默认值。</li>
<li><code>ResultSet.TYPE_SCROLL_INSENSITIVE</code>:该常量控制记录指针可以自由移动(可滚动结果集),但底层数据的改变不会影响<code>ResultSet</code>的内容。</li>
<li><code>ResultSet.TYPE_SCROLL_SENSITIVE</code>:该常量控制记录指针可以自由移动(可滚动结果集),而且<strong>底层数据的改变会影响<code>ResultSet</code>的内容</strong>。</li>
</ul>
</li>
<li><code>resultSetConcurrency</code>:控制<code>ResultSet</code>的<code>并发类型</code>,该参数可以接收如下两个值。<ul>
<li><code>ResultSet.CONCUR_READ_ONLY</code>:该常量指示<code>ResultSet</code>是<code>只读</code>的并发模式(默认)。</li>
<li><code>ResultSet.CONCUR_UPDATABLE</code>:该常量指示<code>ResultSet</code>是<code>可更新</code>的并发模式。</li>
</ul>
</li>
</ul>
<p>注意:<code>TYPE_SCROLL_INSENSITIVE</code>、 <code>TYPE_SCROLL_SENSITIVE</code>两个常量的作用需要底层数据库驱动的支持,对于有些数据库驱动来说,这两个常量并没有太大的区别。</p>
<p>下面代码通过这两个参数创建了一个<code>PreparedStatement</code>对象,由该对象生成的<code>ResultSet</code>对象将是可滚动、可更新的结果集。</p>
<p>需要指出的是,可更新的结果集还需要满足如下两个条件。</p>
<ul>
<li>所有数据都应该来自一个表。</li>
<li>选出的数据集必须包含主键列。</li>
</ul>
<p>通过该<code>PreparedStatement</code>创建的<code>ResultSet</code>就是可滚动、可更新的,程序可调用<code>ResultSet</code>的<code>updateXxx(int columnIndex, Xxx value)</code>方法来修改记录指针所指向的行的特定列的值,最后调用<code>ResultSet</code>的<code>updateRow()</code>方法来提交修改。<br><code>Java 8</code>为<code>ResultSet</code>添加了:</p>
<ul>
<li><code>updateObject(String columnLabel,Object x, SQLType targetSqlType)</code>和</li>
<li><code>updateObject(int columnIndex, Object x, SQLType targetsqlType)</code></li>
</ul>
<p>这两个默认方法,这两个方法可以直接用<code>Object</code>来修改记录指针所指记录、特定列的值,其中<code>SQLType</code>用于指定该数据列的类型.但目前最新的<code>MySQL</code>驱动暂不支持该方法。<br>下面程序示范了这种创建可滚动、可更新的结果集的方法。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.sql.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ResultSetTest</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String driver;</span><br><span class="line">    <span class="keyword">private</span> String url;</span><br><span class="line">    <span class="keyword">private</span> String user;</span><br><span class="line">    <span class="keyword">private</span> String pass;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">initParam</span><span class="params">(String paramFile)</span> <span class="keyword">throws</span> Exception</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// 使用Properties类来加载属性文件</span></span><br><span class="line">        Properties props = <span class="keyword">new</span> Properties();</span><br><span class="line">        props.load(<span class="keyword">new</span> FileInputStream(paramFile));</span><br><span class="line">        driver = props.getProperty(<span class="string">&quot;driver&quot;</span>);</span><br><span class="line">        url = props.getProperty(<span class="string">&quot;url&quot;</span>);</span><br><span class="line">        user = props.getProperty(<span class="string">&quot;user&quot;</span>);</span><br><span class="line">        pass = props.getProperty(<span class="string">&quot;pass&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">query</span><span class="params">(String sql)</span> <span class="keyword">throws</span> Exception</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// 1.加载驱动</span></span><br><span class="line">        Class.forName(driver);</span><br><span class="line">        <span class="keyword">try</span> (</span><br><span class="line">                <span class="comment">// 2.获取数据库连接</span></span><br><span class="line">                Connection conn = DriverManager.getConnection(url, user, pass);</span><br><span class="line">                <span class="comment">// 3.创建Statement对象</span></span><br><span class="line">                <span class="comment">// 使用Connection来创建一个PreparedStatement对象</span></span><br><span class="line">                <span class="comment">// 传入参数使得结果集可滚动,可更新.</span></span><br><span class="line">                PreparedStatement pstmt = conn.prepareStatement(sql,</span><br><span class="line">                        ResultSet.TYPE_SCROLL_INSENSITIVE,</span><br><span class="line">                        ResultSet.CONCUR_UPDATABLE);</span><br><span class="line">                <span class="comment">// 4.使用Statement对象操作数据库</span></span><br><span class="line">                ResultSet rs = pstmt.executeQuery())</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// 移动记录指针到最后一行</span></span><br><span class="line">            rs.last();</span><br><span class="line">            <span class="comment">// 获取行号</span></span><br><span class="line">            <span class="keyword">int</span> rowCount = rs.getRow();</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = rowCount; i &gt; <span class="number">0</span>; i--)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// 移动行记录指针到第i行</span></span><br><span class="line">                rs.absolute(i);</span><br><span class="line">                <span class="comment">// 从结果集中取出数据列</span></span><br><span class="line">                System.out.println(rs.getString(<span class="number">1</span>) + <span class="string">&quot;\t&quot;</span> + rs.getString(<span class="number">2</span>)</span><br><span class="line">                        + <span class="string">&quot;\t&quot;</span> + rs.getString(<span class="number">3</span>));</span><br><span class="line">                <span class="comment">// 修改记录指针所有记录、第2列的值</span></span><br><span class="line">                rs.updateString(<span class="number">2</span>, <span class="string">&quot;学生名&quot;</span> + i);</span><br><span class="line">                <span class="comment">// 提交修改</span></span><br><span class="line">                rs.updateRow();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        ResultSetTest rt = <span class="keyword">new</span> ResultSetTest();</span><br><span class="line">        rt.initParam(<span class="string">&quot;mysql.ini&quot;</span>);</span><br><span class="line">        rt.query(<span class="string">&quot;select * from student_table&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>运行上面程序,将会看到<code>student_table</code>表中的记录被倒过来输出了,因为是从最大记录行开始输出的。而且当程序运行结束后, <code>student_table</code>表中所有记录的<code>student_name</code>列的值都被修改了。<br>运行效果如下:</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">7</span>       赵六    <span class="number">3</span></span><br><span class="line"><span class="number">6</span>       null    <span class="number">2</span></span><br><span class="line"><span class="number">5</span>       _王五   <span class="number">2</span></span><br><span class="line"><span class="number">4</span>       王五    <span class="number">2</span></span><br><span class="line"><span class="number">3</span>       李四    <span class="number">1</span></span><br><span class="line"><span class="number">2</span>       张三    <span class="number">1</span></span><br><span class="line"><span class="number">1</span>       张三    <span class="number">1</span></span><br></pre></td></tr></table></figure>
<p><strong>注意:</strong><br>如果要创建可更新的结果集,则使用查询语句查询的数据通常只能来自于一个数据表,而且查询结果集中的数据列必须包含主键列,否则将会引起更新失败</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://lanlan2017.github.io/JavaReadingNotes/50709bfb/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/JavaReadingNotes/images/avatar.gif">
      <meta itemprop="name" content="蓝蓝">
      <meta itemprop="description" content="好好学习，天天向上">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="蓝蓝站点">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/JavaReadingNotes/50709bfb/" class="post-title-link" itemprop="url">13.4.4 使用CallableStatement调用存储过程</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-07-04 23:16:33" itemprop="dateCreated datePublished" datetime="2019-07-04T23:16:33+08:00">2019-07-04</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2020-02-07 01:34:56" itemprop="dateModified" datetime="2020-02-07T01:34:56+08:00">2020-02-07</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/1-%E7%96%AF%E7%8B%82Java%E8%AE%B2%E4%B9%89-%E7%AC%AC4%E7%89%88/" itemprop="url" rel="index"><span itemprop="name">1 疯狂Java讲义 (第4版)</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/1-%E7%96%AF%E7%8B%82Java%E8%AE%B2%E4%B9%89-%E7%AC%AC4%E7%89%88/%E7%AC%AC13%E7%AB%A0-MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%8EJDBC%E7%BC%96%E7%A8%8B/" itemprop="url" rel="index"><span itemprop="name">第13章 MySQL数据库与JDBC编程</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/1-%E7%96%AF%E7%8B%82Java%E8%AE%B2%E4%B9%89-%E7%AC%AC4%E7%89%88/%E7%AC%AC13%E7%AB%A0-MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%8EJDBC%E7%BC%96%E7%A8%8B/13-4-%E6%89%A7%E8%A1%8CSQL%E8%AF%AD%E5%8F%A5%E7%9A%84%E6%96%B9%E5%BC%8F/" itemprop="url" rel="index"><span itemprop="name">13.4 执行SQL语句的方式</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
    <span class="post-meta-item-icon">
      <i class="far fa-comment"></i>
    </span>
    <span class="post-meta-item-text">Waline：</span>
  
    <a title="waline" href="/JavaReadingNotes/50709bfb/#waline-comments" itemprop="discussionUrl">
      <span class="post-comments-count waline-comment-count" id="/JavaReadingNotes/50709bfb/" data-xid="/JavaReadingNotes/50709bfb/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>2.3k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>2 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="13-4-4-使用CallableStatement调用存储过程"><a href="#13-4-4-使用CallableStatement调用存储过程" class="headerlink" title="13.4.4 使用CallableStatement调用存储过程"></a>13.4.4 使用CallableStatement调用存储过程</h1><p>下面的<code>SQL</code>语句可以在<code>MySQL</code>数据库中创建一个简单的存储过程。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">delimiter $$</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">procedure</span> add_pro(a <span class="type">int</span>,b <span class="type">int</span>,<span class="keyword">out</span> sum <span class="type">int</span>)</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line"><span class="keyword">set</span> sum <span class="operator">=</span> a <span class="operator">+</span>b;</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line">$$</span><br></pre></td></tr></table></figure>
<p>上面的<code>SQL</code>语句将<code>MySQL</code>的语句结束符改为双美元符(<code>$$</code>),这样就可以在创建存储过程中使用分号作为分隔符( <code>MySQL</code>默认使用分号作为语句结束符)。上面程序创建了名为<code>add_pro</code>的存储过程,该存储过程包含三个参数:<code>a</code>、<code>b</code>是传入参数,而<code>sum</code>使用<code>out</code>修饰,是传出参数。<br>调用存储过程使用<code>CallableStatement</code>,可以通过<code>Connection</code>的<code>prepareCall()</code>方法来创建<code>CallableStatement</code>对象,创建该对象时需要传入调用存储过程的<code>SQL</code>语句。调用存储过程的<code>SQL</code>语句总是这种格式:<code>&#123;call 过程名 (?,?,?,)&#125;</code>,其中的问号作为存储过程参数的占位符。例如,如下代码就创建了调用上面存储过程的<code>CallableStatement</code>对象。<br><code>cstmt=conn.prepareCall(&quot;&#123;call add_pro(?,?,?)&quot;);</code><br>存储过程的参数既有传入参数,也有传出参数。所谓传入参数就是<code>Java</code>程序必须为这些参数传入值,可以通过<code>CallableStatement</code>的<code>setXxx()</code>方法为传入参数设置值;<br>所谓传出参数就是<code>Java</code>程序可以通过该参数获取存储过程里的值, <code>CallableStatement</code>需要调用<code>registerOutParameter()</code>方法来注册该参数。如下代码所示:<br><code>cstmt.registerOutParameter(3, Types.INTEGER);</code><br>经过上面步骤之后,就可以调用<code>CallableStatement</code>的<code>execute()</code>方法来执行存储过程了,执行结束后通过<code>CallableStatement</code>对象的<code>getXxx(int index)</code>方法来获取指定传出参数的值。下面程序示范了如何来调用该存储过程。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.awt.*;</span><br><span class="line"><span class="keyword">import</span> java.awt.event.*;</span><br><span class="line"><span class="keyword">import</span> javax.swing.*;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.sql.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CallableStatementTest</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String driver;</span><br><span class="line">    <span class="keyword">private</span> String url;</span><br><span class="line">    <span class="keyword">private</span> String user;</span><br><span class="line">    <span class="keyword">private</span> String pass;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">initParam</span><span class="params">(String paramFile)</span> <span class="keyword">throws</span> Exception</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// 使用Properties类来加载属性文件</span></span><br><span class="line">        Properties props = <span class="keyword">new</span> Properties();</span><br><span class="line">        props.load(<span class="keyword">new</span> FileInputStream(paramFile));</span><br><span class="line">        driver = props.getProperty(<span class="string">&quot;driver&quot;</span>);</span><br><span class="line">        url = props.getProperty(<span class="string">&quot;url&quot;</span>);</span><br><span class="line">        user = props.getProperty(<span class="string">&quot;user&quot;</span>);</span><br><span class="line">        pass = props.getProperty(<span class="string">&quot;pass&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">callProcedure</span><span class="params">()</span> <span class="keyword">throws</span> Exception</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// 1.加载驱动</span></span><br><span class="line">        Class.forName(driver);</span><br><span class="line">        <span class="keyword">try</span> (</span><br><span class="line">                <span class="comment">// 2.获取数据库连接</span></span><br><span class="line">                Connection conn = DriverManager.getConnection(url, user, pass);</span><br><span class="line">                <span class="comment">// 3.使用Connection来创建一个CallableStatment对象</span></span><br><span class="line">                CallableStatement cstmt = conn</span><br><span class="line">                        .prepareCall(<span class="string">&quot;&#123;call add_pro(?,?,?)&#125;&quot;</span>))</span><br><span class="line">        &#123;</span><br><span class="line">            cstmt.setInt(<span class="number">1</span>, <span class="number">4</span>);</span><br><span class="line">            cstmt.setInt(<span class="number">2</span>, <span class="number">5</span>);</span><br><span class="line">            <span class="comment">// 4.注册CallableStatement的第三个参数是int类型</span></span><br><span class="line">            cstmt.registerOutParameter(<span class="number">3</span>, Types.INTEGER);</span><br><span class="line">            <span class="comment">// 执行存储过程</span></span><br><span class="line">            cstmt.execute();</span><br><span class="line">            <span class="comment">// 获取，并输出存储过程传出参数的值。</span></span><br><span class="line">            System.out.println(<span class="string">&quot;执行结果是: &quot;</span> + cstmt.getInt(<span class="number">3</span>));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        CallableStatementTest ct = <span class="keyword">new</span> CallableStatementTest();</span><br><span class="line">        ct.initParam(<span class="string">&quot;mysql.ini&quot;</span>);</span><br><span class="line">        ct.callProcedure();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>运行上面程序将会看到这个简单存储过程的执行结果,传入参数分别是<code>4</code>、<code>5</code>,执行加法后传出总和<code>9</code>.</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://lanlan2017.github.io/JavaReadingNotes/973ba1f1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/JavaReadingNotes/images/avatar.gif">
      <meta itemprop="name" content="蓝蓝">
      <meta itemprop="description" content="好好学习，天天向上">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="蓝蓝站点">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/JavaReadingNotes/973ba1f1/" class="post-title-link" itemprop="url">13.4.3 使用 PreparedStatement执行SQL语句</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-07-04 14:35:37" itemprop="dateCreated datePublished" datetime="2019-07-04T14:35:37+08:00">2019-07-04</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2020-02-07 01:34:56" itemprop="dateModified" datetime="2020-02-07T01:34:56+08:00">2020-02-07</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/1-%E7%96%AF%E7%8B%82Java%E8%AE%B2%E4%B9%89-%E7%AC%AC4%E7%89%88/" itemprop="url" rel="index"><span itemprop="name">1 疯狂Java讲义 (第4版)</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/1-%E7%96%AF%E7%8B%82Java%E8%AE%B2%E4%B9%89-%E7%AC%AC4%E7%89%88/%E7%AC%AC13%E7%AB%A0-MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%8EJDBC%E7%BC%96%E7%A8%8B/" itemprop="url" rel="index"><span itemprop="name">第13章 MySQL数据库与JDBC编程</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/1-%E7%96%AF%E7%8B%82Java%E8%AE%B2%E4%B9%89-%E7%AC%AC4%E7%89%88/%E7%AC%AC13%E7%AB%A0-MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%8EJDBC%E7%BC%96%E7%A8%8B/13-4-%E6%89%A7%E8%A1%8CSQL%E8%AF%AD%E5%8F%A5%E7%9A%84%E6%96%B9%E5%BC%8F/" itemprop="url" rel="index"><span itemprop="name">13.4 执行SQL语句的方式</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
    <span class="post-meta-item-icon">
      <i class="far fa-comment"></i>
    </span>
    <span class="post-meta-item-text">Waline：</span>
  
    <a title="waline" href="/JavaReadingNotes/973ba1f1/#waline-comments" itemprop="discussionUrl">
      <span class="post-comments-count waline-comment-count" id="/JavaReadingNotes/973ba1f1/" data-xid="/JavaReadingNotes/973ba1f1/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>7.1k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>6 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="13-4-3-使用-PreparedStatement执行SQL语句"><a href="#13-4-3-使用-PreparedStatement执行SQL语句" class="headerlink" title="13.4.3 使用 PreparedStatement执行SQL语句"></a>13.4.3 使用 PreparedStatement执行SQL语句</h1><p>如果经常需要反复执行一条结构相似的<code>SQL</code>语句,例如如下两条<code>SQL</code>语句:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> student_table <span class="keyword">values</span>(<span class="keyword">null</span>, <span class="string">&#x27;张三&#x27;</span>, <span class="number">1</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> student_table <span class="keyword">values</span>(<span class="keyword">null</span>, <span class="string">&#x27;李四&#x27;</span>, <span class="number">2</span>);</span><br></pre></td></tr></table></figure>
<p>对于这两条<code>SQL</code>语句而言,它们的结构基本相似,只是执行插入时插入的值不同而已。对于这种情况,可以使用带<code>占位符</code>(<code>?</code>)参数的<code>SQL</code>语句来代替它:<br><code>insert into student_table values(null,?,?);</code><br>但<code>Statement</code>执行<code>SQL</code>语句时不允许使用问号占位符参数,而且这个问号占位符参数必须获得值后以执行。为了满足这种功能,<code>JDBC</code>提供了<code>PreparedStatement</code>接口,它是<code>Statement</code>接口的子接口,它可以预编译<code>SQL</code>语句,<strong>预编译后的<code>SQL</code>语句被存储在<code>PreparedStatement</code>对象中,然后可以使用该对象多次高效地执行该语句</strong>。简而言之,<strong>使用<code>PreparedStatement</code>比使用<code>Statement</code>的效率要高</strong>。<br>创建<code>PreparedStatement</code>对象使用<code>Connection</code>的<code>prepareStatement()</code>方法,该方法需要传入一个<code>SQL</code>字符串,该<code>SQL</code>字符串可以包含<code>占位符</code>参数。如下代码所示:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pstmt=conn.prepareStatement(<span class="string">&quot;insert into student_table values (null,?,1)&quot;</span>);</span><br></pre></td></tr></table></figure>
<p><code>PreparedStatement</code>也提供了<code>execute()</code>、<code>executeUpdate()</code>、<code>executeQuery()</code>三个方法来执行<code>SQL</code>语句,不过这三个方法无须传入参数,因为<code>PreparedStatement</code>已存储了预编译的<code>SQL</code>语句。<br>使用<code>PreparedStatement</code>预编译<code>SQL</code>语句时,该<code>SQL</code>语句可以带<code>占位符</code>参数,因此在执行<code>SQL</code>语句之前必须为这些参数传入参数值, <code>Preparedstatement</code>提供了以下两种方式来传入参数值:</p>
<ul>
<li>如果程序知道预编译<code>SQL</code>语句中各参数的类型(如参数类型为<code>Xxx</code>),则使用<code>setXxx(int index, Xxx value)</code>方法来传入参数值。</li>
<li>如果程序不清楚预编译<code>SQL</code>语句中各参数的类型,则可以使用<code>setObject()</code>方法来传入参数,由<code>PreparedStatement</code>来负责类型转换。</li>
</ul>
<p>下面程序示范了使用<code>Statement</code>和<code>PreparedStatement</code>分别插入100条记录的对比。使用<code>Statement</code>需要传入100条<code>SQL</code>语句,但使用<code>PreparedStatement</code>则只需要传入1条预编译的<code>SQL</code>语句,然后100次为该<code>PreparedStatement</code>的参数设值即可.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.sql.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PreparedStatementTest</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String driver;</span><br><span class="line">    <span class="keyword">private</span> String url;</span><br><span class="line">    <span class="keyword">private</span> String user;</span><br><span class="line">    <span class="keyword">private</span> String pass;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">initParam</span><span class="params">(String paramFile)</span> <span class="keyword">throws</span> Exception</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// 使用Properties类来加载属性文件</span></span><br><span class="line">        Properties props = <span class="keyword">new</span> Properties();</span><br><span class="line">        props.load(<span class="keyword">new</span> FileInputStream(paramFile));</span><br><span class="line">        driver = props.getProperty(<span class="string">&quot;driver&quot;</span>);</span><br><span class="line">        url = props.getProperty(<span class="string">&quot;url&quot;</span>);</span><br><span class="line">        user = props.getProperty(<span class="string">&quot;user&quot;</span>);</span><br><span class="line">        pass = props.getProperty(<span class="string">&quot;pass&quot;</span>);</span><br><span class="line">        <span class="comment">// 1.加载驱动</span></span><br><span class="line">        Class.forName(driver);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insertUseStatement</span><span class="params">()</span> <span class="keyword">throws</span> Exception</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">long</span> start = System.currentTimeMillis();</span><br><span class="line">        <span class="keyword">try</span> (</span><br><span class="line">                <span class="comment">// 2.获取数据库连接</span></span><br><span class="line">                Connection conn = DriverManager.getConnection(url, user, pass);</span><br><span class="line">                <span class="comment">// 3.使用Connection来创建一个Statment对象</span></span><br><span class="line">                Statement stmt = conn.createStatement())</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// 需要使用100条SQL语句来插入100条记录</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">100</span>; i++)</span><br><span class="line">            &#123;</span><br><span class="line">                stmt.executeUpdate(<span class="string">&quot;insert into student_table values(&quot;</span></span><br><span class="line">                        + <span class="string">&quot; null ,&#x27;姓名&quot;</span> + i + <span class="string">&quot;&#x27; , 1)&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(</span><br><span class="line">                    <span class="string">&quot;使用Statement费时:&quot;</span> + (System.currentTimeMillis() - start));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insertUsePrepare</span><span class="params">()</span> <span class="keyword">throws</span> Exception</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">long</span> start = System.currentTimeMillis();</span><br><span class="line">        <span class="keyword">try</span> (</span><br><span class="line">                <span class="comment">// 2.获取数据库连接</span></span><br><span class="line">                Connection conn = DriverManager.getConnection(url, user, pass);</span><br><span class="line">                <span class="comment">// 3.使用Connection来创建一个PreparedStatement对象</span></span><br><span class="line">                PreparedStatement pstmt = conn.prepareStatement(</span><br><span class="line">                        <span class="string">&quot;insert into student_table values(null,?,1)&quot;</span>))</span><br><span class="line"></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// 100次为PreparedStatement的参数设值，就可以插入100条记录</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">100</span>; i++)</span><br><span class="line">            &#123;</span><br><span class="line">                pstmt.setString(<span class="number">1</span>, <span class="string">&quot;姓名&quot;</span> + i);</span><br><span class="line">                pstmt.executeUpdate();</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(<span class="string">&quot;使用PreparedStatement费时:&quot;</span></span><br><span class="line">                    + (System.currentTimeMillis() - start));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        PreparedStatementTest pt = <span class="keyword">new</span> PreparedStatementTest();</span><br><span class="line">        pt.initParam(<span class="string">&quot;mysql.ini&quot;</span>);</span><br><span class="line">        pt.insertUseStatement();</span><br><span class="line">        pt.insertUsePrepare();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>多次运行上面程序,可以发现使用<code>PreparedStatement</code>插入100条记录所用的时间比使用<code>Statement</code>插入100条记录所用的时间少,这表明**<code>PreparedStatement</code>的执行效率比<code>Statement</code>的执行效率高**。<br>除此之外,使用<code>PreparedStatement</code>还有一个优势——当<code>SQL</code>语句中要使用参数时,无须”拼接<code>SQL</code>字符串。而使用<code>Statement</code>则要”拼接”<code>SQL</code>字符串,这是相当容易出现错误的,尤其是当<code>SQL</code>语句中有多个字符串参数时。使用<code>PreparedStatement</code>则只需要使用问号占位符来代替这些参数即可,降低了编程复杂度。<br>使用<code>PreparedStatement</code>还有一个很好的作用—用于防止<code>SQL</code>注入(<code>SQL</code>注入是一个较常见的<code>Cracker</code>入侵方式,它利用<code>SQL</code>语句的漏洞来入侵)。<br>下面以一个简单的登录窗口为例来介绍这种<code>SQL</code>注入的结果。下面登录窗口包含两个文本框,个用于输入用户名,一个用于输入密码,系统根据用户输入与<code>jdbc_test</code>表里的记录进行匹配,如果找到相应记录则提示登录成功.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> jdbc.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.awt.BorderLayout;</span><br><span class="line"><span class="keyword">import</span> java.io.FileInputStream;</span><br><span class="line"><span class="keyword">import</span> java.sql.Connection;</span><br><span class="line"><span class="keyword">import</span> java.sql.DriverManager;</span><br><span class="line"><span class="keyword">import</span> java.sql.ResultSet;</span><br><span class="line"><span class="keyword">import</span> java.sql.Statement;</span><br><span class="line"><span class="keyword">import</span> java.util.Properties;</span><br><span class="line"><span class="keyword">import</span> javax.swing.JButton;</span><br><span class="line"><span class="keyword">import</span> javax.swing.JFrame;</span><br><span class="line"><span class="keyword">import</span> javax.swing.JOptionPane;</span><br><span class="line"><span class="keyword">import</span> javax.swing.JTextField;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoginFrame</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String PROP_FILE = <span class="string">&quot;mysql.ini&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> String driver;</span><br><span class="line">    <span class="comment">// url是数据库的服务地址</span></span><br><span class="line">    <span class="keyword">private</span> String url;</span><br><span class="line">    <span class="keyword">private</span> String user;</span><br><span class="line">    <span class="keyword">private</span> String pass;</span><br><span class="line">    <span class="comment">// 登录界面的GUI组件</span></span><br><span class="line">    <span class="keyword">private</span> JFrame jf = <span class="keyword">new</span> JFrame(<span class="string">&quot;登录&quot;</span>);</span><br><span class="line">    <span class="keyword">private</span> JTextField userField = <span class="keyword">new</span> JTextField(<span class="number">20</span>);</span><br><span class="line">    <span class="keyword">private</span> JTextField passField = <span class="keyword">new</span> JTextField(<span class="number">20</span>);</span><br><span class="line">    <span class="keyword">private</span> JButton loginButton = <span class="keyword">new</span> JButton(<span class="string">&quot;登录&quot;</span>);</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> <span class="keyword">throws</span> Exception</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        Properties connProp = <span class="keyword">new</span> Properties();</span><br><span class="line">        connProp.load(<span class="keyword">new</span> FileInputStream(PROP_FILE));</span><br><span class="line">        driver = connProp.getProperty(<span class="string">&quot;driver&quot;</span>);</span><br><span class="line">        url = connProp.getProperty(<span class="string">&quot;url&quot;</span>);</span><br><span class="line">        user = connProp.getProperty(<span class="string">&quot;user&quot;</span>);</span><br><span class="line">        pass = connProp.getProperty(<span class="string">&quot;pass&quot;</span>);</span><br><span class="line">        <span class="comment">// 加载驱动</span></span><br><span class="line">        Class.forName(driver);</span><br><span class="line">        <span class="comment">// 为登录按钮添加事件监听器</span></span><br><span class="line">        loginButton.addActionListener(e -&gt;</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// 登录成功则显示“登录成功”</span></span><br><span class="line">            <span class="keyword">if</span> (validate(userField.getText(), passField.getText()))</span><br><span class="line">            &#123;</span><br><span class="line">                JOptionPane.showMessageDialog(jf, <span class="string">&quot;登录成功&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 否则显示“登录失败”</span></span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                JOptionPane.showMessageDialog(jf, <span class="string">&quot;登录失败&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        jf.add(userField, BorderLayout.NORTH);</span><br><span class="line">        jf.add(passField);</span><br><span class="line">        jf.add(loginButton, BorderLayout.SOUTH);</span><br><span class="line">        jf.pack();</span><br><span class="line">        jf.setVisible(<span class="keyword">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">validate</span><span class="params">(String userName, String userPass)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// 执行查询的SQL语句</span></span><br><span class="line">        String sql = <span class="string">&quot;select * from jdbc_test &quot;</span> + <span class="string">&quot;where jdbc_name=&#x27;&quot;</span> + userName</span><br><span class="line">                + <span class="string">&quot;&#x27; and jdbc_desc=&#x27;&quot;</span> + userPass + <span class="string">&quot;&#x27;&quot;</span>;</span><br><span class="line">        System.out.println(sql);</span><br><span class="line">        <span class="keyword">try</span> (Connection conn = DriverManager.getConnection(url, user, pass);</span><br><span class="line">                Statement stmt = conn.createStatement();</span><br><span class="line">                ResultSet rs = stmt.executeQuery(sql))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// 如果查询的ResultSet里有超过一条的记录，则登录成功</span></span><br><span class="line">            <span class="keyword">if</span> (rs.next())</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e)</span><br><span class="line">        &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// private boolean validate(String userName, String userPass)</span></span><br><span class="line">    <span class="comment">// &#123;</span></span><br><span class="line">    <span class="comment">// try (Connection conn = DriverManager.getConnection(url, user, pass);</span></span><br><span class="line">    <span class="comment">// PreparedStatement pstmt = conn.prepareStatement(</span></span><br><span class="line">    <span class="comment">// &quot;select * from jdbc_test where jdbc_name=? and jdbc_desc=?&quot;))</span></span><br><span class="line">    <span class="comment">// &#123;</span></span><br><span class="line">    <span class="comment">// pstmt.setString(1, userName);</span></span><br><span class="line">    <span class="comment">// pstmt.setString(2, userPass);</span></span><br><span class="line">    <span class="comment">// try (ResultSet rs = pstmt.executeQuery())</span></span><br><span class="line">    <span class="comment">// &#123;</span></span><br><span class="line">    <span class="comment">// // 如果查询的ResultSet里有超过一条的记录，则登录成功</span></span><br><span class="line">    <span class="comment">// if (rs.next())</span></span><br><span class="line">    <span class="comment">// &#123;</span></span><br><span class="line">    <span class="comment">// return true;</span></span><br><span class="line">    <span class="comment">// &#125;</span></span><br><span class="line">    <span class="comment">// &#125;</span></span><br><span class="line">    <span class="comment">// &#125; catch (Exception e)</span></span><br><span class="line">    <span class="comment">// &#123;</span></span><br><span class="line">    <span class="comment">// e.printStackTrace();</span></span><br><span class="line">    <span class="comment">// &#125;</span></span><br><span class="line">    <span class="comment">// return false;</span></span><br><span class="line">    <span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">new</span> LoginFrame().init();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>运行上面程序,如果用户正常输入其用户名、密码当然没有问题,输入正确可以正常登录,输入错误将提示输入失败。但如果这个用户是一个<code>Cracker</code>,他可以在文本框中输入<code>&#39; or true or &#39;</code>,这个输入明显是不正确的,但当单击”登录”按钮后也会显示”登录成功”对话框。可以在程序运行的后台看到如下<code>SOL</code>语句:</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from jdbc_test where jdbc_name=&#x27;&#x27; or true or &#x27;&#x27; and jdbc_desc=&#x27;&#x27;</span><br></pre></td></tr></table></figure>
<p>看到这条<code>SQL</code>语句,读者应该不难明白为什么这样输入也可以显示”正常登录”对话框了,因为<code>Cracker</code>直接输入了<code>true</code>,而<code>SQL</code>把这个<code>true</code>当成了直接量。<br>如果把上面的<code>validate()</code>方法注释掉,然后取消另一个<code>validate()</code>方法的注释,换成使用<code>PreparedStatement</code>来执行验证.<br>这样,即使用户输入了:<code>&#39; or true or &#39;</code>,系统一样会显示”登录失败”对话框.<br>总体来看,使用<code>PreparedStatement</code>比使用<code>Statement</code>多了如下三个好处:</p>
<ul>
<li><code>PreparedStatement</code>预编译<code>SQL</code>语句,性能更好。</li>
<li><code>PreparedStatement</code>无须”拼接”<code>SQL</code>语句,编程更简单。</li>
<li><code>PreparedStatement</code>可以防止<code>SQL</code>注入,安全性更好。</li>
</ul>
<p>基于以上三点,通常推荐避免使用<code>Statement</code>来执行<code>SQL</code>语句,改为使用<code>PreparedStatement</code>执行<code>SQL</code>语句.</p>
<h2 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h2><p>使用<code>PreparedStatement</code>执行带占位符参数的<code>SQL</code>语句时,<code>SQL</code>语句中的占位符参数只能代替普通值,不要使用占位符参数代替表名、列名等数据库对象,更不要用占位符参数来代替<code>SQL</code>语句中的<code>Insert</code>、 <code>select</code>等关键字。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://lanlan2017.github.io/JavaReadingNotes/8b945643/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/JavaReadingNotes/images/avatar.gif">
      <meta itemprop="name" content="蓝蓝">
      <meta itemprop="description" content="好好学习，天天向上">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="蓝蓝站点">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/JavaReadingNotes/8b945643/" class="post-title-link" itemprop="url">13.4.2 使用execute方法执行SQL语句</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-07-04 14:20:20" itemprop="dateCreated datePublished" datetime="2019-07-04T14:20:20+08:00">2019-07-04</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2020-02-07 01:34:56" itemprop="dateModified" datetime="2020-02-07T01:34:56+08:00">2020-02-07</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/1-%E7%96%AF%E7%8B%82Java%E8%AE%B2%E4%B9%89-%E7%AC%AC4%E7%89%88/" itemprop="url" rel="index"><span itemprop="name">1 疯狂Java讲义 (第4版)</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/1-%E7%96%AF%E7%8B%82Java%E8%AE%B2%E4%B9%89-%E7%AC%AC4%E7%89%88/%E7%AC%AC13%E7%AB%A0-MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%8EJDBC%E7%BC%96%E7%A8%8B/" itemprop="url" rel="index"><span itemprop="name">第13章 MySQL数据库与JDBC编程</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/1-%E7%96%AF%E7%8B%82Java%E8%AE%B2%E4%B9%89-%E7%AC%AC4%E7%89%88/%E7%AC%AC13%E7%AB%A0-MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%8EJDBC%E7%BC%96%E7%A8%8B/13-4-%E6%89%A7%E8%A1%8CSQL%E8%AF%AD%E5%8F%A5%E7%9A%84%E6%96%B9%E5%BC%8F/" itemprop="url" rel="index"><span itemprop="name">13.4 执行SQL语句的方式</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
    <span class="post-meta-item-icon">
      <i class="far fa-comment"></i>
    </span>
    <span class="post-meta-item-text">Waline：</span>
  
    <a title="waline" href="/JavaReadingNotes/8b945643/#waline-comments" itemprop="discussionUrl">
      <span class="post-comments-count waline-comment-count" id="/JavaReadingNotes/8b945643/" data-xid="/JavaReadingNotes/8b945643/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>2.8k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>3 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="13-4-2-使用execute方法执行SQL语句"><a href="#13-4-2-使用execute方法执行SQL语句" class="headerlink" title="13.4.2 使用execute方法执行SQL语句"></a>13.4.2 使用execute方法执行SQL语句</h1><p><strong><code>Statement</code>的<code>execute()</code>方法几乎可以执行任何<code>SQL</code>语句</strong>,但它执行<code>SQL</code>语句时比较麻烦,通常没有必要使用<code>execute()</code>方法来执行<code>SQL</code>语句,使用<code>executeQuery()</code>或<code>executeUpdate()</code>方法更简单。但如果不清楚<code>SQL</code>语句的类型,则只能使用<code>execute</code>方法来执行该<code>SQL</code>语句了。<br>使用<code>execute()</code>方法执行<code>SQL</code>语句的返回值是<code>boolean</code>值,它表明执行该<code>SQL</code>语句是否返回了<code>ResultSet</code>对象。那么如何来获取执行<code>SQL</code>语句后得到的<code>ResultSet</code>对象呢? <code>Statement</code>提供了如下两个方法来获取执行结果。</p>
<table>
<thead>
<tr>
<th align="left">方法</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>getResultSet()</code></td>
<td align="left">获取该<code>Statement</code>执行查询语句所返回的<code>ResultSet</code>对象。</td>
</tr>
<tr>
<td align="left"><code>getUpdateCount()</code></td>
<td align="left">获取该<code>Statement</code>执行<code>DML</code>语句所影响的记录行数</td>
</tr>
</tbody></table>
<p>下面程序示范了使用<code>Statement</code>的<code>execute()</code>方法来执行任意的<code>SQL</code>语句,执行不同的<code>SQL</code>语句时产生不同的输出。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.sql.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ExecuteSQL</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String driver;</span><br><span class="line">    <span class="keyword">private</span> String url;</span><br><span class="line">    <span class="keyword">private</span> String user;</span><br><span class="line">    <span class="keyword">private</span> String pass;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">initParam</span><span class="params">(String paramFile)</span> <span class="keyword">throws</span> Exception</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// 使用Properties类来加载属性文件</span></span><br><span class="line">        Properties props = <span class="keyword">new</span> Properties();</span><br><span class="line">        props.load(<span class="keyword">new</span> FileInputStream(paramFile));</span><br><span class="line">        driver = props.getProperty(<span class="string">&quot;driver&quot;</span>);</span><br><span class="line">        url = props.getProperty(<span class="string">&quot;url&quot;</span>);</span><br><span class="line">        user = props.getProperty(<span class="string">&quot;user&quot;</span>);</span><br><span class="line">        pass = props.getProperty(<span class="string">&quot;pass&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">executeSql</span><span class="params">(String sql)</span> <span class="keyword">throws</span> Exception</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// 1.加载驱动</span></span><br><span class="line">        Class.forName(driver);</span><br><span class="line">        <span class="keyword">try</span> (</span><br><span class="line">                <span class="comment">// 2.获取数据库连接</span></span><br><span class="line">                Connection conn = DriverManager.getConnection(url, user, pass);</span><br><span class="line">                <span class="comment">// 3.使用Connection来创建一个Statement对象</span></span><br><span class="line">                Statement stmt = conn.createStatement())</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// 4.执行SQL,返回boolean值表示是否包含ResultSet</span></span><br><span class="line">            <span class="keyword">boolean</span> hasResultSet = stmt.execute(sql);</span><br><span class="line">            <span class="comment">// 5.如果执行后有ResultSet结果集</span></span><br><span class="line">            <span class="keyword">if</span> (hasResultSet)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">try</span> (</span><br><span class="line">                        <span class="comment">// 获取结果集</span></span><br><span class="line">                        ResultSet rs = stmt.getResultSet())</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="comment">// ResultSetMetaData是用于分析结果集的元数据接口</span></span><br><span class="line">                    ResultSetMetaData rsmd = rs.getMetaData();</span><br><span class="line">                    <span class="comment">// 获取列数</span></span><br><span class="line">                    <span class="keyword">int</span> columnCount = rsmd.getColumnCount();</span><br><span class="line">                    <span class="comment">// 迭代输出ResultSet对象</span></span><br><span class="line">                    <span class="keyword">while</span> (rs.next())</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="comment">// 依次输出每列的值</span></span><br><span class="line">                        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; columnCount; i++)</span><br><span class="line">                        &#123;</span><br><span class="line">                            System.out.print(rs.getString(i + <span class="number">1</span>) + <span class="string">&quot;\t&quot;</span>);</span><br><span class="line">                        &#125;</span><br><span class="line">                        System.out.print(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                System.out</span><br><span class="line">                        .println(<span class="string">&quot;该SQL语句影响的记录有&quot;</span> + stmt.getUpdateCount() + <span class="string">&quot;条&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        ExecuteSQL es = <span class="keyword">new</span> ExecuteSQL();</span><br><span class="line">        es.initParam(<span class="string">&quot;mysql.ini&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;------执行删除表的DDL语句-----&quot;</span>);</span><br><span class="line">        es.executeSql(<span class="string">&quot;drop table if exists my_test&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;------执行建表的DDL语句-----&quot;</span>);</span><br><span class="line">        es.executeSql(<span class="string">&quot;create table my_test&quot;</span></span><br><span class="line">                + <span class="string">&quot;(test_id int auto_increment primary key, &quot;</span></span><br><span class="line">                + <span class="string">&quot;test_name varchar(255))&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;------执行插入数据的DML语句-----&quot;</span>);</span><br><span class="line">        es.executeSql(<span class="string">&quot;insert into my_test(test_name) &quot;</span></span><br><span class="line">                + <span class="string">&quot;select student_name from student_table&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;------执行查询数据的查询语句-----&quot;</span>);</span><br><span class="line">        es.executeSql(<span class="string">&quot;select * from my_test&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>运行上面程序,会看到使用<code>Statement</code>的不同方法执行不同<code>SQL</code>语句的效果。执行<code>DDL</code>语句显示受影响的记录条数为0;执行<code>DML</code>语句显示插入、修改或删除的记录条数;执行查询语句则可以输出查询结果。<br>提示<br>上面程序获得<code>SQL</code>执行结果时没有根据各列的数据类型调用相应的<code>getXxx()</code>方法而是直接使用<code>getString()</code>方法来取得值,这是可以的。 <code>ResultSet</code>的<code>getString()</code>方法几乎可以获取除<code>Blob</code>之外的任意类型列的值,因为所有的数据类型都可以自动转换成字符串类型。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/JavaReadingNotes/page/157/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/JavaReadingNotes/">1</a><span class="space">&hellip;</span><a class="page-number" href="/JavaReadingNotes/page/157/">157</a><span class="page-number current">158</span><a class="page-number" href="/JavaReadingNotes/page/159/">159</a><span class="space">&hellip;</span><a class="page-number" href="/JavaReadingNotes/page/188/">188</a><a class="extend next" rel="next" href="/JavaReadingNotes/page/159/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 2018 – 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">蓝蓝</span>
</div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
      <span>站点总字数：</span>
    <span title="站点总字数">5.8m</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span>站点阅读时长 &asymp;</span>
    <span title="站点阅读时长">88:01</span>
  </span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@next-theme/pjax@0.5.0/pjax.min.js" integrity="sha256-3NkoLDrmHLTYj7csHIZSr0MHAFTXth7Ua/DDt4MRUAg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js" integrity="sha256-yt2kYMy0w8AbtF89WXb2P1rfjcP/HTHLT7097U8Y5b8=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/lozad@1.16.0/dist/lozad.min.js" integrity="sha256-mOFREFhqmHeQbXpK2lp4nA3qooVgACfh88fpJftLBbc=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/pangu@4.0.7/dist/browser/pangu.min.js" integrity="sha256-j+yj56cdEY2CwkVtGyz18fNybFGpMGJ8JxG3GSyO2+I=" crossorigin="anonymous"></script>
<script src="/JavaReadingNotes/js/comments.js"></script><script src="/JavaReadingNotes/js/utils.js"></script><script src="/JavaReadingNotes/js/motion.js"></script><script src="/JavaReadingNotes/js/next-boot.js"></script><script src="/JavaReadingNotes/js/bookmark.js"></script><script src="/JavaReadingNotes/js/pjax.js"></script>

  
<script src="https://cdn.jsdelivr.net/npm/hexo-generator-searchdb@1.4.0/dist/search.js" integrity="sha256-vXZMYLEqsROAXkEw93GGIvaB2ab+QW6w3+1ahD9nXXA=" crossorigin="anonymous"></script>
<script src="/JavaReadingNotes/js/third-party/search/local-search.js"></script>



  <script src="/JavaReadingNotes/js/third-party/fancybox.js"></script>

  <script src="/JavaReadingNotes/js/third-party/pace.js"></script>

  




  

  <script class="next-config" data-name="enableMath" type="application/json">false</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"none","js":{"url":"https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js","integrity":"sha256-r+3itOMtGGjap0x+10hu6jW/gZCzxHsoKrOd7gyRSGY="}}</script>
<script src="/JavaReadingNotes/js/third-party/math/mathjax.js"></script>


  <script src="https://cdn.jsdelivr.net/npm/quicklink@2.2.0/dist/quicklink.umd.js" integrity="sha256-4kQf9z5ntdQrzsBC3YSHnEz02Z9C1UeW/E9OgnvlzSY=" crossorigin="anonymous"></script>
  <script class="next-config" data-name="quicklink" type="application/json">{"enable":true,"home":true,"archive":true,"delay":true,"timeout":3000,"priority":true,"url":"https://lanlan2017.github.io/JavaReadingNotes/page/158/"}</script>
  <script src="/JavaReadingNotes/js/third-party/quicklink.js"></script>
<script class="next-config" data-name="waline" type="application/json">{"lang":null,"enable":true,"serverURL":"https://waline-test-lanlan2017.vercel.app","placeholder":"填写邮箱可接收回复通知 填写个人网址可为您引流","avatar":"mm","pageSize":10,"visitor":false,"comment_count":true,"requiredFields":[],"meta":["nick","mail","link"],"libUrl":"https://cdn.jsdelivr.net/npm/@waline/client/dist/Waline.min.js","el":"#waline-comments","path":"/JavaReadingNotes/page/158/"}</script>
<script>
document.addEventListener('page:loaded', () => {
  NexT.utils.loadComments(CONFIG.waline.el).then(() => 
    NexT.utils.getScript(CONFIG.waline.libUrl, { condition: window.Waline })
  ).then(() => {
    new Waline(CONFIG.waline);
  });
});
</script>
</body>
</html>
