<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)">
<meta name="generator" content="Hexo 5.4.0">

<link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
  <link rel="apple-touch-icon" sizes="180x180" href="/JavaReadingNotes/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/JavaReadingNotes/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/JavaReadingNotes/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/JavaReadingNotes/images/logo.svg" color="#222">
  <meta name="google-site-verification" content="_Sly-yzHYmALHXzjFpPWsodMrjBSphw7bfRbMUH80Qc">
  <meta name="msvalidate.01" content="B1CFD346B8DEBBFE0C983C2AF8955531">
  <meta name="baidu-site-verification" content="vkMTwK56xr">

<link rel="stylesheet" href="/JavaReadingNotes/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css" integrity="sha256-mUZM63G8m73Mcidfrv5E+Y61y7a12O5mW4ezU3bxqW4=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css" integrity="sha256-Vzbj7sDDS/woiFS3uNKo8eIuni59rjyNGtXfstRzStA=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/themes/blue/pace-theme-minimal.css">
  <script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script>

<script class="next-config" data-name="main" type="application/json">{"hostname":"lanlan2017.github.io","root":"/JavaReadingNotes/","images":"/JavaReadingNotes/images","scheme":"Gemini","darkmode":true,"version":"8.8.2","exturl":false,"sidebar":{"position":"right","display":"post","padding":18,"offset":12},"copycode":true,"bookmark":{"enable":true,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":true,"pangu":true,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/JavaReadingNotes/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/JavaReadingNotes/js/config.js"></script>
<meta name="description" content="好好学习，天天向上">
<meta property="og:type" content="website">
<meta property="og:title" content="蓝蓝站点">
<meta property="og:url" content="https://lanlan2017.github.io/JavaReadingNotes/page/50/index.html">
<meta property="og:site_name" content="蓝蓝站点">
<meta property="og:description" content="好好学习，天天向上">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="蓝蓝">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://lanlan2017.github.io/JavaReadingNotes/page/50/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"page/50/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>蓝蓝站点</title>
  

  <script src="/JavaReadingNotes/js/third-party/analytics/baidu-analytics.js"></script>
  <script async src="https://hm.baidu.com/hm.js?dadeb188eb14ccde0b25a19230c429b5"></script>


<link rel="dns-prefetch" href="https://waline-test-mzjszagu6-lanlan2017.vercel.app">
  <noscript>
    <link rel="stylesheet" href="/JavaReadingNotes/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/JavaReadingNotes/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">蓝蓝站点</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">Java读书笔记</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home"><a href="/JavaReadingNotes/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li>
        <li class="menu-item menu-item-dir"><a href="/JavaReadingNotes/dir/" rel="section"><i class="fa fa-sitemap fa-fw"></i>目录</a></li>
        <li class="menu-item menu-item-categories"><a href="/JavaReadingNotes/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li>
        <li class="menu-item menu-item-archives"><a href="/JavaReadingNotes/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li>
        <li class="menu-item menu-item-tags"><a href="/JavaReadingNotes/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="蓝蓝"
      src="/JavaReadingNotes/images/avatar.gif">
  <p class="site-author-name" itemprop="name">蓝蓝</p>
  <div class="site-description" itemprop="description">好好学习，天天向上</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/JavaReadingNotes/archives/">
          <span class="site-state-item-count">1871</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/JavaReadingNotes/categories/">
        <span class="site-state-item-count">626</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://lanlan2017.github.io/todo/" title="todo → https:&#x2F;&#x2F;lanlan2017.github.io&#x2F;todo&#x2F;"><i class="fa fa-check-square fa-fw"></i>todo</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://lanlan2017.github.io/links/" title="links → https:&#x2F;&#x2F;lanlan2017.github.io&#x2F;links&#x2F;"><i class="fa fa-link fa-fw"></i>links</a>
      </span>
  </div>
  <div class="cc-license site-overview-item animated" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" class="cc-opacity" rel="noopener" target="_blank"><img src="https://cdn.jsdelivr.net/npm/@creativecommons/vocabulary@2020.11.3/assets/license_badges/small/by_nc_sa.svg" alt="Creative Commons"></a>
  </div>



        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="返回顶部">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="reading-progress-bar"></div>
  <a role="button" class="book-mark-link book-mark-link-fixed"></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://lanlan2017.github.io/JavaReadingNotes/13e777bd/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/JavaReadingNotes/images/avatar.gif">
      <meta itemprop="name" content="蓝蓝">
      <meta itemprop="description" content="好好学习，天天向上">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="蓝蓝站点">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/JavaReadingNotes/13e777bd/" class="post-title-link" itemprop="url">16.1 古代妇女的枷锁——“三从四德”</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-09-27 19:57:33" itemprop="dateCreated datePublished" datetime="2021-09-27T19:57:33+08:00">2021-09-27</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-09-30 15:39:03" itemprop="dateModified" datetime="2021-09-30T15:39:03+08:00">2021-09-30</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/8-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E7%A6%85-%E7%AC%AC2%E7%89%88/" itemprop="url" rel="index"><span itemprop="name">8 设计模式之禅(第2版)</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/8-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E7%A6%85-%E7%AC%AC2%E7%89%88/2-%E7%AC%AC%E4%BA%8C%E9%83%A8%E5%88%86-%E7%9C%9F%E5%88%80%E5%AE%9E%E6%9E%AA-23%E7%A7%8D%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E5%AE%8C%E7%BE%8E%E6%BC%94%E7%BB%8E/" itemprop="url" rel="index"><span itemprop="name">2 第二部分 真刀实枪 23种设计模式完美演绎</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/8-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E7%A6%85-%E7%AC%AC2%E7%89%88/2-%E7%AC%AC%E4%BA%8C%E9%83%A8%E5%88%86-%E7%9C%9F%E5%88%80%E5%AE%9E%E6%9E%AA-23%E7%A7%8D%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E5%AE%8C%E7%BE%8E%E6%BC%94%E7%BB%8E/%E7%AC%AC16%E7%AB%A0-%E8%B4%A3%E4%BB%BB%E9%93%BE%E6%A8%A1%E5%BC%8F/" itemprop="url" rel="index"><span itemprop="name">第16章 责任链模式</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
    <span class="post-meta-item-icon">
      <i class="far fa-comment"></i>
    </span>
    <span class="post-meta-item-text">Waline：</span>
  
    <a title="waline" href="/JavaReadingNotes/13e777bd/#waline-comments" itemprop="discussionUrl">
      <span class="post-comments-count waline-comment-count" id="/JavaReadingNotes/13e777bd/" data-xid="/JavaReadingNotes/13e777bd/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>8.6k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>8 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="16-1-古代妇女的枷锁——“三从四德”"><a href="#16-1-古代妇女的枷锁——“三从四德”" class="headerlink" title="16.1 古代妇女的枷锁——“三从四德”"></a>16.1 古代妇女的枷锁——“三从四德”</h1><p>中国古代对妇女制定了“三从四德”的道德规范，“三从”是指“未嫁从父、既嫁从夫、夫死从子”。也就是说，一位女性在结婚之前要听从于父亲，结婚之后要听从于丈夫，如果丈夫死了还要听从于儿子。举例来说，如果一位女性要出去逛街，在她出嫁前必须征得父亲的同意，出嫁之后必须获得丈夫的许可，那丈夫死了怎么办？那就得问问儿子是否允许自己出去逛街。估计你接下来马上要问：“要是没有儿子怎么办？”那就请示小叔子、侄子等。在父系社会中，妇女只占从属地位，现在想想中国古代的妇女还是挺悲惨的，连逛街都要多番请示。作为父亲、丈夫或儿子，只有两种选择：要不承担起责任来，允许她或不允许她逛街； 要不就让她请示下一个人，这是整个社会体系的约束，应用到我们项目中就是业务规则。下面来看如何通过程序来实现“三从”，需求很简单：通过程序描述一下古代妇女的“三从”制度。好，我们先来看类图，如图16-1所示。</p>
<p><img data-src="https://raw.githubusercontent.com/lanlan2017/images/master/Blog/Sum/20210929111939.png" alt="image-20210929111938715"></p>
<center>图16-1 妇女“三从”类图</center>

<p>类图非常简单，IHandler是三个有决策权对象的接口，IWomen是女性的代码，其实现也非常简单，IWomen如代码清单16-1所示。</p>
<p>代码清单16-1 女性接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">IWomen</span> </span>&#123;</span><br><span class="line">    <span class="comment">//获得个人状况</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getType</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="comment">//获得个人请示，你要干什么？出去逛街？约会?还是看电影？</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getRequest</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>女性接口仅两个方法，一个是取得当前的个人状况getType，通过返回值决定是结婚了还是没结婚、丈夫是否在世等，另外一个方法getRequest是要请示的内容，要出去逛街还是吃饭，其实现类如代码清单16-2所示。</p>
<p>代码清单16-2 古代妇女</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Women</span> <span class="keyword">implements</span> <span class="title">IWomen</span></span>&#123;</span><br><span class="line">    <span class="comment">/** 通过一个int类型的参数来描述妇女的个人状况 </span></span><br><span class="line"><span class="comment">    * 1--未出嫁 </span></span><br><span class="line"><span class="comment">    * 2--出嫁 </span></span><br><span class="line"><span class="comment">    * 3--夫死 </span></span><br><span class="line"><span class="comment">    */</span> </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> type=<span class="number">0</span>;</span><br><span class="line">    <span class="comment">//妇女的请示</span></span><br><span class="line">    <span class="keyword">private</span> String request = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="comment">//构造函数传递过来请求</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Women</span><span class="params">(<span class="keyword">int</span> _type,String _request)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.type = _type;</span><br><span class="line">        <span class="keyword">this</span>.request = _request;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//获得自己的状况</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getType</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.type;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//获得妇女的请求</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getRequest</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.request;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们使用数字来代表女性的不同状态：1是未结婚；2是已经结婚的，而且丈夫健在；3 是丈夫去世了。从整个设计上分析，有处理权的人（如父亲、丈夫、儿子）才是设计的核心，他们是要处理这些请求的，我们来看有处理权的人员接口IHandler，如代码清单16-3所示。</p>
<p>代码清单16-3 有处理权的人员接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">IHandler</span> </span>&#123;</span><br><span class="line">    <span class="comment">//一个女性（女儿、妻子或者母亲）要求逛街，你要处理这个请求</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">HandleMessage</span><span class="params">(IWomen women)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>非常简单，有处理权的人对妇女的请求进行处理，分别有三个实现类，在女儿没有出嫁之前父亲是有决定权的，其实现类如代码清单16-4所示。</p>
<p>代码清单16-4 父亲类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Father</span> <span class="keyword">implements</span> <span class="title">IHandler</span> </span>&#123;</span><br><span class="line">    <span class="comment">//未出嫁的女儿来请示父亲</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">HandleMessage</span><span class="params">(IWomen women)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;女儿的请示是：&quot;</span>+women.getRequest());</span><br><span class="line">        System.out.println(<span class="string">&quot;父亲的答复是:同意&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在女性出嫁后，丈夫有决定权，如代码清单16-5所示。</p>
<p>代码清单16-5 丈夫类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Husband</span> <span class="keyword">implements</span> <span class="title">IHandler</span> </span>&#123;</span><br><span class="line">    <span class="comment">//妻子向丈夫请示</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">HandleMessage</span><span class="params">(IWomen women)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;妻子的请示是：&quot;</span>+women.getRequest());</span><br><span class="line">        System.out.println(<span class="string">&quot;丈夫的答复是：同意&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在女性丧偶后，对母亲提出的请求儿子有决定权，如代码清单16-6所示。</p>
<p>代码清单16-6 儿子类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Son</span> <span class="keyword">implements</span> <span class="title">IHandler</span> </span>&#123;</span><br><span class="line">    <span class="comment">//母亲向儿子请示</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">HandleMessage</span><span class="params">(IWomen women)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;母亲的请示是：&quot;</span>+women.getRequest());</span><br><span class="line">        System.out.println(<span class="string">&quot;儿子的答复是：同意&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>以上三个实现类非常简单，只有一个方法，处理女儿、妻子、母亲提出的请求，我们来模拟一下一个古代妇女出去逛街是如何请示的，如代码清单16-7所示。</p>
<p>代码清单16-7 场景类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Client</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//随机挑选几个女性</span></span><br><span class="line">        Random rand = <span class="keyword">new</span> Random();</span><br><span class="line">        ArrayList&lt;IWomen&gt; arrayList = <span class="keyword">new</span> ArrayList();</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">5</span>;i++)&#123;</span><br><span class="line">            arrayList.add(<span class="keyword">new</span> Women(rand.nextInt(<span class="number">4</span>),<span class="string">&quot;我要出去逛街&quot;</span>));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//定义三个请示对象</span></span><br><span class="line">        IHandler father = <span class="keyword">new</span> Father();</span><br><span class="line">        IHandler husband = <span class="keyword">new</span> Husband();</span><br><span class="line">        IHandler son = <span class="keyword">new</span> Son();</span><br><span class="line">        <span class="keyword">for</span>(IWomen women:arrayList)&#123;</span><br><span class="line">            <span class="keyword">if</span>(women.getType() ==<span class="number">1</span>)&#123;</span><br><span class="line">                <span class="comment">//未结婚少女，请示父亲</span></span><br><span class="line">                System.out.println(<span class="string">&quot;\n--------女儿向父亲请示-------&quot;</span>);</span><br><span class="line">                father.HandleMessage(women);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span>(women.getType() ==<span class="number">2</span>)&#123;</span><br><span class="line">                <span class="comment">//已婚少妇，请示丈夫</span></span><br><span class="line">                System.out.println(<span class="string">&quot;\n--------妻子向丈夫请示-------&quot;</span>);</span><br><span class="line">                husband.HandleMessage(women);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span>(women.getType() == <span class="number">3</span>)&#123;</span><br><span class="line">                <span class="comment">//母亲请示儿子</span></span><br><span class="line">                System.out.println(<span class="string">&quot;\n--------母亲向儿子请示-------&quot;</span>);</span><br><span class="line">                son.HandleMessage(women);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="comment">//暂时什么也不做</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>首先是通过随机方法产生了5个古代妇女的对象，然后看她们是如何就逛街这件事去请示的，运行结果如下所示（由于是随机的，您看到的结果可能和这里有所不同）：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">--------女儿向父亲请示------- </span><br><span class="line">女儿的请示是：我要出去逛街 </span><br><span class="line">父亲的答复是：同意 </span><br><span class="line">--------母亲向儿子请示------- </span><br><span class="line">母亲的请示是：我要出去逛街 </span><br><span class="line">儿子的答复是：同意 </span><br><span class="line">--------妻子向丈夫请示------- </span><br><span class="line">妻子的请示是：我要出去逛街 </span><br><span class="line">丈夫的答复是：同意</span><br><span class="line">--------女儿向父亲请示------- </span><br><span class="line">女儿的请示是：我要出去逛街 </span><br><span class="line">父亲的答复是：同意</span><br></pre></td></tr></table></figure>
<p>“三从四德”的旧社会规范已经完整地表现出来了，你看谁向谁请示都定义出来了，但是你是不是发现这个程序写得有点不舒服？有点别扭？有点想重构它的感觉？那就对了！这段代码有以下几个问题：</p>
<ul>
<li>职责界定不清晰</li>
</ul>
<p>对女儿提出的请示，应该在父亲类中做出决定，父亲有责任、有义务处理女儿的请示， 因此Father类应该是知道女儿的请求自己处理，而不是在Client类中进行组装出来，也就是说原本应该是父亲这个类做的事情抛给了其他类进行处理，不应该是这样的。</p>
<ul>
<li>代码臃肿</li>
</ul>
<p>我们在Client类中写了if…else的判断条件，而且能随着能处理该类型的请示人员越多，if…else的判断就越多，想想看，臃肿的条件判断还怎么有可读性？！</p>
<ul>
<li>耦合过重</li>
</ul>
<p>这是什么意思呢，我们要根据Women的type来决定使用IHandler的那个实现类来处理请求。有一个问题是：如果IHandler的实现类继续扩展怎么办？修改Client类？与开闭原则违背了！</p>
<ul>
<li>异常情况欠考虑</li>
</ul>
<p>妻子只能向丈夫请示吗？如果妻子（比如一个现代女性穿越到古代了，不懂什么“三从四德”）向自己的父亲请示了，父亲应该做何处理？我们的程序上可没有体现出来，逻辑失败了！</p>
<p>既然有这么多的问题，那我们要想办法来解决这些问题，我们先来分析一下需求，女性提出一个请示，必然要获得一个答复，甭管是同意还是不同意，总之是要一个答复的，而且这个答复是唯一的，不能说是父亲作出一个决断，而丈夫也作出了一个决断，也即是请示传递出去，必然有一个唯一的处理人给出唯一的答复，OK，分析完毕，收工，重新设计，我们可以抽象成这样一个结构，女性的请求先发送到父亲类，父亲类一看是自己要处理的，就作出回应处理，如果女儿已经出嫁了，那就要把这个请求转发到女婿来处理，那女婿一旦去天国报道了，那就由儿子来处理这个请求，类似于如图16-2所示的顺序处理图。</p>
<p><img data-src="https://raw.githubusercontent.com/lanlan2017/images/master/Blog/Sum/20210929112714.png" alt="image-20210929112713972"></p>
<center>图16-2 女性请示的顺序处理图</center>

<p>父亲、丈夫、儿子每个节点有两个选择：要么承担责任，做出回应；要么把请求转发到后序环节。结构分析得已经很清楚了，那我们看怎么来实现这个功能，类图重新修正，如图16-3所示。</p>
<p><img data-src="https://raw.githubusercontent.com/lanlan2017/images/master/Blog/Sum/20210929112803.png" alt="image-20210929112803611"></p>
<center>图16-3 顺序处理的类图</center>
从类图上看，三个实现类Father、Husband、Son只要实现构造函数和父类中的抽象方法response就可以了，具体由谁处理女性提出的请求，都已经转移到了Handler抽象类中，我们来看Handler怎么实现，如代码清单16-8所示。

<p>代码清单16-8 修改后的Handler类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Handler</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="keyword">int</span> FATHER_LEVEL_REQUEST = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="keyword">int</span> HUSBAND_LEVEL_REQUEST = <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="keyword">int</span> SON_LEVEL_REQUEST = <span class="number">3</span>;</span><br><span class="line">    <span class="comment">//能处理的级别</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> level =<span class="number">0</span>;</span><br><span class="line">    <span class="comment">//责任传递，下一个人责任人是谁</span></span><br><span class="line">    <span class="keyword">private</span> Handler nextHandler;</span><br><span class="line">    <span class="comment">//每个类都要说明一下自己能处理哪些请求</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Handler</span><span class="params">(<span class="keyword">int</span> _level)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.level = _level;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//一个女性（女儿、妻子或者是母亲）要求逛街，你要处理这个请求</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">HandleMessage</span><span class="params">(IWomen women)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(women.getType() == <span class="keyword">this</span>.level)&#123;</span><br><span class="line">            <span class="keyword">this</span>.response(women);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="keyword">this</span>.nextHandler != <span class="keyword">null</span>)&#123;</span><br><span class="line">                <span class="comment">//有后续环节，才把请求往后递送</span></span><br><span class="line">                <span class="keyword">this</span>.nextHandler.HandleMessage(women);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="comment">//已经没有后续处理人了，不用处理了</span></span><br><span class="line">                System.out.println(<span class="string">&quot;---没地方请示了，按不同意处理---\n&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/** 如果不属于你处理的请求，你应该让她找下一个环节的人，如女儿出嫁了， </span></span><br><span class="line"><span class="comment">    * 还向父亲请示是否可以逛街，那父亲就应该告诉女儿，应该找丈夫请示 </span></span><br><span class="line"><span class="comment">    */</span> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setNext</span><span class="params">(Handler _handler)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.nextHandler = _handler;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//有请示那当然要回应</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">response</span><span class="params">(IWomen women)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>方法比较长，但是还是比较简单的，读者有没有看到，其实在这里也用到模板方法模式，在模板方法中判断请求的级别和当前能够处理的级别，如果相同则调用基本方法，做出反馈；如果不相等，则传递到下一个环节，由下一环节做出回应，如果已经达到环节结尾， 则直接做不同意处理。基本方法response需要各个实现类实现，每个实现类只要实现两个职责：一是定义自己能够处理的等级级别；二是对请求做出回应，我们首先来看首节点Father 类，如代码清单16-9所示。</p>
<p>代码清单16-9 父亲类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Father</span> <span class="keyword">extends</span> <span class="title">Handler</span> </span>&#123;</span><br><span class="line">    <span class="comment">//父亲只处理女儿的请求</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Father</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(Handler.FATHER_LEVEL_REQUEST);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//父亲的答复</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">response</span><span class="params">(IWomen women)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;--------女儿向父亲请示-------&quot;</span>);</span><br><span class="line">        System.out.println(women.getRequest());</span><br><span class="line">        System.out.println(<span class="string">&quot;父亲的答复是:同意\n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>丈夫类定义自己能处理的等级为2的请示，如代码清单16-10所示。</p>
<p>代码清单16-10 丈夫类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Husband</span> <span class="keyword">extends</span> <span class="title">Handler</span> </span>&#123;</span><br><span class="line">    <span class="comment">//丈夫只处理妻子的请求</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Husband</span><span class="params">()</span></span>&#123;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">super</span>(Handler.HUSBAND_LEVEL_REQUEST);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//丈夫请示的答复</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">response</span><span class="params">(IWomen women)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;--------妻子向丈夫请示-------&quot;</span>);</span><br><span class="line">        System.out.println(women.getRequest());</span><br><span class="line">        System.out.println(<span class="string">&quot;丈夫的答复是：同意\n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>儿子类只能处理等级为3的请示，如代码清单16-11所示。</p>
<p>代码清单16-11 儿子类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Son</span> <span class="keyword">extends</span> <span class="title">Handler</span> </span>&#123;</span><br><span class="line">    <span class="comment">//儿子只处理母亲的请求</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Son</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(Handler.SON_LEVEL_REQUEST);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//儿子的答复</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">response</span><span class="params">(IWomen women)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;--------母亲向儿子请示-------&quot;</span>);</span><br><span class="line">        System.out.println(women.getRequest());</span><br><span class="line">        System.out.println(<span class="string">&quot;儿子的答复是：同意\n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这三个类都很简单，构造方法是必须实现的，父类框定子类必须有一个显式构造函数， 子类不实现编译不通过。通过构造方法我们设置了各个类能处理的请求类型，Father只能处理请求类型为1（也就是女儿）的请求；Husband只能处理请求类型类为2（也就是妻子）的请求，儿子只能处理请求类型为3（也就是母亲）的请求，那如果请求类型为4的该如何处理呢？在Handler中我们已经判断了，如何没有相应的处理者（也就是没有下一环节），则视为不同意。</p>
<p>Women类的接口没有任何变化，请参考图16-1所示。</p>
<p>实现类稍微有些变化，如代码清单16-12所示。</p>
<p>代码清单16-12 女性类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Women</span> <span class="keyword">implements</span> <span class="title">IWomen</span></span>&#123;</span><br><span class="line">    <span class="comment">/** 通过一个int类型的参数来描述妇女的个人状况</span></span><br><span class="line"><span class="comment">    * 1--未出嫁 </span></span><br><span class="line"><span class="comment">    * 2--出嫁 </span></span><br><span class="line"><span class="comment">    * 3--夫死 </span></span><br><span class="line"><span class="comment">    */</span> </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> type=<span class="number">0</span>;</span><br><span class="line">    <span class="comment">//妇女的请示</span></span><br><span class="line">    <span class="keyword">private</span> String request = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="comment">//构造函数传递过来请求</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Women</span><span class="params">(<span class="keyword">int</span> _type,String _request)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.type = _type;</span><br><span class="line">        <span class="comment">//为了便于显示，在这里做了点处理</span></span><br><span class="line">        <span class="keyword">switch</span>(<span class="keyword">this</span>.type)&#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">1</span>: <span class="keyword">this</span>.request = <span class="string">&quot;女儿的请求是：&quot;</span> + _request;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">2</span>: <span class="keyword">this</span>.request = <span class="string">&quot;妻子的请求是：&quot;</span> + _request;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">3</span>: <span class="keyword">this</span>.request = <span class="string">&quot;母亲的请求是：&quot;</span> + _request;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//获得自己的状况</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getType</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.type;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//获得妇女的请求</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getRequest</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.request;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>为了展示结果清晰一点，Women类做了一些改变，如粗体部分所示。我们再来看Client 类是怎么描述古代这一个礼节的，如代码清单16-13所示。</p>
<p>代码清单16-13 场景类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Client</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//随机挑选几个女性</span></span><br><span class="line">        Random rand = <span class="keyword">new</span> Random();</span><br><span class="line">        ArrayList&lt;IWomen&gt; arrayList = <span class="keyword">new</span> ArrayList();</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">5</span>;i++)&#123;</span><br><span class="line">            arrayList.add(<span class="keyword">new</span> Women(rand.nextInt(<span class="number">4</span>),<span class="string">&quot;我要出去逛街&quot;</span>));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//定义三个请示对象</span></span><br><span class="line">        Handler father = <span class="keyword">new</span> Father();</span><br><span class="line">        Handler husband = <span class="keyword">new</span> Husband();</span><br><span class="line">        Handler son = <span class="keyword">new</span> Son();</span><br><span class="line">        <span class="comment">//设置请示顺序</span></span><br><span class="line">        father.setNext(husband);</span><br><span class="line">        husband.setNext(son);</span><br><span class="line">        <span class="keyword">for</span>(IWomen women:arrayList)&#123;</span><br><span class="line">            father.HandleMessage(women);</span><br><span class="line">            </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在Client中设置请求的传递顺序，先向父亲请示，不是父亲应该解决的问题，则由父亲传递到丈夫类解决，若不是丈夫类解决的问题则传递到儿子类解决，最终的结果必然有一个返回，其运行结果如下所示。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">--------妻子向丈夫请示------- </span><br><span class="line">妻子的请求是：我要出去逛街 </span><br><span class="line">丈夫的答复是：同意 </span><br><span class="line">--------女儿向父亲请示------- </span><br><span class="line">女儿的请求是：我要出去逛街 </span><br><span class="line">父亲的答复是：同意 </span><br><span class="line">--------母亲向儿子请示------- </span><br><span class="line">母亲的请求是：我要出去逛街 </span><br><span class="line">儿子的答复是：同意 </span><br><span class="line">--------妻子向丈夫请示------- </span><br><span class="line">妻子的请求是：我要出去逛街 </span><br><span class="line">丈夫的答复是：同意 </span><br><span class="line">--------母亲向儿子请示------- </span><br><span class="line">母亲的请求是：我要出去逛街 </span><br><span class="line">儿子的答复是：同意</span><br></pre></td></tr></table></figure>
<p>结果也正确，业务调用类Client也不用去做判断到底是需要谁去处理，而且Handler抽象类的子类可以继续增加下去，只需要扩展传递链而已，调用类可以不用了解变化过程，甚至是谁在处理这个请求都不用知道。在这种模式下，即使现代社会的一个小太妹穿越到古代 （例如掉入时空隧道，或者时空突然扭转，甚至是突然魔法显灵），对“三从四德”没有任何了解也可以自由地应付，反正只要请示父亲就可以了，该父亲处理就父亲处理，不该父亲处理就往下传递。这就是责任链模式。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://lanlan2017.github.io/JavaReadingNotes/9d91a8e7/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/JavaReadingNotes/images/avatar.gif">
      <meta itemprop="name" content="蓝蓝">
      <meta itemprop="description" content="好好学习，天天向上">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="蓝蓝站点">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/JavaReadingNotes/9d91a8e7/" class="post-title-link" itemprop="url">21.1 公司的人事架构是这样的吗</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-09-27 19:57:33" itemprop="dateCreated datePublished" datetime="2021-09-27T19:57:33+08:00">2021-09-27</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-09-30 15:39:03" itemprop="dateModified" datetime="2021-09-30T15:39:03+08:00">2021-09-30</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/8-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E7%A6%85-%E7%AC%AC2%E7%89%88/" itemprop="url" rel="index"><span itemprop="name">8 设计模式之禅(第2版)</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/8-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E7%A6%85-%E7%AC%AC2%E7%89%88/2-%E7%AC%AC%E4%BA%8C%E9%83%A8%E5%88%86-%E7%9C%9F%E5%88%80%E5%AE%9E%E6%9E%AA-23%E7%A7%8D%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E5%AE%8C%E7%BE%8E%E6%BC%94%E7%BB%8E/" itemprop="url" rel="index"><span itemprop="name">2 第二部分 真刀实枪 23种设计模式完美演绎</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/8-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E7%A6%85-%E7%AC%AC2%E7%89%88/2-%E7%AC%AC%E4%BA%8C%E9%83%A8%E5%88%86-%E7%9C%9F%E5%88%80%E5%AE%9E%E6%9E%AA-23%E7%A7%8D%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E5%AE%8C%E7%BE%8E%E6%BC%94%E7%BB%8E/%E7%AC%AC21%E7%AB%A0-%E7%BB%84%E5%90%88%E6%A8%A1%E5%BC%8F/" itemprop="url" rel="index"><span itemprop="name">第21章 组合模式</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
    <span class="post-meta-item-icon">
      <i class="far fa-comment"></i>
    </span>
    <span class="post-meta-item-text">Waline：</span>
  
    <a title="waline" href="/JavaReadingNotes/9d91a8e7/#waline-comments" itemprop="discussionUrl">
      <span class="post-comments-count waline-comment-count" id="/JavaReadingNotes/9d91a8e7/" data-xid="/JavaReadingNotes/9d91a8e7/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>14k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>13 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="21-1-公司的人事架构是这样的吗"><a href="#21-1-公司的人事架构是这样的吗" class="headerlink" title="21.1 公司的人事架构是这样的吗"></a>21.1 公司的人事架构是这样的吗</h1><p>各位读者，大家在上学的时候应该都学过“数据结构”这门课程吧，还记得其中有一节叫“二叉树”吧，我们上学那会儿这一章节是必考内容，左子树，右子树，什么先序遍历、后序遍历，重点就是二叉树的遍历，我还记得当时老师就说，考试的时候一定有二叉树的构建和遍历，现在想起来还是觉得老师是正确的，树状结构在实际中应用非常广泛，想想看你最常使用的XML格式是不是就是一个树形结构。</p>
<p>咱就先说个最常见的例子，公司的人事管理就是一个典型的树状结构，想想看你公司的组织架构是不是如图21-1所示。</p>
<p><img data-src="https://raw.githubusercontent.com/lanlan2017/images/master/Blog/Sum/20210929170413.png" alt="image-20210929170413274"></p>
<center>图21-1 普遍的组织架构</center>

<p>从最高的老大，往下一层一层的管理，最后到我们这层小兵……很典型的树状结构（说明一下，这不是二叉树，有关二叉树的定义可以翻翻以前的教科书），我们今天的任务就是要把这个树状结构实现出来，并且还要把它遍历一遍，就类似于阅读你公司的人员花名册。</p>
<p>从该树状结构上分析，有两种不同性质的节点：有分支的节点（如研发部经理）和无分支的节点（如员工A、员工D等），我们增加一点学术术语上去，总经理叫做根节点(是不是想到XML中的那个根节点root，那就对了)，类似研发部经理有分支的节点叫做树枝节点，类似员工A的无分支的节点叫做树叶节点，都很形象，三个类型的节点，那是不是定义三个类就可以？好，我们按照这个思路走下去，先看我们自己设计的类图，如图21-2所示。</p>
<p><img data-src="https://raw.githubusercontent.com/lanlan2017/images/master/Blog/Sum/20210929170508.png" alt="image-20210929170508685"></p>
<center>图21-2 最容易想到的组织架构类图</center>

<p>这个类图是初学者最容易想到的类图（首先声明，这个类图是有缺陷的，如果你已经看明白这个类图的缺陷了，该段落就可以一目十行地看下去，我们是循序渐进地讲课，一步一个脚印），非常简单，我们来看一下如何实现，先看最高级别的根节点接口，如代码清单21-1所示。</p>
<p>代码清单21-1 根节点接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">IRoot</span> </span>&#123;</span><br><span class="line">    <span class="comment">//得到总经理的信息</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getInfo</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="comment">//总经理下边要有小兵，那要能增加小兵，比如研发部总经理，这是个树枝节点</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(IBranch branch)</span></span>;</span><br><span class="line">    <span class="comment">//那要能增加树叶节点</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(ILeaf leaf)</span></span>;</span><br><span class="line">    <span class="comment">//既然能增加，那还要能够遍历，不可能总经理不知道他手下有哪些人</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ArrayList <span class="title">getSubordinateInfo</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这个根节点的对象就是我们的总经理，其具体实现如代码清单21-2所示。</p>
<p>代码清单21-2 根节点的实现</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Root</span> <span class="keyword">implements</span> <span class="title">IRoot</span> </span>&#123;</span><br><span class="line">    <span class="comment">//保存根节点下的树枝节点和树叶节点，Subordinate的意思是下级</span></span><br><span class="line">    <span class="keyword">private</span> ArrayList subordinateList = <span class="keyword">new</span> ArrayList();</span><br><span class="line">    <span class="comment">//根节点的名称</span></span><br><span class="line">    <span class="keyword">private</span> String name = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="comment">//根节点的职位</span></span><br><span class="line">    <span class="keyword">private</span> String position = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="comment">//根节点的薪水</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> salary = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">//通过构造函数传递进来总经理的信息</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Root</span><span class="params">(String name,String position,<span class="keyword">int</span> salary)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">        <span class="keyword">this</span>.position = position;</span><br><span class="line">        <span class="keyword">this</span>.salary = salary;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//增加树枝节点</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(IBranch branch)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.subordinateList.add(branch);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//增加叶子节点，比如秘书，直接隶属于总经理</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(ILeaf leaf)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.subordinateList.add(leaf);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//得到自己的信息</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getInfo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        String info = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        info = <span class="string">&quot;名称：&quot;</span>+ <span class="keyword">this</span>.name;</span><br><span class="line">        ;</span><br><span class="line">        info = info + <span class="string">&quot;\t职位：&quot;</span> + <span class="keyword">this</span>.position;</span><br><span class="line">        info = info + <span class="string">&quot;\t薪水： &quot;</span> + <span class="keyword">this</span>.salary;</span><br><span class="line">        <span class="keyword">return</span> info;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//得到下级的信息</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ArrayList <span class="title">getSubordinateInfo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.subordinateList;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>很简单，通过构造函数传入参数，然后获得信息，可以增加子树枝节点（部门经理）和叶子节点（秘书）。我们再来看其他有分支的节点接口，如代码清单21-3所示。</p>
<p>代码清单21-3 其他有分支的节点接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">IBranch</span> </span>&#123;</span><br><span class="line">    <span class="comment">//获得信息</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getInfo</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="comment">//增加数据节点，例如研发部下设的研发一组</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(IBranch branch)</span></span>;</span><br><span class="line">    <span class="comment">//增加叶子节点</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(ILeaf leaf)</span></span>;</span><br><span class="line">    <span class="comment">//获得下级信息</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ArrayList <span class="title">getSubordinateInfo</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>有了接口，就应该有实现，其具体的实现类，如代码清单21-4所示。</p>
<p>代码清单21-4 分支的节点实现</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Branch</span> <span class="keyword">implements</span> <span class="title">IBranch</span> </span>&#123;</span><br><span class="line">    <span class="comment">//存储子节点的信息</span></span><br><span class="line">    <span class="keyword">private</span> ArrayList subordinateList = <span class="keyword">new</span> ArrayList();</span><br><span class="line">    <span class="comment">//树枝节点的名称</span></span><br><span class="line">    <span class="keyword">private</span> String name=<span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="comment">//树枝节点的职位</span></span><br><span class="line">    <span class="keyword">private</span> String position = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="comment">//树枝节点的薪水</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> salary = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">//通过构造函数传递树枝节点的参数</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Branch</span><span class="params">(String name,String position,<span class="keyword">int</span> salary)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">        <span class="keyword">this</span>.position = position;</span><br><span class="line">        <span class="keyword">this</span>.salary = salary;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//增加一个子树枝节点</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(IBranch branch)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.subordinateList.add(branch);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//增加一个叶子节点</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(ILeaf leaf)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.subordinateList.add(leaf);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//获得自己树枝节点的信息</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getInfo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        </span><br><span class="line">        String info = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        info = <span class="string">&quot;名称：&quot;</span> + <span class="keyword">this</span>.name;</span><br><span class="line">        info = info + <span class="string">&quot;\t职位：&quot;</span>+ <span class="keyword">this</span>.position;</span><br><span class="line">        info = info + <span class="string">&quot;\t薪水：&quot;</span>+<span class="keyword">this</span>.salary;</span><br><span class="line">        <span class="keyword">return</span> info;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//获得下级的信息</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ArrayList <span class="title">getSubordinateInfo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.subordinateList;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>不管是总经理还是部门经理都是有子节点的存在，最终的子节点就是叶子节点，其接口如代码清单21-5所示。</p>
<p>代码清单21-5 叶子节点的接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ILeaf</span> </span>&#123;</span><br><span class="line">    <span class="comment">//获得自己的信息</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getInfo</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>叶子节点的接口简单，实现也非常容易，如代码清单21-6所示。</p>
<p>代码清单21-6 叶子节点的实现</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Leaf</span> <span class="keyword">implements</span> <span class="title">ILeaf</span> </span>&#123;</span><br><span class="line">    <span class="comment">//叶子叫什么名字</span></span><br><span class="line">    <span class="keyword">private</span> String name = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="comment">//叶子的职位</span></span><br><span class="line">    <span class="keyword">private</span> String position = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="comment">//叶子的薪水</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> salary=<span class="number">0</span>;</span><br><span class="line">    <span class="comment">//通过构造函数传递信息</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Leaf</span><span class="params">(String name,String position,<span class="keyword">int</span> salary)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">        <span class="keyword">this</span>.position = position;</span><br><span class="line">        <span class="keyword">this</span>.salary = salary;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//最小的小兵只能获得自己的信息了</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getInfo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        String info = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        info = <span class="string">&quot;名称：&quot;</span> + <span class="keyword">this</span>.name;</span><br><span class="line">        info = info + <span class="string">&quot;\t职位：&quot;</span>+ <span class="keyword">this</span>.position;</span><br><span class="line">        info = info + <span class="string">&quot;\t薪水：&quot;</span>+<span class="keyword">this</span>.salary;</span><br><span class="line">        <span class="keyword">return</span> info;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>好了，所有的根节点、树枝节点和叶子节点都已经实现了，从总经理、部门经理到最终的员工都已经实现，然后的工作就是组装成一个树状结构并遍历这棵树，通过什么来完成呢？通过场景类Client完成，如代码清单21-7所示。</p>
<p>代码清单21-7 场景类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Client</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//首先产生了一个根节点</span></span><br><span class="line">        IRoot ceo = <span class="keyword">new</span> Root(<span class="string">&quot;王大麻子&quot;</span>,<span class="string">&quot;总经理&quot;</span>,<span class="number">100000</span>);</span><br><span class="line">        <span class="comment">//产生三个部门经理，也就是树枝节点</span></span><br><span class="line">        IBranch developDep = <span class="keyword">new</span> Branch(<span class="string">&quot;刘大瘸子&quot;</span>,<span class="string">&quot;研发部门经理&quot;</span>,<span class="number">10000</span>);</span><br><span class="line">        IBranch salesDep = <span class="keyword">new</span> Branch(<span class="string">&quot;马二拐子&quot;</span>,<span class="string">&quot;销售部门经理&quot;</span>,<span class="number">20000</span>);</span><br><span class="line">        IBranch financeDep = <span class="keyword">new</span> Branch(<span class="string">&quot;赵三驼子&quot;</span>,<span class="string">&quot;财务部经理&quot;</span>,<span class="number">30000</span>);</span><br><span class="line">        <span class="comment">//再把三个小组长产生出来</span></span><br><span class="line">        IBranch firstDevGroup = <span class="keyword">new</span> Branch(<span class="string">&quot;杨三乜斜&quot;</span>,<span class="string">&quot;开发一组组长&quot;</span>,<span class="number">5000</span>);</span><br><span class="line">        IBranch secondDevGroup = <span class="keyword">new</span> Branch(<span class="string">&quot;吴大棒槌&quot;</span>,<span class="string">&quot;开发二组组长&quot;</span>,<span class="number">6000</span>);</span><br><span class="line">        <span class="comment">//剩下的就是我们这些小兵了,就是路人甲、路人乙</span></span><br><span class="line">        ILeaf a = <span class="keyword">new</span> Leaf(<span class="string">&quot;a&quot;</span>,<span class="string">&quot;开发人员&quot;</span>,<span class="number">2000</span>);</span><br><span class="line">        ILeaf b = <span class="keyword">new</span> Leaf(<span class="string">&quot;b&quot;</span>,<span class="string">&quot;开发人员&quot;</span>,<span class="number">2000</span>);</span><br><span class="line">        ILeaf c = <span class="keyword">new</span> Leaf(<span class="string">&quot;c&quot;</span>,<span class="string">&quot;开发人员&quot;</span>,<span class="number">2000</span>);</span><br><span class="line">        ILeaf d = <span class="keyword">new</span> Leaf(<span class="string">&quot;d&quot;</span>,<span class="string">&quot;开发人员&quot;</span>,<span class="number">2000</span>);</span><br><span class="line">        ILeaf e = <span class="keyword">new</span> Leaf(<span class="string">&quot;e&quot;</span>,<span class="string">&quot;开发人员&quot;</span>,<span class="number">2000</span>);</span><br><span class="line">        ILeaf f = <span class="keyword">new</span> Leaf(<span class="string">&quot;f&quot;</span>,<span class="string">&quot;开发人员&quot;</span>,<span class="number">2000</span>);</span><br><span class="line">        ILeaf g = <span class="keyword">new</span> Leaf(<span class="string">&quot;g&quot;</span>,<span class="string">&quot;开发人员&quot;</span>,<span class="number">2000</span>);</span><br><span class="line">        ILeaf h = <span class="keyword">new</span> Leaf(<span class="string">&quot;h&quot;</span>,<span class="string">&quot;销售人员&quot;</span>,<span class="number">5000</span>);</span><br><span class="line">        ILeaf i = <span class="keyword">new</span> Leaf(<span class="string">&quot;i&quot;</span>,<span class="string">&quot;销售人员&quot;</span>,<span class="number">4000</span>);</span><br><span class="line">        ILeaf j = <span class="keyword">new</span> Leaf(<span class="string">&quot;j&quot;</span>,<span class="string">&quot;财务人员&quot;</span>,<span class="number">5000</span>);</span><br><span class="line">        ILeaf k = <span class="keyword">new</span> Leaf(<span class="string">&quot;k&quot;</span>,<span class="string">&quot;CEO秘书&quot;</span>,<span class="number">8000</span>);</span><br><span class="line">        ILeaf zhengLaoLiu = <span class="keyword">new</span> Leaf(<span class="string">&quot;郑老六&quot;</span>,<span class="string">&quot;研发部副总&quot;</span>,<span class="number">20000</span>);</span><br><span class="line">        <span class="comment">//该产生的人都产生出来了，然后我们怎么组装这棵树</span></span><br><span class="line">        <span class="comment">//首先是定义总经理下有三个部门经理</span></span><br><span class="line">        ceo.add(developDep);</span><br><span class="line">        ceo.add(salesDep);</span><br><span class="line">        ceo.add(financeDep);</span><br><span class="line">        <span class="comment">//总经理下还有一个秘书</span></span><br><span class="line">        ceo.add(k);</span><br><span class="line">        <span class="comment">//定义研发部门下的结构</span></span><br><span class="line">        developDep.add(firstDevGroup);</span><br><span class="line">        developDep.add(secondDevGroup);</span><br><span class="line">        <span class="comment">//研发部经理下还有一个副总</span></span><br><span class="line">        developDep.add(zhengLaoLiu);</span><br><span class="line">        <span class="comment">//看看开发两个开发小组下有什么</span></span><br><span class="line">        firstDevGroup.add(a);</span><br><span class="line">        firstDevGroup.add(b);</span><br><span class="line">        firstDevGroup.add(c);</span><br><span class="line">        secondDevGroup.add(d);</span><br><span class="line">        secondDevGroup.add(e);</span><br><span class="line">        secondDevGroup.add(f);</span><br><span class="line">        <span class="comment">//再看销售部下的人员情况</span></span><br><span class="line">        salesDep.add(h);</span><br><span class="line">        salesDep.add(i);</span><br><span class="line">        <span class="comment">//最后一个财务</span></span><br><span class="line">        financeDep.add(j);</span><br><span class="line">        <span class="comment">//打印写完的树状结构</span></span><br><span class="line">        System.out.println(ceo.getInfo());</span><br><span class="line">        <span class="comment">//打印出来整个树形</span></span><br><span class="line">        getAllSubordinateInfo(ceo.getSubordinateInfo());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//遍历所有的树枝节点，打印出信息</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">getAllSubordinateInfo</span><span class="params">(ArrayList subordinateList)</span></span>&#123;</span><br><span class="line">        <span class="keyword">int</span> length = subordinateList.size();</span><br><span class="line">        <span class="comment">//定义一个ArrayList长度，不要在for循环中每次计算</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> m=<span class="number">0</span>;m&lt;length;m++)&#123;</span><br><span class="line">            Object s = subordinateList.get(m);</span><br><span class="line">            <span class="keyword">if</span>(s <span class="keyword">instanceof</span> Leaf)&#123;</span><br><span class="line">                <span class="comment">//是个叶子节点，也就是员工</span></span><br><span class="line">                ILeaf employee = (ILeaf)s;</span><br><span class="line">                System.out.println(((Leaf) s).getInfo());</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">                IBranch branch = (IBranch)s;</span><br><span class="line">                System.out.println(branch.getInfo());</span><br><span class="line">                <span class="comment">//再递归调用</span></span><br><span class="line">                getAllSubordinateInfo(branch.getSubordinateInfo());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这个程序比较长，如果在我们的项目中有这样的程序，肯定是要被拉出来做典型的，你写一大坨的程序给谁呀，以后还要维护，程序要短小精悍！幸运的是，我们这是作为案例来讲解，而且就是指出这样组装这棵树是有问题的，等会我们深入讲解，先看运行结果：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">名称：王大麻子 职位：总经理 薪水: 100000 </span><br><span class="line">名称：刘大瘸子 职位：研发部门经理 薪水：10000 </span><br><span class="line">名称：杨三乜斜 职位：开发一组组长 薪水：5000 </span><br><span class="line">名称：a 职位：开发人员 薪水：2000 </span><br><span class="line">名称：b 职位：开发人员 薪水：2000 </span><br><span class="line">名称：c 职位：开发人员 薪水：2000 </span><br><span class="line">名称：吴大棒槌 职位：开发二组组长 薪水：6000 </span><br><span class="line">名称：d 职位：开发人员 薪水：2000 </span><br><span class="line">名称：e 职位：开发人员 薪水：2000 </span><br><span class="line">名称：f 职位：开发人员 薪水：2000 </span><br><span class="line">名称：郑老六 职位：研发部副总 薪水：20000 </span><br><span class="line">名称：马二拐子 职位：销售部门经理 薪水：20000 </span><br><span class="line">名称：h 职位：销售人员 薪水：5000 </span><br><span class="line">名称：i 职位：销售人员 薪水：4000 </span><br><span class="line">名称：赵三驼子 职位：财务部经理 薪水：30000 </span><br><span class="line">名称：j 职位：财务人员 薪水：5000 </span><br><span class="line">名称：k 职位：CEO秘书 薪水：8000</span><br></pre></td></tr></table></figure>
<p>和我们期望的结果一样，一棵完整的树就生成了，而且我们还能够遍历。不错，不错， 但是看类图或程序的时候，你有没有发觉有问题？getInfo每个接口都有，为什么不能抽象出来？Root类和Branch类有什么差别？根节点本身就是树枝节点的一种，为什么要定义成两个接口两个类?如果我要加一个任职期限，你是不是每个类都需要修改？如果我要后序遍历 （从员工找到他的上级领导）能做到吗？——彻底晕菜了！</p>
<p>问题很多，我们一个一个解决，先说抽象的问题。我们确实可以把IBranch和IRoot合并成一个接口，确认无疑的事我们先做，那我们就修改一下类图，如图21-3所示。</p>
<p>仔细看看这个类图，还能不能发现点问题。想想看接口的作用是什么？定义一类事物所具有的共性，那ILeaf和IBranch是不是也有共性呢？有，getInfo方法！我们是不是要把这个共性也封装起来呢？是的，是的，提炼事物的共同点，然后封装之，这是我们作为设计专家的拿手好戏，修改后的类图如图21-4所示。</p>
<p><img data-src="https://raw.githubusercontent.com/lanlan2017/images/master/Blog/Sum/20210929171106.png" alt="image-20210929171106675"></p>
<center>图21-3 整合根节点和树枝节点后的类图</center>

<p><img data-src="https://raw.githubusercontent.com/lanlan2017/images/master/Blog/Sum/20210929171143.png" alt="image-20210929171143357"></p>
<center>图21-4 修改后的类图</center>

<p>类图上增加了一个ICorp接口，它是公司所有人员信息的接口类，不管你是经理还是员工，你都有名字、职位、薪水，这个定义成一个接口没有错，但是你可能对于ILeaf接口持怀疑状态，空接口有何意义呀？有意义！它是每个树枝节点的代表，系统扩容的时候你就会发现它是多么“栋梁”。我们先来看新增加的接口ICorp，如代码清单21-8所示。</p>
<p>代码清单21-8 公司人员接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ICorp</span> </span>&#123;</span><br><span class="line">    <span class="comment">//每个员工都有信息，你想隐藏，门儿都没有！</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getInfo</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>接口很简单，只有一个方法，就是获得员工的信息，树叶节点是最基层的构件，我们先来看看它的接口，空接口，如代码清单21-9所示。</p>
<p>代码清单21-9 树叶接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ILeaf</span> <span class="keyword">extends</span> <span class="title">ICorp</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>树叶接口的实现类，如代码清单21-10所示。</p>
<p>代码清单21-10 树叶接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Leaf</span> <span class="keyword">implements</span> <span class="title">ILeaf</span> </span>&#123;</span><br><span class="line">    <span class="comment">//小兵也有名称</span></span><br><span class="line">    <span class="keyword">private</span> String name = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="comment">//小兵也有职位</span></span><br><span class="line">    <span class="keyword">private</span> String position = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="comment">//小兵也有薪水，否则谁给你干</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> salary = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">//通过一个构造函数传递小兵的信息</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Leaf</span><span class="params">(String name,String position,<span class="keyword">int</span> salary)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">        <span class="keyword">this</span>.position = position;</span><br><span class="line">        <span class="keyword">this</span>.salary = salary;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//获得小兵的信息</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getInfo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        String info = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        info = <span class="string">&quot;姓名：&quot;</span> + <span class="keyword">this</span>.name;</span><br><span class="line">        info = info + <span class="string">&quot;\t职位：&quot;</span>+ <span class="keyword">this</span>.position;</span><br><span class="line">        info = info + <span class="string">&quot;\t薪水：&quot;</span> + <span class="keyword">this</span>.salary;</span><br><span class="line">        <span class="keyword">return</span> info;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>小兵就只有这些信息了，我们是具体干活的，我们是管理不了其他同事的，我们来看看那些经理和小组长是怎么实现的，也就是IBranch接口，如代码清单21-11所示。</p>
<p>代码清单21-11 树枝接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">IBranch</span> <span class="keyword">extends</span> <span class="title">ICorp</span> </span>&#123;</span><br><span class="line">    <span class="comment">//能够增加小兵（树叶节点）或者是经理（树枝节点）</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addSubordinate</span><span class="params">(ICorp corp)</span></span>;</span><br><span class="line">    <span class="comment">//我还要能够获得下属的信息</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ArrayList&lt;ICorp&gt; <span class="title">getSubordinate</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="comment">/*本来还应该有一个方法delSubordinate(ICorp corp)，删除下属 </span></span><br><span class="line"><span class="comment">    * 这个方法我们没有用到就不写进来了 */</span> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>接口也很简单，其实现类也不可能太复杂，如代码清单21-12所示。</p>
<p>代码清单21-12 树枝实现类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Branch</span> <span class="keyword">implements</span> <span class="title">IBranch</span> </span>&#123;</span><br><span class="line">    <span class="comment">//领导也是人，也有名字</span></span><br><span class="line">    <span class="keyword">private</span> String name = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="comment">//领导和领导不同，也是职位区别</span></span><br><span class="line">    <span class="keyword">private</span> String position = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="comment">//领导也是拿薪水的</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> salary = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">//领导下边有哪些下级领导和小兵</span></span><br><span class="line">    ArrayList&lt;ICorp&gt; subordinateList = <span class="keyword">new</span> ArrayList&lt;ICorp&gt;();</span><br><span class="line">    <span class="comment">//通过构造函数传递领导的信息</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Branch</span><span class="params">(String name,String position,<span class="keyword">int</span> salary)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">        <span class="keyword">this</span>.position = position;</span><br><span class="line">        <span class="keyword">this</span>.salary = salary;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//增加一个下属，可能是小头目，也可能是个小兵</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addSubordinate</span><span class="params">(ICorp corp)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.subordinateList.add(corp);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//我有哪些下属</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ArrayList&lt;ICorp&gt; <span class="title">getSubordinate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.subordinateList;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//领导也是人，他也有信息</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getInfo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        String info = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        info = <span class="string">&quot;姓名：&quot;</span> + <span class="keyword">this</span>.name;</span><br><span class="line">        info = info + <span class="string">&quot;\t职位：&quot;</span>+ <span class="keyword">this</span>.position;</span><br><span class="line">        info = info + <span class="string">&quot;\t薪水：&quot;</span> + <span class="keyword">this</span>.salary;</span><br><span class="line">        <span class="keyword">return</span> info;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>实现类也很简单，不多说，程序写得好不好，就看别人怎么调用了，我们看场景类Client，如代码清单21-13所示。</p>
<p>代码清单21-13 场景类a</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Client</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//首先是组装一个组织结构出来</span></span><br><span class="line">        Branch ceo = compositeCorpTree();</span><br><span class="line">        <span class="comment">//首先把CEO的信息打印出来</span></span><br><span class="line">        System.out.println(ceo.getInfo());</span><br><span class="line">        <span class="comment">//然后是所有员工信息</span></span><br><span class="line">        System.out.println(getTreeInfo(ceo));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//把整个树组装出来</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Branch <span class="title">compositeCorpTree</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="comment">//首先产生总经理CEO</span></span><br><span class="line">        Branch root = <span class="keyword">new</span> Branch(<span class="string">&quot;王大麻子&quot;</span>,<span class="string">&quot;总经理&quot;</span>,<span class="number">100000</span>);</span><br><span class="line">        <span class="comment">//把三个部门经理产生出来</span></span><br><span class="line">        Branch developDep = <span class="keyword">new</span> Branch(<span class="string">&quot;刘大瘸子&quot;</span>,<span class="string">&quot;研发部门经理&quot;</span>,<span class="number">10000</span>);</span><br><span class="line">        Branch salesDep = <span class="keyword">new</span> Branch(<span class="string">&quot;马二拐子&quot;</span>,<span class="string">&quot;销售部门经理&quot;</span>,<span class="number">20000</span>);</span><br><span class="line">        Branch financeDep = <span class="keyword">new</span> Branch(<span class="string">&quot;赵三驼子&quot;</span>,<span class="string">&quot;财务部经理&quot;</span>,<span class="number">30000</span>);</span><br><span class="line">        <span class="comment">//再把三个小组长产生出来</span></span><br><span class="line">        Branch firstDevGroup = <span class="keyword">new</span> Branch(<span class="string">&quot;杨三乜斜&quot;</span>,<span class="string">&quot;开发一组组长&quot;</span>,<span class="number">5000</span>);</span><br><span class="line">        Branch secondDevGroup = <span class="keyword">new</span> Branch(<span class="string">&quot;吴大棒槌&quot;</span>,<span class="string">&quot;开发二组组长&quot;</span>,<span class="number">6000</span>);</span><br><span class="line">        <span class="comment">//把所有的小兵都产生出来</span></span><br><span class="line">        Leaf a = <span class="keyword">new</span> Leaf(<span class="string">&quot;a&quot;</span>,<span class="string">&quot;开发人员&quot;</span>,<span class="number">2000</span>);</span><br><span class="line">        Leaf b = <span class="keyword">new</span> Leaf(<span class="string">&quot;b&quot;</span>,<span class="string">&quot;开发人员&quot;</span>,<span class="number">2000</span>);</span><br><span class="line">        Leaf c = <span class="keyword">new</span> Leaf(<span class="string">&quot;c&quot;</span>,<span class="string">&quot;开发人员&quot;</span>,<span class="number">2000</span>);</span><br><span class="line">        Leaf d = <span class="keyword">new</span> Leaf(<span class="string">&quot;d&quot;</span>,<span class="string">&quot;开发人员&quot;</span>,<span class="number">2000</span>);</span><br><span class="line">        Leaf e = <span class="keyword">new</span> Leaf(<span class="string">&quot;e&quot;</span>,<span class="string">&quot;开发人员&quot;</span>,<span class="number">2000</span>);</span><br><span class="line">        Leaf f = <span class="keyword">new</span> Leaf(<span class="string">&quot;f&quot;</span>,<span class="string">&quot;开发人员&quot;</span>,<span class="number">2000</span>);</span><br><span class="line">        Leaf g = <span class="keyword">new</span> Leaf(<span class="string">&quot;g&quot;</span>,<span class="string">&quot;开发人员&quot;</span>,<span class="number">2000</span>);</span><br><span class="line">        Leaf h = <span class="keyword">new</span> Leaf(<span class="string">&quot;h&quot;</span>,<span class="string">&quot;销售人员&quot;</span>,<span class="number">5000</span>);</span><br><span class="line">        Leaf i = <span class="keyword">new</span> Leaf(<span class="string">&quot;i&quot;</span>,<span class="string">&quot;销售人员&quot;</span>,<span class="number">4000</span>);</span><br><span class="line">        Leaf j = <span class="keyword">new</span> Leaf(<span class="string">&quot;j&quot;</span>,<span class="string">&quot;财务人员&quot;</span>,<span class="number">5000</span>);</span><br><span class="line">        Leaf k = <span class="keyword">new</span> Leaf(<span class="string">&quot;k&quot;</span>,<span class="string">&quot;CEO秘书&quot;</span>,<span class="number">8000</span>);</span><br><span class="line">        Leaf zhengLaoLiu = <span class="keyword">new</span> Leaf(<span class="string">&quot;郑老六&quot;</span>,<span class="string">&quot;研发部副经理&quot;</span>,<span class="number">20000</span>);</span><br><span class="line">        <span class="comment">//开始组装</span></span><br><span class="line">        <span class="comment">//CEO下有三个部门经理和一个秘书</span></span><br><span class="line">        root.addSubordinate(k);</span><br><span class="line">        root.addSubordinate(developDep);</span><br><span class="line">        root.addSubordinate(salesDep);</span><br><span class="line">        root.addSubordinate(financeDep);</span><br><span class="line">        <span class="comment">//研发部经理</span></span><br><span class="line">        developDep.addSubordinate(zhengLaoLiu);</span><br><span class="line">        developDep.addSubordinate(firstDevGroup);</span><br><span class="line">        developDep.addSubordinate(secondDevGroup);</span><br><span class="line">        <span class="comment">//看看两个开发小组下有什么</span></span><br><span class="line">        firstDevGroup.addSubordinate(a);</span><br><span class="line">        firstDevGroup.addSubordinate(b);</span><br><span class="line">        firstDevGroup.addSubordinate(c);</span><br><span class="line">        secondDevGroup.addSubordinate(d);</span><br><span class="line">        secondDevGroup.addSubordinate(e);</span><br><span class="line">        secondDevGroup.addSubordinate(f);</span><br><span class="line">        <span class="comment">//再看销售部下的人员情况</span></span><br><span class="line">        salesDep.addSubordinate(h);</span><br><span class="line">        salesDep.addSubordinate(i);</span><br><span class="line">        <span class="comment">//最后一个财务</span></span><br><span class="line">        financeDep.addSubordinate(j);</span><br><span class="line">        <span class="keyword">return</span> root;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//遍历整棵树,只要给我根节点，我就能遍历出所有的节点</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getTreeInfo</span><span class="params">(Branch root)</span></span>&#123;</span><br><span class="line">        ArrayList&lt;ICorp&gt; subordinateList = root.getSubordinate();</span><br><span class="line">        String info = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="keyword">for</span>(ICorp s :subordinateList)&#123;</span><br><span class="line">            <span class="keyword">if</span>(s <span class="keyword">instanceof</span> Leaf)&#123;</span><br><span class="line">                <span class="comment">//是员工就直接获得信息</span></span><br><span class="line">                info = info + s.getInfo()+<span class="string">&quot;\n&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="comment">//是个小头目</span></span><br><span class="line">                info = info + s.getInfo() +<span class="string">&quot;\n&quot;</span>+ getTreeInfo((Branch)s);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> info;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>运行结果完全相同，不再赘述。通过这样构件，一个非常清晰的树状人员资源管理图出现了，那我们的程序是否还可以优化？可以！你看Leaf和Branch中都有getInfo信息，是不是可以抽象？好，我们抽象一下，如图21-5所示。</p>
<p><img data-src="https://raw.githubusercontent.com/lanlan2017/images/master/Blog/Sum/20210929171703.png" alt="image-20210929171702993"></p>
<center>图21-5 精简的类图</center>
你一看这个图，乐了。能不乐嘛，减少很多工作量了，接口没有了，改成抽象类了，IBranch接口也没有了，直接把方法放到了实现类中了，太精简了！而且场景类只认定抽象类Corp就成，那我们首先来看抽象类ICorp，如代码清单21-14所示。

<p>代码清单21-14 抽象公司职员类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Corp</span> </span>&#123;</span><br><span class="line">    <span class="comment">//公司每个人都有名称</span></span><br><span class="line">    <span class="keyword">private</span> String name = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="comment">//公司每个人都职位</span></span><br><span class="line">    <span class="keyword">private</span> String position = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="comment">//公司每个人都有薪水</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> salary =<span class="number">0</span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Corp</span><span class="params">(String _name,String _position,<span class="keyword">int</span> _salary)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = _name;</span><br><span class="line">        <span class="keyword">this</span>.position = _position;</span><br><span class="line">        <span class="keyword">this</span>.salary = _salary;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//获得员工信息</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getInfo</span><span class="params">()</span></span>&#123;</span><br><span class="line">        String info = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        info = <span class="string">&quot;姓名：&quot;</span> + <span class="keyword">this</span>.name;</span><br><span class="line">        </span><br><span class="line">        info = info + <span class="string">&quot;\t职位：&quot;</span>+ <span class="keyword">this</span>.position;</span><br><span class="line">        info = info + <span class="string">&quot;\t薪水：&quot;</span> + <span class="keyword">this</span>.salary;</span><br><span class="line">        <span class="keyword">return</span> info;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>抽象类嘛，就应该抽象出一些共性的东西出来，然后看两个具体的实现类，树叶节点如代码清单21-15所示。</p>
<p>代码清单21-15 树叶节点</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Leaf</span> <span class="keyword">extends</span> <span class="title">Corp</span> </span>&#123;</span><br><span class="line">    <span class="comment">//就写一个构造函数，这个是必需的</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Leaf</span><span class="params">(String _name,String _position,<span class="keyword">int</span> _salary)</span></span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(_name,_position,_salary);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这个精简得比较多，几行代码就完成了，确实就应该这样，下面是小头目的实现类，如代码清单21-16所示。</p>
<p>代码清单21-16 树枝节点</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Branch</span> <span class="keyword">extends</span> <span class="title">Corp</span> </span>&#123;</span><br><span class="line">    <span class="comment">//领导下边有哪些下级领导和小兵</span></span><br><span class="line">    ArrayList&lt;Corp&gt; subordinateList = <span class="keyword">new</span> ArrayList&lt;Corp&gt;();</span><br><span class="line">    <span class="comment">//构造函数是必需的</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Branch</span><span class="params">(String _name,String _position,<span class="keyword">int</span> _salary)</span></span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(_name,_position,_salary);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//增加一个下属，可能是小头目，也可能是个小兵</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addSubordinate</span><span class="params">(Corp corp)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.subordinateList.add(corp);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//我有哪些下属</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ArrayList&lt;Corp&gt; <span class="title">getSubordinate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.subordinateList;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>场景类中构建树形结构，并进行遍历。组装没有变化，遍历组织机构数稍有变化，如代码清单21-17所示。</p>
<p>代码清单21-17 稍稍修改的场景类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Client</span> </span>&#123;</span><br><span class="line">    <span class="comment">//遍历整棵树,只要给我根节点，我就能遍历出所有的节点</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getTreeInfo</span><span class="params">(Branch root)</span></span>&#123;</span><br><span class="line">        ArrayList&lt;Corp&gt; subordinateList = root.getSubordinate();</span><br><span class="line">        String info = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="keyword">for</span>(Corp s :subordinateList)&#123;</span><br><span class="line">            <span class="keyword">if</span>(s <span class="keyword">instanceof</span> Leaf)&#123;</span><br><span class="line">                <span class="comment">//是员工就直接获得信息</span></span><br><span class="line">                info = info + s.getInfo()+<span class="string">&quot;\n&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="comment">//是个小头目</span></span><br><span class="line">                info = info+s.getInfo()+<span class="string">&quot;\n&quot;</span>+ getTreeInfo((Branch)s);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> info;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>场景类中main方法没有变动，请参考代码清单21-7所示，不再赘述。遍历组织机构树的getTreeInfo稍有修改，就是把用到ICorp接口的地方修改为Corp抽象类，仅仅修改了粗体部分，其他保持不变，运行结果相同。这就是组合模式。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://lanlan2017.github.io/JavaReadingNotes/8d8359db/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/JavaReadingNotes/images/avatar.gif">
      <meta itemprop="name" content="蓝蓝">
      <meta itemprop="description" content="好好学习，天天向上">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="蓝蓝站点">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/JavaReadingNotes/8d8359db/" class="post-title-link" itemprop="url">22.1 韩非子身边的卧底是谁派来的</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-09-27 19:57:33" itemprop="dateCreated datePublished" datetime="2021-09-27T19:57:33+08:00">2021-09-27</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-09-30 15:39:03" itemprop="dateModified" datetime="2021-09-30T15:39:03+08:00">2021-09-30</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/8-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E7%A6%85-%E7%AC%AC2%E7%89%88/" itemprop="url" rel="index"><span itemprop="name">8 设计模式之禅(第2版)</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/8-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E7%A6%85-%E7%AC%AC2%E7%89%88/2-%E7%AC%AC%E4%BA%8C%E9%83%A8%E5%88%86-%E7%9C%9F%E5%88%80%E5%AE%9E%E6%9E%AA-23%E7%A7%8D%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E5%AE%8C%E7%BE%8E%E6%BC%94%E7%BB%8E/" itemprop="url" rel="index"><span itemprop="name">2 第二部分 真刀实枪 23种设计模式完美演绎</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/8-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E7%A6%85-%E7%AC%AC2%E7%89%88/2-%E7%AC%AC%E4%BA%8C%E9%83%A8%E5%88%86-%E7%9C%9F%E5%88%80%E5%AE%9E%E6%9E%AA-23%E7%A7%8D%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E5%AE%8C%E7%BE%8E%E6%BC%94%E7%BB%8E/%E7%AC%AC22%E7%AB%A0-%E8%A7%82%E5%AF%9F%E8%80%85%E6%A8%A1%E5%BC%8F/" itemprop="url" rel="index"><span itemprop="name">第22章 观察者模式</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
    <span class="post-meta-item-icon">
      <i class="far fa-comment"></i>
    </span>
    <span class="post-meta-item-text">Waline：</span>
  
    <a title="waline" href="/JavaReadingNotes/8d8359db/#waline-comments" itemprop="discussionUrl">
      <span class="post-comments-count waline-comment-count" id="/JavaReadingNotes/8d8359db/" data-xid="/JavaReadingNotes/8d8359db/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>9.2k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>8 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="22-1-韩非子身边的卧底是谁派来的"><a href="#22-1-韩非子身边的卧底是谁派来的" class="headerlink" title="22.1 韩非子身边的卧底是谁派来的"></a>22.1 韩非子身边的卧底是谁派来的</h1><p>《孙子兵法》有云：“知彼知己，百战不殆；不知彼而知己，一胜一负；不知彼，不知己，每战必殆”，那怎么才能知己知彼呢？知己是很容易的，自己的军队嘛，很容易知根知底，那怎么知彼呢？安插间谍是个好办法，这是古今中外屡试不爽的方法，我们今天就来讲一个间谍的故事。</p>
<p>韩非子大家都应该记得吧，法家的代表人物，主张建立法制社会，实施重罚制度，真是非常有远见呀！看看现在社会在呼吁什么，建立法制化的社会，这在2000多年前就已经提出了。大家可能还不知道，法家还有一个非常重要的代表人物——李斯。李斯是秦国的丞相， 最终被残忍车裂的那位，李斯和韩非子都是荀子的学生，李斯是师兄，韩非子是师弟，若干年后，李斯成为最强诸侯国秦国的上尉，致力于统一全国，于是安插了间谍到各个国家的重要人物的身边，以获取必要的信息，韩非子作为韩国的重量级人物，身边自然有不少间谍， 韩非子做的事，李斯都了如指掌，那可是相隔千里！怎么做到的呢？间谍呀！我们先通过程序把这个过程展现一下，看看李斯是怎么监控韩非子的，先看两个主角的类图，如图22-1所示。</p>
<p><img data-src="https://raw.githubusercontent.com/lanlan2017/images/master/Blog/Sum/20210929193001.png" alt="image-20210929193001857"></p>
<center>图22-1 监控者和被监控者</center>
仅有这两个对象还是不够的，我们要解决的是李斯是怎么监控韩非子的？创建一个后台线程一直处于运行状态，一旦发现韩非子在吃饭或者娱乐就触发事件？这是真实世界的翻版，安排了一个间谍，观察韩非子的生活起居，并上报给李斯，然后李斯再触发update事件，类图继续扩充，如图22-2所示。

<p><img data-src="https://raw.githubusercontent.com/lanlan2017/images/master/Blog/Sum/20210929193132.png" alt="image-20210929193132294"></p>
<center>图22-2 通过后台线程监控</center>

<p>这个类图应该是程序员最容易想到的，你要监控，我就给你找个间谍角色（Spy类）， 我们来看程序的实现，先看我们的主角韩非子的接口（类似于韩非子这样的人，被观察者角色），如代码清单22-1所示。</p>
<p>代码清单22-1 被观察者接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">IHanFeiZi</span> </span>&#123;</span><br><span class="line">    <span class="comment">//韩非子也是人，也要吃早饭的</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">haveBreakfast</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="comment">//韩非之也是人，是人就要娱乐活动</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">haveFun</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>对接口进行扩充，增加了两个状态isHavingBreakfast（是否在吃早饭）和isHavingFun（是否在娱乐），以方便Spy进行监控，如代码清单22-2所示。</p>
<p>代码清单22-2 具体的被观察者</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HanFeiZi</span> <span class="keyword">implements</span> <span class="title">IHanFeiZi</span></span>&#123;</span><br><span class="line">    <span class="comment">//韩非子是否在吃饭，作为监控的判断标准</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> isHavingBreakfast = <span class="keyword">false</span>;</span><br><span class="line">    <span class="comment">//韩非子是否在娱乐</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> isHavingFun = <span class="keyword">false</span>;</span><br><span class="line">    <span class="comment">//韩非子要吃饭了</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">haveBreakfast</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;韩非子:开始吃饭了...&quot;</span>);</span><br><span class="line">        <span class="keyword">this</span>.isHavingBreakfast =<span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//韩非子开始娱乐了</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">haveFun</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;韩非子:开始娱乐了...&quot;</span>);</span><br><span class="line">        <span class="keyword">this</span>.isHavingFun = <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//以下是bean的基本方法，getter/setter，不多说</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isHavingBreakfast</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> isHavingBreakfast;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setHavingBreakfast</span><span class="params">(<span class="keyword">boolean</span> isHavingBreakfast)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.isHavingBreakfast = isHavingBreakfast;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isHavingFun</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> isHavingFun;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setHavingFun</span><span class="params">(<span class="keyword">boolean</span> isHavingFun)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.isHavingFun = isHavingFun;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>其中有两个getter/setter方法，这个就没有在类图中表示出来，比较简单，通过isHavingBreakfast和isHavingFun这两个布尔型变量来判断韩非子是否在吃饭或者娱乐，韩非子属于被观察者，那还有观察者李斯，我们来看李斯的接口，如代码清单22-3所示。</p>
<p>代码清单22-3 抽象观察者</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ILiSi</span> </span>&#123;</span><br><span class="line">    <span class="comment">//一发现别人有动静，自己也要行动起来</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">(String context)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>李斯这类人比较简单，一发现自己观察的对象发生了变化，比如吃饭、娱乐，自己立刻也要行动起来，怎么行动呢？如代码清单22-4所示。</p>
<p>代码清单22-4 韩非子</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LiSi</span> <span class="keyword">implements</span> <span class="title">ILiSi</span></span>&#123;</span><br><span class="line">    <span class="comment">//首先李斯是个观察者，一旦韩非子有活动，他就知道，他就要向老板汇报</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">(String str)</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;李斯:观察到韩非子活动，开始向老板汇报了...&quot;</span>);</span><br><span class="line">        <span class="keyword">this</span>.reportToQinShiHuang(str);</span><br><span class="line">        System.out.println(<span class="string">&quot;李斯：汇报完毕...\n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//汇报给秦始皇</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">reportToQinShiHuang</span><span class="params">(String reportContext)</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;李斯：报告，秦老板！韩非子有活动了---&gt;&quot;</span>+reportContext);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>两个重量级的人物都定义出来了，间谍这个“卑鄙”小人是不是也要登台了，如代码清单22-5所示。</p>
<p>代码清单22-5 间谍</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Spy</span> <span class="keyword">extends</span> <span class="title">Thread</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> HanFeiZi hanFeiZi;</span><br><span class="line">    <span class="keyword">private</span> LiSi liSi;</span><br><span class="line">    <span class="keyword">private</span> String type;</span><br><span class="line">    <span class="comment">//通过构造函数传递参数，我要监控的是谁，谁来监控，要监控什么</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Spy</span><span class="params">(HanFeiZi _hanFeiZi,LiSi _liSi,String _type)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.hanFeiZi =_hanFeiZi;</span><br><span class="line">        <span class="keyword">this</span>.liSi = _liSi;</span><br><span class="line">        <span class="keyword">this</span>.type = _type;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">while</span>(<span class="keyword">true</span>)&#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="keyword">this</span>.type.equals(<span class="string">&quot;breakfast&quot;</span>))&#123;</span><br><span class="line">                <span class="comment">//监控是否在吃早餐</span></span><br><span class="line">                <span class="comment">//如果发现韩非子在吃饭，就通知李斯</span></span><br><span class="line">                <span class="keyword">if</span>(<span class="keyword">this</span>.hanFeiZi.isHavingBreakfast())&#123;</span><br><span class="line">                    <span class="keyword">this</span>.liSi.update(<span class="string">&quot;韩非子在吃饭&quot;</span>);</span><br><span class="line">                    <span class="comment">//重置状态，继续监控</span></span><br><span class="line">                    <span class="keyword">this</span>.hanFeiZi.setHavingBreakfast(<span class="keyword">false</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="comment">//监控是否在娱乐</span></span><br><span class="line">                <span class="keyword">if</span>(<span class="keyword">this</span>.hanFeiZi.isHavingFun())&#123;</span><br><span class="line">                    <span class="keyword">this</span>.liSi.update(<span class="string">&quot;韩非子在娱乐&quot;</span>);</span><br><span class="line">                    <span class="keyword">this</span>.hanFeiZi.setHavingFun(<span class="keyword">false</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>监控程序继承了java.lang.Thread类，可以同时启动多个线程进行监控，Java的多线程机制还是比较简单的，继承Thread类，重写run()方法，然后new SubThread()，再然后subThread.start()就可以启动一个线程了。我们建立一个场景类来回顾一下这段历史，如代码清单22-6所示。</p>
<p>代码清单22-6 场景类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Client</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        <span class="comment">//定义出韩非子和李斯</span></span><br><span class="line">        LiSi liSi = <span class="keyword">new</span> LiSi();</span><br><span class="line">        HanFeiZi hanFeiZi = <span class="keyword">new</span> HanFeiZi();</span><br><span class="line">        <span class="comment">//观察早餐</span></span><br><span class="line">        Watch watchBreakfast = <span class="keyword">new</span> Watch(hanFeiZi,liSi,<span class="string">&quot;breakfast&quot;</span>);</span><br><span class="line">        <span class="comment">//开始启动线程，监控</span></span><br><span class="line">        watchBreakfast.start();</span><br><span class="line">        <span class="comment">//观察娱乐情况</span></span><br><span class="line">        Watch watchFun = <span class="keyword">new</span> Watch(hanFeiZi,liSi,<span class="string">&quot;fun&quot;</span>);</span><br><span class="line">        watchFun.start();</span><br><span class="line">        <span class="comment">//然后我们看看韩非子在干什么</span></span><br><span class="line">        Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">        <span class="comment">//主线程等待1秒后后再往下执行</span></span><br><span class="line">        hanFeiZi.haveBreakfast();</span><br><span class="line">        <span class="comment">//韩非子娱乐了</span></span><br><span class="line">        Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">        hanFeiZi.haveFun();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>运行结果如下所示：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">韩非子：开始吃饭了... </span><br><span class="line">李斯：观察到韩非子活动，开始向老板汇报了... </span><br><span class="line">李斯：报告，秦老板！韩非子有活动了---&gt;韩非子在吃饭 </span><br><span class="line">李斯：汇报完毕 </span><br><span class="line">韩非子：开始娱乐了... </span><br><span class="line">李斯：观察到韩非子活动，开始向老板汇报了... </span><br><span class="line">李斯：报告，秦老板！韩非子有活动了---&gt;韩非子在娱乐 </span><br><span class="line">李斯：汇报完毕</span><br></pre></td></tr></table></figure>
<p>结果出来，韩非子一吃早饭李斯就知道，韩非子一娱乐李斯也知道，非常正确！结果正确但并不表示你有成绩，我告诉你：你的成绩是0，甚至是负的！你有没有看到你的CPU飙升，Eclipse不响应状态？看到了？看到了你还不想为什么？！看看上面的程序，别的就不多说了，使用了一个死循环while(true)来做监听，要是用到项目中，你要多少硬件投入进来？ 你还让不让别人的程序运行了？！一台服务器就跑你这一个程序就完事！</p>
<p>错误也看到了，我们必须要修改，这个没法应用到项目中，而且这个程序根本就不是面向对象的程序，这完全是面向过程的，不改不行，怎么修改呢？我们来想，既然韩非子一吃饭李斯就知道了，那我们为什么不把李斯这个类聚集到韩非子那个类上呢？说改就改，立马动手，我们来看修改后的类图，如图22-3所示。</p>
<p>类图非常简单，就是在HanFeiZi类中引用了LiSi实例，看我们程序代码怎么修改，IHanFeiZi接口完全没有修改，可以参考代码清单22-1所示。我们来看实现类的修改，如代码清单22-7所示。</p>
<p>代码清单22-7 通过聚集方式的被观察者</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HanFeiZi</span> <span class="keyword">implements</span> <span class="title">IHanFeiZi</span></span>&#123;</span><br><span class="line">    <span class="comment">//把李斯声明出来</span></span><br><span class="line">    <span class="keyword">private</span> ILiSi liSi =<span class="keyword">new</span> LiSi();</span><br><span class="line">    <span class="comment">//韩非子要吃饭了</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">haveBreakfast</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;韩非子:开始吃饭了...&quot;</span>);</span><br><span class="line">        <span class="comment">//通知李斯</span></span><br><span class="line">        <span class="keyword">this</span>.liSi.update(<span class="string">&quot;韩非子在吃饭&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//韩非子开始娱乐了</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">haveFun</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;韩非子:开始娱乐了...&quot;</span>);</span><br><span class="line">        <span class="keyword">this</span>.liSi.update(<span class="string">&quot;韩非子在娱乐&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img data-src="https://raw.githubusercontent.com/lanlan2017/images/master/Blog/Sum/20210929195135.png" alt="image-20210929195135289"></p>
<center>图22-3 通过聚集方式监控</center>

<p>韩非子HanFeiZi实现类就把接口的两个方法实现就可以了，在每个方法中调用LiSi.update()方法，完成李斯观察韩非子的职责，李斯的接口和实现类都没有任何改变，请参考代码清单22-3、22-4。我们再来看看Client程序的变更，如代码清单22-8所示。</p>
<p>代码清单22-8 通过聚集方式的场景类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Client</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//定义出韩非子</span></span><br><span class="line">        HanFeiZi hanFeiZi = <span class="keyword">new</span> HanFeiZi();</span><br><span class="line">        <span class="comment">//然后我们看看韩非子在干什么</span></span><br><span class="line">        hanFeiZi.haveBreakfast();</span><br><span class="line">        <span class="comment">//韩非子娱乐了</span></span><br><span class="line">        hanFeiZi.haveFun();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>李斯就不用在场景类中定义了，非常简单，运行结果相同，不再赘述。</p>
<p>我们思考一下，修改后的程序运行结果正确，效率也比较高，是不是应该乐呵乐呵了？ 大功告成了？稍等等，你想在战国争雄的时候，韩非子这么有名望、有实力的人，就只有秦国关心他吗？想想也不可能呀，确实有一大帮的各国类似于李斯这样的人在看着他，监视着他的一举一动，但是看看我们的程序，你在HanFeiZi这个类中定义：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> ILiSi liSi =<span class="keyword">new</span> LiSi();</span><br></pre></td></tr></table></figure>
<p>这样一来只有李斯才能观察到韩非子，这是不对的，也就是说韩非子的活动只通知了李斯一个人，这不可能；再者说了，李斯只观察韩非子的吃饭、娱乐吗？政治倾向不关心吗？ 思维倾向不关心吗？杀人放火不关心吗？也就说韩非子的一系列活动都要通知李斯，这可怎么办？要按照上面的例子，我们如何修改？这和开闭原则严重违背呀，我们的程序有问题， 修改如图22-4所示。</p>
<p><img data-src="https://raw.githubusercontent.com/lanlan2017/images/master/Blog/Sum/20210929195341.png" alt="image-20210929195341469"></p>
<center>图22-4 改进后的观察者和被观察者</center>

<p>我们把原有类图做了两个修改：</p>
<ul>
<li>增加Observable</li>
</ul>
<p>实现该接口的都是被观察者，那韩非子是被观察者，他当然也要实现该接口了，同时他还有与其他庸人相异的事要做，因此他还是要实现IHanFeizi接口。</p>
<ul>
<li>修改ILiSI接口名称为Observer</li>
</ul>
<p>接口名称修改了一下，这样显得更抽象化，所有实现该接口的都是观察者（类似李斯这样的）。</p>
<p>Observable是被观察者，就是类似韩非子这样的人，在Observable接口中有三个比较重要的方法，分别是addObserver增加观察者，deleteObserver删除观察者，notifyObservers通知所有的观察者，这是什么意思呢？我这里有一个信息，一个对象，我可以允许有多个对象来察看，你观察也成，我观察也成，只要是观察者就成，也就是说我的改变或动作执行，会通知其他的对象，看程序会更明白一点，先看Observable接口，如代码清单22-9所示。</p>
<p>代码清单22-9 被观察者接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Observable</span> </span>&#123;</span><br><span class="line">    <span class="comment">//增加一个观察者</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addObserver</span><span class="params">(Observer observer)</span></span>;</span><br><span class="line">    <span class="comment">//删除一个观察者</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteObserver</span><span class="params">(Observer observer)</span></span>;</span><br><span class="line">    <span class="comment">//既然要观察，我发生改变了他也应该有所动作，通知观察者</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">notifyObservers</span><span class="params">(String context)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这是一个通用的被观察者接口，所有的被观察者都可以实现这个接口。再来看韩非子的实现类，如代码清单22-10所示。</p>
<p>代码清单22-10 被观察者实现类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HanFeiZi</span> <span class="keyword">implements</span> <span class="title">Observable</span> ,<span class="title">IHanFeiZi</span></span>&#123;</span><br><span class="line">    <span class="comment">//定义个变长数组，存放所有的观察者</span></span><br><span class="line">    <span class="keyword">private</span> ArrayList&lt;Observer&gt; observerList = <span class="keyword">new</span> ArrayList&lt;Observer&gt;();</span><br><span class="line">    <span class="comment">//增加观察者</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addObserver</span><span class="params">(Observer observer)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.observerList.add(observer);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//删除观察者</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteObserver</span><span class="params">(Observer observer)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.observerList.remove(observer);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//通知所有的观察者</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">notifyObservers</span><span class="params">(String context)</span></span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(Observer observer:observerList)&#123;</span><br><span class="line">            observer.update(context);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//韩非子要吃饭了</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">haveBreakfast</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;韩非子:开始吃饭了...&quot;</span>);</span><br><span class="line">        <span class="comment">//通知所有的观察者</span></span><br><span class="line">        <span class="keyword">this</span>.notifyObservers(<span class="string">&quot;韩非子在吃饭&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//韩非子开始娱乐了</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">haveFun</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;韩非子:开始娱乐了...&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">this</span>.notifyObservers(<span class="string">&quot;韩非子在娱乐&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>观察者只是把原有的ILiSi接口修改了一个名字而已，如代码清单22-11所示。</p>
<p>代码清单22-11 观察者接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Observer</span> </span>&#123;</span><br><span class="line">    <span class="comment">//一发现别人有动静，自己也要行动起来</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">(String context)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后是三个很无耻的观察者，咱先看看真实的李斯，如代码清单22-12所示。</p>
<p>代码清单22-12 具体的观察者</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LiSi</span> <span class="keyword">implements</span> <span class="title">Observer</span></span>&#123;</span><br><span class="line">    <span class="comment">//首先李斯是个观察者，一旦韩非子有活动，他就知道，他就要向老板汇报</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">(String str)</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;李斯：观察到韩非子活动，开始向老板汇报了...&quot;</span>);</span><br><span class="line">        <span class="keyword">this</span>.reportToQinShiHuang(str);</span><br><span class="line">        System.out.println(<span class="string">&quot;李斯：汇报完毕...\n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//汇报给秦始皇</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">reportToQinShiHuang</span><span class="params">(String reportContext)</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;李斯：报告，秦老板！韩非子有活动了--&gt;&quot;</span>+reportContext);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>李斯是真有其人，以下两个观察者王斯和刘斯是杜撰出来的，如代码清单22-13所示。</p>
<p>代码清单22-13 杜撰的观察者</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WangSi</span> <span class="keyword">implements</span> <span class="title">Observer</span></span>&#123;</span><br><span class="line">    <span class="comment">//王斯，看到韩非子有活动</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">(String str)</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;王斯：观察到韩非子活动，自己也开始活动了...&quot;</span>);</span><br><span class="line">        <span class="keyword">this</span>.cry(str);</span><br><span class="line">        System.out.println(<span class="string">&quot;王斯：哭死了...\n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//一看韩非子有活动，他就痛哭</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">cry</span><span class="params">(String context)</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;王斯：因为&quot;</span>+context+<span class="string">&quot;，--所以我悲伤呀！&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LiuSi</span> <span class="keyword">implements</span> <span class="title">Observer</span></span>&#123;</span><br><span class="line">    <span class="comment">//刘斯，观察到韩非子活动后，自己也得做一些事</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">(String str)</span></span>&#123;</span><br><span class="line">        </span><br><span class="line">        System.out.println(<span class="string">&quot;刘斯：观察到韩非子活动，开始动作了...&quot;</span>);</span><br><span class="line">        <span class="keyword">this</span>.happy(str);</span><br><span class="line">        System.out.println(<span class="string">&quot;刘斯：乐死了\n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//一看韩非子有变化，他就快乐</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">happy</span><span class="params">(String context)</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;刘斯：因为&quot;</span> +context+<span class="string">&quot;,--所以我快乐呀！&quot;</span> );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>所有的历史人物都在场了，那我们来看看这场历史闹剧是如何演绎的，如代码清单22- 14所示。</p>
<p>代码清单22-14 场景类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Client</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//三个观察者产生出来</span></span><br><span class="line">        Observer liSi = <span class="keyword">new</span> LiSi();</span><br><span class="line">        Observer wangSi = <span class="keyword">new</span> WangSi();</span><br><span class="line">        Observer liuSi = <span class="keyword">new</span> LiuSi();</span><br><span class="line">        <span class="comment">//定义出韩非子</span></span><br><span class="line">        HanFeiZi hanFeiZi = <span class="keyword">new</span> HanFeiZi();</span><br><span class="line">        <span class="comment">//我们后人根据历史，描述这个场景，有三个人在观察韩非子</span></span><br><span class="line">        hanFeiZi.addObserver(liSi);</span><br><span class="line">        hanFeiZi.addObserver(wangSi);</span><br><span class="line">        hanFeiZi.addObserver(liuSi);</span><br><span class="line">        <span class="comment">//然后这里我们看看韩非子在干什么</span></span><br><span class="line">        hanFeiZi.haveBreakfast();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>运行结果如下所示：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">韩非子：开始吃饭了... </span><br><span class="line">李斯：观察到韩非子活动，开始向老板汇报了... </span><br><span class="line">李斯：报告，秦老板！韩非子有活动了---&gt;韩非子在吃饭 </span><br><span class="line">李斯：汇报完毕... </span><br><span class="line">王斯：观察到韩非子活动，自己也开始活动了... </span><br><span class="line">王斯：因为韩非子在吃饭——所以我悲伤呀！ </span><br><span class="line">王斯：哭死了... </span><br><span class="line">刘斯：观察到韩非子活动，开始动作了... </span><br><span class="line">刘斯：因为韩非子在吃饭——所以我快乐呀！</span><br><span class="line">刘斯：乐死了</span><br></pre></td></tr></table></figure>
<p>好了，结果也正确了，也符合开闭原则了，同时也实现类间解耦，想再加观察者？继续实现Observer接口就成了，这时候必须修改Client程序，因为你的业务都发生了变化。这就是观察者模式。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://lanlan2017.github.io/JavaReadingNotes/cc8f8a27/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/JavaReadingNotes/images/avatar.gif">
      <meta itemprop="name" content="蓝蓝">
      <meta itemprop="description" content="好好学习，天天向上">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="蓝蓝站点">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/JavaReadingNotes/cc8f8a27/" class="post-title-link" itemprop="url">26.1 城市的纵向发展功臣——电梯</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-09-27 19:57:33" itemprop="dateCreated datePublished" datetime="2021-09-27T19:57:33+08:00">2021-09-27</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-09-30 15:39:03" itemprop="dateModified" datetime="2021-09-30T15:39:03+08:00">2021-09-30</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/8-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E7%A6%85-%E7%AC%AC2%E7%89%88/" itemprop="url" rel="index"><span itemprop="name">8 设计模式之禅(第2版)</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/8-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E7%A6%85-%E7%AC%AC2%E7%89%88/2-%E7%AC%AC%E4%BA%8C%E9%83%A8%E5%88%86-%E7%9C%9F%E5%88%80%E5%AE%9E%E6%9E%AA-23%E7%A7%8D%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E5%AE%8C%E7%BE%8E%E6%BC%94%E7%BB%8E/" itemprop="url" rel="index"><span itemprop="name">2 第二部分 真刀实枪 23种设计模式完美演绎</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/8-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E7%A6%85-%E7%AC%AC2%E7%89%88/2-%E7%AC%AC%E4%BA%8C%E9%83%A8%E5%88%86-%E7%9C%9F%E5%88%80%E5%AE%9E%E6%9E%AA-23%E7%A7%8D%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E5%AE%8C%E7%BE%8E%E6%BC%94%E7%BB%8E/%E7%AC%AC26%E7%AB%A0-%E7%8A%B6%E6%80%81%E6%A8%A1%E5%BC%8F/" itemprop="url" rel="index"><span itemprop="name">第26章 状态模式</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
    <span class="post-meta-item-icon">
      <i class="far fa-comment"></i>
    </span>
    <span class="post-meta-item-text">Waline：</span>
  
    <a title="waline" href="/JavaReadingNotes/cc8f8a27/#waline-comments" itemprop="discussionUrl">
      <span class="post-comments-count waline-comment-count" id="/JavaReadingNotes/cc8f8a27/" data-xid="/JavaReadingNotes/cc8f8a27/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>11k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>10 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="26-1-城市的纵向发展功臣——电梯"><a href="#26-1-城市的纵向发展功臣——电梯" class="headerlink" title="26.1 城市的纵向发展功臣——电梯"></a>26.1 城市的纵向发展功臣——电梯</h1><p>现在城市发展很快，百万级人口的城市很多，那其中有两个东西的发明在城市的发展中起到非常重要的作用：一个是汽车，另一个是电梯。汽车让城市可以横向扩展，电梯让城市可以纵向延伸，向空中伸展。汽车对城市的发展我们就不说了，电梯，你想想看，如果没有电梯，每天你需要爬15层楼梯，你是不是会累坏了？建筑师设计了一个没有电梯的建筑，投资者肯定不愿意投资，那也是建筑师的耻辱，今天我们就用程序表现一下这个电梯是怎么运作的。</p>
<p>我们每天都在乘电梯，那我们来看看电梯有哪些动作（映射到Java中就是有多少方法）：开门、关门、运行、停止。好，我们就用程序来实现一下电梯的动作，先看类图设计，如图26-1所示。</p>
<p><img data-src="https://raw.githubusercontent.com/lanlan2017/images/master/Blog/Sum/20210930105239.png" alt="image-20210930105239335"></p>
<center>图26-1 电梯的类图</center>
非常简单的类图，定义一个接口，然后是一个实现类，然后业务场景类Client就可以调用，并运行起来，简单也要实现出来。看看该程序的接口，如代码清单26-1所示。

<p>代码清单26-1 电梯接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ILift</span> </span>&#123;</span><br><span class="line">    <span class="comment">//首先电梯门开启动作</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">open</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="comment">//电梯门可以开启，那当然也就有关闭了</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">close</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="comment">//电梯要能上能下</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="comment">//电梯还要能停下来</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">stop</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>接口有了，再来看实现类，如代码清单26-2所示。</p>
<p>代码清单26-2 电梯实现类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Lift</span> <span class="keyword">implements</span> <span class="title">ILift</span> </span>&#123;</span><br><span class="line">    <span class="comment">//电梯门关闭</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">close</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;电梯门关闭...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//电梯门开启</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">open</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;电梯门开启...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//电梯开始运行起来</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;电梯上下运行起来...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//电梯停止</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">stop</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;电梯停止了...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>电梯的开、关、运行、停都实现了，再看看场景类是怎么调用的，如代码清单26-3所示。</p>
<p>代码清单26-3 场景类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Client</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        ILift lift = <span class="keyword">new</span> Lift();</span><br><span class="line">        <span class="comment">//首先是电梯门开启，人进去</span></span><br><span class="line">        lift.open();</span><br><span class="line">        <span class="comment">//然后电梯门关闭</span></span><br><span class="line">        lift.close();</span><br><span class="line">        <span class="comment">//再然后，电梯运行起来，向上或者向下</span></span><br><span class="line">        lift.run();</span><br><span class="line">        <span class="comment">//最后到达目的地，电梯停下来</span></span><br><span class="line">        lift.stop();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>运行的结果如下所示：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">电梯门开启... </span><br><span class="line">电梯门关闭... </span><br><span class="line">电梯上下运行起来... </span><br><span class="line">电梯停止了...</span><br></pre></td></tr></table></figure>
<p>太简单的程序了！每个程序员都会写这个程序，这么简单的程序还拿出来显摆，是不是太小看我们的智商了？非也，非也，我们继续往下分析，这个程序有什么问题？你想想，电梯门可以打开，但不是随时都可以开，是有前提条件的。你不可能电梯在运行的时候突然开门吧？！电梯也不会出现停止了但是不开门的情况吧？！那要是有也是事故嘛，再仔细想想，电梯的这4个动作的执行都有前置条件，具体点说就是在特定状态下才能做特定事，那我们来分析一下电梯有哪些特定状态。</p>
<ul>
<li>敞门状态</li>
</ul>
<p>按了电梯上下按钮，电梯门开，这中间大概有10秒的时间，那就是敞门状态。在这个状态下电梯只能做的动作是关门动作。</p>
<ul>
<li>闭门状态</li>
</ul>
<p>电梯门关闭了，在这个状态下，可以进行的动作是：开门（我不想坐电梯了）、停止 （忘记按路层号了）、运行。</p>
<ul>
<li>运行状态</li>
</ul>
<p>电梯正在跑，上下窜，在这个状态下，电梯只能做的是停止。</p>
<ul>
<li>停止状态</li>
</ul>
<p>电梯停止不动，在这个状态下，电梯有两个可选动作：继续运行和开门动作。</p>
<p>我们用一张表来表示电梯状态和动作之间的关系，如图26-2所示。</p>
<p><img data-src="https://raw.githubusercontent.com/lanlan2017/images/master/Blog/Sum/20210930105605.png" alt="image-20210930105605468"></p>
<center>图26-2 电梯状态和动作对应表（○表示不允许，☆表示允许动作）</center>

<p>看到这张表后，我们才发觉，哦，我们的程序做得很不严谨，好，我们来修改一下，如图26-3所示。</p>
<p>在接口中定义了4个常量，分别表示电梯的4个状态：敞门状态、闭门状态、运行状态、 停止状态，然后在实现类中电梯的每一次动作发生都要对状态进行判断，判断是否可以执行，也就是动作的执行是否符合业务逻辑，实现类中有4个私有方法是仅仅实现电梯的动作，没有任何前置条件，因此这4个方法是不能为外部类调用的，设置为私有方法。我们先看接口的改变，如代码清单26-4所示。</p>
<p><img data-src="https://raw.githubusercontent.com/lanlan2017/images/master/Blog/Sum/20210930105659.png" alt="image-20210930105659255"></p>
<center>图26-3 增加了状态的类图</center>

<p>代码清单26-4 电梯接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ILift</span> </span>&#123;</span><br><span class="line">    <span class="comment">//电梯的4个状态</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="keyword">int</span> OPENING_STATE = <span class="number">1</span>;</span><br><span class="line">    <span class="comment">//敞门状态</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="keyword">int</span> CLOSING_STATE = <span class="number">2</span>;</span><br><span class="line">    <span class="comment">//闭门状态</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="keyword">int</span> RUNNING_STATE = <span class="number">3</span>;</span><br><span class="line">    <span class="comment">//运行状态</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="keyword">int</span> STOPPING_STATE = <span class="number">4</span>;</span><br><span class="line">    <span class="comment">//停止状态</span></span><br><span class="line">    <span class="comment">//设置电梯的状态</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setState</span><span class="params">(<span class="keyword">int</span> state)</span></span>;</span><br><span class="line">    <span class="comment">//首先电梯门开启动作</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">open</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="comment">//电梯门可以开启，那当然也就有关闭了</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">close</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="comment">//电梯要能上能下，运行起来</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="comment">//电梯还要能停下来</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">stop</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这里增加了4个静态常量，并增加了一个方法setState，设置电梯的状态。我们再来看实现类是如何实现的，如代码清单26-5所示。</p>
<p>代码清单26-5 电梯实现类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Lift</span> <span class="keyword">implements</span> <span class="title">ILift</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> state;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setState</span><span class="params">(<span class="keyword">int</span> state)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.state = state;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//电梯门关闭</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">close</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//电梯在什么状态下才能关闭</span></span><br><span class="line">        <span class="keyword">switch</span>(<span class="keyword">this</span>.state)&#123;</span><br><span class="line">            <span class="keyword">case</span> OPENING_STATE:<span class="comment">//可以关门，同时修改电梯状态</span></span><br><span class="line">            <span class="keyword">this</span>.closeWithoutLogic();</span><br><span class="line">            <span class="keyword">this</span>.setState(CLOSING_STATE);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> CLOSING_STATE:<span class="comment">//电梯是关门状态，则什么都不做</span></span><br><span class="line">            <span class="comment">//do</span></span><br><span class="line">            nothing;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> RUNNING_STATE:<span class="comment">//正在运行，门本来就是关闭的，也什么都不做</span></span><br><span class="line">            <span class="comment">//do</span></span><br><span class="line">            nothing;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> STOPPING_STATE:<span class="comment">//停止状态，门也是关闭的，什么也不做</span></span><br><span class="line">            <span class="comment">//do</span></span><br><span class="line">            nothing;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//电梯门开启</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">open</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//电梯在什么状态才能开启</span></span><br><span class="line">        <span class="keyword">switch</span>(<span class="keyword">this</span>.state)&#123;</span><br><span class="line">            <span class="keyword">case</span> OPENING_STATE:<span class="comment">//闭门状态，什么都不做</span></span><br><span class="line">            <span class="comment">//do</span></span><br><span class="line">            nothing;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> CLOSING_STATE:<span class="comment">//闭门状态，则可以开启</span></span><br><span class="line">            <span class="keyword">this</span>.openWithoutLogic();</span><br><span class="line">            <span class="keyword">this</span>.setState(OPENING_STATE);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> RUNNING_STATE:<span class="comment">//运行状态，则不能开门，什么都不做</span></span><br><span class="line">            <span class="comment">//do</span></span><br><span class="line">            nothing;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> STOPPING_STATE:<span class="comment">//停止状态，当然要开门了</span></span><br><span class="line">            <span class="keyword">this</span>.openWithoutLogic();</span><br><span class="line">            <span class="keyword">this</span>.setState(OPENING_STATE);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//电梯开始运行起来</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">switch</span>(<span class="keyword">this</span>.state)&#123;</span><br><span class="line">            <span class="keyword">case</span> OPENING_STATE:<span class="comment">//敞门状态，什么都不做</span></span><br><span class="line">            <span class="comment">//do</span></span><br><span class="line">            nothing;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> CLOSING_STATE:<span class="comment">//闭门状态，则可以运行</span></span><br><span class="line">            <span class="keyword">this</span>.runWithoutLogic();</span><br><span class="line">            <span class="keyword">this</span>.setState(RUNNING_STATE);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> RUNNING_STATE:<span class="comment">//运行状态，则什么都不做</span></span><br><span class="line">            <span class="comment">//do</span></span><br><span class="line">            nothing;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> STOPPING_STATE:<span class="comment">//停止状态，可以运行</span></span><br><span class="line">            <span class="keyword">this</span>.runWithoutLogic();</span><br><span class="line">            <span class="keyword">this</span>.setState(RUNNING_STATE);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//电梯停止</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">stop</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">switch</span>(<span class="keyword">this</span>.state)&#123;</span><br><span class="line">            <span class="keyword">case</span> OPENING_STATE:<span class="comment">//敞门状态，要先停下来的，什么都不做</span></span><br><span class="line">            <span class="comment">//do</span></span><br><span class="line">            nothing;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> CLOSING_STATE:<span class="comment">//闭门状态，则当然可以停止了</span></span><br><span class="line">            <span class="keyword">this</span>.stopWithoutLogic();</span><br><span class="line">            <span class="keyword">this</span>.setState(CLOSING_STATE);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> RUNNING_STATE:<span class="comment">//运行状态，有运行当然那也就有停止了</span></span><br><span class="line">            <span class="keyword">this</span>.stopWithoutLogic();</span><br><span class="line">            <span class="keyword">this</span>.setState(CLOSING_STATE);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> STOPPING_STATE:<span class="comment">//停止状态，什么都不做</span></span><br><span class="line">            <span class="comment">//do</span></span><br><span class="line">            nothing;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//纯粹的电梯关门，不考虑实际的逻辑</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">closeWithoutLogic</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;电梯门关闭...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//纯粹的电梯开门，不考虑任何条件</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">openWithoutLogic</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;电梯门开启...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//纯粹的运行，不考虑其他条件</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">runWithoutLogic</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;电梯上下运行起来...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//单纯的停止，不考虑其他条件</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">stopWithoutLogic</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;电梯停止了...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>程序有点长，但是还是很简单的，就是在每一个接口定义的方法中使用switch…case来判断它是否符合业务逻辑，然后运行指定的动作。我们重新编写一个场景类来描述一下该环境，如代码清单26-6所示。</p>
<p>代码清单26-6 场景类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Client</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        ILift lift = <span class="keyword">new</span> Lift();</span><br><span class="line">        <span class="comment">//电梯的初始条件应该是停止状态</span></span><br><span class="line">        lift.setState(ILift.STOPPING_STATE);</span><br><span class="line">        <span class="comment">//首先是电梯门开启，人进去</span></span><br><span class="line">        lift.open();</span><br><span class="line">        <span class="comment">//然后电梯门关闭</span></span><br><span class="line">        lift.close();</span><br><span class="line">        <span class="comment">//再然后，电梯运行起来，向上或者向下</span></span><br><span class="line">        lift.run();</span><br><span class="line">        <span class="comment">//最后到达目的地，电梯停下来</span></span><br><span class="line">        lift.stop();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在业务调用的方法中增加了电梯状态判断，电梯要不是随时都可以开的，必须满足一定条件才能开门，人才能走进去，我们设置电梯的起始是停止状态，运行结果如下所示：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">电梯门开启... </span><br><span class="line">电梯门关闭... </span><br><span class="line">电梯上下运行起来... </span><br><span class="line">电梯停止了...</span><br></pre></td></tr></table></figure>
<p>我们来想一下，这段程序有什么问题。</p>
<ul>
<li>电梯实现类Lift有点长</li>
</ul>
<p>长的原因是我们在程序中使用了大量的switch…case这样的判断（if…else也是一样），程序中只要有这样的判断就避免不了加长程序，而且在业务复杂的情况下，程序会更长，这就不是一个很好的习惯了，较长的方法和类无法带来良好的维护性，毕竟，程序首先是给人阅读的，然后才是机器执行。</p>
<ul>
<li>扩展性非常差劲</li>
</ul>
<p>大家来想想，电梯还有两个状态没有加，是什么？通电状态和断电状态，你要是在程序增加这两个方法，你看看Open()、Close()、Run()、Stop()这4个方法都要增加判断条件，也就是说switch判断体中还要增加case项，这与开闭原则相违背。</p>
<ul>
<li>非常规状态无法实现</li>
</ul>
<p>我们来思考我们的业务，电梯在门敞开状态下就不能上下运行了吗？电梯有没有发生过只有运行没有停止状态呢（从40层直接坠到1层嘛）？电梯故障嘛，还有电梯在检修的时候，可以在stop状态下不开门，这也是正常的业务需求呀，你想想看，如果加上这些判断条件，上面的程序有多少需要修改？虽然这些都是电梯的业务逻辑，但是一个类有且仅有一个原因引起类的变化，单一职责原则，看看我们的类，业务任务上一个小小的增加或改动都使得我们这个电梯类产生了修改，这在项目开发上是有很大风险的。</p>
<p>既然我们已经发现程序中有以上问题，我们怎么来修改呢？刚刚我们是从电梯的方法以及这些方法执行的条件去分析，现在我们换个角度来看问题。我们来想，电梯在具有这些状态的时候能够做什么事情，也就是说在电梯处于某个具体状态时，我们来思考这个状态是由什么动作触发而产生的，以及在这个状态下电梯还能做什么事情。例如，电梯在停止状态时，我们来思考两个问题：</p>
<ul>
<li>停止状态是怎么来的，那当然是由于电梯执行了stop方法而来的。</li>
<li>在停止状态下，电梯还能做什么动作？继续运行？开门？当然都可以了。</li>
</ul>
<p>我们再来分析其他3个状态，也都是一样的结果，我们只要实现电梯在一个状态下的两个任务模型就可以了：这个状态是如何产生的，以及在这个状态下还能做什么其他动作（也就是这个状态怎么过渡到其他状态），既然我们以状态为参考模型，那我们就先定义电梯的状态接口，类图如图26-4所示。</p>
<p><img data-src="https://raw.githubusercontent.com/lanlan2017/images/master/Blog/Sum/20210930110024.png" alt="image-20210930110024745"></p>
<center>图26-4 以状态作为导向的类图</center>
在类图中，定义了一个LiftState抽象类，声明了一个受保护的类型Context变量，这个是串联各个状态的封装类。封装的目的很明显，就是电梯对象内部状态的变化不被调用类知晓，也就是迪米特法则了（我的类内部情节你知道得越少越好），并且还定义了4个具体的实现类，承担的是状态的产生以及状态间的转换过渡，我们先来看LiftState代码，如代码清单26-7所示。

<p>代码清单26-7 抽象电梯状态</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">LiftState</span></span>&#123;</span><br><span class="line">    <span class="comment">//定义一个环境角色，也就是封装状态的变化引起的功能变化</span></span><br><span class="line">    <span class="keyword">protected</span> Context context;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setContext</span><span class="params">(Context _context)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.context = _context;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//首先电梯门开启动作</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">open</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="comment">//电梯门有开启，那当然也就有关闭了</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">close</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="comment">//电梯要能上能下，运行起来</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="comment">//电梯还要能停下来</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">stop</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>抽象类比较简单，我们先看一个具体的实现——敞门状态的实现类，如代码清单26-8所示。</p>
<p>代码清单26-8 敞门状态</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OpenningState</span> <span class="keyword">extends</span> <span class="title">LiftState</span> </span>&#123;</span><br><span class="line">    <span class="comment">//开启当然可以关闭了，我就想测试一下电梯门开关功能</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">close</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//状态修改</span></span><br><span class="line">        <span class="keyword">super</span>.context.setLiftState(Context.closeingState);</span><br><span class="line">        <span class="comment">//动作委托为CloseState来执行</span></span><br><span class="line">        <span class="keyword">super</span>.context.getLiftState().close();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//打开电梯门</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">open</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;电梯门开启...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//门开着时电梯就运行跑，这电梯，吓死你！</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//do</span></span><br><span class="line">        nothing;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//开门还不停止？</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">stop</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//do</span></span><br><span class="line">        nothing;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我来解释一下这个类的几个方法，Openning状态是由open()方法产生的，因此，在这个方法中有一个具体的业务逻辑，我们是用print来代替了。在Openning状态下，电梯能过渡到其他什么状态呢？按照现在的定义的是只能过渡到Closing状态，因此我们在Close()中定义了状态变更，同时把Close这个动作也委托了给CloseState类下的Close方法执行，这个可能不好理解，我们再看看Context类可能好理解一点，如代码清单26-9所示。</p>
<p>代码清单26-9 上下文类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Context</span> </span>&#123;</span><br><span class="line">    <span class="comment">//定义出所有的电梯状态</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> OpenningState openningState = <span class="keyword">new</span> OpenningState();</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> ClosingState closeingState = <span class="keyword">new</span> ClosingState();</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> RunningState runningState = <span class="keyword">new</span> RunningState();</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> StoppingState stoppingState = <span class="keyword">new</span> StoppingState();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//定义一个当前电梯状态</span></span><br><span class="line">    <span class="keyword">private</span> LiftState liftState;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> LiftState <span class="title">getLiftState</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> liftState;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setLiftState</span><span class="params">(LiftState liftState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.liftState = liftState;</span><br><span class="line">        <span class="comment">//把当前的环境通知到各个实现类中</span></span><br><span class="line">        <span class="keyword">this</span>.liftState.setContext(<span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">open</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.liftState.open();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">close</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.liftState.close();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.liftState.run();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">stop</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.liftState.stop();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>结合以上3个类，我们可以这样理解：Context是一个环境角色，它的作用是串联各个状态的过渡，在LiftSate抽象类中我们定义并把这个环境角色聚合进来，并传递到子类，也就是4个具体的实现类中自己根据环境来决定如何进行状态的过渡。关闭状态如代码清单26-10所示。</p>
<p>代码清单26-10 关闭状态</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ClosingState</span> <span class="keyword">extends</span> <span class="title">LiftState</span> </span>&#123;</span><br><span class="line">    <span class="comment">//电梯门关闭，这是关闭状态要实现的动作</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">close</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;电梯门关闭...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//电梯门关了再打开</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">open</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.context.setLiftState(Context.openningState);</span><br><span class="line">        <span class="comment">//置为敞门状态</span></span><br><span class="line">        <span class="keyword">super</span>.context.getLiftState().open();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//电梯门关了就运行，这是再正常不过了</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.context.setLiftState(Context.runningState);</span><br><span class="line">        <span class="comment">//设置为运行状态</span></span><br><span class="line">        <span class="keyword">super</span>.context.getLiftState().run();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//电梯门关着，我就不按楼层</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">stop</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.context.setLiftState(Context.stoppingState);</span><br><span class="line">        <span class="comment">//设置为停止状态</span></span><br><span class="line">        <span class="keyword">super</span>.context.getLiftState().stop();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>运行状态如代码清单26-11所示。</p>
<p>代码清单26-11 运行状态</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RunningState</span> <span class="keyword">extends</span> <span class="title">LiftState</span> </span>&#123;</span><br><span class="line">    <span class="comment">//电梯门关闭？这是肯定的</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">close</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//do</span></span><br><span class="line">    nothing &#125;</span><br><span class="line">    <span class="comment">//运行的时候开电梯门？你疯了！电梯不会给你开的</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">open</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//do</span></span><br><span class="line">    nothing &#125;</span><br><span class="line">    <span class="comment">//这是在运行状态下要实现的方法</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;电梯上下运行...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//这绝对是合理的，只运行不停止还有谁敢坐这个电梯？！估计只有上帝了</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">stop</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.context.setLiftState(Context.stoppingState);</span><br><span class="line">        <span class="comment">//环境设置为停止状态</span></span><br><span class="line">        <span class="keyword">super</span>.context.getLiftState().stop();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>停止状态如代码清单26-12所示。</p>
<p>代码清单26-12 停止状态</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StoppingState</span> <span class="keyword">extends</span> <span class="title">LiftState</span> </span>&#123;</span><br><span class="line">    <span class="comment">//停止状态关门？电梯门本来就是关着的！</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">close</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//do</span></span><br><span class="line">        nothing;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//停止状态，开门，那是要的！</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">open</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.context.setLiftState(Context.openningState);</span><br><span class="line">        <span class="keyword">super</span>.context.getLiftState().open();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//停止状态再运行起来，正常得很</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.context.setLiftState(Context.runningState);</span><br><span class="line">        <span class="keyword">super</span>.context.getLiftState().run();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//停止状态是怎么发生的呢？当然是停止方法执行了</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">stop</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;电梯停止了...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>业务逻辑都已经实现了，我们看看怎么来模拟场景类，如代码清单26-13所示。</p>
<p>代码清单26-13 场景类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Client</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Context context = <span class="keyword">new</span> Context();</span><br><span class="line">        context.setLiftState(<span class="keyword">new</span> ClosingState());</span><br><span class="line">        context.open();</span><br><span class="line">        context.close();</span><br><span class="line">        context.run();</span><br><span class="line">        context.stop();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Client场景类太简单了，只要定义一个电梯的初始状态，然后调用相关的方法，就完成 了，完全不用考虑状态的变更，运行结果完全相同，不再赘述。</p>
<p>我们再来回顾一下我们刚刚批判的上一段代码。首先是代码太长，这个问题已经解决了，通过各个子类来实现，每个子类的代码都很短，而且也取消了switch…case条件的判断。 其次是不符合开闭原则，那如果在我们这个例子中要增加两个状态应该怎么做呢？增加两个子类，一个是通电状态，另一个是断电状态，同时修改其他实现类的相应方法，因为状态要过渡，那当然要修改原有的类，只是在原有类中的方法上增加，而不去做修改。再次是不符合迪米特法则，我们现在的各个状态是单独的类，只有与这个状态有关的因素修改了，这个类才修改，符合迪米特法则，非常完美!这就是状态模式。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://lanlan2017.github.io/JavaReadingNotes/a31669a2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/JavaReadingNotes/images/avatar.gif">
      <meta itemprop="name" content="蓝蓝">
      <meta itemprop="description" content="好好学习，天天向上">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="蓝蓝站点">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/JavaReadingNotes/a31669a2/" class="post-title-link" itemprop="url">30.2 抽象工厂模式VS建造者模式</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-09-27 19:57:33" itemprop="dateCreated datePublished" datetime="2021-09-27T19:57:33+08:00">2021-09-27</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-09-30 21:45:46" itemprop="dateModified" datetime="2021-09-30T21:45:46+08:00">2021-09-30</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/8-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E7%A6%85-%E7%AC%AC2%E7%89%88/" itemprop="url" rel="index"><span itemprop="name">8 设计模式之禅(第2版)</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/8-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E7%A6%85-%E7%AC%AC2%E7%89%88/3-%E7%AC%AC%E4%B8%89%E9%83%A8%E5%88%86-%E8%B0%81%E7%9A%84%E5%9C%B0%E7%9B%98%E8%B0%81%E5%81%9A%E4%B8%BB-%E2%80%94%E2%80%94%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8FPK/" itemprop="url" rel="index"><span itemprop="name">3 第三部分 谁的地盘谁做主 ——设计模式PK</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/8-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E7%A6%85-%E7%AC%AC2%E7%89%88/3-%E7%AC%AC%E4%B8%89%E9%83%A8%E5%88%86-%E8%B0%81%E7%9A%84%E5%9C%B0%E7%9B%98%E8%B0%81%E5%81%9A%E4%B8%BB-%E2%80%94%E2%80%94%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8FPK/%E7%AC%AC30%E7%AB%A0-%E5%88%9B%E5%BB%BA%E7%B1%BB%E6%A8%A1%E5%BC%8F%E5%A4%A7PK/" itemprop="url" rel="index"><span itemprop="name">第30章 创建类模式大PK</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
    <span class="post-meta-item-icon">
      <i class="far fa-comment"></i>
    </span>
    <span class="post-meta-item-text">Waline：</span>
  
    <a title="waline" href="/JavaReadingNotes/a31669a2/#waline-comments" itemprop="discussionUrl">
      <span class="post-comments-count waline-comment-count" id="/JavaReadingNotes/a31669a2/" data-xid="/JavaReadingNotes/a31669a2/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>9.2k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>8 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="30-2-抽象工厂模式VS建造者模式"><a href="#30-2-抽象工厂模式VS建造者模式" class="headerlink" title="30.2 抽象工厂模式VS建造者模式"></a>30.2 抽象工厂模式VS建造者模式</h1><p>抽象工厂模式实现对产品家族的创建，一个产品家族是这样的一系列产品：具有不同分类维度的产品组合，采用抽象工厂模式则是不需要关心构建过程，只关心什么产品由什么工厂生产即可。而建造者模式则是要求按照指定的蓝图建造产品，它的主要目的是通过组装零配件而产生一个新产品，两者的区别还是比较明显的，但是还有读者对这两个模式产生混淆，我们通过一个例子说明两者的差别。</p>
<p>现代化的汽车工厂能够批量生产汽车（不考虑手工打造的豪华车）。不同的工厂生产不同的汽车，宝马工厂生产宝马牌子的车，奔驰工厂生产奔驰牌子的车。车不仅具有不同品牌，还有不同的用途分类，如商务车Van，运动型车SUV等，我们按照两种设计模式分别实现车辆的生产过程。</p>
<h2 id="30-2-1-按抽象工厂模式生产车辆"><a href="#30-2-1-按抽象工厂模式生产车辆" class="headerlink" title="30.2.1 按抽象工厂模式生产车辆"></a>30.2.1 按抽象工厂模式生产车辆</h2><p>按照抽象工厂模式，首先需要定义一个抽象的产品接口即汽车接口，然后宝马和奔驰分别实现该接口，由于它们只具有了一个品牌属性，还没有定义一个具体的型号，属于对象的抽象层次，每个具体车型由其子类实现，如R系列的奔驰车是商务车，X系列的宝马车属于SUV，我们来看类图，如图30-3所示。</p>
<p><img data-src="https://raw.githubusercontent.com/lanlan2017/images/master/Blog/Sum/20210930155636.png" alt="image-20210930155636695"></p>
<center>图30-3 车辆生产的工厂类图</center>

<p>在类图中，产品类很简单，我们从两个维度看产品：品牌和车型，每个品牌下都有两个车型，如宝马SUV，宝马商务车等，同时我们又建造了两个工厂，一个专门生产宝马车的宝马工厂BMWFactory，一个是生产奔驰车的奔驰车生产工厂BenzFactory。当然，汽车工厂也有两个不同的维度，可以建立这样两个工厂：一个专门生产SUV车辆的生产工厂，生产宝马SUV和奔驰SUV，另外一个工厂专门生成商务车，分别是宝马商务车和奔驰商务车，这样设计在技术上是完全可行的，但是在业务上是不可行的，为什么？这是因为你看到过有一个工厂既能生产奔驰SUV也能生产宝马SUV吗？这是不可能的，因为业务受限，除非是国内的山寨工厂。我们先来看产品类，汽车接口如代码清单30-12所示。</p>
<p>代码清单30-12 汽车接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ICar</span> </span>&#123;</span><br><span class="line">    <span class="comment">//汽车的生产商，也就是牌子</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getBand</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="comment">//汽车的型号</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getModel</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在产品接口中我们定义了车辆有两个可以查询的属性：品牌和型号，奔驰车和宝马车是两个不同品牌的产品，但不够具体，只是知道它们的品牌而已，还不能够实例化，因此还是一个抽象类，如代码清单30-13所示。</p>
<p>代码清单30-13 抽象宝马车</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">AbsBMW</span> <span class="keyword">implements</span> <span class="title">ICar</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> String BMW_BAND = <span class="string">&quot;宝马汽车&quot;</span>;</span><br><span class="line">    <span class="comment">//宝马车</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getBand</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> BMW_BAND;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//型号由具体的实现类实现</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> String <span class="title">getModel</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>抽象产品类中实现了产品的类型定义，车辆的型号没有实现，两实现类分别实现商务车和运动型车，分别如代码清单30-14、代码清单30-15所示。</p>
<p>代码清单30-14 宝马商务车</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BMWVan</span> <span class="keyword">extends</span> <span class="title">AbsBMW</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> String SEVENT_SEARIES = <span class="string">&quot;7系列车型商务车&quot;</span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getModel</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> SEVENT_SEARIES;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>代码清单30-15 宝马SUV</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BMWSuv</span> <span class="keyword">extends</span> <span class="title">AbsBMW</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> String X_SEARIES = <span class="string">&quot;X系列车型SUV&quot;</span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getModel</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> X_SEARIES;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>奔驰车与宝马车类似，都已经有清晰品牌定义，但是型号还没有确认，也是一个抽象的产品类，如代码清单30-16所示。</p>
<p>代码清单30-16 抽象奔驰车</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">AbsBenz</span> <span class="keyword">implements</span> <span class="title">ICar</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> String BENZ_BAND = <span class="string">&quot;奔驰汽车&quot;</span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getBand</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> BENZ_BAND;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//具体型号由实现类完成</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> String <span class="title">getModel</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>由于分类的标准是相同的，因此奔驰车也应该有商务车和运动车两个类型，分别如代码清单30-17和代码清单30-18所示。</p>
<p>代码清单30-17 奔驰商务车</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BenzVan</span> <span class="keyword">extends</span> <span class="title">AbsBenz</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> String R_SERIES = <span class="string">&quot;R系列商务车&quot;</span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getModel</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> R_SERIES;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>代码清单30-18 奔驰SUV</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BenzSuv</span> <span class="keyword">extends</span> <span class="title">AbsBenz</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> String G_SERIES = <span class="string">&quot;G系列SUV&quot;</span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getModel</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> G_SERIES;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>所有的产品类都已经实现了，剩下的工作就是要定义工厂类进行生产，由于产品类型多样，也导致了必须有多个工厂类来生产不同产品，首先就需要定义一个抽象工厂，声明每个工厂必须完成的职责，如代码清单30-19所示。</p>
<p>代码清单30-19 抽象工厂</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">CarFactory</span> </span>&#123;</span><br><span class="line">    <span class="comment">//生产SUV</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ICar <span class="title">createSuv</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="comment">//生产商务车</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ICar <span class="title">createVan</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>抽象工厂定义了每个工厂必须生产两个类型车：SUV（运动车）和VAN（商务车），否则一个工厂就不能被实例化，我们来看宝马车工厂，如代码清单30-20所示。</p>
<p>代码清单30-20 宝马车工厂</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BMWFactory</span> <span class="keyword">implements</span> <span class="title">CarFactory</span> </span>&#123;</span><br><span class="line">    <span class="comment">//生产SUV</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ICar <span class="title">createSuv</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> BMWSuv();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//生产商务车</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ICar <span class="title">createVan</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> BMWVan();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>很简单，你要我生产宝马商务车，没问题，直接产生一个宝马商务车对象，返回给调用者，这对调用者来说根本不需要关心到底是怎么生产的，它只要找到一个宝马工厂，即可生产出自己需要的产品（汽车）。奔驰车工厂与此类似，如代码清单30-21所示。</p>
<p>代码清单30-21 奔驰车工厂</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BenzFactory</span> <span class="keyword">implements</span> <span class="title">CarFactory</span> </span>&#123;</span><br><span class="line">    <span class="comment">//生产SUV</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ICar <span class="title">createSuv</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> BenzSuv();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//生产商务车</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ICar <span class="title">createVan</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> BenzVan();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>产品和工厂都具备了，剩下的工作就是建立一个场景类模拟调用者调用，如代码清单30-22所示。</p>
<p>代码清单30-22 场景类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Client</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//要求生产一辆奔驰SUV</span></span><br><span class="line">        System.out.println(<span class="string">&quot;===要求生产一辆奔驰SUV===&quot;</span>);</span><br><span class="line">        <span class="comment">//首先找到生产奔驰车的工厂</span></span><br><span class="line">        System.out.println(<span class="string">&quot;A、找到奔驰车工厂&quot;</span>);</span><br><span class="line">        CarFactory carFactory= <span class="keyword">new</span> BenzFactory();</span><br><span class="line">        <span class="comment">//开始生产奔驰SUV</span></span><br><span class="line">        System.out.println(<span class="string">&quot;B、开始生产奔驰SUV&quot;</span>);</span><br><span class="line">        ICar benzSuv = carFactory.createSuv();</span><br><span class="line">        <span class="comment">//生产完毕，展示一下车辆信息</span></span><br><span class="line">        System.out.println(<span class="string">&quot;C、生产出的汽车如下：&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;汽车品牌：&quot;</span>+benzSuv.getBand());</span><br><span class="line">        System.out.println(<span class="string">&quot;汽车型号：&quot;</span> + benzSuv.getModel());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>运行结果如下所示：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">===要求生产一辆奔驰SUV=== </span><br><span class="line">A、找到奔驰车工厂 </span><br><span class="line">B、开始生产奔驰SUV </span><br><span class="line">C、生产出的汽车如下： </span><br><span class="line">汽车品牌：奔驰汽车 </span><br><span class="line">汽车型号：G系列SUV</span><br></pre></td></tr></table></figure>
<p>对外界调用者来说，只要更换一个具备相同结构的对象，即可发生非常大的改变，如我们原本使用BenzFactory生产汽车，但是过了一段时间后，我们的系统需要生产宝马汽车，这对系统来说不需要很大的改动，只要把工厂类使用BMWFactory代替即可，立刻可以生产出宝马车，注意这里生产的是一辆完整的车，对于一个产品，只要给出产品代码（车类型）即可生产，抽象工厂模式把一辆车认为是一个完整的、不可拆分的对象。它注重完整性，一个产品一旦找到一个工厂生产，那就是固定的型号，不会出现一个宝马工厂生产奔驰车的情况。那现在的问题是我们就想要一辆混合的车型，如奔驰的引擎，宝马的车轮，那该怎么处理呢？使用我们的建造者模式！</p>
<h2 id="30-2-2-按建造者模式生产车辆"><a href="#30-2-2-按建造者模式生产车辆" class="headerlink" title="30.2.2 按建造者模式生产车辆"></a>30.2.2 按建造者模式生产车辆</h2><p>按照建造者模式设计一个生产车辆需要把车辆进行拆分，拆分成引擎和车轮两部分，然后由建造者进行建造，想要什么车，你只要有设计图纸就成，马上可以制造一辆车出来。它注重的是对零件的装配、组合、封装，它从一个细微构件装配角度看待一个对象。我们来看生产车辆的类图，如图30-4所示。</p>
<p>注意看我们类图中的蓝图类Blueprint，它负责对产品建造过程定义。既然要生产产品， 那必然要对产品进行一个描述，在类图中我们定义了一个接口来描述汽车，如代码清单30- 23所示。</p>
<p>代码清单30-23 车辆产品描述</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ICar</span> </span>&#123;</span><br><span class="line">    <span class="comment">//汽车车轮</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getWheel</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="comment">//汽车引擎</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getEngine</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img data-src="https://raw.githubusercontent.com/lanlan2017/images/master/Blog/Sum/20210930160247.png" alt="image-20210930160246938"></p>
<center>图30-4 建造者模式建造车辆</center>

<p>我们定义一辆车必须有车轮和引擎，具体的产品如代码清单30-24所示。</p>
<p>代码清单30-24 具体车辆</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Car</span> <span class="keyword">implements</span> <span class="title">ICar</span> </span>&#123;</span><br><span class="line">    <span class="comment">//汽车引擎</span></span><br><span class="line">    <span class="keyword">private</span> String engine;</span><br><span class="line">    <span class="comment">//汽车车轮</span></span><br><span class="line">    <span class="keyword">private</span> String wheel;</span><br><span class="line">    <span class="comment">//一次性传递汽车需要的信息</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Car</span><span class="params">(String _engine,String _wheel)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.engine = _engine;</span><br><span class="line">        <span class="keyword">this</span>.wheel = _wheel;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getEngine</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> engine;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getWheel</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> wheel;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;车的轮子是：&quot;</span> + wheel + <span class="string">&quot;\n车的引擎是：&quot;</span> + engine;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>一个简单的JavaBean定义产品的属性，明确对产品的描述。我们继续来思考，因为我们的产品是比较抽象的，它没有指定引擎的型号，也没有指定车轮的牌子，那么这样的组合方式有很多，完全要靠建造者来建造，建造者说要生产一辆奔驰SUV那就得用奔驰的引擎和奔驰的车轮，该建造者对于一个具体的产品来说是绝对的权威，我们来描述一下建造者，如代码清单30-25所示。</p>
<p>代码清单30-25 抽象建造者</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">CarBuilder</span> </span>&#123;</span><br><span class="line">    <span class="comment">//待建造的汽车</span></span><br><span class="line">    <span class="keyword">private</span> ICar car;</span><br><span class="line">    <span class="comment">//设计蓝图</span></span><br><span class="line">    <span class="keyword">private</span> Blueprint bp;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Car <span class="title">buildCar</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="comment">//按照顺序生产一辆车</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Car(buildEngine(),buildWheel());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//接收一份设计蓝图</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">receiveBlueprint</span><span class="params">(Blueprint _bp)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.bp = _bp;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//查看蓝图，只有真正的建造者才可以查看蓝图</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> Blueprint <span class="title">getBlueprint</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> bp;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//建造车轮</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">abstract</span> String <span class="title">buildWheel</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="comment">//建造引擎</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">abstract</span> String <span class="title">buildEngine</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>看到Blueprint类了，它中文的意思是“蓝图”，你要建造一辆车必须有一个设计样稿或者蓝图吧，否则怎么生产？怎么装配？该类就是一个可参考的生产样本，如代码清单30-26所示。</p>
<p>代码清单30-26 生产蓝图</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Blueprint</span> </span>&#123;</span><br><span class="line">    <span class="comment">//车轮的要求</span></span><br><span class="line">    <span class="keyword">private</span> String wheel;</span><br><span class="line">    <span class="comment">//引擎的要求</span></span><br><span class="line">    <span class="keyword">private</span> String engine;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getWheel</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> wheel;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setWheel</span><span class="params">(String wheel)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.wheel = wheel;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getEngine</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> engine;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setEngine</span><span class="params">(String engine)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.engine = engine;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这和一个具体的产品Car类是一样的？错，不一样！它是一个蓝图，是一个可以参考的模板，有一个蓝图可以设计出非常多的产品，如有一个R系统的奔驰商务车设计蓝图，我们就可以生产出一系列的奔驰车。它指导我们的产品生产，而不是一个具体的产品。我们来看宝马车建造车间，如代码清单30-27所示。</p>
<p>代码清单30-27 宝马车建造车间</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BMWBuilder</span> <span class="keyword">extends</span> <span class="title">CarBuilder</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">buildEngine</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.getBlueprint().getEngine();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">buildWheel</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.getBlueprint().getWheel();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这是非常简单的类。只要获得一个蓝图，然后按照蓝图制造引擎和车轮即可，剩下的事情就交给抽象的建造者进行装配。奔驰车间与此类似，如代码清单30-28所示。</p>
<p>代码清单30-28 奔驰车建造车间</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BenzBuilder</span> <span class="keyword">extends</span> <span class="title">CarBuilder</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">buildEngine</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.getBlueprint().getEngine();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">buildWheel</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.getBlueprint().getWheel();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>两个建造车间都已经完成，那现在的问题就变成了怎么让车间运作，谁来编写蓝图？谁来协调生产车间？谁来对外提供最终产品？于是导演类出场了，它不仅仅有每个车间需要的设计蓝图，还具有指导不同车间装配顺序的职责，如代码清单30-29所示。</p>
<p>代码清单30-29 导演类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Director</span> </span>&#123;</span><br><span class="line">    <span class="comment">//声明对建造者的引用</span></span><br><span class="line">    <span class="keyword">private</span> CarBuilder benzBuilder = <span class="keyword">new</span> BenzBuilder();</span><br><span class="line">    <span class="keyword">private</span> CarBuilder bmwBuilder = <span class="keyword">new</span> BMWBuilder();</span><br><span class="line">    <span class="comment">//生产奔驰SUV</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ICar <span class="title">createBenzSuv</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="comment">//制造出汽车</span></span><br><span class="line">        <span class="keyword">return</span> createCar(benzBuilder, <span class="string">&quot;benz的引擎&quot;</span>, <span class="string">&quot;benz的轮胎&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//生产出一辆宝马商务车</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ICar <span class="title">createBMWVan</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> createCar(benzBuilder, <span class="string">&quot;BMW的引擎&quot;</span>, <span class="string">&quot;BMW的轮胎&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//生产出一个混合车型</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ICar <span class="title">createComplexCar</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> createCar(bmwBuilder, <span class="string">&quot;BMW的引擎&quot;</span>, <span class="string">&quot;benz的轮胎&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//生产车辆</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> ICar <span class="title">createCar</span><span class="params">(CarBuilder _carBuilder,String engine,String wheel)</span></span>&#123;</span><br><span class="line">        <span class="comment">//导演怀揣蓝图</span></span><br><span class="line">        Blueprint bp = <span class="keyword">new</span> Blueprint();</span><br><span class="line">        bp.setEngine(engine);</span><br><span class="line">        bp.setWheel(wheel);</span><br><span class="line">        System.out.println(<span class="string">&quot;获得生产蓝图&quot;</span>);</span><br><span class="line">        _carBuilder.receiveBlueprint(bp);</span><br><span class="line">        <span class="keyword">return</span> _carBuilder.buildCar();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这里有一个私有方法createCar，其作用是减少导演类中的方法对蓝图的依赖，全部由该方法来完成。我们编写一个场景类，如代码清单30-30所示。</p>
<p>代码清单30-30 场景类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Client</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//定义出导演类</span></span><br><span class="line">        Director director =<span class="keyword">new</span> Director();</span><br><span class="line">        <span class="comment">//给我一辆奔驰车SUV</span></span><br><span class="line">        System.out.println(<span class="string">&quot;===制造一辆奔驰SUV===&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        ICar benzSuv = director.createBenzSuv();</span><br><span class="line">        System.out.println(benzSuv);</span><br><span class="line">        <span class="comment">//给我一辆宝马商务车</span></span><br><span class="line">        System.out.println(<span class="string">&quot;\n===制造一辆宝马商务车===&quot;</span>);</span><br><span class="line">        ICar bmwVan = director.createBMWVan();</span><br><span class="line">        System.out.println(bmwVan);</span><br><span class="line">        <span class="comment">//给我一辆混合车型</span></span><br><span class="line">        System.out.println(<span class="string">&quot;\n===制造一辆混合车===&quot;</span>);</span><br><span class="line">        ICar complexCar = director.createComplexCar();</span><br><span class="line">        System.out.println(complexCar);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>场景类只要找到导演类（也就是车间主任了）说给我制造一辆这样的宝马车，车间主任马上通晓你的意图，设计了一个蓝图，然后命令建造车间拼命加班加点建造，最终返回给你一件最新出品的产品，运行结果如下所示：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">===制造一辆奔驰SUV=== </span><br><span class="line">获得生产蓝图 </span><br><span class="line">车的轮子是：benz的轮胎 </span><br><span class="line">车的引擎是：benz的引擎 </span><br><span class="line">===制造一辆宝马商务车=== </span><br><span class="line">获得生产蓝图 </span><br><span class="line">车的轮子是：BMW的轮胎 </span><br><span class="line">车的引擎是：BMW的引擎 </span><br><span class="line">===制造一辆混合车=== </span><br><span class="line">获得生产蓝图 </span><br><span class="line">车的轮子是：benz的轮胎 </span><br><span class="line">车的引擎是：BMW的引擎</span><br></pre></td></tr></table></figure>
<p>注意最后一个运行结果片段，我们可以立刻生产出一辆混合车型，只要有设计蓝图，这非常容易实现。反观我们的抽象工厂模式，它是不可能实现该功能的，因为它更关注的是整体，而不关注到底用的是奔驰引擎还是宝马引擎，而我们的建造者模式却可以很容易地实现该设计，市场信息变更了，我们就可以立刻跟进，生产出客户需要的产品。</p>
<h2 id="30-2-3-最佳实践"><a href="#30-2-3-最佳实践" class="headerlink" title="30.2.3 最佳实践"></a>30.2.3 最佳实践</h2><p>注意看上面的描述，我们在抽象工厂模式中使用“工厂”来描述构建者，而在建造者模式中使用“车间”来描述构建者，其实我们已经在说它们两者的区别了，抽象工厂模式就好比是一个一个的工厂，宝马车工厂生产宝马SUV和宝马VAN，奔驰车工厂生产奔驰车SUV和奔驰VAN，它是从一个更高层次去看对象的构建，具体到工厂内部还有很多的车间，如制造引擎的车间、装配引擎的车间等，但这些都是隐藏在工厂内部的细节，对外不公布。也就是对领导者来说，他只要关心一个工厂到底是生产什么产品的，不用关心具体怎么生产。而建造者模式就不同了，它是由车间组成，不同的车间完成不同的创建和装配任务，一个完整的汽车生产过程需要引擎制造车间、引擎装配车间的配合才能完成，它们配合的基础就是设计蓝图，而这个蓝图是掌握在车间主任（导演类）手中，它给建造车间什么蓝图就能生产什么产品，建造者模式更关心建造过程。虽然从外界看来一个车间还是生产车辆，但是这个车间的转型是非常快的，只要重新设计一个蓝图，即可产生不同的产品，这有赖于建造者模式的功劳。</p>
<p>相对来说，抽象工厂模式比建造者模式的尺度要大，它关注产品整体，而建造者模式关注构建过程，因此建造者模式可以很容易地构建出一个崭新的产品，只要导演类能够提供具体的工艺流程。也正因为如此，两者的应用场景截然不同，如果希望屏蔽对象的创建过程， 只提供一个封装良好的对象，则可以选择抽象工厂方法模式。而建造者模式可以用在构件的装配方面，如通过装配不同的组件或者相同组件的不同顺序，可以产生出一个新的对象，它可以产生一个非常灵活的架构，方便地扩展和维护系统。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://lanlan2017.github.io/JavaReadingNotes/2ee810d/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/JavaReadingNotes/images/avatar.gif">
      <meta itemprop="name" content="蓝蓝">
      <meta itemprop="description" content="好好学习，天天向上">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="蓝蓝站点">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/JavaReadingNotes/2ee810d/" class="post-title-link" itemprop="url">32.1 命令模式VS策略模式</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-09-27 19:57:33" itemprop="dateCreated datePublished" datetime="2021-09-27T19:57:33+08:00">2021-09-27</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-09-30 21:45:46" itemprop="dateModified" datetime="2021-09-30T21:45:46+08:00">2021-09-30</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/8-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E7%A6%85-%E7%AC%AC2%E7%89%88/" itemprop="url" rel="index"><span itemprop="name">8 设计模式之禅(第2版)</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/8-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E7%A6%85-%E7%AC%AC2%E7%89%88/3-%E7%AC%AC%E4%B8%89%E9%83%A8%E5%88%86-%E8%B0%81%E7%9A%84%E5%9C%B0%E7%9B%98%E8%B0%81%E5%81%9A%E4%B8%BB-%E2%80%94%E2%80%94%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8FPK/" itemprop="url" rel="index"><span itemprop="name">3 第三部分 谁的地盘谁做主 ——设计模式PK</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/8-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E7%A6%85-%E7%AC%AC2%E7%89%88/3-%E7%AC%AC%E4%B8%89%E9%83%A8%E5%88%86-%E8%B0%81%E7%9A%84%E5%9C%B0%E7%9B%98%E8%B0%81%E5%81%9A%E4%B8%BB-%E2%80%94%E2%80%94%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8FPK/%E7%AC%AC32%E7%AB%A0-%E8%A1%8C%E4%B8%BA%E7%B1%BB%E6%A8%A1%E5%BC%8F%E5%A4%A7PK-md/" itemprop="url" rel="index"><span itemprop="name">第32章 行为类模式大PK.md</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
    <span class="post-meta-item-icon">
      <i class="far fa-comment"></i>
    </span>
    <span class="post-meta-item-text">Waline：</span>
  
    <a title="waline" href="/JavaReadingNotes/2ee810d/#waline-comments" itemprop="discussionUrl">
      <span class="post-comments-count waline-comment-count" id="/JavaReadingNotes/2ee810d/" data-xid="/JavaReadingNotes/2ee810d/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>9.1k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>8 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="32-1-命令模式VS策略模式"><a href="#32-1-命令模式VS策略模式" class="headerlink" title="32.1 命令模式VS策略模式"></a>32.1 命令模式VS策略模式</h1><p>命令模式和策略模式的类图确实很相似，只是命令模式多了一个接收者（Receiver）角色。它们虽然同为行为类模式，但是两者的区别还是很明显的。策略模式的意图是封装算法，它认为“算法”已经是一个完整的、不可拆分的原子业务（注意这里是原子业务，而不是原子对象），即其意图是让这些算法独立，并且可以相互替换，让行为的变化独立于拥有行为的客户；而命令模式则是对动作的解耦，把一个动作的执行分为执行对象（接收者角色）、执行行为（命令角色），让两者相互独立而不相互影响。</p>
<p>我们从一个相同的业务需求出发，按照命令模式和策略模式分别设计出一套实现，来看看它们的侧重点有什么不同。zip和gzip文件格式相信大家都很熟悉，它们是两种不同的压缩格式，我们今天就来对一个目录或文件实现两种不同的压缩方式：zip压缩和gzip压缩（这里的压缩指的是压缩和解压缩两种对应的操作行为，下同）。实现这两种压缩格式有什么意义呢？有意义！一是zip格式（.zip后缀）是Windows操作系统常用的压缩格式，gzip格式（.gz 后缀）是*nix系统常用的压缩格式；二是JDK提供了对zip和gzip文件的操作包，非常容易实现文件的压缩和解压缩操作。</p>
<p>下面我们来实现不同格式的压缩和解压缩功能。</p>
<h2 id="32-1-1-策略模式实现压缩算法"><a href="#32-1-1-策略模式实现压缩算法" class="headerlink" title="32.1.1 策略模式实现压缩算法"></a>32.1.1 策略模式实现压缩算法</h2><p>使用策略模式实现压缩算法非常简单，也是非常标准的，类图如图32-1所示。</p>
<p>在类图中，我们的侧重点是zip压缩算法和gzip压缩算法可以互相替换，一个文件或者目录可以使用zip压缩，也可以使用gzip压缩，选择哪种压缩算法是由高层模块（实际操作者） 决定的。我们来看一下代码实现。先看抽象的压缩算法，如代码清单32-1所示。</p>
<p><img data-src="https://raw.githubusercontent.com/lanlan2017/images/master/Blog/Sum/20210930163955.png" alt="image-20210930163955571"></p>
<center>图32-1 策略模式实现压缩算法的类图</center>

<p>代码清单32-1 抽象压缩算法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Algorithm</span> </span>&#123;</span><br><span class="line">    <span class="comment">//压缩算法</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">compress</span><span class="params">(String source,String to)</span></span>;</span><br><span class="line">    <span class="comment">//解压缩算法</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">uncompress</span><span class="params">(String source,String to)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>每一个算法要实现两个功能：压缩和解压缩，传递进来一个绝对路径source，compress 把它压缩到to目录下，uncompress则进行反向操作——解压缩，这两个方法一定要成对地实现，为什么呢？用gzip解压缩算法能解开zip格式的压缩文件吗？我们分别来看两种不同格式的压缩算法，zip、gzip压缩算法分别如代码清单32-2、代码清单32-3所示。</p>
<p>代码清单32-2 zip压缩算法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Zip</span> <span class="keyword">implements</span> <span class="title">Algorithm</span> </span>&#123;</span><br><span class="line">    <span class="comment">//zip格式的压缩算法</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">compress</span><span class="params">(String source, String to)</span> </span>&#123;</span><br><span class="line">        System.out.println(source + <span class="string">&quot; --&gt; &quot;</span> +to + <span class="string">&quot; ZIP压缩成功!&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//zip格式的解压缩算法</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">uncompress</span><span class="params">(String source,String to)</span></span>&#123;</span><br><span class="line">        System.out.println(source + <span class="string">&quot; --&gt; &quot;</span> +to + <span class="string">&quot; ZIP解压缩成功!&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>代码清单32-3 gzip压缩算法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Gzip</span> <span class="keyword">implements</span> <span class="title">Algorithm</span> </span>&#123;</span><br><span class="line">    <span class="comment">//gzip的压缩算法</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">compress</span><span class="params">(String source, String to)</span> </span>&#123;</span><br><span class="line">        System.out.println(source + <span class="string">&quot; --&gt; &quot;</span> +to + <span class="string">&quot; GZIP压缩成功!&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//gzip解压缩算法</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">uncompress</span><span class="params">(String source,String to)</span></span>&#123;</span><br><span class="line">        System.out.println(source + <span class="string">&quot; --&gt; &quot;</span> +to + <span class="string">&quot; GZIP解压缩成功!&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这两种压缩算法实现起来都很简单，Java对此都提供了相关的API操作，这里就不再提供详细的编写代码，读者可以参考JDK自己进行实现，或者上网搜索一下，网上有太多类似的源代码。</p>
<p>两个具体的算法实现了同一个接口，完全遵循依赖倒转原则。我们再来看环境角色，如代码清单32-4所示。</p>
<p>代码清单32-4 环境角色</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Context</span> </span>&#123;</span><br><span class="line">    <span class="comment">//指向抽象算法</span></span><br><span class="line">    <span class="keyword">private</span> Algorithm al;</span><br><span class="line">    <span class="comment">//构造函数传递具体的算法</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Context</span><span class="params">(Algorithm _al)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.al = _al;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//执行压缩算法</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">compress</span><span class="params">(String source,String to)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> al.compress(source, to);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//执行解压缩算法</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">uncompress</span><span class="params">(String source,String to)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> al.uncompress(source, to);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>也是非常简单，指定一个算法，执行该算法，一个标准的策略模式就编写完毕了。请读者注意，这里虽然有两个算法Zip和Gzip，但是对调用者来说，这两个算法没有本质上的区别，只是“形式”上不同，什么意思呢？从调用者来看，使用哪一个算法都无所谓，两者完全可以互换，甚至用一个算法替代另外一个算法。我们继续看调用者是如何调用的，如代码清单32-5所示。</p>
<p>代码清单32-5 场景类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Client</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//定义环境角色</span></span><br><span class="line">        Context context;</span><br><span class="line">        <span class="comment">//对文件执行zip压缩算法</span></span><br><span class="line">        System.out.println(<span class="string">&quot;========执行算法========&quot;</span>);</span><br><span class="line">        context = <span class="keyword">new</span> Context(<span class="keyword">new</span> Zip());</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        *算法替换 </span></span><br><span class="line"><span class="comment">        * context = new Context(new Gzip());</span></span><br><span class="line"><span class="comment">        *</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">        <span class="comment">//执行压缩算法</span></span><br><span class="line">        context.compress(<span class="string">&quot;c:\\windows&quot;</span>,<span class="string">&quot;d:\\windows.zip&quot;</span>);</span><br><span class="line">        <span class="comment">//执行解压缩算法</span></span><br><span class="line">        context.uncompress(<span class="string">&quot;c:\\windows.zip&quot;</span>,<span class="string">&quot;d:\\windows&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>运行结果如下所示：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">========执行算法======== </span><br><span class="line">c:\windows --&gt; d:\windows.zip ZIP 压缩成功! </span><br><span class="line">c:\windows.zip --&gt; d:\windows ZIP 解压缩成功!</span><br></pre></td></tr></table></figure>
<p>要使用gzip算法吗？在客户端（Client）上把注释删掉就可以了，其他的模块根本不受任何影响，策略模式关心的是算法是否可以相互替换。策略模式虽然简单，但是在项目组使用得非常多，可以说随手拈来就是一个策略模式。</p>
<h2 id="32-1-2-命令模式实现压缩算法"><a href="#32-1-2-命令模式实现压缩算法" class="headerlink" title="32.1.2 命令模式实现压缩算法"></a>32.1.2 命令模式实现压缩算法</h2><p>命令模式的主旨是封装命令，使请求者与实现者解耦。例如，到饭店点菜，客人（请求者）通过服务员（调用者）向厨师（接收者）发送了订单（行为的请求），该例子就是通过封装命令来使请求者和接收者解耦。我们继续来看压缩和解压缩的例子，怎么使用命令模式来完成该需求呢？我们先画出类图，如图32-2所示。</p>
<p>类图看着复杂，但是还是一个典型的命令模式，通过定义具体命令完成文件的压缩、解压缩任务，注意我们这里对文件的每一个操作都是封装好的命令，对于给定的请求，命令不同，处理的结果当然也不同，这就是命令模式要强调的。我们先来看抽象命令，如代码清单32-6所示。</p>
<p>代码清单32-6 抽象压缩命令</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">AbstractCmd</span> </span>&#123;</span><br><span class="line">    <span class="comment">//对接收者的引用</span></span><br><span class="line">    <span class="keyword">protected</span> IReceiver zip = <span class="keyword">new</span> ZipReceiver();</span><br><span class="line">    <span class="keyword">protected</span> IReceiver gzip = <span class="keyword">new</span> GzipReceiver();</span><br><span class="line">    <span class="comment">//抽象方法，命令的具体单元</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">boolean</span> <span class="title">execute</span><span class="params">(String source,String to)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img data-src="https://raw.githubusercontent.com/lanlan2017/images/master/Blog/Sum/20210930164353.png" alt="image-20210930164353477"></p>
<center>图32-2 命令模式实现压缩算法的类图</center>

<p>抽象命令定义了两个接收者的引用：zip接收者和gzip接收者，大家可以想象一下这两个“受气包”，它们完全是受众，人家让它干啥它就干啥，具体使用哪个接收者是命令决定的。具体命令有4个：zip压缩、zip解压缩、gzip压缩、gzip解压缩，分别如代码清单32-7、 32-8、32-9、32-10所示。</p>
<p>代码清单32-7 zip压缩命令</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ZipCompressCmd</span> <span class="keyword">extends</span> <span class="title">AbstractCmd</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">execute</span><span class="params">(String source,String to)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.zip.compress(source, to);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>代码清单32-8 zip解压缩命令</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ZipUncompressCmd</span> <span class="keyword">extends</span> <span class="title">AbstractCmd</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">execute</span><span class="params">(String source,String to)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.zip.uncompress(source, to);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>代码清单32-9 gzip压缩命令</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GzipCompressCmd</span> <span class="keyword">extends</span> <span class="title">AbstractCmd</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">execute</span><span class="params">(String source,String to)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.gzip.compress(source, to);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>代码清单32-10 gzip解压缩命令</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GzipUncompressCmd</span> <span class="keyword">extends</span> <span class="title">AbstractCmd</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">execute</span><span class="params">(String source,String to)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.gzip.uncompress(source, to);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>它们非常简单，都只有一个方法，坚决地执行命令，使用了委托的方式，由接收者来实现。我们再来看抽象接收者，如代码清单32-11所示。</p>
<p>代码清单32-11 抽象接收者</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">IReceiver</span> </span>&#123;</span><br><span class="line">    <span class="comment">//压缩</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">compress</span><span class="params">(String source,String to)</span></span>;</span><br><span class="line">    <span class="comment">//解压缩</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">uncompress</span><span class="params">(String source,String to)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>抽象接收者与策略模式的抽象策略完全相同，具体的实现也完全相同，只是类名做了改动，我们先来看zip压缩的实现，如代码清单32-12所示。<br>代码清单32-12 zip接收者</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ZipReceiver</span> <span class="keyword">implements</span> <span class="title">IReceiver</span> </span>&#123;</span><br><span class="line">    <span class="comment">//zip格式的压缩算法</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">compress</span><span class="params">(String source, String to)</span> </span>&#123;</span><br><span class="line">        System.out.println(source + <span class="string">&quot; --&gt; &quot;</span> +to + <span class="string">&quot; ZIP压缩成功!&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//zip格式的解压缩算法</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">uncompress</span><span class="params">(String source,String to)</span></span>&#123;</span><br><span class="line">        System.out.println(source + <span class="string">&quot; --&gt; &quot;</span> +to + <span class="string">&quot; ZIP解压缩成功!&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这就是一个具体动作执行者，它在策略模式中是一个具体的算法，关心的是是否可以被替换；而在命令模式中，它则是一个具体、真实的命令执行者。我们再来看gzip接收者，如代码清单32-13所示。</p>
<p>代码清单32-13 gzip接收者</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GzipReceiver</span> <span class="keyword">implements</span> <span class="title">IReceiver</span> </span>&#123;</span><br><span class="line">    <span class="comment">//gzip的压缩算法</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">compress</span><span class="params">(String source, String to)</span> </span>&#123;</span><br><span class="line">        System.out.println(source + <span class="string">&quot; --&gt; &quot;</span> +to + <span class="string">&quot; GZIP压缩成功!&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//gzip解压缩算法</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">uncompress</span><span class="params">(String source,String to)</span></span>&#123;</span><br><span class="line">        System.out.println(source + <span class="string">&quot; --&gt; &quot;</span> +to + <span class="string">&quot; GZIP解压缩成功!&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>大家可以这样思考这个问题，接收者就是厨房的厨师，具体要哪个厨师做这道菜则是餐馆的规章制度已经明确的，你让专做粤菜的师傅做一个剁椒鱼头，能做出好菜吗？在命令模式中，就是在抽象命令中定义了接收者的引用，然后在具体的实现类中确定要让哪个接收者进行处理。这就好比是客人点菜：我要一个剁椒鱼头，这就是一个命令，然后服务员 （Inovker）接收到这个命令后，就开始执行，把这个命令指定给具体的执行者执行。</p>
<p>当然了，接收者这部分还可以这样设计，即按照职责设计接收者，比如压缩接收者、解压缩接收者，但接口需要稍稍改动，如代码清单32-14所示。</p>
<p>代码清单32-14 依照职责设计的接收者接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">IReceiver</span> </span>&#123;</span><br><span class="line">    <span class="comment">//执行zip命令</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">zipExec</span><span class="params">(String source,String to)</span></span>;</span><br><span class="line">    <span class="comment">//执行gzip命令</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">gzipExec</span><span class="params">(String source,String to)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>接收者接口只是定义了每个接收者都必须完成zip和gzip相关的两个逻辑，有多少个职责就有多少个实现类。我们这里只有两个职责：压缩和解压缩，分别如代码清单32-15、32-16 所示。</p>
<p>代码清单32-15 压缩接收者</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CompressReceiver</span> <span class="keyword">implements</span> <span class="title">IReceiver</span> </span>&#123;</span><br><span class="line">    <span class="comment">//执行gzip压缩命令</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">gzipExec</span><span class="params">(String source, String to)</span> </span>&#123;</span><br><span class="line">        System.out.println(source + <span class="string">&quot; --&gt; &quot;</span> +to + <span class="string">&quot; GZIP压缩成功!&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//执行zip压缩命令</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">zipExec</span><span class="params">(String source, String to)</span> </span>&#123;</span><br><span class="line">        System.out.println(source + <span class="string">&quot; --&gt; &quot;</span> +to + <span class="string">&quot; ZIP压缩成功!&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>代码清单32-16 解压缩接收者</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UncompressReceiver</span> <span class="keyword">implements</span> <span class="title">IReceiver</span> </span>&#123;</span><br><span class="line">    <span class="comment">//执行gzip解压缩命令</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">gzipExec</span><span class="params">(String source, String to)</span> </span>&#123;</span><br><span class="line">        System.out.println(source + <span class="string">&quot; --&gt; &quot;</span> +to + <span class="string">&quot; GZIP解压缩成功!&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//执行zip解压缩命令</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">zipExec</span><span class="params">(String source, String to)</span> </span>&#123;</span><br><span class="line">        System.out.println(source + <span class="string">&quot; --&gt; &quot;</span> +to + <span class="string">&quot; ZIP解压缩成功!&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>剩下的工作就是对抽象命令、具体命令稍作修改，这里不再赘述。为什么要在这里增加一个分支描述呢？这是为了与策略模式对比，在命令模式中，我们可以把接收者设计得与策略模式的算法相同，也可以不相同。我们按照职责设计的接口就不适用于策略模式，不可能封装一个叫做压缩的算法类，然后在类中提供两种不同格式的压缩功能，这违背了策略模式的意图——封装算法，为什么呢？如果要增加一个rar压缩算法，该怎么办呢？修改抽象算法？这是绝对不允许的！那为什么命令模式就是允许的呢？因为命令模式着重于请求者和接收者解耦，你管我接收者怎么变化，只要不影响请求者就成，这才是命令模式的意图。</p>
<p>命令、接收者都具备了，我们再来封装一个命令的调用者，如代码清单32-17所示。</p>
<p>代码清单32-17 调用者</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Invoker</span> </span>&#123;</span><br><span class="line">    <span class="comment">//抽象命令的引用</span></span><br><span class="line">    <span class="keyword">private</span> AbstractCmd cmd;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Invoker</span><span class="params">(AbstractCmd _cmd)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.cmd = _cmd;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//执行命令</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">execute</span><span class="params">(String source,String to)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> cmd.execute(source, to);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>调用者非常简单，只负责把命令向后传递，当然这里也可以进行一定的拦截处理，我们暂时用不到就不做处理了。我们来看场景类是如何描述这个场景的，如代码清单32-18所示。</p>
<p>代码清单32-18 场景类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Client</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//定义一个命令,压缩一个文件</span></span><br><span class="line">        AbstractCmd cmd = <span class="keyword">new</span> ZipCompressCmd();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        * 想换一个？执行解压命令 </span></span><br><span class="line"><span class="comment">        * AbstractCmd cmd = new ZipUncompressCmd();</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">        <span class="comment">//定义调用者</span></span><br><span class="line">        Invoker invoker = <span class="keyword">new</span> Invoker(cmd);</span><br><span class="line">        <span class="comment">//我命令你对这个文件进行压缩</span></span><br><span class="line">        System.out.println(<span class="string">&quot;========执行压缩命令========&quot;</span>);</span><br><span class="line">        invoker.execute(<span class="string">&quot;c:\\windows&quot;</span>, <span class="string">&quot;d:\\windows.zip&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>想新增一个命令？当然没有问题，只要重新定义一个命令就成，命令改变了，高层模块只要调用它就成。请注意，这里的程序还有点欠缺，没有与文件的后缀名绑定，不应该出现使用zip压缩命令产生一个.gzip后缀的文件名，读者在实际应用中可以考虑与文件后缀名之间建立关联。</p>
<p>通过以上例子，我们看到命令模式也实现了文件的压缩、解压缩的功能，它的实现是关注了命令的封装，是请求者与执行者彻底分开，看看我们的程序，执行者根本就不用了解命令的具体执行者，它只要封装一个命令——“给我用zip格式压缩这个文件”就可以了，具体由谁来执行，则由调用者负责，如此设计后，就可以保证请求者和执行者之间可以相互独立， 各自发展而不相互影响。</p>
<p>同时，由于是一个命令模式，接收者的处理可以进行排队处理，在排队处理的过程中， 可以进行撤销处理，比如客人点了一个菜，厨师还没来得及做，那要撤回很简单，撤回也是命令，这是策略模式所不能实现的。</p>
<h2 id="32-1-3-小结"><a href="#32-1-3-小结" class="headerlink" title="32.1.3 小结"></a>32.1.3 小结</h2><p>策略模式和命令模式相似，特别是命令模式退化时，比如无接收者（接收者非常简单或者接收者是一个Java的基础操作，无需专门编写一个接收者），在这种情况下，命令模式和策略模式的类图完全一样，代码实现也比较类似，但是两者还是有区别的。</p>
<ul>
<li>关注点不同</li>
</ul>
<p>策略模式关注的是算法替换的问题，一个新的算法投产，旧算法退休，或者提供多种算法由调用者自己选择使用，算法的自由更替是它实现的要点。换句话说，策略模式关注的是算法的完整性、封装性，只有具备了这两个条件才能保证其可以自由切换。</p>
<p>命令模式则关注的是解耦问题，如何让请求者和执行者解耦是它需要首先解决的，解耦的要求就是把请求的内容封装为一个一个的命令，由接收者执行。由于封装成了命令，就同时可以对命令进行多种处理，例如撤销、记录等。</p>
<ul>
<li>角色功能不同</li>
</ul>
<p>在我们的例子中，策略模式中的抽象算法和具体算法与命令模式的接收者非常相似，但是它们的职责不同。策略模式中的具体算法是负责一个完整算法逻辑，它是不可再拆分的原子业务单元，一旦变更就是对算法整体的变更。</p>
<p>而命令模式则不同，它关注命令的实现，也就是功能的实现。例如我们在分支中也提到接收者的变更问题，它只影响到命令族的变更，对请求者没有任何影响，从这方面来说，接收者对命令负责，而与请求者无关。命令模式中的接收者只要符合六大设计原则，完全不用关心它是否完成了一个具体逻辑，它的影响范围也仅仅是抽象命令和具体命令，对它的修改不会扩散到模式外的模块。</p>
<p>当然，如果在命令模式中需要指定接收者，则需要考虑接收者的变化和封装，例如一个老顾客每次吃饭都点同一个厨师的饭菜，那就必须考虑接收者的抽象化问题。</p>
<ul>
<li>使用场景不同</li>
</ul>
<p>策略模式适用于算法要求变换的场景，而命令模式适用于解耦两个有紧耦合关系的对象场合或者多命令多撤销的场景。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://lanlan2017.github.io/JavaReadingNotes/714c0790/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/JavaReadingNotes/images/avatar.gif">
      <meta itemprop="name" content="蓝蓝">
      <meta itemprop="description" content="好好学习，天天向上">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="蓝蓝站点">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/JavaReadingNotes/714c0790/" class="post-title-link" itemprop="url">32.3 观察者模式VS责任链模式</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-09-27 19:57:33" itemprop="dateCreated datePublished" datetime="2021-09-27T19:57:33+08:00">2021-09-27</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-09-30 21:45:46" itemprop="dateModified" datetime="2021-09-30T21:45:46+08:00">2021-09-30</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/8-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E7%A6%85-%E7%AC%AC2%E7%89%88/" itemprop="url" rel="index"><span itemprop="name">8 设计模式之禅(第2版)</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/8-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E7%A6%85-%E7%AC%AC2%E7%89%88/3-%E7%AC%AC%E4%B8%89%E9%83%A8%E5%88%86-%E8%B0%81%E7%9A%84%E5%9C%B0%E7%9B%98%E8%B0%81%E5%81%9A%E4%B8%BB-%E2%80%94%E2%80%94%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8FPK/" itemprop="url" rel="index"><span itemprop="name">3 第三部分 谁的地盘谁做主 ——设计模式PK</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/8-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E7%A6%85-%E7%AC%AC2%E7%89%88/3-%E7%AC%AC%E4%B8%89%E9%83%A8%E5%88%86-%E8%B0%81%E7%9A%84%E5%9C%B0%E7%9B%98%E8%B0%81%E5%81%9A%E4%B8%BB-%E2%80%94%E2%80%94%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8FPK/%E7%AC%AC32%E7%AB%A0-%E8%A1%8C%E4%B8%BA%E7%B1%BB%E6%A8%A1%E5%BC%8F%E5%A4%A7PK-md/" itemprop="url" rel="index"><span itemprop="name">第32章 行为类模式大PK.md</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
    <span class="post-meta-item-icon">
      <i class="far fa-comment"></i>
    </span>
    <span class="post-meta-item-text">Waline：</span>
  
    <a title="waline" href="/JavaReadingNotes/714c0790/#waline-comments" itemprop="discussionUrl">
      <span class="post-comments-count waline-comment-count" id="/JavaReadingNotes/714c0790/" data-xid="/JavaReadingNotes/714c0790/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>12k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>11 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="32-3-观察者模式VS责任链模式"><a href="#32-3-观察者模式VS责任链模式" class="headerlink" title="32.3 观察者模式VS责任链模式"></a>32.3 观察者模式VS责任链模式</h1><p>为什么要把观察者模式和责任链模式放在一起对比呢？看起来这两个模式没有太多的相似性，真没有吗？回答是有。我们在观察者模式中也提到了触发链（也叫做观察者链）的问题，一个具体的角色既可以是观察者，也可以是被观察者，这样就形成了一个观察者链。这与责任链模式非常类似，它们都实现了事务的链条化处理，比如说在上课的时候你睡着了， 打鼾声音太大，盖过了老师讲课声音，老师火了，捅到了校长这里，校长也处理不了，然后告状给你父母，于是你的魔鬼日子来临了，这是责任链模式，老师、校长、父母都是链中的一个具体角色，事件（你睡觉）在链中传递，最终由一个具体的节点来处理，并将结果反馈给调用者（你挨揍了）。那什么是触发链？你还是在课堂上睡觉，还是打鼾声音太大，老师火了，但是老师掏出个扩音器来讲课，于是你睡不着了，同时其他同学的耳朵遭殃了，这就是触发链，其中老师既是观察者（相对你）也是被观察者（相对其他同学），事件从“你睡觉”到老师这里转化为“扩音器放大声音”，这也是一个链条结构，但是链结构中传递的事件改变了。</p>
<p>我们还是以一个具体的例子来说明两者的区别，DNS协议相信大家都听说过，只要在“网络设置”中设置一个DNS服务器地址就可以把我们需要的域名翻译成IP地址。DNS协议还是比较简单的，传递过去一个域名以及记录标志（比如是要A记录还是要MX记录），DNS就开始查找自己的记录树，找到后把IP地址反馈给请求者。我们可以在Windows 操作系统中了解一下DNS解析过程，在DOS窗口下输入nslookup命令后，结果如图32-6所示。</p>
<p><img data-src="https://raw.githubusercontent.com/lanlan2017/images/master/Blog/Sum/20210930172207.png" alt="image-20210930172207752"></p>
<center>图32-6 DNS服务器解析域名</center>
我们的意图就是要DNS服务器192.168.10.1解析出www.xxx.com.cn的IP地址，DNS服务器是如何工作的呢？图32-6中的192.168.10.1这个DNS Server存储着全球的域名和IP之间的对应关系吗？不可能，目前全球的域名数量是1.7亿个，如此庞大的数字，每个DNS服务器都存储一份，还怎么快速响应？DNS解析的响应时间一般都是毫秒级别的，如此高的性能要求还怎么让DNS服务器遍地开花呢？而且域名变更非常频繁，数据读写的量也非常大，不可能每个DNS服务器都保留这1.7亿数据，那么是怎么设计的呢？DNS协议还是很聪明的，它规定了每个区域的DNS服务器（Local DNS）只保留自己区域的域名解析，对于不能解析的域名， 则提交上级域名解析器解析，最终由一台位于美国洛杉矶的顶级域名服务器进行解析，返回结果。很明显这是一个事务的链结构处理，我们使用两种模式来实现该解析过程。

<h2 id="32-3-1-责任链模式实现DNS解析过程"><a href="#32-3-1-责任链模式实现DNS解析过程" class="headerlink" title="32.3.1 责任链模式实现DNS解析过程"></a>32.3.1 责任链模式实现DNS解析过程</h2><p>本小节我们用责任链模式来实现DNS解析过程。首先我们定义一下业务场景，这里有三个DNS服务器：上海DNS服务器（区域服务器）、中国顶级DNS服务器（父服务器）、全球顶级DNS服务器，其示意图如图32-7所示。</p>
<p><img data-src="https://raw.githubusercontent.com/lanlan2017/images/master/Blog/Sum/20210930172314.png" alt="image-20210930172314258"></p>
<center>图32-7 DNS解析示意图</center>
假设有请求者发出请求，由上海DNS进行解析，如果能够解析，则返回结果，若不能解析，则提交给父服务器（中国顶级DNS）进行解析，若还不能解析，则提交到全球顶级DNS 进行解析，若还不能解析呢？那就返回该域名无法解析。确实，这与责任链模式非常相似， 我们把这一过程抽象一下，类图如图32-8所示。

<p><img data-src="https://raw.githubusercontent.com/lanlan2017/images/master/Blog/Sum/20210930172345.png" alt="image-20210930172345216"></p>
<center>图32-8 责任链模式实现DNS解析的类图</center>
我们来解释一下类图，Recorder是一个BO对象，它记录DNS服务器解析后的结果，包括域名、IP地址、属主（即由谁解析的），除此之外还有getter/setter方法。DnsServer抽象类中的resolve方法是一个基本方法，每个DNS服务器都必须拥有该方法，它对DNS进行解析，如何解析呢？具体是由echo方法来实现的，每个DNS服务器独自实现。类图还是比较简单的， 我们首先看一下解析记录Recorder类，如代码清单32-31所示。

<p>代码清单32-31 解析记录</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Recorder</span> </span>&#123;</span><br><span class="line">    <span class="comment">//域名</span></span><br><span class="line">    <span class="keyword">private</span> String domain;</span><br><span class="line">    <span class="comment">//IP地址</span></span><br><span class="line">    <span class="keyword">private</span> String ip;</span><br><span class="line">    <span class="comment">//属主</span></span><br><span class="line">    <span class="keyword">private</span> String owner;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getDomain</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> domain;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setDomain</span><span class="params">(String domain)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.domain = domain;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getIp</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> ip;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setIp</span><span class="params">(String ip)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.ip = ip;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getOwner</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> owner;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setOwner</span><span class="params">(String owner)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.owner = owner;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//输出记录信息</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span></span>&#123;</span><br><span class="line">        String str= <span class="string">&quot;域名：&quot;</span> + <span class="keyword">this</span>.domain;</span><br><span class="line">        str = str + <span class="string">&quot;\nIP地址：&quot;</span> + <span class="keyword">this</span>.ip;</span><br><span class="line">        str = str + <span class="string">&quot;\n解析者：&quot;</span> + <span class="keyword">this</span>.owner;</span><br><span class="line">        <span class="keyword">return</span> str;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>为什么要覆写toString方法呢？是为了打印展示的需要，可以直接把Recorder的信息打印出来。我们再来看抽象域名服务器，如代码清单32-32所示。</p>
<p>代码清单32-32 抽象域名服务器</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">DnsServer</span> </span>&#123;</span><br><span class="line">    <span class="comment">//上级DNS是谁</span></span><br><span class="line">    <span class="keyword">private</span> DnsServer upperServer;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//解析域名</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> Recorder <span class="title">resolve</span><span class="params">(String domain)</span></span>&#123;</span><br><span class="line">        Recorder recorder=<span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">if</span>(isLocal(domain))&#123;</span><br><span class="line">            <span class="comment">//是本服务器能解析的域名</span></span><br><span class="line">            recorder = echo(domain);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="comment">//本服务器不能解析</span></span><br><span class="line">            <span class="comment">//提交上级DNS进行解析</span></span><br><span class="line">            recorder = upperServer.resolve(domain);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> recorder;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//指向上级DNS</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUpperServer</span><span class="params">(DnsServer _upperServer)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.upperServer = _upperServer;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//每个DNS都有一个数据处理区（ZONE）,检查域名是否在本区中</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">abstract</span> <span class="keyword">boolean</span> <span class="title">isLocal</span><span class="params">(String domain)</span></span>;</span><br><span class="line">    <span class="comment">//每个DNS服务器都必须实现解析任务</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> Recorder <span class="title">echo</span><span class="params">(String domain)</span></span>&#123;</span><br><span class="line">        Recorder recorder = <span class="keyword">new</span> Recorder();</span><br><span class="line">        <span class="comment">//获得IP地址</span></span><br><span class="line">        recorder.setIp(genIpAddress());</span><br><span class="line">        recorder.setDomain(domain);</span><br><span class="line">        <span class="keyword">return</span> recorder;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//随机产生一个IP地址，工具类</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> String <span class="title">genIpAddress</span><span class="params">()</span></span>&#123;</span><br><span class="line">        Random rand = <span class="keyword">new</span> Random();</span><br><span class="line">        String address = rand.nextInt(<span class="number">255</span>) + <span class="string">&quot;.&quot;</span> + rand.nextInt(<span class="number">255</span>) + <span class="string">&quot;.&quot;</span>+ rand.nextInt(<span class="number">255</span>) + <span class="string">&quot;.&quot;</span>+ rand.nextInt(<span class="number">255</span>);</span><br><span class="line">        <span class="keyword">return</span> address;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在该类中有一个方法——genIpAddress方法——没有在类图中展现出来，它用于实现随机生成IP地址，这是我们为模拟DNS解析场景而建立的一个虚拟方法，在实际的应用中是不可能出现的。抽象DNS服务器编写完成，我们再来看具体的DNS服务器，先看上海的DNS服务器，如代码清单32-33所示。</p>
<p>代码清单32-33 上海DNS服务器</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SHDnsServer</span> <span class="keyword">extends</span> <span class="title">DnsServer</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> Recorder <span class="title">echo</span><span class="params">(String domain)</span> </span>&#123;</span><br><span class="line">        Recorder recorder= <span class="keyword">super</span>.echo(domain);</span><br><span class="line">        recorder.setOwner(<span class="string">&quot;上海DNS服务器&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> recorder;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//定义上海的DNS服务器能处理的级别</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">boolean</span> <span class="title">isLocal</span><span class="params">(String domain)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> domain.endsWith(<span class="string">&quot;.sh.cn&quot;</span>);</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>为什么要覆写echo方法？各具体的DNS服务器实现自己的解析过程，属于个性化处理， 它代表的是每个DNS服务器的不同处理逻辑。还要注意一下，我们在这里做了一个简化处理，所有以”.sh.cn”结尾的域名都由上海DNS服务器解析。其他的中国顶级DNS和全球顶级DNS实现过程类似，如代码清单32-34、32-35所示。</p>
<p>代码清单32-34 中国顶级DNS服务器</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ChinaTopDnsServer</span> <span class="keyword">extends</span> <span class="title">DnsServer</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> Recorder <span class="title">echo</span><span class="params">(String domain)</span> </span>&#123;</span><br><span class="line">        Recorder recorder = <span class="keyword">super</span>.echo(domain);</span><br><span class="line">        recorder.setOwner(<span class="string">&quot;中国顶级DNS服务器&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> recorder;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">boolean</span> <span class="title">isLocal</span><span class="params">(String domain)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> domain.endsWith(<span class="string">&quot;.cn&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>代码清单32-35 全球顶级DNS服务器</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TopDnsServer</span> <span class="keyword">extends</span> <span class="title">DnsServer</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> Recorder <span class="title">echo</span><span class="params">(String domain)</span> </span>&#123;</span><br><span class="line">        Recorder recorder = <span class="keyword">super</span>.echo(domain);</span><br><span class="line">        recorder.setOwner(<span class="string">&quot;全球顶级DNS服务器&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> recorder;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">boolean</span> <span class="title">isLocal</span><span class="params">(String domain)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//所有的域名最终的解析地点</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>所有的DNS服务器都准备好了，下面我们写一个客户端来模拟一下IP地址是怎么解析的，如代码清单32-36所示。</p>
<p>代码清单32-36 场景类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Client</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//上海域名服务器</span></span><br><span class="line">        DnsServer sh = <span class="keyword">new</span> SHDnsServer();</span><br><span class="line">        <span class="comment">//中国顶级域名服务器</span></span><br><span class="line">        DnsServer china = <span class="keyword">new</span> ChinaTopDnsServer();</span><br><span class="line">        <span class="comment">//全球顶级域名服务器</span></span><br><span class="line">        DnsServer top = <span class="keyword">new</span> TopDnsServer();</span><br><span class="line">        <span class="comment">//定义查询路径</span></span><br><span class="line">        china.setUpperServer(top);</span><br><span class="line">        sh.setUpperServer(china);</span><br><span class="line">        <span class="comment">//解析域名</span></span><br><span class="line">        System.out.println(<span class="string">&quot;=====域名解析模拟器=====&quot;</span>);</span><br><span class="line">        <span class="keyword">while</span>(<span class="keyword">true</span>)&#123;</span><br><span class="line">            System.out.print(<span class="string">&quot;\n请输入域名(输入N退出):&quot;</span>);</span><br><span class="line">            String domain = (<span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> InputStreamReader (System.in))).readLine();</span><br><span class="line">            <span class="keyword">if</span>(domain.equalsIgnoreCase(<span class="string">&quot;n&quot;</span>))&#123;</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            Recorder recorder = sh.resolve(domain);</span><br><span class="line">            System.out.println(<span class="string">&quot;----DNS服务器解析结果----&quot;</span>);</span><br><span class="line">            System.out.println(recorder);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们来模拟一下，运行结果如下所示：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">=====域名解析模拟器===== </span><br><span class="line">请输入域名(输入N退出):www.xxx.sh.cn </span><br><span class="line">----DNS服务器解析结果---- </span><br><span class="line">域名：www. xxx.sh.cn </span><br><span class="line">IP地址：69.224.162.154 </span><br><span class="line">解析者：上海DNS服务器 </span><br><span class="line">请输入域名(输入N退出):www. xxx.com.cn </span><br><span class="line">----DNS服务器解析结果---- </span><br><span class="line">域名：www. xxx.com.cn </span><br><span class="line">IP地址：51.28.66.140 </span><br><span class="line">解析者：中国顶级DNS服务器 </span><br><span class="line">请输入域名(输入N退出):www. xxx.com </span><br><span class="line">----DNS服务器解析结果---- </span><br><span class="line">域名：www. xxx.com</span><br><span class="line">IP地址：73.247.80.117 </span><br><span class="line">解析者：全球顶级DNS服务器 </span><br><span class="line">请输入域名(输入N退出):n</span><br></pre></td></tr></table></figure>
<p>请注意看运行结果，以”.sh.cn”结尾的域名确实由上海DNS服务器解析了，以”.cn”结尾的域名由中国顶级DNS服务器解析了，其他域名都由全球顶级DNS服务器解析。这个模拟过程看起来很完整，它完全就是责任链模式的一个具体应用，把一个请求放置到链中的首节点， 然后由链中的某个节点进行解析并将结果反馈给调用者。但是，我可以负责任地告诉你：这个解析过程是有缺陷的，什么缺陷？后面会说明。</p>
<h2 id="32-3-2-触发链模式实现DNS解析过程"><a href="#32-3-2-触发链模式实现DNS解析过程" class="headerlink" title="32.3.2 触发链模式实现DNS解析过程"></a>32.3.2 触发链模式实现DNS解析过程</h2><p>上面说到使用责任链模式模拟DNS解析过程是有缺陷的，究竟有什么缺陷？大家是不是觉得这个解析过程很完美了，没什么问题了？那说明你对DNS协议了解得还不太深入。我们来做一个实验，在dos窗口下输入nslookup命令，然后输入多个域名，注意观察返回值有哪些数据是相同的。可以看出，解析者都相同，都是由同一个DNS服务器解析的，准确地说都是由本机配置的DNS服务器做的解析。这与我们上面的模拟过程是不相同的，看看我们模拟的过程，对请求者来说，”.sh.cn”是由区域DNS解析的，”.com”却是由全球顶级DNS解析的，与真实的过程不相同，这是怎么回事呢？</p>
<p>肯定地说，采用责任链模式模拟DNS解析过程是不完美的，或者说是有缺陷的，怎么来修复这个缺陷呢？我们先来看看真实的DNS解析过程，如图32-9所示。</p>
<p><img data-src="https://raw.githubusercontent.com/lanlan2017/images/master/Blog/Sum/20210930172848.png" alt="image-20210930172848826"></p>
<center>图32-9 真实的DNS解析示意图</center>
解析一个域名的完整路径如图32-9中的标号①～⑥所示，首先由请求者发送一个请求， 然后由上海DNS服务器尝试解析，若不能解析再通过路径②转发给中国顶级DNS进行解析， 解析后的结果通过路径⑤返回给上海DNS服务器，然后由上海DNS服务器通过路径⑥返回给请求者。同样，若中国顶级DNS不能解析，则通过路径③转由全球顶级DNS进行解析，通过路径④把结果返回给中国顶级DNS，然后再通过路径⑤返回给上海DNS。注意看标号⑥，不管一个域名最终由谁解析，最终反馈到请求者的还是第一个节点，也就是说首节点负责对请求者应答，其他节点都不与请求者交互，而只与自己的左右节点交互。实际上我们的DNS服务器确实是如此处理的，例如本机请求查询一个www.abcdefg.com的域名，上海DNS服务器解析不到这个域名，于是提交到中国顶级DNS服务器，如果中国顶级DNS服务器有该域名的记录，则找到该记录，反馈到上海DNS服务器，上海DNS服务器做两件事务处理：一是响应请求者，二是存储该记录，以备其他请求者再次查询，这类似于数据缓存。

<p>整个场景我们已经清晰，想想看，我们把请求者看成是被观察者，它的行为或属性变更通知了观察者——上海DNS，上海DNS又作为被观察者出现了自己不能处理的行为（行为改变），通知了中国顶级DNS，依次类推，这是不是一个非常标准的触发链？而且还必须是同步的触发，异步触发已经在该场景中失去了意义（读者可以想想为什么）。</p>
<p>分析了这么多，我们用触发链来模拟DNS的解析过程，如图32-10所示。</p>
<p><img data-src="https://raw.githubusercontent.com/lanlan2017/images/master/Blog/Sum/20210930172945.png" alt="image-20210930172945418"></p>
<center>图32-10 触发链模式实现DNS解析的类图</center>

<p>与责任链模式很相似，仅仅多了一个Observable父类和Observer接口，但是在实现上这两种模式有非常大的差异。我们先来解释一下抽象DnsServer的作用。</p>
<ul>
<li>标示声明</li>
</ul>
<p>表示所有的DNS服务器都具备双重身份：既是观察者也是被观察者，这很重要，它声明所有的服务器都具有相同的身份标志，具有该标志后就可以在链中随意移动，而无需固定在链中的某个位置（这也是链的一个重要特性）。</p>
<ul>
<li>业务抽象</li>
</ul>
<p>方法setUpperServer的作用是设置父DNS，也就是设置自己的观察者，update方法不仅仅是一个事件的处理者，也同时是事件的触发者。</p>
<p>我们来看代码，首先是最简单的，Recorder类与责任链模式中的记录相同，这里不再赘述。那我们就先看看该模式的核心抽象DnsServer，如代码清单32-37所示。</p>
<p>代码清单32-37 抽象DNS服务器</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">DnsServer</span> <span class="keyword">extends</span> <span class="title">Observable</span> <span class="keyword">implements</span> <span class="title">Observer</span> </span>&#123;</span><br><span class="line">    <span class="comment">//处理请求，也就是接收到事件后的处理</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">(Observable arg0, Object arg1)</span> </span>&#123;</span><br><span class="line">        Recorder recorder = (Recorder)arg1;</span><br><span class="line">        <span class="comment">//如果本机能解析</span></span><br><span class="line">        <span class="keyword">if</span>(isLocal(recorder))&#123;</span><br><span class="line">            recorder.setIp(genIpAddress());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="comment">//本机不能解析，则提交到上级DNS</span></span><br><span class="line">            responsFromUpperServer(recorder);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//签名</span></span><br><span class="line">        sign(recorder);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//作为被观察者，允许增加观察者，这里上级DNS一般只有一个</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUpperServer</span><span class="params">(DnsServer dnsServer)</span></span>&#123;</span><br><span class="line">        <span class="comment">//先清空，然后再增加</span></span><br><span class="line">        <span class="keyword">super</span>.deleteObservers();</span><br><span class="line">        <span class="keyword">super</span>.addObserver(dnsServer);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//向父DNS请求解析，也就是通知观察者</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">responsFromUpperServer</span><span class="params">(Recorder recorder)</span></span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.setChanged();</span><br><span class="line">        <span class="keyword">super</span>.notifyObservers(recorder);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//每个DNS服务器签上自己的名字</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">sign</span><span class="params">(Recorder recorder)</span></span>;</span><br><span class="line">    <span class="comment">//每个DNS服务器都必须定义自己的处理级别</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">abstract</span> <span class="keyword">boolean</span> <span class="title">isLocal</span><span class="params">(Recorder recorder)</span></span>;</span><br><span class="line">    <span class="comment">//随机产生一个IP地址，工具类</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> String <span class="title">genIpAddress</span><span class="params">()</span></span>&#123;</span><br><span class="line">        Random rand = <span class="keyword">new</span> Random();</span><br><span class="line">        String address = rand.nextInt(<span class="number">255</span>) + <span class="string">&quot;.&quot;</span> + rand.nextInt(<span class="number">255</span>) + <span class="string">&quot;.&quot;</span>+ rand.nextInt(<span class="number">255</span>) + <span class="string">&quot;.&quot;</span>+ rand.nextInt(<span class="number">255</span>);</span><br><span class="line">        <span class="keyword">return</span> address;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>注意看一下responseFromUpperServer方法，它只允许设置一个观察者，因为一般的DNS 服务器都只有一个上级DNS服务器。sign方法是签名，这个记录是由谁解析出来的，就由各个实现类独自来实现。三个DnsServer的实现类都比较简单，如代码清单32-38、32-39、32- 40所示。</p>
<p>代码清单32-38 上海DNS服务器</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SHDnsServer</span> <span class="keyword">extends</span> <span class="title">DnsServer</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">sign</span><span class="params">(Recorder recorder)</span> </span>&#123;</span><br><span class="line">        recorder.setOwner(<span class="string">&quot;上海DNS服务器&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//定义上海的DNS服务器能处理的级别</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">boolean</span> <span class="title">isLocal</span><span class="params">(Recorder recorder)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> recorder.getDomain().endsWith(<span class="string">&quot;.sh.cn&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>代码清单32-39 中国顶级DNS服务器</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ChinaTopDnsServer</span> <span class="keyword">extends</span> <span class="title">DnsServer</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">sign</span><span class="params">(Recorder recorder)</span> </span>&#123;</span><br><span class="line">        recorder.setOwner(<span class="string">&quot;中国顶级DNS服务器&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">boolean</span> <span class="title">isLocal</span><span class="params">(Recorder recorder)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> recorder.getDomain().endsWith(<span class="string">&quot;.cn&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>代码清单32-40 全球顶级DNS服务器</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TopDnsServer</span> <span class="keyword">extends</span> <span class="title">DnsServer</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">sign</span><span class="params">(Recorder recorder)</span> </span>&#123;</span><br><span class="line">        recorder.setOwner(<span class="string">&quot;全球顶级DNS服务器&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">boolean</span> <span class="title">isLocal</span><span class="params">(Recorder recorder)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//所有的域名最终的解析地点</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们再建立一个场景类模拟一下DNS解析过程，如代码清单32-41所示。</p>
<p>代码清单32-41 场景类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Client</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">//上海域名服务器</span></span><br><span class="line">        DnsServer sh = <span class="keyword">new</span> SHDnsServer();</span><br><span class="line">        <span class="comment">//中国顶级域名服务器</span></span><br><span class="line">        DnsServer china = <span class="keyword">new</span> ChinaTopDnsServer();</span><br><span class="line">        <span class="comment">//全球顶级域名服务器</span></span><br><span class="line">        DnsServer top = <span class="keyword">new</span> TopDnsServer();</span><br><span class="line">        <span class="comment">//定义查询路径</span></span><br><span class="line">        china.setUpperServer(top);</span><br><span class="line">        </span><br><span class="line">        sh.setUpperServer(china);</span><br><span class="line">        <span class="comment">//解析域名</span></span><br><span class="line">        System.out.println(<span class="string">&quot;=====域名解析模拟器=====&quot;</span>);</span><br><span class="line">        <span class="keyword">while</span>(<span class="keyword">true</span>)&#123;</span><br><span class="line">            System.out.print(<span class="string">&quot;\n请输入域名(输入N退出):&quot;</span>);</span><br><span class="line">            String domain = (<span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> InputStreamReader (System.in))).readLine();</span><br><span class="line">            <span class="keyword">if</span>(domain.equalsIgnoreCase(<span class="string">&quot;n&quot;</span>))&#123;</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            Recorder recorder = <span class="keyword">new</span> Recorder();</span><br><span class="line">            recorder.setDomain(domain);</span><br><span class="line">            sh.update(<span class="keyword">null</span>,recorder);</span><br><span class="line">            System.out.println(<span class="string">&quot;----DNS服务器解析结果----&quot;</span>);</span><br><span class="line">            System.out.println(recorder);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>与责任链模式中的场景类很相似。读者请注意sh.update(null,recorder)这句代码，这是我们虚拟了观察者触发动作，完整的做法是把场景类作为一个被观察者，然后设置观察者为上海DNS服务器，再进行测试，其结果完全相同，我们这里为减少代码量采用了简化处理，有兴趣的读者可以扩充实现。</p>
<p>我们来看看运行结果如何，结果如下所示：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">=====域名解析模拟器===== </span><br><span class="line">请输入域名(输入N退出):www.xxx.sh.cn </span><br><span class="line">----DNS服务器解析结果---- </span><br><span class="line">域名：www.xxx.sh.cn </span><br><span class="line">IP地址：197.15.34.227 </span><br><span class="line">解析者：上海DNS服务器 </span><br><span class="line">请输入域名(输入N退出):www.xxx.com.cn </span><br><span class="line">----DNS服务器解析结果---- </span><br><span class="line">域名：www.xxx.com.cn </span><br><span class="line">IP地址：201.177.148.99 </span><br><span class="line">解析者：上海DNS服务器 </span><br><span class="line">请输入域名(输入N退出):www.xxx.com</span><br><span class="line">----DNS服务器解析结果---- </span><br><span class="line">域名：www.xxx.com </span><br><span class="line">IP地址：251.41.14.230 </span><br><span class="line">解析者：上海DNS服务器 </span><br><span class="line">请输入域名(输入N退出):n</span><br></pre></td></tr></table></figure>
<p>可以看出，所有的解析结果都是由上海DNS服务器返回的，这才是真正的DNS解析过程。如何知道它是由上海DNS服务器解析的还是由别的DNS服务器解析的呢？很好办，把代码拷贝过去，然后调试跟踪一下就可以了。或者仔细看看代码，理解一下代码逻辑也可以非常清楚地知道它是如何解析的。</p>
<p>再仔细看一下我们的代码逻辑，上下两个节点之间的关系很微妙，很有意思。</p>
<ul>
<li>下级节点对上级节点顶礼膜拜</li>
</ul>
<p>比如我们输入的这个域名<a target="_blank" rel="noopener" href="http://www.xxx.com,上海域名服务器只知道它是由父节点(中国顶级dns服务器)解析的,而不知道父节点把该请求转发给了更上层节点(全球顶级dns服务器),也就是说下级节点关注的是上级节点的响应,只要是上级反馈的结果就认为是上级的.www.xxx.com这个域名最终是由最高节点(全球顶级dns服务器)解析的,它把解析结果传递给第二个节点(中国顶级dns服务器)时的签名为“全球顶级dns服务器”,而第二个节点把请求传递给首节点(上海dns服务器)时的签名被修改为“中国顶级dns服务器”.所有从上级节点反馈的响应都认为是上级节点处理的结果,而不追究到底是不是真的是上级节点处理的./">www.xxx.com，上海域名服务器只知道它是由父节点（中国顶级DNS服务器）解析的，而不知道父节点把该请求转发给了更上层节点（全球顶级DNS服务器），也就是说下级节点关注的是上级节点的响应，只要是上级反馈的结果就认为是上级的。www.xxx.com这个域名最终是由最高节点（全球顶级DNS服务器）解析的，它把解析结果传递给第二个节点（中国顶级DNS服务器）时的签名为“全球顶级DNS服务器”，而第二个节点把请求传递给首节点（上海DNS服务器）时的签名被修改为“中国顶级DNS服务器”。所有从上级节点反馈的响应都认为是上级节点处理的结果，而不追究到底是不是真的是上级节点处理的。</a></p>
<ul>
<li>上级节点对下级节点绝对信任</li>
</ul>
<p>上级节点只对下级节点负责，它不关心下级节点的请求从何而来，只要是下级发送的请求就认为是下级的。还是以<a href="http://www.xxx.com域名为例，当最高节点（全球顶级DNS服务器）获得解析请求时，它认为这个请求是谁的？当然是第二个节点（中国顶级DNS服务器）的，否则它也不会把结果反馈给它，但是这个请求的源头却是首节点（上海DNS服务器）的。">www.xxx.com域名为例，当最高节点（全球顶级DNS服务器）获得解析请求时，它认为这个请求是谁的？当然是第二个节点（中国顶级DNS服务器）的，否则它也不会把结果反馈给它，但是这个请求的源头却是首节点（上海DNS服务器）的。</a></p>
<h2 id="32-3-3-小结"><a href="#32-3-3-小结" class="headerlink" title="32.3.3 小结"></a>32.3.3 小结</h2><p>通过对DNS解析过程的实现，我们发现触发链和责任链虽然都是链结构，但是还是有区别的。</p>
<ul>
<li>链中的消息对象不同</li>
</ul>
<p>从首节点开始到最终的尾节点，两个链中传递的消息对象是不同的。责任链模式基本上不改变消息对象的结构，虽然每个节点都可以参与消费（一般是不参与消费），类似于“雁过拔毛”，但是它的结构不会改变，比如从首节点传递进来一个String对象或者Person对象， 不会到链尾的时候成了int对象或者Human对象，这在责任链模式中是不可能的，但是在触发链模式中是允许的，链中传递的对象可以自由变化，只要上下级节点对传递对象了解即可， 它不要求链中的消息对象不变化，它只要求链中相邻两个节点的消息对象固定。</p>
<ul>
<li>上下节点的关系不同</li>
</ul>
<p>在责任链模式中，上下节点没有关系，都是接收同样的对象，所有传递的对象都是从链首传递过来，上一节点是什么没有关系，只要按照自己的逻辑处理就成。而触发链模式就不同了，它的上下级关系很亲密，下级对上级顶礼膜拜，上级对下级绝对信任，链中的任意两个相邻节点都是一个牢固的独立团体。</p>
<ul>
<li>消息的分销渠道不同</li>
</ul>
<p>在责任链模式中，一个消息从链首传递进来后，就开始沿着链条向链尾运动，方向是单一的、固定的；而触发链模式则不同，由于它采用的是观察者模式，所以有非常大的灵活性，一个消息传递到链首后，具体怎么传递是不固定的，可以以广播方式传递，也可以以跳跃方式传递，这取决于处理消息的逻辑。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://lanlan2017.github.io/JavaReadingNotes/186efce2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/JavaReadingNotes/images/avatar.gif">
      <meta itemprop="name" content="蓝蓝">
      <meta itemprop="description" content="好好学习，天天向上">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="蓝蓝站点">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/JavaReadingNotes/186efce2/" class="post-title-link" itemprop="url">33.2 门面模式VS中介者模式</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-09-27 19:57:33" itemprop="dateCreated datePublished" datetime="2021-09-27T19:57:33+08:00">2021-09-27</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-09-30 21:45:46" itemprop="dateModified" datetime="2021-09-30T21:45:46+08:00">2021-09-30</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/8-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E7%A6%85-%E7%AC%AC2%E7%89%88/" itemprop="url" rel="index"><span itemprop="name">8 设计模式之禅(第2版)</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/8-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E7%A6%85-%E7%AC%AC2%E7%89%88/3-%E7%AC%AC%E4%B8%89%E9%83%A8%E5%88%86-%E8%B0%81%E7%9A%84%E5%9C%B0%E7%9B%98%E8%B0%81%E5%81%9A%E4%B8%BB-%E2%80%94%E2%80%94%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8FPK/" itemprop="url" rel="index"><span itemprop="name">3 第三部分 谁的地盘谁做主 ——设计模式PK</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/8-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E7%A6%85-%E7%AC%AC2%E7%89%88/3-%E7%AC%AC%E4%B8%89%E9%83%A8%E5%88%86-%E8%B0%81%E7%9A%84%E5%9C%B0%E7%9B%98%E8%B0%81%E5%81%9A%E4%B8%BB-%E2%80%94%E2%80%94%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8FPK/%E7%AC%AC33%E7%AB%A0-%E8%B7%A8%E6%88%98%E5%8C%BAPK/" itemprop="url" rel="index"><span itemprop="name">第33章 跨战区PK</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
    <span class="post-meta-item-icon">
      <i class="far fa-comment"></i>
    </span>
    <span class="post-meta-item-text">Waline：</span>
  
    <a title="waline" href="/JavaReadingNotes/186efce2/#waline-comments" itemprop="discussionUrl">
      <span class="post-comments-count waline-comment-count" id="/JavaReadingNotes/186efce2/" data-xid="/JavaReadingNotes/186efce2/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>8.1k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>7 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="33-2-门面模式VS中介者模式"><a href="#33-2-门面模式VS中介者模式" class="headerlink" title="33.2 门面模式VS中介者模式"></a>33.2 门面模式VS中介者模式</h1><p>门面模式为复杂的子系统提供一个统一的访问界面，它定义的是一个高层接口，该接口使得子系统更加容易使用，避免外部模块深入到子系统内部而产生与子系统内部细节耦合的问题。中介者模式使用一个中介对象来封装一系列同事对象的交互行为，它使各对象之间不再显式地引用，从而使其耦合松散，建立一个可扩展的应用架构。</p>
<h2 id="33-2-1-中介者模式实现工资计算"><a href="#33-2-1-中介者模式实现工资计算" class="headerlink" title="33.2.1 中介者模式实现工资计算"></a>33.2.1 中介者模式实现工资计算</h2><p>大家工作会得到工资，那么工资与哪些因素有关呢？这里假设工资与职位、税收有关， 职位提升工资就会增加，同时税收也增加，职位下降了工资也同步降低，当然税收也降低。 而如果税收比率增加了呢？工资自然就减少了！这三者之间两两都有关系，很适合中介者模式的场景，类图如图33-4所示。</p>
<p><img data-src="https://raw.githubusercontent.com/lanlan2017/images/master/Blog/Sum/20210930203153.png" alt="image-20210930203153669"></p>
<center>图33-4 工资、职位、税收的示意类图</center>

<p>类图中的方法比较简单，我们主要分析的是三者之间的关系，通过类图可以发现三者之间已经没有耦合，原本在需求分析时我们发现三者有直接的交互，采用中介者模式后，三个对象之间已经相互独立了，全部委托中介者完成。我们在类图中还定义了一个抽象同事类， 它是一个标志性接口，其子类都是同事类，都可以被中介者接收，如代码清单33-11所示。</p>
<p>代码清单33-11 抽象同事类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">AbsColleague</span> </span>&#123;</span><br><span class="line">    <span class="comment">//每个同事类都对中介者非常了解</span></span><br><span class="line">    <span class="keyword">protected</span> AbsMediator mediator;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">AbsColleague</span><span class="params">(AbsMediator _mediator)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.mediator = _mediator;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在抽象同事类中定义了每个同事类对中介者都非常了解，如此才能把请求委托给中介者完成。三个同事类都具有相同的设计，即定义一个业务接口以及每个对象必须实现的职责， 同时既然是同事类就都继承AbsColleague。抽象同事类只是一个标志性父类，并没有限制子类的业务逻辑，因此每一个同事类并没有违背单一职责原则。首先来看职位接口，如代码清单33-12所示。</p>
<p>代码清单33-12 职位接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">IPosition</span> </span>&#123;</span><br><span class="line">    <span class="comment">//升职</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">promote</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="comment">//降职</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">demote</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>职位会有升有降，职位变化如代码清单33-13所示。</p>
<p>代码清单33-13 职位</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Position</span> <span class="keyword">extends</span> <span class="title">AbsColleague</span> <span class="keyword">implements</span> <span class="title">IPosition</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Position</span><span class="params">(AbsMediator _mediator)</span></span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(_mediator);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">demote</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.mediator.down(<span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">promote</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.mediator.up(<span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>每一个职位的升降动作都委托给中介者执行，具体一个职位升降影响到谁这里没有定义，完全由中介者完成，简单而且扩展性非常好。下面我们来看工资接口，如代码清单33- 14所示。</p>
<p>代码清单33-14 工资接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ISalary</span> </span>&#123;</span><br><span class="line">    <span class="comment">//加薪</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">increaseSalary</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="comment">//降薪</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">decreaseSalary</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>工资也会有升有降，如代码清单33-15所示。</p>
<p>代码清单33-15 工资</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Salary</span> <span class="keyword">extends</span> <span class="title">AbsColleague</span> <span class="keyword">implements</span> <span class="title">ISalary</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Salary</span><span class="params">(AbsMediator _mediator)</span></span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(_mediator);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">decreaseSalary</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.mediator.down(<span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">increaseSalary</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.mediator.up(<span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>交税是公民的义务，税收接口如代码清单33-16所示。</p>
<p>代码清单33-16 税收接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ITax</span> </span>&#123;</span><br><span class="line">    <span class="comment">//税收上升</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">raise</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="comment">//税收下降</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">drop</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>税收的变化对我们的工资当然有影响，如代码清单33-17所示。</p>
<p>代码清单33-17 税收</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Tax</span> <span class="keyword">extends</span> <span class="title">AbsColleague</span> <span class="keyword">implements</span> <span class="title">ITax</span> </span>&#123;</span><br><span class="line">    <span class="comment">//注入中介者</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Tax</span><span class="params">(AbsMediator _mediator)</span></span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(_mediator);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">drop</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.mediator.down(<span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">raise</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.mediator.up(<span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>以上同事类的业务都委托给了中介者，其本类已经没有任何的逻辑了，非常简单，现在的问题是中介者类非常复杂，因为它要处理三者之间的关系。我们首先来看抽象中介者，如代码清单33-18所示。</p>
<p>代码清单33-18 抽象中介者</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">AbsMediator</span> </span>&#123;</span><br><span class="line">    <span class="comment">//工资</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">final</span> ISalary salary;</span><br><span class="line">    <span class="comment">//职位</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">final</span> IPosition position;</span><br><span class="line">    <span class="comment">//税收</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">final</span> ITax tax;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">AbsMediator</span><span class="params">()</span></span>&#123;</span><br><span class="line">        salary = <span class="keyword">new</span> Salary(<span class="keyword">this</span>);</span><br><span class="line">        position = <span class="keyword">new</span> Position(<span class="keyword">this</span>);</span><br><span class="line">        tax = <span class="keyword">new</span> Tax(<span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//工资增加了</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">up</span><span class="params">(ISalary _salary)</span></span>;</span><br><span class="line">    <span class="comment">//职位提升了</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">up</span><span class="params">(IPosition _position)</span></span>;</span><br><span class="line">    <span class="comment">//税收增加了</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">up</span><span class="params">(ITax _tax)</span></span>;</span><br><span class="line">    <span class="comment">//工资降低了</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">down</span><span class="params">(ISalary _salary)</span></span>;</span><br><span class="line">    <span class="comment">//职位降低了</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">down</span><span class="params">(IPosition _position)</span></span>;</span><br><span class="line">    <span class="comment">//税收降低了</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">down</span><span class="params">(ITax _tax)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在抽象中介者中我们定义了6个方法，分别处理职位升降、工资升降以及税收升降的业务逻辑，采用Java多态机制来实现，我们来看实现类，如代码清单33-19所示。</p>
<p>代码清单33-19 中介者</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Mediator</span> <span class="keyword">extends</span> <span class="title">AbsMediator</span></span>&#123;</span><br><span class="line">    <span class="comment">//工资增加了</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">up</span><span class="params">(ISalary _salary)</span> </span>&#123;</span><br><span class="line">        upSalary();</span><br><span class="line">        upTax();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//职位提升了</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">up</span><span class="params">(IPosition position)</span> </span>&#123;</span><br><span class="line">        upPosition();</span><br><span class="line">        upSalary();</span><br><span class="line">        upTax();</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//税收增加了</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">up</span><span class="params">(ITax tax)</span> </span>&#123;</span><br><span class="line">        upTax();</span><br><span class="line">        downSalary();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**工资、职位、税收降低的处理方法相同，不再赘述 */</span><span class="comment">//工资增加</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">upSalary</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;工资翻倍，乐翻天&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">upTax</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;税收上升，为国家做贡献&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">upPosition</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;职位上升一级，狂喜&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">downSalary</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;经济不景气，降低工资&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">downTax</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;税收减低，国家收入减少&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">downPostion</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;官降三级，比自杀还痛苦&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>该类的方法较多，但是还是非常简单的，它的12个方法分为两大类型：一类是每个业务的独立流程，比如增加工资，仅仅实现单独增加工资的职能，而不关心职位、税收是如何变化的，该类型的方法是private私有类型，只能提供本类内访问；另一类是实现抽象中介者定义的方法，完成具体的每一个逻辑，比如职位上升，同时也引起了工资增加、税收增加。我们编写一个场景类，看看运行结果，如代码清单33-20所示。</p>
<p>代码清单33-20 场景类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Client</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//定义中介者</span></span><br><span class="line">        Mediator mediator = <span class="keyword">new</span> Mediator();</span><br><span class="line">        <span class="comment">//定义各个同事类</span></span><br><span class="line">        IPosition position = <span class="keyword">new</span> Position(mediator);</span><br><span class="line">        ISalary salary = <span class="keyword">new</span> Salary(mediator);</span><br><span class="line">        ITax tax = <span class="keyword">new</span> Tax(mediator);</span><br><span class="line">        <span class="comment">//职位提升了</span></span><br><span class="line">        System.out.println(<span class="string">&quot;===职位提升===&quot;</span>);</span><br><span class="line">        position.promote();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>运行结果如下所示：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">===职位提升=== </span><br><span class="line">职位上升一级，狂喜 </span><br><span class="line">工资翻倍，乐翻天 </span><br><span class="line">税收上升，为国家做贡献</span><br></pre></td></tr></table></figure>
<p>我们回过头来分析一下设计，在接收到需求后我们发现职位、工资、税收之间有着紧密的耦合关系，如果不采用中介者模式，则每个对象都要与其他两个对象进行通信，这势必会增加系统的复杂性，同时也使系统处于僵化状态，很难实现拥抱变化的理想。通过增加一个中介者，每个同事类的职位、工资、税收都只与中介者通信，中介者封装了各个同事类之间的逻辑关系，方便系统的扩展和维护。</p>
<h2 id="33-2-2-门面模式实现工资计算"><a href="#33-2-2-门面模式实现工资计算" class="headerlink" title="33.2.2 门面模式实现工资计算"></a>33.2.2 门面模式实现工资计算</h2><p>工资计算是一件非常复杂的事情，简单来说，它是对基本工资、月奖金、岗位津贴、绩效、考勤、税收、福利等因素综合运算后的一个数字。即使设计一个HR（人力资源）系统，员工工资计算也是非常复杂的模块，但是对于外界，比如高管层，最希望看到的结果是张三拿了多少钱，李四拿了多少钱，而不是看中间的计算过程，怎么计算那是人事部门的事情。换句话说，对外界的访问者来说，它只要传递进去一个人员名称和月份即可获得工资数，而不用关心其中的计算有多么复杂，这就用得上门面模式了。</p>
<p>门面模式对子系统起封装作用，它可以提供一个统一的对外服务接口，如图33-5所示。</p>
<p><img data-src="https://raw.githubusercontent.com/lanlan2017/images/master/Blog/Sum/20210930203813.png" alt="image-20210930203813115"></p>
<center>图33-5 HR系统的类图</center>

<p>该类图主要实现了工资计算，通过HRFacade门面可以查询用户的工资以及出勤天数等，而不用关心这个工资或者出勤天数是怎么计算出来的，从而屏蔽了外系统对工资计算模块的内部细节依赖。我们先看子系统内部的各个实现，考勤情况如代码清单33-21所示。</p>
<p>代码清单33-21 考勤情况</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Attendance</span> </span>&#123;</span><br><span class="line">    <span class="comment">//得到出勤天数</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getWorkDays</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (<span class="keyword">new</span> Random()).nextInt(<span class="number">30</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>非常简单，只用一个方法获得一个员工的出勤天数。我们再来看奖金计算，如代码清单33-22所示。</p>
<p>代码清单33-22 奖金计算</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Bonus</span> </span>&#123;</span><br><span class="line">    <span class="comment">//考勤情况</span></span><br><span class="line">    <span class="keyword">private</span> Attendance atte = <span class="keyword">new</span> Attendance();</span><br><span class="line">    <span class="comment">//奖金</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getBonus</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="comment">//获得出勤情况</span></span><br><span class="line">        <span class="keyword">int</span> workDays = atte.getWorkDays();</span><br><span class="line">        <span class="comment">//奖金计算模型</span></span><br><span class="line">        <span class="keyword">int</span> bonus = workDays * <span class="number">1800</span> / <span class="number">30</span>;</span><br><span class="line">        <span class="keyword">return</span> bonus;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们在这里实现了一个示意方法，实际的奖金计算是非常复杂的，与考勤、绩效、基本工资、岗位都有关系，单单一个奖金计算就可以设计出一个门面。我们再来看基本工资，这个基本上是按照职位而定的，比较固定，如代码清单33-23所示。</p>
<p>代码清单33-23 基本工资</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BasicSalary</span> </span>&#123;</span><br><span class="line">    <span class="comment">//获得一个人的基本工资</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getBasicSalary</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">2000</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们定义了员工的基本工资都为2000元，没有任何浮动的余地。再来看绩效，如代码清单33-24所示。</p>
<p>代码清单33-24 绩效</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Performance</span> </span>&#123;</span><br><span class="line">    <span class="comment">//基本工资</span></span><br><span class="line">    <span class="keyword">private</span> BasicSalary salary = <span class="keyword">new</span> BasicSalary();</span><br><span class="line">    <span class="comment">//绩效奖励</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getPerformanceValue</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="comment">//随机绩效</span></span><br><span class="line">        <span class="keyword">int</span> perf = (<span class="keyword">new</span> Random()).nextInt(<span class="number">100</span>);</span><br><span class="line">        <span class="keyword">return</span> salary.getBasicSalary() * perf /<span class="number">100</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>绩效按照一个非常简单的算法，即基本工资乘以一个随机的百分比。我们再来看税收，如代码清单33-25所示。</p>
<p>代码清单33-25 税收</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Tax</span> </span>&#123;</span><br><span class="line">    <span class="comment">//收取多少税金</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getTax</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="comment">//交纳一个随机数量的税金</span></span><br><span class="line">        <span class="keyword">return</span> (<span class="keyword">new</span> Random()).nextInt(<span class="number">300</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>一个计算员工薪酬的所有子元素都已经具备了，剩下的就是编写组合逻辑类，总工资的计算如代码清单33-26所示。</p>
<p>代码清单33-26 总工资计算</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SalaryProvider</span> </span>&#123;</span><br><span class="line">    <span class="comment">//基本工资</span></span><br><span class="line">    <span class="keyword">private</span> BasicSalary basicSalary = <span class="keyword">new</span> BasicSalary();</span><br><span class="line">    <span class="comment">//奖金</span></span><br><span class="line">    <span class="keyword">private</span> Bonus bonus = <span class="keyword">new</span> Bonus();</span><br><span class="line">    <span class="comment">//绩效</span></span><br><span class="line">    <span class="keyword">private</span> Performance perf = <span class="keyword">new</span> Performance();</span><br><span class="line">    <span class="comment">//税收</span></span><br><span class="line">    <span class="keyword">private</span> Tax tax = <span class="keyword">new</span> Tax();</span><br><span class="line">    <span class="comment">//获得用户的总收入</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">totalSalary</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> basicSalary.getBasicSalary() + bonus.getBonus() + perf.getPerformanceValue() - tax.getTax();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这里只是对前面的元素值做了一个加减法计算，这是对实际HR系统的简化处理，如果把这个类暴露给外系统，那么被修改的风险是非常大的，因为它的方法totalSalary是一个具体的业务逻辑。我们采用门面模式的目的是要求门面是无逻辑的，与业务无关，只是一个子系统的访问入口。门面模式只是一个技术层次上的实现，全部业务还是在子系统内实现。我们来看HR门面，如代码清单33-27所示。</p>
<p>代码清单33-27 HR门面</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HRFacade</span> </span>&#123;</span><br><span class="line">    <span class="comment">//总工资情况</span></span><br><span class="line">    <span class="keyword">private</span> SalaryProvider salaryProvider = <span class="keyword">new</span> SalaryProvider();</span><br><span class="line">    <span class="comment">//考勤情况</span></span><br><span class="line">    <span class="keyword">private</span> Attendance attendance = <span class="keyword">new</span> Attendance();</span><br><span class="line">    <span class="comment">//查询一个人的总收入</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">querySalary</span><span class="params">(String name,Date date)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> salaryProvider.totalSalary();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//查询一个员工一个月工作了多少天</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">queryWorkDays</span><span class="params">(String name)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> attendance.getWorkDays();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>所有的行为都是委托行为，由具体的子系统实现，门面只是提供了一个统一访问的基础而已，不做任何的校验、判断、异常等处理。我们编写一个场景类查看运行结果，如代码清单33-28所示。</p>
<p>代码清单33-28 场景类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Client</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//定义门面</span></span><br><span class="line">        HRFacade facade = <span class="keyword">new</span> HRFacade();</span><br><span class="line">        System.out.println(<span class="string">&quot;===外系统查询总收入===&quot;</span>);</span><br><span class="line">        <span class="keyword">int</span> salary = facade.querySalary(<span class="string">&quot;张三&quot;</span>,<span class="keyword">new</span> Date(System. currentTimeMillis()));</span><br><span class="line">        System.out.println( <span class="string">&quot;张三 11月 总收入为：&quot;</span> +salary);</span><br><span class="line">        <span class="comment">//再查询出勤天数</span></span><br><span class="line">        System.out.println(<span class="string">&quot;\n===外系统查询出勤天数===&quot;</span>);</span><br><span class="line">        <span class="keyword">int</span> workDays = facade.queryWorkDays(<span class="string">&quot;李四&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;李四 本月出勤：&quot;</span> +workDays);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>运行结果如下所示：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">===外系统查询总收入=== </span><br><span class="line">张三 11月 总收入为：4133 </span><br><span class="line">===外系统查询出勤天数=== </span><br><span class="line">李四 本月出勤：22</span><br></pre></td></tr></table></figure>
<p>在该例中，我们使用了门面模式对薪水计算子系统进行封装，避免子系统内部复杂逻辑外泄，确保子系统的业务逻辑的单纯性，即使业务流程需要变更，影响的也是子系统内部功能，比如奖金需要与基本工资挂钩，这样的修改对外系统来说是透明的，只需要子系统内部变更即可。</p>
<h2 id="33-2-3-最佳实践"><a href="#33-2-3-最佳实践" class="headerlink" title="33.2.3 最佳实践"></a>33.2.3 最佳实践</h2><p>门面模式和中介者模式之间的区别还是比较明显的，门面模式是以封装和隔离为主要任务，而中介者模式则是以调和同事类之间的关系为主，因为要调和，所以具有了部分的业务逻辑控制。两者的主要区别如下：</p>
<ul>
<li>功能区别</li>
</ul>
<p>门面模式只是增加了一个门面，它对子系统来说没有增加任何的功能，子系统若脱离门 面模式是完全可以独立运行的。而中介者模式则增加了业务功能，它把各个同事类中的原有 耦合关系移植到了中介者，同事类不可能脱离中介者而独立存在，除非是想增加系统的复杂 性和降低扩展性。</p>
<ul>
<li>知晓状态不同</li>
</ul>
<p>对门面模式来说，子系统不知道有门面存在，而对中介者来说，每个同事类都知道中介 者存在，因为要依靠中介者调和同事之间的关系，它们对中介者非常了解。</p>
<ul>
<li>封装程度不同</li>
</ul>
<p>门面模式是一种简单的封装，所有的请求处理都委托给子系统完成，而中介者模式则需要有一个中心，由中心协调同事类完成，并且中心本身也完成部分业务，它属于更进一步的业务功能封装。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://lanlan2017.github.io/JavaReadingNotes/a9c2727d/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/JavaReadingNotes/images/avatar.gif">
      <meta itemprop="name" content="蓝蓝">
      <meta itemprop="description" content="好好学习，天天向上">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="蓝蓝站点">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/JavaReadingNotes/a9c2727d/" class="post-title-link" itemprop="url">33.3 包装模式群PK</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-09-27 19:57:33" itemprop="dateCreated datePublished" datetime="2021-09-27T19:57:33+08:00">2021-09-27</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-09-30 21:51:39" itemprop="dateModified" datetime="2021-09-30T21:51:39+08:00">2021-09-30</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/8-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E7%A6%85-%E7%AC%AC2%E7%89%88/" itemprop="url" rel="index"><span itemprop="name">8 设计模式之禅(第2版)</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/8-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E7%A6%85-%E7%AC%AC2%E7%89%88/3-%E7%AC%AC%E4%B8%89%E9%83%A8%E5%88%86-%E8%B0%81%E7%9A%84%E5%9C%B0%E7%9B%98%E8%B0%81%E5%81%9A%E4%B8%BB-%E2%80%94%E2%80%94%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8FPK/" itemprop="url" rel="index"><span itemprop="name">3 第三部分 谁的地盘谁做主 ——设计模式PK</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/8-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E7%A6%85-%E7%AC%AC2%E7%89%88/3-%E7%AC%AC%E4%B8%89%E9%83%A8%E5%88%86-%E8%B0%81%E7%9A%84%E5%9C%B0%E7%9B%98%E8%B0%81%E5%81%9A%E4%B8%BB-%E2%80%94%E2%80%94%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8FPK/%E7%AC%AC33%E7%AB%A0-%E8%B7%A8%E6%88%98%E5%8C%BAPK/" itemprop="url" rel="index"><span itemprop="name">第33章 跨战区PK</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
    <span class="post-meta-item-icon">
      <i class="far fa-comment"></i>
    </span>
    <span class="post-meta-item-text">Waline：</span>
  
    <a title="waline" href="/JavaReadingNotes/a9c2727d/#waline-comments" itemprop="discussionUrl">
      <span class="post-comments-count waline-comment-count" id="/JavaReadingNotes/a9c2727d/" data-xid="/JavaReadingNotes/a9c2727d/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>7.7k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>7 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="33-3-包装模式群PK"><a href="#33-3-包装模式群PK" class="headerlink" title="33.3 包装模式群PK"></a>33.3 包装模式群PK</h1><p>我们讲了这么多的设计模式，大家有没有发觉在很多的模式中有些角色是不干活的？它们只是充当黔首作用，你有问题，找我，但我不处理，我让其他人处理。最典型的就是代理模式了，代理角色接收请求然后传递到被代理角色处理。门面模式也是一样，门面角色的任务就是把请求转发到子系统。类似这种结构的模式还有很多，我们先给这种类型的模式定义一个名字，叫做包装模式（wrapping pattern）。注意，包装模式是一组模式而不是一个。包装模式包括哪些设计模式呢？包装模式包括：装饰模式、适配器模式、门面模式、代理模式、桥梁模式。下面我们通过一组例子来说明这五个包装模式的区别。</p>
<h2 id="33-3-1-代理模式"><a href="#33-3-1-代理模式" class="headerlink" title="33.3.1 代理模式"></a>33.3.1 代理模式</h2><p>现在很多明星都有经纪人，一般有什么事他们都会说：“你找我的经纪人谈好了”，下面我们就看看这一过程怎么模拟。假设有一个追星族想找明星签字，我们看看采用代理模式怎么实现。代理模式是包装模式中的最一般的实现，类图如图33-6所示。</p>
<p><img data-src="https://raw.githubusercontent.com/lanlan2017/images/master/Blog/Sum/20210930204514.png" alt="image-20210930204514221"></p>
<center>图33-6 追星族找明星签字</center>
类图很简单，就是一个简单的代理模式，我们来看明星的定义，明星接口如代码清单33-29所示。

<p>代码清单33-29 明星接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">IStar</span> </span>&#123;</span><br><span class="line">    <span class="comment">//明星都会签名</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sign</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>明星只有一个行为：签字。我们来看明星的实现，如代码清单33-30所示。</p>
<p>代码清单33-30 明星</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Singer</span> <span class="keyword">implements</span> <span class="title">IStar</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sign</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;明星签字：我是XXX大明星&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>经纪人与明星应该有相同的行为，比如说签名，虽然经纪人不签名，但是他把你要签名的笔记本、衣服、CD等传递过去让真正的明星签字，经纪人如代码清单33-31所示。</p>
<p>代码清单33-31 经纪人</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Agent</span> <span class="keyword">implements</span> <span class="title">IStar</span> </span>&#123;</span><br><span class="line">    <span class="comment">//定义是谁的经纪人</span></span><br><span class="line">    <span class="keyword">private</span> IStar star;</span><br><span class="line">    <span class="comment">//构造函数传递明星</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Agent</span><span class="params">(IStar _star)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.star = _star;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//经纪人是不会签字的，签字了歌迷也不认</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sign</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        star.sign();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>应该非常明确地指出一个经纪人是谁的代理，因此要在构造函数中接收一个明星对象， 确定是要做这个明星的代理。我们再来看看追星族是怎么找明星签字的，如代码清单33-32所示。</p>
<p>代码清单33-32 追星族</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Idolater</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//崇拜的明星是谁</span></span><br><span class="line">        IStar star = <span class="keyword">new</span> Singer();</span><br><span class="line">        <span class="comment">//找到明星的经纪人</span></span><br><span class="line">        IStar agent = <span class="keyword">new</span> Agent(star);</span><br><span class="line">        System.out.println(<span class="string">&quot;追星族：我是你的崇拜者，请签名！&quot;</span>);</span><br><span class="line">        <span class="comment">//签字</span></span><br><span class="line">        agent.sign();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>很简单，找到明星的代理，然后明星就签字了。运行结果如下所示：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">追星族：我是你的崇拜者，请签名！ </span><br><span class="line">明星签字：我是XXX大明星</span><br></pre></td></tr></table></figure>
<p>看看我们的程序逻辑，我们是找明星的经纪人签字，真实签字的是明星，经纪人只是把这个请求传递给明星处理而已，这是普通的代理模式的典型应用。</p>
<h2 id="33-3-2-装饰模式"><a href="#33-3-2-装饰模式" class="headerlink" title="33.3.2 装饰模式"></a>33.3.2 装饰模式</h2><p>明星也都是一步一步地奋斗出来的，谁都不是一步就成为大明星的。甚至一些演员通过粉饰自己给观众一个好的印象，现在我们就来看怎么粉饰一个演员，如图33-7所示。</p>
<p><img data-src="https://raw.githubusercontent.com/lanlan2017/images/master/Blog/Sum/20210930204858.png" alt="image-20210930204858856"></p>
<center>图33-7 演技修饰</center>

<p>下面我们就来看看这些过程如何实现，先看明星接口，如代码清单33-33所示。</p>
<p>代码清单33-33 明星接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">IStar</span> </span>&#123;</span><br><span class="line">    <span class="comment">//演戏</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">act</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们来看看我们的主角，如代码清单33-34所示。</p>
<p>代码清单33-34 假明星</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FreakStar</span> <span class="keyword">implements</span> <span class="title">IStar</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">act</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;演中：演技很拙劣&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们看看这个明星是怎么粉饰的，先定义一个抽象装饰类，如代码清单33-35所示。</p>
<p>代码清单33-35 抽象装饰类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Decorator</span> <span class="keyword">implements</span> <span class="title">IStar</span> </span>&#123;</span><br><span class="line">    <span class="comment">//粉饰的是谁</span></span><br><span class="line">    <span class="keyword">private</span> IStar star;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Decorator</span><span class="params">(IStar _star)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.star = _star;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">act</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.star.act();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>前后两次修饰，开演前毫无忌惮地吹嘘，如代码清单33-36所示。</p>
<p>代码清单33-36 吹大话</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HotAir</span> <span class="keyword">extends</span> <span class="title">Decorator</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">HotAir</span><span class="params">(IStar _star)</span></span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(_star);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">act</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;演前：夸夸其谈，没有自己不能演的角色&quot;</span>);</span><br><span class="line">        <span class="keyword">super</span>.act();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>大家发现这个明星演技不好的时候，他拼命找借口，说是那天天气不好、心情不好等， 如代码清单33-37所示。</p>
<p>代码清单33-37 抵赖</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Deny</span> <span class="keyword">extends</span> <span class="title">Decorator</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Deny</span><span class="params">(IStar _star)</span></span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(_star);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">act</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.act();</span><br><span class="line">        System.out.println(<span class="string">&quot;演后：百般抵赖，死不承认&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们建立一个场景把这种情况展示一下，如代码清单33-38所示。</p>
<p>代码清单33-38 场景类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Client</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//定义出所谓的明星</span></span><br><span class="line">        IStar freakStar = <span class="keyword">new</span> FreakStar();</span><br><span class="line">        <span class="comment">//看看他是怎么粉饰自己的</span></span><br><span class="line">        <span class="comment">//演前吹嘘自己无所不能</span></span><br><span class="line">        freakStar = <span class="keyword">new</span> HotAir(freakStar);</span><br><span class="line">        <span class="comment">//演完后，死不承认自己演的不好</span></span><br><span class="line">        freakStar = <span class="keyword">new</span> Deny(freakStar);</span><br><span class="line">        System.out.println(<span class="string">&quot;====看看一些虚假明星的形象====&quot;</span>);</span><br><span class="line">        freakStar.act();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>运行结果如下所示：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">====看看一些虚假明星的形象==== </span><br><span class="line">演前：夸夸其谈，没有自己不能演的角色 </span><br><span class="line">演中：演技很拙劣 </span><br><span class="line">演后：百般抵赖，死不承认</span><br></pre></td></tr></table></figure>
<h2 id="33-3-3-适配器模式"><a href="#33-3-3-适配器模式" class="headerlink" title="33.3.3 适配器模式"></a>33.3.3 适配器模式</h2><p>我们知道在演艺圈中还存在一种情况：替身，替身也是演员，只是普通的演员而已，在一段戏中，前十五分钟是明星本人，后十五分钟也是明星本人，就中间的五分钟是替身，那这个场景该怎么描述呢？注意中间那五分钟，这个时候一个普通演员被导演认为是明星演员，我们来看类图，如图33-8所示。</p>
<p><img data-src="https://raw.githubusercontent.com/lanlan2017/images/master/Blog/Sum/20210930213500.png" alt="image-20210930213500367"></p>
<p>图33-8 替身演员类图</p>
<p>导演找了一个普通演员作为明星的替身，不过观众看到的还是明星的身份。我们来看代码，首先看明星接口，如代码清单33-39所示。</p>
<p>代码清单33-39 明星接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">IStar</span> </span>&#123;</span><br><span class="line">    <span class="comment">//明星都要演戏</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">act</span><span class="params">(String context)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>再来看一个具体的电影明星，他的主要职责就是演戏，如代码清单33-40所示。</p>
<p>代码清单33-40 电影明星</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FilmStar</span> <span class="keyword">implements</span> <span class="title">IStar</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">act</span><span class="params">(String context)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;明星演戏：&quot;</span> + context);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们再来看普通演员，明星就那么多，但是普通演员非常多，我们看其接口，如代码清单33-41所示。</p>
<p>代码清单33-41 普通演员接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">IActor</span> </span>&#123;</span><br><span class="line">    <span class="comment">//普通演员演戏</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">playact</span><span class="params">(String contet)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>普通演员也是演员，是要演戏的，我们来看一个普通演员的实现，如代码清单33-42所示。</p>
<p>代码清单33-42 普通演员</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UnknownActor</span> <span class="keyword">implements</span> <span class="title">IActor</span> </span>&#123;</span><br><span class="line">    <span class="comment">//普通演员演戏</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">playact</span><span class="params">(String context)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;普通演员：&quot;</span>+context);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们来看替身该怎么编写，如代码清单33-43所示。</p>
<p>代码清单33-43 替身演员</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Standin</span> <span class="keyword">implements</span> <span class="title">IStar</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> IActor actor;</span><br><span class="line">    <span class="comment">//替身是谁</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Standin</span><span class="params">(IActor _actor)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.actor = _actor;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">act</span><span class="params">(String context)</span> </span>&#123;</span><br><span class="line">        actor.playact(context);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这是一个通用的替身，哪个普通演员能担任哪个明星的替身是由导演决定的，导演想让谁当就让谁当，我们来看导演，如代码清单33-44所示。</p>
<p>代码清单33-44 导演类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">direcotr</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;=======演戏过程模拟==========&quot;</span>);</span><br><span class="line">        <span class="comment">//定义一个大明星</span></span><br><span class="line">        IStar star = <span class="keyword">new</span> FilmStar();</span><br><span class="line">        star.act(<span class="string">&quot;前十五分钟，明星本人演戏&quot;</span>);</span><br><span class="line">        <span class="comment">//导演把一个普通演员当做明星演员来用</span></span><br><span class="line">        IActor actor = <span class="keyword">new</span> UnknownActor();</span><br><span class="line">        IStar standin= <span class="keyword">new</span> Standin(actor);</span><br><span class="line">        standin.act(<span class="string">&quot;中间五分钟，替身在演戏&quot;</span>);</span><br><span class="line">        star.act(<span class="string">&quot;后十五分钟，明星本人演戏&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>运行结果如下所示：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">=======演戏过程模拟========== </span><br><span class="line">明星演戏：前十五分钟，明星本人演戏 </span><br><span class="line">普通演员：中间五分钟，替身在演戏 </span><br><span class="line">明星演戏：后十五分钟，明星本人演戏</span><br></pre></td></tr></table></figure>
<h2 id="33-3-4-桥梁模式"><a href="#33-3-4-桥梁模式" class="headerlink" title="33.3.4 桥梁模式"></a>33.3.4 桥梁模式</h2><p>我们继续说明星圈的事情，现在明星类型太多了，比如电影明星、电视明星、歌星、体育明星、网络明星等，每个类型的明星都有明确的职责，电影明星的主要工作就是演电影， 电视明星的主要工作就是演电视剧或者主持电视节目。再看看现在的明星，单一发展的基本没有，主持人出专辑、体育明星演电影、歌星拍戏等太平常了，我们就用程序来表现一下多元化情形，如图33-9所示。</p>
<p><img data-src="https://raw.githubusercontent.com/lanlan2017/images/master/Blog/Sum/20210930213931.png" alt="image-20210930213931585"></p>
<center>图33-9 各类明星描述</center>

<p>图33-9中定义了一个抽象明星AbsStar，然后产生出各个具体类型的明星，比如电影明星FilmStar、歌星Singer，当然还可以继续扩展下去。这里还定义了一个抽象的行为AbsAction，描述明星所具有的活动，比如演电影、唱歌等，在这种设计下，明星可以扩展，明星的活动也可以扩展，非常灵活。我们先来看明星的活动，抽象活动如代码清单33- 45所示。</p>
<p>代码清单33-45 抽象活动</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">AbsAction</span> </span>&#123;</span><br><span class="line">    <span class="comment">//每个活动都有描述</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">desc</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>很简单，只有一个活动的描述，由子类来实现。我们来看演电影和唱歌两个活动，分别如代码清单33-46、33-47所示。</p>
<p>代码清单33-46 演电影</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ActFilm</span> <span class="keyword">extends</span> <span class="title">AbsAction</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">desc</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;演出精彩绝伦的电影&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>代码清单33-47 唱歌</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Sing</span> <span class="keyword">extends</span> <span class="title">AbsAction</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">desc</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;唱出优美的歌曲&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>各种精彩的活动都有了，我们再来看抽象明星，它是所有明星的代表，如代码清单33- 48所示。</p>
<p>代码清单33-48 抽象明星</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">AbsStar</span> </span>&#123;</span><br><span class="line">    <span class="comment">//一个明星参加哪些活动</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">final</span> AbsAction action;</span><br><span class="line">    <span class="comment">//通过构造函数传递具体活动</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">AbsStar</span><span class="params">(AbstAction _action)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.action = _action;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//每个明星都有自己的主要工作</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doJob</span><span class="params">()</span></span>&#123;</span><br><span class="line">        action.desc();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>明星都有自己的主要活动（或者是主要工作），我们在抽象明星中只是定义明星有活动，具体有什么活动由各个子类实现。我们再来看电影明星，如代码清单33-49所示。</p>
<p>代码清单33-49 电影明星</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FilmStar</span> <span class="keyword">extends</span> <span class="title">AbsStar</span> </span>&#123;</span><br><span class="line">    <span class="comment">//默认的电影明星的主要工作是拍电影</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">FilmStar</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(<span class="keyword">new</span> ActFilm());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//也可以重新设置一个新职业</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">FilmStar</span><span class="params">(AbsAction _action)</span></span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(_action);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//细化电影明星的职责</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doJob</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;\n======影星的工作=====&quot;</span>);</span><br><span class="line">        <span class="keyword">super</span>.doJob();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>电影明星的本职工作就应该是演电影，因此就有了一个无参构造函数来定义电影明星的默认工作，如果明星要客串一下去唱歌也可以，有参构造解决了该问题。歌星的实现与此相同，如代码清单33-50所示。</p>
<p>代码清单33-50 歌星</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Singer</span> <span class="keyword">extends</span> <span class="title">AbsStar</span> </span>&#123;</span><br><span class="line">    <span class="comment">//歌星的默认活动是唱歌</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Singer</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(<span class="keyword">new</span> Sing());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//也可以重新设置一个新职业</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Singer</span><span class="params">(AbsAction _action)</span></span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(_action);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//细化歌星的职责</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doJob</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;\n======歌星的工作=====&quot;</span>);</span><br><span class="line">        <span class="keyword">super</span>.doJob();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们使用电影明星和歌星来作为代表，这两类明星也是我们经常听到或看到的，下面建立一个场景类来模拟一下明星的事迹，如代码清单33-51所示。</p>
<p>代码清单33-51 场景类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Client</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//声明一个电影明星</span></span><br><span class="line">        AbsStar zhangSan = <span class="keyword">new</span> FilmStar();</span><br><span class="line">        <span class="comment">//声明一个歌星</span></span><br><span class="line">        AbsStar liSi = <span class="keyword">new</span> Singer();</span><br><span class="line">        <span class="comment">//展示一下各个明星的主要工作</span></span><br><span class="line">        zhangSan.doJob();</span><br><span class="line">        liSi.doJob();</span><br><span class="line">        <span class="comment">//当然，也有部分明星不务正业，比如歌星演戏</span></span><br><span class="line">        liSi = <span class="keyword">new</span> Singer(<span class="keyword">new</span> ActFilm());</span><br><span class="line">        liSi.doJob();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>运行结果如下所示：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">======影星的工作===== </span><br><span class="line">演出精彩绝伦的电影 </span><br><span class="line">======歌星的工作===== </span><br><span class="line">唱出优美的歌曲 </span><br><span class="line">======歌星的工作===== </span><br><span class="line">演出精彩绝伦的电影</span><br></pre></td></tr></table></figure>
<p>好了，各类明星都有自己的本职工作，但是偶尔客串一个其他类型的活动也是允许的， 如此设计后，明星就可以不用固定在自己的本职工作上，而是向其他方向发展，比如影视歌三栖明星。</p>
<p>门面模式我们在其他章节已经讲解得比较多了，本小节就不再赘述。</p>
<h2 id="33-3-5-最佳实践"><a href="#33-3-5-最佳实践" class="headerlink" title="33.3.5 最佳实践"></a>33.3.5 最佳实践</h2><p>5个包装模式是大家在系统设计中经常会用到的模式，它们具有相似的特征：都是通过 委托的方式对一个对象或一系列对象（例如门面模式）施行包装，有了包装，设计的系统才 更加灵活、稳定，并且极具扩展性。从实现的角度来看，它们都是代理的一种具体表现形 式，我们来看看它们在使用场景上有什么区别。</p>
<p>代理模式主要用在不希望展示一个对象内部细节的场景中，比如一个远程服务不需要把远程连接的所有细节都暴露给外部模块，通过增加一个代理类，可以很轻松地实现被代理类的功能封装。此外，代理模式还可以用在一个对象的访问需要限制的场景中，比如AOP。</p>
<p>装饰模式是一种特殊的代理模式，它倡导的是在不改变接口的前提下为对象增强功能， 或者动态添加额外职责。就扩展性而言，它比子类更加灵活，例如在一个已经运行的项目中，可以很轻松地通过增加装饰类来扩展系统的功能。</p>
<p>适配器模式的主要意图是接口转换，把一个对象的接口转换成系统希望的另外一个接口，这里的系统指的不仅仅是一个应用，也可能是某个环境，比如通过接口转换可以屏蔽外界接口，以免外界接口深入系统内部，从而提高系统的稳定性和可靠性。</p>
<p>桥梁模式是在抽象层产生耦合，解决的是自行扩展的问题，它可以使两个有耦合关系的对象互不影响地扩展，比如对于使用笔画图这样的需求，可以采用桥梁模式设计成用什么笔 （铅笔、毛笔）画什么图（圆形、方形）的方案，至于以后需求的变更，如增加笔的类型， 增加图形等，对该设计来说是小菜一碟。</p>
<p>门面模式是一个粗粒度的封装，它提供一个方便访问子系统的接口，不具有任何的业务逻辑，仅仅是一个访问复杂系统的快速通道，没有它，子系统照样运行，有了它，只是更方便访问而已。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://lanlan2017.github.io/JavaReadingNotes/47429945/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/JavaReadingNotes/images/avatar.gif">
      <meta itemprop="name" content="蓝蓝">
      <meta itemprop="description" content="好好学习，天天向上">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="蓝蓝站点">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/JavaReadingNotes/47429945/" class="post-title-link" itemprop="url">34.1 搬移UNIX的命令</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-09-27 19:57:33" itemprop="dateCreated datePublished" datetime="2021-09-27T19:57:33+08:00">2021-09-27</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-10-01 15:21:16" itemprop="dateModified" datetime="2021-10-01T15:21:16+08:00">2021-10-01</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/8-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E7%A6%85-%E7%AC%AC2%E7%89%88/" itemprop="url" rel="index"><span itemprop="name">8 设计模式之禅(第2版)</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/8-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E7%A6%85-%E7%AC%AC2%E7%89%88/4-%E7%AC%AC%E5%9B%9B%E9%83%A8%E5%88%86-%E5%AE%8C%E7%BE%8E%E4%B8%96%E7%95%8C-%E2%80%94%E2%80%94%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E6%B7%B7%E7%BC%96/" itemprop="url" rel="index"><span itemprop="name">4 第四部分 完美世界 ——设计模式混编</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/8-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E7%A6%85-%E7%AC%AC2%E7%89%88/4-%E7%AC%AC%E5%9B%9B%E9%83%A8%E5%88%86-%E5%AE%8C%E7%BE%8E%E4%B8%96%E7%95%8C-%E2%80%94%E2%80%94%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E6%B7%B7%E7%BC%96/%E7%AC%AC34%E7%AB%A0-%E5%91%BD%E4%BB%A4%E6%A8%A1%E5%BC%8F-%E8%B4%A3%E4%BB%BB%E9%93%BE%E6%A8%A1%E5%BC%8F/" itemprop="url" rel="index"><span itemprop="name">第34章 命令模式+责任链模式</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
    <span class="post-meta-item-icon">
      <i class="far fa-comment"></i>
    </span>
    <span class="post-meta-item-text">Waline：</span>
  
    <a title="waline" href="/JavaReadingNotes/47429945/#waline-comments" itemprop="discussionUrl">
      <span class="post-comments-count waline-comment-count" id="/JavaReadingNotes/47429945/" data-xid="/JavaReadingNotes/47429945/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>16k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>14 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="34-1-搬移UNIX的命令"><a href="#34-1-搬移UNIX的命令" class="headerlink" title="34.1 搬移UNIX的命令"></a>34.1 搬移UNIX的命令</h1><p>在操作系统的世界里，有两大阵营一直在PK着：<code>*nix</code>（包括UNIX和Linux）和Windows。从目前的统计数据来看，<code>*nix</code>在应用服务器领域占据相对优势，不过Windows也不甘示弱，国内某些小型银行已经在使用PC Server（安装Windows操作系统的服务器）集群来进行银行业务运算，而且稳定性、性能各方面的效果不错；而在个人桌面方面，Windows 是占绝对优势的，大家应该基本上都在用这个操作系统，它的诸多优点这里就不多说了，我们今天就来解决一个习惯问题。如果你负责过UNIX系统维护，你自己的笔记本又是Windows 操作系统的话，我想你肯定有这样的经验，如图34-1所示。</p>
<p><img data-src="https://raw.githubusercontent.com/lanlan2017/images/master/Blog/Sum/20210930214930.png" alt="image-20210930214930410"></p>
<center>图34-1 时常犯的错误</center>

<p>是不是经常把UNIX上的命令敲到Windows系统了？为了避免这种情况发生，可以把UNIX上的命令移植到Windows上，也就是Windows下的shell工具，有很多类似的工具，比如cygwin、GUN Bash等，这些都是非常完美的工具，我们今天的任务就是自己写一个这样的工具。怎么写呢？我们学了这么多的模式，当然要融会贯通了，可以使用命令模式、责任链模式、模板方法模式设计一个方便扩展、稳定的工具。</p>
<p>我们先说说UNIX下的命令，一条命令分为命令名、选项和操作数，例如命令”ls-l/usr”， 其中，ls是命令名，l是选项，/usr是操作数，后两项都是可选项，根据实际情况而定。UNIX 命令一定遵守以下几个规则：</p>
<ul>
<li>命令名为小写字母。</li>
<li>命令名、选项、操作数之间以空格分隔，空格数量不受限制。</li>
<li>选项之间可以组合使用，也可以单独拆分使用。</li>
<li>选项以横杠（-）开头。</li>
</ul>
<p>在UNIX世界中，我们最常用的就是ls这个命令，它用于显示目录或文件信息，下面我们先来看看这个命令。常用的有以下几条组合命令：</p>
<ul>
<li>ls：简单列出一个目录下的文件。</li>
<li>ls-l：详细列出目录下的文件。</li>
<li>ls-a：列出目录下包含的隐藏文件，主要是点号（.）开头的文件。</li>
<li>ls-s：列出文件的大小。</li>
</ul>
<p>除此之外，还有一些非常常用的组合命令，如”ls-la”、”ls-ls”等。ls命令名确定了，但是其后连接的选项和操作数是不确定的。操作数我们不用关心它，每个命令必然有一个操作数，若没有则是当前的目录。问题的关键是选项，用哪个选项以及什么时候使用都是由用户决定的，也就是从设计上考虑。设计者需要完全解析所有的参数，需要很多个类来处理如此多的选项，客户输入一个参数，立刻返回一个结果。针对一个ls命令族，要求如下：</p>
<ul>
<li>每一个ls命令都有操作数，默认操作数为当前目录。</li>
<li>选项不可重复，例如对于”ls-l-l-s”，解析出的选项应该只有两个：l选项和s选项。</li>
<li>每个选项返回不同的结果，也就是说每个选项应该由不同的业务逻辑来处理。</li>
<li>为提高扩展性，ls命令族内的运算应该是对外封闭的，减少外界访问ls命令族内部细 节的可能性。</li>
</ul>
<p>针对一个命令族的分析结果，我们可以使用什么模式？责任链模式！对，只要把一个参数传递到链首，就可以立刻获得一个结果，中间是如何传递的以及由哪个逻辑解析都不需要外界（高层）模块关心，该模块的类图如图34-2所示。</p>
<p><img data-src="https://raw.githubusercontent.com/lanlan2017/images/master/Blog/Sum/20210930215126.png" alt="image-20210930215126398"></p>
<center>图34-2 命令族的解析类图</center>
类图还是比较清晰的，UNIX的命令有上百个，我们定义一个CommandName抽象类，所有的命令都继承于该类，它就是责任链模式的handler类，负责链表控制；每个命令族都有一个独立的抽象类，因为每个命令族都有其独特的个性，比如ls命令和df命令，其后可加的参数是不一样的，这就可以在抽象类AbstractLS中定义，而且它还有标示作用，标示其下的实现类都是实现ls命令的，只是命令的选项不同；Context负责建立一条命令的链表，比如ls命令族、df命令族等，它组装出一个处理一个命令族的责任链，并返回首节点供高层模块调用，这是非常典型的责任链模式。

<p>分析完毕一个具体的命令族，已经确定可以采用责任链模式，我们继续往下分析。 UNIX命令非常多，敲一个命令返回一个结果，每个具体的命令可以由相关的命令族（也就是责任链）来解析，但是如此多的命令还是需要有一个派发的角色，输入一个命令，不管后台谁来解析，返回一个结果就成，这就要用到命令模式。命令模式负责协调各个命令正确地传递到各个责任链的首节点，这就是它的任务，其类图如图34-3所示。</p>
<p><img data-src="https://raw.githubusercontent.com/lanlan2017/images/master/Blog/Sum/20210930215233.png" alt="image-20210930215233203"></p>
<center>图34-3 命令传递类图</center>

<p>是不是典型的命令模式类图？其中Chain是一个标示符，表示的就是我们上面分析的责任链，每一个具体的命令负责调用责任链的首节点，获得返回值，结束命令的执行。两个核心模块都分析完毕了，就可以把类图融合在一起，完整的类图如图34-4所示。</p>
<p>这个类图还是比较简单的，我们来看一下各个类的职责。</p>
<ul>
<li>ClassUtils</li>
</ul>
<p>ClassUtils是工具类，其主要职责是根据一个接口、父类查找到所有的子类。在不考虑效 率的应用中，使用该类可以带来非常好的扩展性。</p>
<ul>
<li>CommandVO</li>
</ul>
<p>CommandVO是命令的值对象，它把一个命令解析为命令名、选项、操作数，例如”ls- l/usr”命令分别解析为getCommandName、getParam、getData三个方法的返回值。</p>
<ul>
<li>CommandEnum</li>
</ul>
<p>CommandEnum是枚举类型，是主要的命令配置文件。为什么需要枚举类型？这是JDK 1.5提供的一个非常好的功能，我们在程序中再讲解如何使用它。</p>
<p>所有的分析都已经完成了，我们来看看程序。程序不复杂，看看类图，应该先写命令的解释，这是项目的核心。我们先来看CommandName抽象类，如代码清单34-1所示。</p>
<p><img data-src="https://raw.githubusercontent.com/lanlan2017/images/master/Blog/Sum/20210930215409.png" alt="image-20210930215409230"></p>
<center>图34-4 完整类图</center>

<p>代码清单34-1 抽象命令名类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">CommandName</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> CommandName nextOperator;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> String <span class="title">handleMessage</span><span class="params">(CommandVO vo)</span></span>&#123;</span><br><span class="line">        <span class="comment">//处理结果</span></span><br><span class="line">        String result = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="comment">//判断是否是自己处理的参数</span></span><br><span class="line">        <span class="keyword">if</span>(vo.getParam().size() == <span class="number">0</span> || vo.getParam().contains (<span class="keyword">this</span>.getOperateParam()))&#123;</span><br><span class="line">            result = <span class="keyword">this</span>.echo(vo);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="keyword">this</span>.nextOperator !=<span class="keyword">null</span>)&#123;</span><br><span class="line">                result = <span class="keyword">this</span>.nextOperator.handleMessage(vo);</span><br><span class="line">                </span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">                result = <span class="string">&quot;命令无法执行&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//设置剩余参数由谁来处理</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setNext</span><span class="params">(CommandName _operator)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.nextOperator = _operator;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//每个处理者都要处理一个后缀参数</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">abstract</span> String <span class="title">getOperateParam</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="comment">//每个处理者都必须实现处理任务</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">abstract</span> String <span class="title">echo</span><span class="params">(CommandVO vo)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>很简单，就是责任链模式中的handler，也就是中控程序，控制一个链应该如何建立。我们再来看3个ls命令族，先看AbstractLS抽象类，如代码清单34-2所示。</p>
<p>代码清单34-2 抽象ls命令</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">AbstractLS</span> <span class="keyword">extends</span> <span class="title">CommandName</span></span>&#123;</span><br><span class="line">    <span class="comment">//默认参数</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> String DEFAULT_PARAM = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="comment">//参数a</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> String A_PARAM =<span class="string">&quot;a&quot;</span>;</span><br><span class="line">    <span class="comment">//参数l</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> String L_PARAM = <span class="string">&quot;l&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>很惊讶，是吗？怎么是个空的抽象类？是的，确实是一个空类，只定义了3个参数名称，它有两个职责：</p>
<ul>
<li>标记ls命令族。</li>
<li>个性化处理。</li>
</ul>
<p>因为现在还没有思考清楚ls有什么个性（可以把命令的选项也认为是其个性化数据）， 所以先写个空类放在这里，以后想清楚了再填写上去，留下一些可扩展的类也许会给未来带来不可估量的优点。</p>
<p>我们再来看ls不带任何参数的命令处理，如代码清单34-3所示。</p>
<p>代码清单34-3 ls命令</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LS</span> <span class="keyword">extends</span> <span class="title">AbstractLS</span> </span>&#123;</span><br><span class="line">    <span class="comment">//最简单的ls命令</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> String <span class="title">echo</span><span class="params">(CommandVO vo)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> FileManager.ls(vo.formatData());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//参数为空</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> String <span class="title">getOperateParam</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.DEFAULT_PARAM;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>太简单了，首先定义了自己能处理什么样的参数，即只能处理不带参数的ls命令，getOperateParam返回一个长度为零的字符串，就是说该类作为链上的一个节点，只处理没有参数的ls命令。echo方法是执行ls命令，通过调用操作系统相关的命令返回结果。我们再来看ls -l命令，如代码清单34-4所示。</p>
<p>代码清单34-4 ls-l命令</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LS_L</span> <span class="keyword">extends</span> <span class="title">AbstractLS</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">protected</span> String <span class="title">echo</span><span class="params">(CommandVO vo)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> FileManager.ls_l(vo.formatData());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//l选项</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> String <span class="title">getOperateParam</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.L_PARAM;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>该类只处理选项为”l”的命令，也非常简单。ls-a命令的处理与此类似，如代码清单34-5 所示。</p>
<p>代码清单34-5 ls-a命令</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LS_A</span> <span class="keyword">extends</span> <span class="title">AbstractLS</span> </span>&#123;</span><br><span class="line">    <span class="comment">//ls -a命令 </span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> String <span class="title">echo</span><span class="params">(CommandVO vo)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> FileManager.ls_a(vo.formatData());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">protected</span> String <span class="title">getOperateParam</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.A_PARAM;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这3个实现类都关联到了FileManager，这个类有什么用呢？它是负责与操作系统交互的。要把UNIX的命令迁移到Windows上运行，就需要调用Windows的低层函数，实现起来较复杂，而且和我们本章要讲的内容没有太大关系，所以这里采用示例性代码代替，如代码清单34-6所示。</p>
<p>代码清单34-6 文件管理类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FileManager</span> </span>&#123;</span><br><span class="line">    <span class="comment">//ls命令</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">ls</span><span class="params">(String path)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;file1\nfile2\nfile3\nfile4&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//ls-l命令 </span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">ls_l</span><span class="params">(String path)</span></span>&#123;</span><br><span class="line">        String str = <span class="string">&quot;drw-rw-rw root system 1024 2009-8-20 10:23 file1\n&quot;</span>;</span><br><span class="line">        str = str + <span class="string">&quot;drw-rw-rw root system 1024 2009-8-20 10:23 file2\n&quot;</span>;</span><br><span class="line">        str = str + <span class="string">&quot;drw-rw-rw root system 1024 2009-8-20 10:23 file3&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span> str;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//ls -a命令 </span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">ls_a</span><span class="params">(String path)</span></span>&#123;</span><br><span class="line">        String str = <span class="string">&quot;.\n..\nfile1\nfile2\nfile3&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span> str;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>以上都是比较简单的方法，大家有兴趣可以自己实现一下，以下提供3种思路：</p>
<ul>
<li>通过java.io.File类自己封装出类似UNIX的返回格式。</li>
<li>通过java.lang.Runtime类的exec方法执行dos的dir命令，产生类似的ls结果。</li>
<li>通过JNI（Java Native Interface）来调用与操作系统有关的动态链接库，当然前提是需 要自己写一个动态链接库文件。</li>
</ul>
<p>3个具体的命令都已经解析完毕，我们再来看看如何建立一条处理链，由于建链的任务 已经移植到抽象命令类，我们就先来看抽象类Command，如代码清单34-7所示。</p>
<p>代码清单34-7 抽象命令</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Command</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> String <span class="title">execute</span><span class="params">(CommandVO vo)</span></span>;</span><br><span class="line">    <span class="comment">//建立链表</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">final</span> List&lt;? extends CommandName&gt; buildChain(Class&lt;? extends CommandName&gt; abstractClass)&#123;</span><br><span class="line">        <span class="comment">//取出所有的命令名下的子类</span></span><br><span class="line">        List&lt;Class&gt; classes = ClassUtils.getSonClass(abstractClass);</span><br><span class="line">        <span class="comment">//存放命令的实例，并建立链表关系</span></span><br><span class="line">        List&lt;CommandName&gt; commandNameList = <span class="keyword">new</span> ArrayList&lt;CommandName&gt;();</span><br><span class="line">        <span class="keyword">for</span>(Class c:classes)&#123;</span><br><span class="line">            CommandName commandName =<span class="keyword">null</span>;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="comment">//产生实例</span></span><br><span class="line">                commandName = (CommandName)Class.forName (c.getName()) .newInstance();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">                <span class="comment">// TODO</span></span><br><span class="line">            异常处理 &#125;</span><br><span class="line">            <span class="comment">//建立链表</span></span><br><span class="line">            <span class="keyword">if</span>(commandNameList.size()&gt;<span class="number">0</span>)&#123;</span><br><span class="line">                commandNameList.get(commandNameList.size()-<span class="number">1</span>).setNext (commandName);</span><br><span class="line">            &#125;</span><br><span class="line">            commandNameList.add(commandName);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> commandNameList;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Command抽象类有两个作用：一是定义命令的执行方法，二是负责命令族（责任链）的 建立。其中buildChain方法负责建立一个责任链，它通过接收一个抽象的命令族类就可以建 立一条命令解析链，如传递AbstarctLS类就可以建立一条解析ls命令族的责任链，请读者注意 如下这句代码：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">commandName = (CommandName)Class.forName(c.getName()).newInstance();</span><br></pre></td></tr></table></figure>
<p>在一个遍历中，类中的每个元素都是一个类名，然后根据类名产生一个实例，它会抛出异常，例如类文件不存在、初始化失败等，读者在设计时要实现该部分的异常。我们再来想一下，每个实现类的类名是如何取得的呢？看下面这句代码：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Class&gt; classes = ClassUtils.getSonClass(abstractClass);</span><br></pre></td></tr></table></figure>
<p>根据一个父类取得所有子类，是一个非常好的工具类，其实现如代码清单34-8所示。</p>
<p>代码清单34-8 根据父类获得子类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ClassUtils</span> </span>&#123;</span><br><span class="line">    <span class="comment">//根据父类查找到所有的子类，默认情况是子类和父类都在同一个包名下</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> List&lt;Class&gt; <span class="title">getSonClass</span><span class="params">(Class fatherClass)</span></span>&#123;</span><br><span class="line">        <span class="comment">//定义一个返回值</span></span><br><span class="line">        List&lt;Class&gt; returnClassList = <span class="keyword">new</span> ArrayList&lt;Class&gt;();</span><br><span class="line">        <span class="comment">//获得包名称</span></span><br><span class="line">        String packageName = fatherClass.getPackage().getName();</span><br><span class="line">        <span class="comment">//获得包中的所有类</span></span><br><span class="line">        List&lt;Class&gt; packClasses = getClasses(packageName);</span><br><span class="line">        <span class="comment">//判断是否是子类</span></span><br><span class="line">        <span class="keyword">for</span>(Class c:packClasses)&#123;</span><br><span class="line">            <span class="keyword">if</span>(fatherClass.isAssignableFrom(c) &amp;&amp; !fatherClass.equals(c))&#123;</span><br><span class="line">                returnClassList.add(c);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> returnClassList;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//从一个包中查找出所有的类，在jar包中不能查找</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> List&lt;Class&gt; <span class="title">getClasses</span><span class="params">(String packageName)</span> </span>&#123;</span><br><span class="line">        ClassLoader classLoader = Thread.currentThread() .getContextClassLoader();</span><br><span class="line">        String path = packageName.replace(<span class="string">&#x27;.&#x27;</span>, <span class="string">&#x27;/&#x27;</span>);</span><br><span class="line">        Enumeration&lt;URL&gt; resources = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            resources = classLoader.getResources(path);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            <span class="comment">// TODO</span></span><br><span class="line">            Auto-generated <span class="keyword">catch</span> block e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        List&lt;File&gt; dirs = <span class="keyword">new</span> ArrayList&lt;File&gt;();</span><br><span class="line">        <span class="keyword">while</span> (resources.hasMoreElements()) &#123;</span><br><span class="line">            URL resource = resources.nextElement();</span><br><span class="line">            dirs.add(<span class="keyword">new</span> File(resource.getFile()));</span><br><span class="line">        &#125;</span><br><span class="line">        ArrayList&lt;Class&gt; classes = <span class="keyword">new</span> ArrayList&lt;Class&gt;();</span><br><span class="line">        <span class="keyword">for</span> (File directory : dirs) &#123;</span><br><span class="line">            classes.addAll(findClasses(directory, packageName));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> classes;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> List&lt;Class&gt; <span class="title">findClasses</span><span class="params">(File directory, String packageName)</span> </span>&#123;</span><br><span class="line">        List&lt;Class&gt; classes = <span class="keyword">new</span> ArrayList&lt;Class&gt;();</span><br><span class="line">        <span class="keyword">if</span> (!directory.exists()) &#123;</span><br><span class="line">            <span class="keyword">return</span> classes;</span><br><span class="line">        &#125;</span><br><span class="line">        File[] files = directory.listFiles();</span><br><span class="line">        <span class="keyword">for</span> (File file : files) &#123;</span><br><span class="line">            <span class="keyword">if</span> (file.isDirectory()) &#123;</span><br><span class="line">                <span class="keyword">assert</span> !file.getName().contains(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">                classes.addAll(findClasses(file, packageName + <span class="string">&quot;.&quot;</span> + file.getName()));</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (file.getName().endsWith(<span class="string">&quot;.class&quot;</span>)) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    classes.add(Class.forName(packageName + <span class="string">&#x27;.&#x27;</span> + file.getName() .substring(<span class="number">0</span>, file.getName().length() - <span class="number">6</span>)));</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> classes;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这个类请大家谨慎使用，在核心的应用中尽量不要使用该工具，它会严重影响性能。</p>
<p>再来看LSCommand类的实现，如代码清单34-9所示。</p>
<p>代码清单34-9 具体的ls命令</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LSCommand</span> <span class="keyword">extends</span> <span class="title">Command</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">execute</span><span class="params">(CommandVO vo)</span></span>&#123;</span><br><span class="line">        <span class="comment">//返回链表的首节点</span></span><br><span class="line">        CommandName firstNode = <span class="keyword">super</span>.buildChain(AbstractLS.class).get(<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span> firstNode.handleMessage(vo);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>很简单的方法，先建立一个命令族的责任链，然后找到首节点调用。在该类中我们使用CommandVO类，它是一个封装对象，其代码如代码清单34-10所示。</p>
<p>代码清单34-10 命令对象</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CommandVO</span> </span>&#123;</span><br><span class="line">    <span class="comment">//定义参数名与参数的分隔符号,一般是空格</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> String DIVIDE_FLAG =<span class="string">&quot; &quot;</span>;</span><br><span class="line">    <span class="comment">//定义参数前的符号，Unix一般是-,如ls</span></span><br><span class="line">    -la <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> String PREFIX=<span class="string">&quot;-&quot;</span>;</span><br><span class="line">    <span class="comment">//命令名，如ls、du</span></span><br><span class="line">    <span class="keyword">private</span> String commandName = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="comment">//参数列表</span></span><br><span class="line">    <span class="keyword">private</span> ArrayList&lt;String&gt; paramList = <span class="keyword">new</span> ArrayList&lt;String&gt;();</span><br><span class="line">    <span class="comment">//操作数列表</span></span><br><span class="line">    <span class="keyword">private</span> ArrayList&lt;String&gt; dataList = <span class="keyword">new</span> ArrayList&lt;String&gt;();</span><br><span class="line">    <span class="comment">//通过构造函数传递进来命令</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CommandVO</span><span class="params">(String commandStr)</span></span>&#123;</span><br><span class="line">        <span class="comment">//常规判断</span></span><br><span class="line">        <span class="keyword">if</span>(commandStr != <span class="keyword">null</span> &amp;&amp; commandStr.length() !=<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="comment">//根据分隔符号拆分出执行符号</span></span><br><span class="line">            String[] complexStr = commandStr.split(CommandVO.DIVIDE_FLAG);</span><br><span class="line">            <span class="comment">//第一个参数是执行符号</span></span><br><span class="line">            <span class="keyword">this</span>.commandName = complexStr[<span class="number">0</span>];</span><br><span class="line">            <span class="comment">//把参数放到List中</span></span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;complexStr.length;i++)&#123;</span><br><span class="line">                String str = complexStr[i];</span><br><span class="line">                <span class="comment">//包含前缀符号，认为是参数</span></span><br><span class="line">                <span class="keyword">if</span>(str.indexOf(CommandVO.PREFIX)==<span class="number">0</span>)&#123;</span><br><span class="line">                    <span class="keyword">this</span>.paramList.add(str.replace (CommandVO.PREFIX, <span class="string">&quot;&quot;</span>).trim());</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span>&#123;</span><br><span class="line">                    <span class="keyword">this</span>.dataList.add(str.trim());</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="comment">//传递的命令错误</span></span><br><span class="line">            System.out.println(<span class="string">&quot;命令解析失败，必须传递一个命令才能执行！&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//得到命令名</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getCommandName</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.commandName;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//获得参数</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ArrayList&lt;String&gt; <span class="title">getParam</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="comment">//为了方便处理空参数</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">this</span>.paramList.size() ==<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">this</span>.paramList.add(<span class="string">&quot;&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ArrayList(<span class="keyword">new</span> HashSet(<span class="keyword">this</span>.paramList));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//获得操作数</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ArrayList&lt;String&gt; <span class="title">getData</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.dataList;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>CommandVO解析一个命令，规定一个命令必须有3项：命令名、选项、操作数。如果没 有呢？那就以长度为零的字符串代替，通过这样的一个约定可以大大降低命令解析的开发工 作。注意getParam参数中的返回值：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> ArrayList(<span class="keyword">new</span> HashSet(<span class="keyword">this</span>.paramList));</span><br></pre></td></tr></table></figure>
<p>为什么要这么处理？HashSet具有值唯一的优点，这样处理就是为了避免出现两个相同的参数，比如对于”ls-l-l-s”这样的命令，通过getParam返回的参数是几个呢？回答是两个：l 选项和s选项。</p>
<p>我们再来看Invoker类，它是负责命令分发的类，如代码清单34-11所示。</p>
<p>代码清单34-11 命令分发</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Invoker</span> </span>&#123;</span><br><span class="line">    <span class="comment">//执行命令</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">exec</span><span class="params">(String _commandStr)</span></span>&#123;</span><br><span class="line">        <span class="comment">//定义返回值</span></span><br><span class="line">        String result = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="comment">//首先解析命令</span></span><br><span class="line">        CommandVO vo = <span class="keyword">new</span> CommandVO(_commandStr);</span><br><span class="line">        <span class="comment">//检查是否支持该命令</span></span><br><span class="line">        <span class="keyword">if</span>(CommandEnum.getNames().contains(vo.getCommandName()))&#123;</span><br><span class="line">            <span class="comment">//产生命令对象</span></span><br><span class="line">            String className = CommandEnum.valueOf (vo.getCommandName()) .getValue();</span><br><span class="line">            </span><br><span class="line">            Command command;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                command = (Command)Class.forName(className).newInstance();</span><br><span class="line">                result = command.execute(vo);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">catch</span>(Exception e)&#123;</span><br><span class="line">                <span class="comment">// TODO</span></span><br><span class="line">            异常处理 &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            result = <span class="string">&quot;无法执行命令，请检查命令格式&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>实现也是比较简单的，从CommandEnum中获得命令与命令类的配置信息，然后建立一个命令实例，调用其execute方法，完成命令的执行操作。CommandEnum类是一个枚举类型，如代码清单34-12所示。</p>
<p>代码清单34-12 命令配置对象</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">enum</span> <span class="title">CommandEnum</span> </span>&#123;</span><br><span class="line">    ls(<span class="string">&quot;com.cbf4life.common.command.LSCommand&quot;</span>);</span><br><span class="line">    <span class="keyword">private</span> String value = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="comment">//定义构造函数，目的是Data(value)类型的相匹配</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">CommandEnum</span><span class="params">(String value)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.value = value;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getValue</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.value;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//返回所有的enum对象</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> List&lt;String&gt; <span class="title">getNames</span><span class="params">()</span></span>&#123;</span><br><span class="line">        CommandEnum[] commandEnum = CommandEnum.values();</span><br><span class="line">        List&lt;String&gt; names = <span class="keyword">new</span> ArrayList&lt;String&gt;();</span><br><span class="line">        <span class="keyword">for</span>(CommandEnum c:commandEnum)&#123;</span><br><span class="line">            names.add(c.name());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> names;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>为什么要用枚举类型？用一个接口来管理也是很容易实现的。注意CommandEnum中的构造函数CommandEnum(String value)和getValue类，没有新建一个Enum对象，但是可以直接使用CommandEnum.ls.getValue方法获得值，这就是Enum类型的独特地方。再看下面：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ls(<span class="string">&quot;com.cbf4life.common.command.LSCommand&quot;</span>);</span><br></pre></td></tr></table></figure>
<p>是不是很特别？是的，枚举的基本功能就是定义默认可选值，但是Java中的枚举功能又增强了很多，可以添加方法和属性，基本上就是一个特殊的类。若要详细了解Enum，读者可以翻阅一下相关语法书。</p>
<p>现在剩下的工作就是写一个Client类，然后看看运行情况如何，如代码清单34-13所示。</p>
<p>代码清单34-13 场景类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Client</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        Invoker invoker = <span class="keyword">new</span> Invoker();</span><br><span class="line">        <span class="keyword">while</span>(<span class="keyword">true</span>)&#123;</span><br><span class="line">            <span class="comment">//UNIX下的默认提示符号</span></span><br><span class="line">            System.out.print(<span class="string">&quot;#&quot;</span>);</span><br><span class="line">            <span class="comment">//捕获输出</span></span><br><span class="line">            String input = (<span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> InputStreamReader (System.in))).readLine();</span><br><span class="line">            <span class="comment">//输入quit或exit则退出</span></span><br><span class="line">            <span class="keyword">if</span>(input.equals(<span class="string">&quot;quit&quot;</span>) || input.equals(<span class="string">&quot;exit&quot;</span>))&#123;</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(invoker.exec(input));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Client也很简单，通过一个while循环允许使用者持续输入，然后打印出返回值，运行结 果如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">#ls </span><br><span class="line">file1 </span><br><span class="line">file2 </span><br><span class="line">file3 </span><br><span class="line">file4 </span><br><span class="line">#ls -l </span><br><span class="line">drw-rw-rw root system 1024 2009-8-20 10:23 file1 </span><br><span class="line">drw-rw-rw root system 1024 2009-8-20 10:23 file2 </span><br><span class="line">drw-rw-rw root system 1024 2009-8-20 10:23 file3 </span><br><span class="line">#ls -a</span><br><span class="line">.</span><br><span class="line">.</span><br><span class="line">.</span><br><span class="line">file1 </span><br><span class="line">file2 </span><br><span class="line">file3 </span><br><span class="line">#quit</span><br></pre></td></tr></table></figure>
<p>我们已经实现了在Windows下操作UNIX命令的功能，但是仅仅一个ls命令族是不够的， 我们要扩展，把一百多个命令都扩展出来，怎么扩展呢？现在增加一个df命令族，显示磁盘的大小，只要增加类图就成，如图34-5所示。</p>
<p><img data-src="https://raw.githubusercontent.com/lanlan2017/images/master/Blog/Sum/20211001143359.png" alt="image-20211001143359455"></p>
<center>图34-5 扩展df命令后的类图</center>

<p>仅仅增加了粗框的部分，也就是增加DFCommand、AbstractDF以及实现类就可以完成扩展功能。先看AbstractDF代码，如代码清单34-14所示。<br>代码清单34-14 df命令的抽象类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">AbstractDF</span> <span class="keyword">extends</span> <span class="title">CommandName</span> </span>&#123;</span><br><span class="line">    <span class="comment">//默认参数</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> String DEFAULT_PARAM = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="comment">//参数k</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> String K_PARAM = <span class="string">&quot;k&quot;</span>;</span><br><span class="line">    <span class="comment">//参数g</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> String G_PARAM = <span class="string">&quot;g&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>与前面一样的功能，定义选项名称。接下来是三个实现类，都非常简单，如代码清单34-15所示。</p>
<p>代码清单34-15 df命令的具体实现类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DF</span> <span class="keyword">extends</span> <span class="title">AbstractDF</span></span>&#123;</span><br><span class="line">    <span class="comment">//定义一下自己能处理什么参数</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> String <span class="title">getOperateParam</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.DEFAULT_PARAM;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//命令处理</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> String <span class="title">echo</span><span class="params">(CommandVO vo)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> DiskManager.df();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DF_K</span> <span class="keyword">extends</span> <span class="title">AbstractDF</span></span>&#123;</span><br><span class="line">    <span class="comment">//定义一下自己能处理什么参数</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> String <span class="title">getOperateParam</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.K_PARAM;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//命令处理</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> String <span class="title">echo</span><span class="params">(CommandVO vo)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> DiskManager.df_k();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DF_G</span> <span class="keyword">extends</span> <span class="title">AbstractDF</span></span>&#123;</span><br><span class="line">    <span class="comment">//定义一下自己能处理什么参数</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> String <span class="title">getOperateParam</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.G_PARAM;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//命令处理</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> String <span class="title">echo</span><span class="params">(CommandVO vo)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> DiskManager.df_g();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>每个选项的实现类都定义了自己能解析什么命令，然后通过echo方法返回执行结果。在三个实现类中都与DiskManager类有关联关系，该类负责与操作系统有关的功能，是必须要实现的，其示例代码如代码清单34-16所示。</p>
<p>代码清单34-16 磁盘管理</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DiskManager</span> </span>&#123;</span><br><span class="line">    <span class="comment">//默认的计算大小</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">df</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;/\t10485760\n/usr\t104857600\n/home\t1048576000\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//按照kb来计算</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">df_k</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;/\t10240\n/usr\t102400\n/home\tt10240000\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//按照gb计算</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">df_g</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;/\t10\n/usr\t100\n/home\tt10000\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>以上为示例代码，若要实际计算磁盘大小，可以使用JNI的方式或者执行操作系统的命令的方式获得，特别是JDK 1.6提供了获得一个root目录大小的方法。</p>
<p>然后再增加一个DFCommand命令，负责执行命令，如代码清单34-17所示。</p>
<p>代码清单34-17 可执行的df命令</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DFCommand</span> <span class="keyword">extends</span> <span class="title">Command</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">execute</span><span class="params">(CommandVO vo)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.buildChain(AbstractDF.class).get(<span class="number">0</span>).handleMessage(vo);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>最后一步，修改一下CommandEnum配置，增加一个枚举项，如代码清单34-18所示。</p>
<p>代码清单34-18 增加后的枚举项</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">enum</span> <span class="title">CommandEnum</span> </span>&#123;</span><br><span class="line">    ls(<span class="string">&quot;com.cbf4life.common.command.LSCommand&quot;</span>), df(<span class="string">&quot;com.cbf4life.common.command.DFCommand&quot;</span>);</span><br><span class="line">    <span class="keyword">private</span> String value = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="comment">//定义构造函数，目的是Data(value)类型的相匹配</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">CommandEnum</span><span class="params">(String value)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.value = value;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getValue</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.value;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//返回所有的enum对象</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> List&lt;String&gt; <span class="title">getNames</span><span class="params">()</span></span>&#123;</span><br><span class="line">        CommandEnum[] commandEnum = CommandEnum.values();</span><br><span class="line">        List&lt;String&gt; names = <span class="keyword">new</span> ArrayList&lt;String&gt;();</span><br><span class="line">        <span class="keyword">for</span>(CommandEnum c:commandEnum)&#123;</span><br><span class="line">            names.add(c.name());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> names;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>运行结果如下所示：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">#ls </span><br><span class="line">file1 </span><br><span class="line">file2 </span><br><span class="line">file3 </span><br><span class="line">file4 </span><br><span class="line">#df / 10485760 </span><br><span class="line">/usr 104857600 </span><br><span class="line">/home 1048576000 </span><br><span class="line">#df -k </span><br><span class="line">/ 10240 </span><br><span class="line">/usr 102400 </span><br><span class="line">/home t10240000 </span><br><span class="line">#df -g </span><br><span class="line">/ 10 </span><br><span class="line">/usr 100 </span><br><span class="line">/home t10000 </span><br><span class="line">#</span><br></pre></td></tr></table></figure>
<p>仅仅增加类就完成了变更，这才是我们要的结果：对修改关闭，对扩展开放。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/JavaReadingNotes/page/49/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/JavaReadingNotes/">1</a><span class="space">&hellip;</span><a class="page-number" href="/JavaReadingNotes/page/49/">49</a><span class="page-number current">50</span><a class="page-number" href="/JavaReadingNotes/page/51/">51</a><span class="space">&hellip;</span><a class="page-number" href="/JavaReadingNotes/page/188/">188</a><a class="extend next" rel="next" href="/JavaReadingNotes/page/51/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 2018 – 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">蓝蓝</span>
</div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
      <span>站点总字数：</span>
    <span title="站点总字数">5.8m</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span>站点阅读时长 &asymp;</span>
    <span title="站点阅读时长">88:01</span>
  </span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@next-theme/pjax@0.5.0/pjax.min.js" integrity="sha256-3NkoLDrmHLTYj7csHIZSr0MHAFTXth7Ua/DDt4MRUAg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js" integrity="sha256-yt2kYMy0w8AbtF89WXb2P1rfjcP/HTHLT7097U8Y5b8=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/lozad@1.16.0/dist/lozad.min.js" integrity="sha256-mOFREFhqmHeQbXpK2lp4nA3qooVgACfh88fpJftLBbc=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/pangu@4.0.7/dist/browser/pangu.min.js" integrity="sha256-j+yj56cdEY2CwkVtGyz18fNybFGpMGJ8JxG3GSyO2+I=" crossorigin="anonymous"></script>
<script src="/JavaReadingNotes/js/comments.js"></script><script src="/JavaReadingNotes/js/utils.js"></script><script src="/JavaReadingNotes/js/motion.js"></script><script src="/JavaReadingNotes/js/next-boot.js"></script><script src="/JavaReadingNotes/js/bookmark.js"></script><script src="/JavaReadingNotes/js/pjax.js"></script>

  
<script src="https://cdn.jsdelivr.net/npm/hexo-generator-searchdb@1.4.0/dist/search.js" integrity="sha256-vXZMYLEqsROAXkEw93GGIvaB2ab+QW6w3+1ahD9nXXA=" crossorigin="anonymous"></script>
<script src="/JavaReadingNotes/js/third-party/search/local-search.js"></script>



  <script src="/JavaReadingNotes/js/third-party/fancybox.js"></script>

  <script src="/JavaReadingNotes/js/third-party/pace.js"></script>

  




  

  <script class="next-config" data-name="enableMath" type="application/json">false</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"none","js":{"url":"https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js","integrity":"sha256-r+3itOMtGGjap0x+10hu6jW/gZCzxHsoKrOd7gyRSGY="}}</script>
<script src="/JavaReadingNotes/js/third-party/math/mathjax.js"></script>


  <script src="https://cdn.jsdelivr.net/npm/quicklink@2.2.0/dist/quicklink.umd.js" integrity="sha256-4kQf9z5ntdQrzsBC3YSHnEz02Z9C1UeW/E9OgnvlzSY=" crossorigin="anonymous"></script>
  <script class="next-config" data-name="quicklink" type="application/json">{"enable":true,"home":true,"archive":true,"delay":true,"timeout":3000,"priority":true,"url":"https://lanlan2017.github.io/JavaReadingNotes/page/50/"}</script>
  <script src="/JavaReadingNotes/js/third-party/quicklink.js"></script>
<script class="next-config" data-name="waline" type="application/json">{"lang":null,"enable":true,"serverURL":"https://waline-test-mzjszagu6-lanlan2017.vercel.app","placeholder":"填写您的邮箱以便接收回复提醒,填写您个人网站地址以便为您增加访问量","avatar":"mm","pageSize":10,"visitor":false,"comment_count":true,"requiredFields":[],"meta":["nick","mail","link"],"libUrl":"https://cdn.jsdelivr.net/npm/@waline/client/dist/Waline.min.js","el":"#waline-comments","path":"/JavaReadingNotes/page/50/"}</script>
<script>
document.addEventListener('page:loaded', () => {
  NexT.utils.loadComments(CONFIG.waline.el).then(() => 
    NexT.utils.getScript(CONFIG.waline.libUrl, { condition: window.Waline })
  ).then(() => {
    new Waline(CONFIG.waline);
  });
});
</script>
</body>
</html>
