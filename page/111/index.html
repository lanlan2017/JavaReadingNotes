<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)">
<meta name="generator" content="Hexo 5.4.0">

<link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
  <link rel="apple-touch-icon" sizes="180x180" href="/JavaReadingNotes/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/JavaReadingNotes/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/JavaReadingNotes/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/JavaReadingNotes/images/logo.svg" color="#222">
  <meta name="google-site-verification" content="_Sly-yzHYmALHXzjFpPWsodMrjBSphw7bfRbMUH80Qc">
  <meta name="msvalidate.01" content="B1CFD346B8DEBBFE0C983C2AF8955531">
  <meta name="baidu-site-verification" content="vkMTwK56xr">

<link rel="stylesheet" href="/JavaReadingNotes/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css" integrity="sha256-mUZM63G8m73Mcidfrv5E+Y61y7a12O5mW4ezU3bxqW4=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css" integrity="sha256-Vzbj7sDDS/woiFS3uNKo8eIuni59rjyNGtXfstRzStA=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/themes/blue/pace-theme-minimal.css">
  <script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script>

<script class="next-config" data-name="main" type="application/json">{"hostname":"lanlan2017.github.io","root":"/JavaReadingNotes/","images":"/JavaReadingNotes/images","scheme":"Gemini","darkmode":true,"version":"8.8.2","exturl":false,"sidebar":{"position":"right","display":"post","padding":18,"offset":12},"copycode":true,"bookmark":{"enable":true,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":true,"pangu":true,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/JavaReadingNotes/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/JavaReadingNotes/js/config.js"></script>
<meta name="description" content="好好学习，天天向上">
<meta property="og:type" content="website">
<meta property="og:title" content="蓝蓝站点">
<meta property="og:url" content="https://lanlan2017.github.io/JavaReadingNotes/page/111/index.html">
<meta property="og:site_name" content="蓝蓝站点">
<meta property="og:description" content="好好学习，天天向上">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="蓝蓝">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://lanlan2017.github.io/JavaReadingNotes/page/111/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"page/111/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>蓝蓝站点</title>
  

  <script src="/JavaReadingNotes/js/third-party/analytics/baidu-analytics.js"></script>
  <script async src="https://hm.baidu.com/hm.js?dadeb188eb14ccde0b25a19230c429b5"></script>


<link rel="dns-prefetch" href="https://waline-test-mzjszagu6-lanlan2017.vercel.app">
  <noscript>
    <link rel="stylesheet" href="/JavaReadingNotes/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/JavaReadingNotes/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">蓝蓝站点</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">Java读书笔记</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home"><a href="/JavaReadingNotes/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li>
        <li class="menu-item menu-item-dir"><a href="/JavaReadingNotes/dir/" rel="section"><i class="fa fa-sitemap fa-fw"></i>目录</a></li>
        <li class="menu-item menu-item-categories"><a href="/JavaReadingNotes/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li>
        <li class="menu-item menu-item-archives"><a href="/JavaReadingNotes/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li>
        <li class="menu-item menu-item-tags"><a href="/JavaReadingNotes/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="蓝蓝"
      src="/JavaReadingNotes/images/avatar.gif">
  <p class="site-author-name" itemprop="name">蓝蓝</p>
  <div class="site-description" itemprop="description">好好学习，天天向上</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/JavaReadingNotes/archives/">
          <span class="site-state-item-count">1871</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/JavaReadingNotes/categories/">
        <span class="site-state-item-count">626</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://lanlan2017.github.io/todo/" title="todo → https:&#x2F;&#x2F;lanlan2017.github.io&#x2F;todo&#x2F;"><i class="fa fa-check-square fa-fw"></i>todo</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://lanlan2017.github.io/links/" title="links → https:&#x2F;&#x2F;lanlan2017.github.io&#x2F;links&#x2F;"><i class="fa fa-link fa-fw"></i>links</a>
      </span>
  </div>
  <div class="cc-license site-overview-item animated" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" class="cc-opacity" rel="noopener" target="_blank"><img src="https://cdn.jsdelivr.net/npm/@creativecommons/vocabulary@2020.11.3/assets/license_badges/small/by_nc_sa.svg" alt="Creative Commons"></a>
  </div>



        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="返回顶部">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="reading-progress-bar"></div>
  <a role="button" class="book-mark-link book-mark-link-fixed"></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://lanlan2017.github.io/JavaReadingNotes/6578749e/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/JavaReadingNotes/images/avatar.gif">
      <meta itemprop="name" content="蓝蓝">
      <meta itemprop="description" content="好好学习，天天向上">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="蓝蓝站点">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/JavaReadingNotes/6578749e/" class="post-title-link" itemprop="url">8.4.5 基于注解的 零配置 方式 9. 切入点指示符</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-09-05 16:41:20" itemprop="dateCreated datePublished" datetime="2019-09-05T16:41:20+08:00">2019-09-05</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2020-02-07 01:34:58" itemprop="dateModified" datetime="2020-02-07T01:34:58+08:00">2020-02-07</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/2-%E8%BD%BB%E9%87%8F%E7%BA%A7Java-EE%E4%BC%81%E4%B8%9A%E5%BA%94%E7%94%A8%E5%AE%9E%E6%88%98-%E7%AC%AC5%E7%89%88/" itemprop="url" rel="index"><span itemprop="name">2 轻量级Java EE企业应用实战(第5版)</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/2-%E8%BD%BB%E9%87%8F%E7%BA%A7Java-EE%E4%BC%81%E4%B8%9A%E5%BA%94%E7%94%A8%E5%AE%9E%E6%88%98-%E7%AC%AC5%E7%89%88/%E7%AC%AC8%E7%AB%A0-%E6%B7%B1%E5%85%A5%E4%BD%BF%E7%94%A8Spring/" itemprop="url" rel="index"><span itemprop="name">第8章 深入使用Spring</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/2-%E8%BD%BB%E9%87%8F%E7%BA%A7Java-EE%E4%BC%81%E4%B8%9A%E5%BA%94%E7%94%A8%E5%AE%9E%E6%88%98-%E7%AC%AC5%E7%89%88/%E7%AC%AC8%E7%AB%A0-%E6%B7%B1%E5%85%A5%E4%BD%BF%E7%94%A8Spring/8-4-Spring%E7%9A%84AOP/" itemprop="url" rel="index"><span itemprop="name">8.4 Spring的AOP</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/2-%E8%BD%BB%E9%87%8F%E7%BA%A7Java-EE%E4%BC%81%E4%B8%9A%E5%BA%94%E7%94%A8%E5%AE%9E%E6%88%98-%E7%AC%AC5%E7%89%88/%E7%AC%AC8%E7%AB%A0-%E6%B7%B1%E5%85%A5%E4%BD%BF%E7%94%A8Spring/8-4-Spring%E7%9A%84AOP/8-4-5-%E5%9F%BA%E4%BA%8E%E6%B3%A8%E8%A7%A3%E7%9A%84-%E9%9B%B6%E9%85%8D%E7%BD%AE-%E6%96%B9%E5%BC%8F/" itemprop="url" rel="index"><span itemprop="name">8.4.5 基于注解的 零配置 方式</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
    <span class="post-meta-item-icon">
      <i class="far fa-comment"></i>
    </span>
    <span class="post-meta-item-text">Waline：</span>
  
    <a title="waline" href="/JavaReadingNotes/6578749e/#waline-comments" itemprop="discussionUrl">
      <span class="post-comments-count waline-comment-count" id="/JavaReadingNotes/6578749e/" data-xid="/JavaReadingNotes/6578749e/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>3k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>3 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="8-4-5-基于注解的-零配置-方式-9-切入点指示符"><a href="#8-4-5-基于注解的-零配置-方式-9-切入点指示符" class="headerlink" title="8.4.5 基于注解的 零配置 方式 9. 切入点指示符"></a>8.4.5 基于注解的 零配置 方式 9. 切入点指示符</h1><p>前面定义切入点表达式时大量使用了<code>execution</code>表达式,其中**<code>execution</code>就是一个切入点指示符**,<code>Spring AOP</code>仅支持部分<code>AspectJ</code>的切入点指示符,但<code>Spring AOP</code>还额外支持一个<code>bean</code>切入点指示符。<br>不仅如此,因为<code>Spring AOP</code>只支持使用方法调用作为连接点,所以**<code>Spring AOP</code>的切入点指示符仅匹配方法执行的连接点**。<br>完整的<code>AspectJ</code>切入点语言支持大量的切入点指示符,但是<code>Spring</code>并不支持它们。<code>Spring AOP</code>不支持的切入点指示符有<code>call</code>, <code>get</code>、<code>set</code>、 <code>preinitialization</code>、 <code>staticinitialization</code>、<code>initialization</code>、 <code>handler</code>、 <code>adviceexecution</code>、 <code>withincode</code>、<code>cflow</code>、 <code>cflowbelow</code>、<code>if</code>、<code>@this</code>和<code>withincode</code>。一旦在<code>Spring AOP</code>中使用这些指示符,将会导致抛出<code>llegalArgumentException</code>异常。</p>
<h1 id="Spring-AOP支持的切入点指示符"><a href="#Spring-AOP支持的切入点指示符" class="headerlink" title="Spring AOP支持的切入点指示符"></a>Spring AOP支持的切入点指示符</h1><p><code>Spring AOP</code>一共支持如下几种切入点指示符。</p>
<h2 id="execution切入点指示符"><a href="#execution切入点指示符" class="headerlink" title="execution切入点指示符"></a>execution切入点指示符</h2><p><code>execution</code>:用于匹配执行方法的连接点,这是<code>Spring AOP</code>中最主要的切入点指示符。该切入点的用法也相对复杂,</p>
<h3 id="execution表达式的格式"><a href="#execution表达式的格式" class="headerlink" title="execution表达式的格式"></a>execution表达式的格式</h3><p><code>execution</code>表达式的格式如下:<br><code>execution(modifiers-pattern? ret-type-pattern declaring-type-pattern? name-pattern(param-pattern) throws-pattern?</code><br>上面格式中的<code>execution</code>是不变的,用于作为<code>execution</code>表达式的开头,整个表达式中各部分的解释如下。</p>
<table>
<thead>
<tr>
<th align="left">表达式的各组成部分</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>modifiers-pattern</code></td>
<td align="left">指定<code>方法的修饰符</code>,支持通配符,该部分可省略。</td>
</tr>
<tr>
<td align="left"><code>ret-type-pattern</code></td>
<td align="left">指定<code>方法的返回值类型</code>,支持通配符,可以使用<code>&quot;*&quot;</code>通配符来匹配所有的返回值类型。</td>
</tr>
<tr>
<td align="left"><code>declaring-type-pattern</code></td>
<td align="left">指定<code>方法所属的类</code>,支持通配符,该部分可省略。</td>
</tr>
<tr>
<td align="left"><code>name-pattern</code></td>
<td align="left">指定匹配指定的<code>方法名</code>,支持通配符,可以使用<code>&quot;*&quot;</code>通配符来匹配所有方法。</td>
</tr>
<tr>
<td align="left"><code>param-pattern</code></td>
<td align="left">指定方法声明中的<code>形参列表</code>.</td>
</tr>
<tr>
<td align="left"><code>throws- pattern</code></td>
<td align="left">指定<code>方法声明抛出的异常</code>,支持通配符,该部分可省略</td>
</tr>
</tbody></table>
<h2 id="param-pattern支持的通配符"><a href="#param-pattern支持的通配符" class="headerlink" title="param-pattern支持的通配符"></a>param-pattern支持的通配符</h2><p><code>param-pattern</code>支持两个通配符,即<code>&quot;*&quot;</code>和”<code>..</code>“<br>其中<code>&quot;*&quot;</code>代表个任意类型的参数,而<code>&quot;.&quot;</code>代表零个或多个任意类型的参数。<br>例如:</p>
<ul>
<li><code>()</code>匹配了一个不接受任何参数的方法,</li>
<li><code>(..)</code>匹配了一个接受任意数量参数的方法(零个或更多),</li>
<li><code>(*)</code>匹配了一个接受个任何类型参数的方法,</li>
<li><code>(*,String)</code>匹配了接受两个参数的方法,第一个可以是任意类型,第二个则必须是<code>String</code>类型。</li>
</ul>
<h2 id="execution表示式示例"><a href="#execution表示式示例" class="headerlink" title="execution表示式示例"></a>execution表示式示例</h2><p>例如,如下几个<code>execution</code>表达式:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//匹配任意public方法的执行</span></span><br><span class="line">execution(<span class="keyword">public</span> * * (..))</span><br><span class="line"><span class="comment">//匹配任何方法名以&quot;set&quot;开始的方法的执行</span></span><br><span class="line">execution(* set* (..))</span><br><span class="line"><span class="comment">//匹配AccountServicelmpI中任意方法的执行</span></span><br><span class="line">execution(* org.crazyit.app.service.Impl.AccountServiceImpl.* (..))</span><br><span class="line"><span class="comment">//匹配org.crazyit.app.service.Impl包中任意类的任意方法的执行</span></span><br><span class="line">execution(* org.crazyit.app.service.Impl.*.*(..))</span><br></pre></td></tr></table></figure>
<h2 id="within切入点指示符"><a href="#within切入点指示符" class="headerlink" title="within切入点指示符"></a>within切入点指示符</h2><p><code>within</code>:用于限定匹配特定类型的连接点,当使用<code>Spring AOP</code>的时候,只能匹配方法执行的连接点。<br>例如,如下几个<code>within</code>表达式:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">// 在org.crazyit.app.service包中的任意连接点(在 Spring AOP中只是方法执行的连接点)</span><br><span class="line">within(org.crazyit.app.service.*)</span><br><span class="line">// 在org.crazyit.app.service包或其子包中的任意连接点(在 Spring AOP中只是方法执行的连接点)</span><br><span class="line">within(org.crazyit.app.service..*)</span><br></pre></td></tr></table></figure>
<h2 id="this切入点指示符"><a href="#this切入点指示符" class="headerlink" title="this切入点指示符"></a>this切入点指示符</h2><p><code>this</code>:<strong>用于限定<code>AOP代理</code>必须是指定类型的实例</strong>,匹配该对象的所有连接点。当使用<code>Spring AOP</code>的时候,只能匹配方法执行的连接点。<br>例如,如下<code>this</code>表达式:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//匹配实现了org.crazyit.app.service.AccountService接口的AOP代理的所有连接点(在Spring AOP中只是方法执行的连接点)</span></span><br><span class="line"><span class="keyword">this</span>(org.crazyit.app.service.AccountService)</span><br></pre></td></tr></table></figure>
<h2 id="target切入点指示符"><a href="#target切入点指示符" class="headerlink" title="target切入点指示符"></a>target切入点指示符</h2><p><code>target</code>:<strong>用于限定<code>目标对象</code>必须是指定类型的实例</strong>,匹配该对象的所有连接点。当使用<code>Spring AOP</code>的时候,只能匹配方法执行的连接点。<br>例如,如下<code>target</code>表达式</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">//匹配实现了`org.crazyit.app.service.AccountService`接口的目标对象的所有连接点</span><br><span class="line">target(org.crazyit.app.service.AccountService)</span><br></pre></td></tr></table></figure>
<h2 id="args切入点指示符"><a href="#args切入点指示符" class="headerlink" title="args切入点指示符"></a>args切入点指示符</h2><p><code>args</code>:用于对连接点的参数类型进行限制,<strong>要求参数类型是指定类型的实例</strong>。当使用<code>Spring AOP</code>的时候,只能匹配方法执行的连接点</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//匹配只接受一个参数,且传入的参数类型是`Serializable`的所有连接点</span></span><br><span class="line">args(java.io.Serializable)</span><br></pre></td></tr></table></figure>
<p>该示例中给出的切入点表达式与<code>execution(* * (java.io.Serializable)</code>不同:</p>
<ul>
<li><code>args</code>版本只匹配动态运行时传入的参数值是<code>Serializable</code>类型的情形;</li>
<li><code>execution</code>版本则匹配方法签名只包含一个<code>Serializable</code>类型的形参的方法</li>
</ul>
<h2 id="bean切入点指示符"><a href="#bean切入点指示符" class="headerlink" title="bean切入点指示符"></a>bean切入点指示符</h2><p>另外, <code>Spring AOP</code>还提供了一个名为<code>bean</code>的切入点指示符,它用于限制只匹配指定<code>Bean</code>实例的连接点。当然, <code>Spring AOP</code>中只能使用方法执行作为连接点。<br><code>bean</code>:用于限定只匹配指定<code>Bean</code>实例内的连接点,实际上只能使用方法执行作为连接点。定义<code>bean</code>表达式时需要传入<code>Bean</code>的<code>id</code>或<code>name</code>,表示只匹配该<code>Bean</code>实例内的连接点。支持使用<code>&quot;*&quot;</code>通配符。<br>例如,如下几个<code>bean</code>表达式:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//匹配 tradeService这个Bean实例内方法执行的连接点</span></span><br><span class="line">bean(tradeService)</span><br><span class="line"><span class="comment">//匹配名字以Service结尾的Bean实例内方法执行的连接点</span></span><br><span class="line">bean(*Service)</span><br></pre></td></tr></table></figure>
<h3 id="bean切入点表示式是Spring-AOP额外支持的"><a href="#bean切入点表示式是Spring-AOP额外支持的" class="headerlink" title="bean切入点表示式是Spring AOP额外支持的"></a>bean切入点表示式是Spring AOP额外支持的</h3><p><code>bean</code>切入点表达式是<code>Spring AOP</code>额外支持的,并不是<code>AspectJ</code>所支持的切入点指示符。这个指示符对<code>Spring</code>框架来说非常实用:它可以明确指定为<code>Spring</code>的哪个<code>Bean</code>织入增强处理。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://lanlan2017.github.io/JavaReadingNotes/669c9566/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/JavaReadingNotes/images/avatar.gif">
      <meta itemprop="name" content="蓝蓝">
      <meta itemprop="description" content="好好学习，天天向上">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="蓝蓝站点">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/JavaReadingNotes/669c9566/" class="post-title-link" itemprop="url">8.4.5 基于注解的 零配置 方式 8. 定义切入点</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-09-05 10:40:33" itemprop="dateCreated datePublished" datetime="2019-09-05T10:40:33+08:00">2019-09-05</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2020-02-07 01:34:58" itemprop="dateModified" datetime="2020-02-07T01:34:58+08:00">2020-02-07</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/2-%E8%BD%BB%E9%87%8F%E7%BA%A7Java-EE%E4%BC%81%E4%B8%9A%E5%BA%94%E7%94%A8%E5%AE%9E%E6%88%98-%E7%AC%AC5%E7%89%88/" itemprop="url" rel="index"><span itemprop="name">2 轻量级Java EE企业应用实战(第5版)</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/2-%E8%BD%BB%E9%87%8F%E7%BA%A7Java-EE%E4%BC%81%E4%B8%9A%E5%BA%94%E7%94%A8%E5%AE%9E%E6%88%98-%E7%AC%AC5%E7%89%88/%E7%AC%AC8%E7%AB%A0-%E6%B7%B1%E5%85%A5%E4%BD%BF%E7%94%A8Spring/" itemprop="url" rel="index"><span itemprop="name">第8章 深入使用Spring</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/2-%E8%BD%BB%E9%87%8F%E7%BA%A7Java-EE%E4%BC%81%E4%B8%9A%E5%BA%94%E7%94%A8%E5%AE%9E%E6%88%98-%E7%AC%AC5%E7%89%88/%E7%AC%AC8%E7%AB%A0-%E6%B7%B1%E5%85%A5%E4%BD%BF%E7%94%A8Spring/8-4-Spring%E7%9A%84AOP/" itemprop="url" rel="index"><span itemprop="name">8.4 Spring的AOP</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/2-%E8%BD%BB%E9%87%8F%E7%BA%A7Java-EE%E4%BC%81%E4%B8%9A%E5%BA%94%E7%94%A8%E5%AE%9E%E6%88%98-%E7%AC%AC5%E7%89%88/%E7%AC%AC8%E7%AB%A0-%E6%B7%B1%E5%85%A5%E4%BD%BF%E7%94%A8Spring/8-4-Spring%E7%9A%84AOP/8-4-5-%E5%9F%BA%E4%BA%8E%E6%B3%A8%E8%A7%A3%E7%9A%84-%E9%9B%B6%E9%85%8D%E7%BD%AE-%E6%96%B9%E5%BC%8F/" itemprop="url" rel="index"><span itemprop="name">8.4.5 基于注解的 零配置 方式</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
    <span class="post-meta-item-icon">
      <i class="far fa-comment"></i>
    </span>
    <span class="post-meta-item-text">Waline：</span>
  
    <a title="waline" href="/JavaReadingNotes/669c9566/#waline-comments" itemprop="discussionUrl">
      <span class="post-comments-count waline-comment-count" id="/JavaReadingNotes/669c9566/" data-xid="/JavaReadingNotes/669c9566/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>2.3k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>2 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="8-4-5-基于注解的-零配置-方式-8-定义切入点"><a href="#8-4-5-基于注解的-零配置-方式-8-定义切入点" class="headerlink" title="8.4.5 基于注解的 零配置 方式 8. 定义切入点"></a>8.4.5 基于注解的 零配置 方式 8. 定义切入点</h1><p>正如在前面的<code>FourAdviceTest java</code>程序中看到的,这个切面类中定义了4个增强处理,定义4个增强处理时分别指定了相同的切入点表达式,这种做法不太符合软件设计原则:因为如果有一天需要修改该切入点表达式,那就要修改4个地方。</p>
<h2 id="定义切入点"><a href="#定义切入点" class="headerlink" title="定义切入点"></a>定义切入点</h2><p>为了解决这个问题, <code>AspectJ</code>和<code>Spring</code>都允许定义切入点。所谓定义切入点,其实质就是为一个切入点表达式起一个名称,从而允许在多个增强处理中重用该名称。<br><code>Spring AOP</code>只支持将<code>Spring Bean</code>的<code>方法</code>执行作为连接点,所以<strong>可以把切入点看成所有能和切入点表达式匹配的<code>Bean</code>方法</strong>。<br>切入点定义包含两个部分</p>
<ul>
<li>一个切入点表达式。</li>
<li>一个包含名字和任意参数的方法签名。</li>
</ul>
<p>其中切入点表达式用于指定该切入点和哪些方法进行匹配,包含名字和任意参数的方法签名将作为该切入点的名称。</p>
<h2 id="切入点语法格式"><a href="#切入点语法格式" class="headerlink" title="切入点语法格式"></a>切入点语法格式</h2><p>在<code>@AspectJ</code>风格的<code>AOP</code>中:</p>
<ul>
<li><code>切入点签名</code>采用一个普通的方法定义(方法体通常为空)来提供,且该方法的返回值必须为<code>void</code>;</li>
<li><code>切入点表达式</code>需要使用<code>@Pointcut</code>注解来标注</li>
</ul>
<p>下面的代码片段定义了一个切入点:<code>anyOldTransfer</code>,这个切入点将匹配任何名为<code>transfer</code>的方法的执行</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 使用`@Pointcut`注解定义切入点</span></span><br><span class="line"><span class="meta">@Pointcut(&quot;execution(* transfer(..))&quot;)</span></span><br><span class="line"><span class="comment">// 使用一个返回值为`void`、方法体为空的方法来命名 切入点</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">anyOldTransfer</span><span class="params">()</span></span>&#123;&#125;</span><br></pre></td></tr></table></figure>
<p>切入点表达式,也就是组成<code>@Pointcut</code>注解的值,是正规的<code>AspectJ</code>切入点表达式。如果想要更多地了解<code>Aspect</code>的切入点语言,请参见<code>AspectJ</code>编程指南。</p>
<p>一旦采用上面的代码片段定义了名为<code>anyOldTransfer</code>的切入点之后,程序就可多次重复使用该切入点了,甚至可以在其他切面类、其他包的切面类里使用该切入点,至于是否可以在其他切面类、其他包的切面类里访问该切入点,则取决于该方法签名前的<code>访问控制符</code>—例如,本示例中<code>anyOldTransfer</code>方法使用<code>private</code>访问控制符,则意味着仅能在当前切面类中使用该切入点。</p>
<h2 id="引入当前切面类中的切入点"><a href="#引入当前切面类中的切入点" class="headerlink" title="引入当前切面类中的切入点"></a>引入当前切面类中的切入点</h2><p>如果需要使用本切面类中的切入点,则可在使用<code>@Before</code>、<code>@After</code>、<code>@Around</code>等注解定义<code>Advice</code>时,使用<code>pointcut</code>或<code>value</code>属性值引用己有的切入点。例如下面的代码片段:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@AfterReturning(</span></span><br><span class="line"><span class="meta">    pointcut=&quot;myPointcut()&quot;,</span></span><br><span class="line"><span class="meta">    returning=&quot;retVal&quot;</span></span><br><span class="line"><span class="meta">)</span></span><br></pre></td></tr></table></figure>
<p>从上面代码可以看出,指定切入点时非常像调用<code>Java</code>方法的语法—只是该方法代表一个切入点,其实质是为该增强处理定义一个切入点表达式。</p>
<h2 id="引入其他切面类中的切入点"><a href="#引入其他切面类中的切入点" class="headerlink" title="引入其他切面类中的切入点"></a>引入其他切面类中的切入点</h2><p>如果需要使用其他切面类中的切入点,则<strong>其他切面类中的切入点不能使用<code>private</code>修饰</strong>。而且在使用<code>@Before</code>、<code>@After</code>、<code>@Around</code>等注解中的<code>pointcut</code>或<code>vaue</code>属性值引用已有的切入点时,<strong>必须添加类名前缀</strong>。<br>下面程序的切面类里仅定义了一个切入点。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.crazyit.app.aspect;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.*;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SystemArchitecture</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="meta">@Pointcut(&quot;execution(* org.crazyit.app.service.impl.*.*(..))&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">myPointcut</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>下面的切面类中将直接使用上面定义的<code>myPointcut()</code>切入点</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.crazyit.app.aspect;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.AfterReturning;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Aspect;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LogAspect</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">// 直接使用SystemArchitecture切面类的myPointcut()切入点</span></span><br><span class="line">    <span class="meta">@AfterReturning(</span></span><br><span class="line"><span class="meta">        returning = &quot;rvt&quot;,</span></span><br><span class="line"><span class="meta">        pointcut = &quot;SystemArchitecture.myPointcut()&quot;)</span></span><br><span class="line">    <span class="comment">// 声明rvt时指定的类型会限制目标方法必须返回指定类型的值或没有返回值</span></span><br><span class="line">    <span class="comment">// 此处将rvt的类型声明为Object，意味着对目标方法的返回值不加限制</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">log</span><span class="params">(Object rvt)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;获取目标方法返回值:&quot;</span> + rvt);</span><br><span class="line">        System.out.println(<span class="string">&quot;模拟记录日志功能...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上面程序中的代码就是直接使用<code>SystemArchitecture</code>类中切入点的代码。当使用其他切面类中的切入点时,应该使用切面类作为前缀来限制切入点。<br>正如从上面的<code>LogAspect.java</code>中看到的,该类可以直接使用<code>SystemArchitecture</code>类中定义的切入点,这意味着其他切面类也可自由使用<code>SystemArchitecture</code>类中定义的切入点,这就很好地复用了切入点所包含的切入点表达式。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://lanlan2017.github.io/JavaReadingNotes/c12eedd7/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/JavaReadingNotes/images/avatar.gif">
      <meta itemprop="name" content="蓝蓝">
      <meta itemprop="description" content="好好学习，天天向上">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="蓝蓝站点">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/JavaReadingNotes/c12eedd7/" class="post-title-link" itemprop="url">8.4.5 基于注解的 零配置 方式 7. 访问目标方法的参数</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-09-04 22:01:17" itemprop="dateCreated datePublished" datetime="2019-09-04T22:01:17+08:00">2019-09-04</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2020-02-07 01:34:58" itemprop="dateModified" datetime="2020-02-07T01:34:58+08:00">2020-02-07</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/2-%E8%BD%BB%E9%87%8F%E7%BA%A7Java-EE%E4%BC%81%E4%B8%9A%E5%BA%94%E7%94%A8%E5%AE%9E%E6%88%98-%E7%AC%AC5%E7%89%88/" itemprop="url" rel="index"><span itemprop="name">2 轻量级Java EE企业应用实战(第5版)</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/2-%E8%BD%BB%E9%87%8F%E7%BA%A7Java-EE%E4%BC%81%E4%B8%9A%E5%BA%94%E7%94%A8%E5%AE%9E%E6%88%98-%E7%AC%AC5%E7%89%88/%E7%AC%AC8%E7%AB%A0-%E6%B7%B1%E5%85%A5%E4%BD%BF%E7%94%A8Spring/" itemprop="url" rel="index"><span itemprop="name">第8章 深入使用Spring</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/2-%E8%BD%BB%E9%87%8F%E7%BA%A7Java-EE%E4%BC%81%E4%B8%9A%E5%BA%94%E7%94%A8%E5%AE%9E%E6%88%98-%E7%AC%AC5%E7%89%88/%E7%AC%AC8%E7%AB%A0-%E6%B7%B1%E5%85%A5%E4%BD%BF%E7%94%A8Spring/8-4-Spring%E7%9A%84AOP/" itemprop="url" rel="index"><span itemprop="name">8.4 Spring的AOP</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/2-%E8%BD%BB%E9%87%8F%E7%BA%A7Java-EE%E4%BC%81%E4%B8%9A%E5%BA%94%E7%94%A8%E5%AE%9E%E6%88%98-%E7%AC%AC5%E7%89%88/%E7%AC%AC8%E7%AB%A0-%E6%B7%B1%E5%85%A5%E4%BD%BF%E7%94%A8Spring/8-4-Spring%E7%9A%84AOP/8-4-5-%E5%9F%BA%E4%BA%8E%E6%B3%A8%E8%A7%A3%E7%9A%84-%E9%9B%B6%E9%85%8D%E7%BD%AE-%E6%96%B9%E5%BC%8F/" itemprop="url" rel="index"><span itemprop="name">8.4.5 基于注解的 零配置 方式</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
    <span class="post-meta-item-icon">
      <i class="far fa-comment"></i>
    </span>
    <span class="post-meta-item-text">Waline：</span>
  
    <a title="waline" href="/JavaReadingNotes/c12eedd7/#waline-comments" itemprop="discussionUrl">
      <span class="post-comments-count waline-comment-count" id="/JavaReadingNotes/c12eedd7/" data-xid="/JavaReadingNotes/c12eedd7/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>7.8k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>7 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="8-4-5-基于注解的-零配置-方式-7-访问目标方法的参数"><a href="#8-4-5-基于注解的-零配置-方式-7-访问目标方法的参数" class="headerlink" title="8.4.5 基于注解的 零配置 方式 7. 访问目标方法的参数"></a>8.4.5 基于注解的 零配置 方式 7. 访问目标方法的参数</h1><p>访问目标方法最简单的做法是<strong>定义增强处理方法时将第一个参数定义为<code>JoinPoint</code>类型</strong>,当该增强处理方法被调用时,该<code>JoinPoint</code>参数就代表了织入增强处理的连接点。</p>
<h2 id="JoinPoint类的方法"><a href="#JoinPoint类的方法" class="headerlink" title="JoinPoint类的方法"></a>JoinPoint类的方法</h2><p><code>JoinPoint</code>里包含了如下几个常用的方法。</p>
<table>
<thead>
<tr>
<th align="left">方法</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>Object[] getArgs()</code></td>
<td align="left">返回执行目标方法时的参数。</td>
</tr>
<tr>
<td align="left"><code>Signature getSignature()</code></td>
<td align="left">返回被增强的方法的相关信息</td>
</tr>
<tr>
<td align="left"><code>Object getTarget()</code></td>
<td align="left">返回被织入增强处理的目标对象</td>
</tr>
<tr>
<td align="left"><code>Object getThis()</code></td>
<td align="left">返回<code>AOP</code>框架为目标对象生成的代理对象。</td>
</tr>
</tbody></table>
<p>通过使用这些方法就可访问到目标方法的相关信息。</p>
<p>当使用<code>Around</code>增加处理时,需要将第一个参数定义为<code>ProceedingJoinPoint</code>类型,该类型是<code>JoinPoint</code>类型的子类。</p>
<h2 id="程序示例"><a href="#程序示例" class="headerlink" title="程序示例"></a>程序示例</h2><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">E:\<span class="title">workspace_QingLiangJiJavaEEQiYeYingYongShiZhang5</span>\<span class="title">JoinPoint</span></span></span><br><span class="line"><span class="function">└─<span class="title">src</span>\</span></span><br><span class="line"><span class="function">  ├─<span class="title">beans.xml</span></span></span><br><span class="line"><span class="function">  ├─<span class="title">lee</span>\</span></span><br><span class="line"><span class="function">  │ └─<span class="title">BeanTest.java</span></span></span><br><span class="line"><span class="function">  └─<span class="title">org</span>\</span></span><br><span class="line"><span class="function">    └─<span class="title">crazyit</span>\</span></span><br><span class="line"><span class="function">      └─<span class="title">app</span>\</span></span><br><span class="line"><span class="function">        ├─<span class="title">aspect</span>\</span></span><br><span class="line"><span class="function">        │ └─<span class="title">FourAdviceTest.java</span></span></span><br><span class="line"><span class="function">        └─<span class="title">service</span>\</span></span><br><span class="line"><span class="function">          ├─<span class="title">Hello.java</span></span></span><br><span class="line"><span class="function">          ├─<span class="title">impl</span>\</span></span><br><span class="line"><span class="function">          │ ├─<span class="title">HelloImpl.java</span></span></span><br><span class="line"><span class="function">          │ └─<span class="title">WorldImpl.java</span></span></span><br><span class="line"><span class="function">          └─<span class="title">World.java</span></span></span><br></pre></td></tr></table></figure>
<p>下面的切面类中定义了<code>Before</code>、 <code>Around</code>、 <code>AfterReturning</code>、<code>Afer</code>四种增强处理,并分别在4种增强处理中<code>访问被织入增强处理的目标方法</code>、<code>执行目标方法的参数</code>、<code>访问被织入增强处理的目标对象</code>等。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.crazyit.app.aspect;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.*;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.*;</span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义一个切面</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FourAdviceTest</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">// 定义Around增强处理</span></span><br><span class="line">    <span class="meta">@Around(&quot;execution(* org.crazyit.app.service.impl.*.*(..))&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">processTx</span><span class="params">(ProceedingJoinPoint jp)</span> <span class="keyword">throws</span> java.lang.Throwable</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Around增强：执行目标方法之前，模拟开始事务...&quot;</span>);</span><br><span class="line">        <span class="comment">// 访问执行目标方法的参数</span></span><br><span class="line">        Object[] args = jp.getArgs();</span><br><span class="line">        <span class="comment">// 当执行目标方法的参数存在，</span></span><br><span class="line">        <span class="comment">// 且第一个参数是字符串参数</span></span><br><span class="line">        <span class="keyword">if</span> (args != <span class="keyword">null</span> &amp;&amp; args.length &gt; <span class="number">0</span></span><br><span class="line">                &amp;&amp; args[<span class="number">0</span>].getClass() == String.class)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// 修改目标方法调用参数的第一个参数</span></span><br><span class="line">            args[<span class="number">0</span>] = <span class="string">&quot;【增加的前缀】&quot;</span> + args[<span class="number">0</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 执行目标方法，并保存目标方法执行后的返回值</span></span><br><span class="line">        Object rvt = jp.proceed(args);</span><br><span class="line">        System.out.println(<span class="string">&quot;Around增强：执行目标方法之后，模拟结束事务...&quot;</span>);</span><br><span class="line">        <span class="comment">// 如果rvt的类型是Integer，将rvt改为它的平方</span></span><br><span class="line">        <span class="keyword">if</span> (rvt != <span class="keyword">null</span> &amp;&amp; rvt <span class="keyword">instanceof</span> Integer)</span><br><span class="line">            rvt = (Integer) rvt * (Integer) rvt;</span><br><span class="line">        <span class="keyword">return</span> rvt;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 定义Before增强处理</span></span><br><span class="line">    <span class="meta">@Before(&quot;execution(* org.crazyit.app.service.impl.*.*(..))&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">authority</span><span class="params">(JoinPoint jp)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Before增强：模拟执行权限检查&quot;</span>);</span><br><span class="line">        <span class="comment">// 返回被织入增强处理的目标方法</span></span><br><span class="line">        System.out.println(</span><br><span class="line">                <span class="string">&quot;Before增强：被织入增强处理的目标方法为：&quot;</span> + jp.getSignature().getName());</span><br><span class="line">        <span class="comment">// 访问执行目标方法的参数</span></span><br><span class="line">        System.out</span><br><span class="line">                .println(<span class="string">&quot;Before增强：目标方法的参数为：&quot;</span> + Arrays.toString(jp.getArgs()));</span><br><span class="line">        <span class="comment">// 访问被增强处理的目标对象</span></span><br><span class="line">        System.out.println(<span class="string">&quot;Before增强：被织入增强处理的目标对象为：&quot;</span> + jp.getTarget());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 定义AfterReturning增强处理</span></span><br><span class="line">    <span class="meta">@AfterReturning(</span></span><br><span class="line"><span class="meta">        pointcut = &quot;execution(* org.crazyit.app.service.impl.*.*(..))&quot;,</span></span><br><span class="line"><span class="meta">        returning = &quot;rvt&quot;</span></span><br><span class="line"><span class="meta">    )</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">log</span><span class="params">(JoinPoint jp, Object rvt)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;AfterReturning增强：获取目标方法返回值:&quot;</span> + rvt);</span><br><span class="line">        System.out.println(<span class="string">&quot;AfterReturning增强：模拟记录日志功能...&quot;</span>);</span><br><span class="line">        <span class="comment">// 返回被织入增强处理的目标方法</span></span><br><span class="line">        System.out.println(<span class="string">&quot;AfterReturning增强：被织入增强处理的目标方法为：&quot;</span></span><br><span class="line">                + jp.getSignature().getName());</span><br><span class="line">        <span class="comment">// 访问执行目标方法的参数</span></span><br><span class="line">        System.out.println(</span><br><span class="line">                <span class="string">&quot;AfterReturning增强：目标方法的参数为：&quot;</span> + Arrays.toString(jp.getArgs()));</span><br><span class="line">        <span class="comment">// 访问被增强处理的目标对象</span></span><br><span class="line">        System.out.println(<span class="string">&quot;AfterReturning增强：被织入增强处理的目标对象为：&quot;</span> + jp.getTarget());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 定义After增强处理</span></span><br><span class="line">    <span class="meta">@After(&quot;execution(* org.crazyit.app.service.impl.*.*(..))&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">release</span><span class="params">(JoinPoint jp)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;After增强：模拟方法结束后的释放资源...&quot;</span>);</span><br><span class="line">        <span class="comment">// 返回被织入增强处理的目标方法</span></span><br><span class="line">        System.out.println(</span><br><span class="line">                <span class="string">&quot;After增强：被织入增强处理的目标方法为：&quot;</span> + jp.getSignature().getName());</span><br><span class="line">        <span class="comment">// 访问执行目标方法的参数</span></span><br><span class="line">        System.out.println(<span class="string">&quot;After增强：目标方法的参数为：&quot;</span> + Arrays.toString(jp.getArgs()));</span><br><span class="line">        <span class="comment">// 访问被增强处理的目标对象</span></span><br><span class="line">        System.out.println(<span class="string">&quot;After增强：被织入增强处理的目标对象为：&quot;</span> + jp.getTarget());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>从上面的代码可以看出,在<code>Before</code>、 <code>Around</code>、 <code>AfterReturning</code>、<code>After</code>四种增强处理中,其实<strong>都可通过相同的代码来<code>访问</code>被增强的目标对象、目标方法和方法的参数</strong>,<br>但只有<code>Around</code>增强处理可以改变方法参数.</p>
<p>被上面切面类处理的目标类还是前面的<code>Hellolmpl</code>、 <code>WorldImpl</code>类,主程序获取它们的实例,并执行它们的方法,执行结束将看到如下所示的执行效果:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">Around增强：执行目标方法之前，模拟开始事务...</span><br><span class="line">Before增强：模拟执行权限检查</span><br><span class="line">Before增强：被织入增强处理的目标方法为：addUser</span><br><span class="line">Before增强：目标方法的参数为：[【增加的前缀】孙悟空, 7788]</span><br><span class="line">Before增强：被织入增强处理的目标对象为：org.crazyit.app.service.impl.HelloImpl@128d2484</span><br><span class="line">执行Hello组件的addUser添加用户：【增加的前缀】孙悟空</span><br><span class="line">Around增强：执行目标方法之后，模拟结束事务...</span><br><span class="line">After增强：模拟方法结束后的释放资源...</span><br><span class="line">After增强：被织入增强处理的目标方法为：addUser</span><br><span class="line">After增强：目标方法的参数为：[【增加的前缀】孙悟空, 7788]</span><br><span class="line">After增强：被织入增强处理的目标对象为：org.crazyit.app.service.impl.HelloImpl@128d2484</span><br><span class="line">AfterReturning增强：获取目标方法返回值:400</span><br><span class="line">AfterReturning增强：模拟记录日志功能...</span><br><span class="line">AfterReturning增强：被织入增强处理的目标方法为：addUser</span><br><span class="line">AfterReturning增强：目标方法的参数为：[【增加的前缀】孙悟空, 7788]</span><br><span class="line">AfterReturning增强：被织入增强处理的目标对象为：org.crazyit.app.service.impl.HelloImpl@128d2484</span><br><span class="line">Around增强：执行目标方法之前，模拟开始事务...</span><br><span class="line">Before增强：模拟执行权限检查</span><br><span class="line">Before增强：被织入增强处理的目标方法为：deleteUser</span><br><span class="line">Before增强：目标方法的参数为：[1]</span><br><span class="line">Before增强：被织入增强处理的目标对象为：org.crazyit.app.service.impl.HelloImpl@128d2484</span><br><span class="line">执行Hello组件的deleteUser删除用户：1</span><br><span class="line">Around增强：执行目标方法之后，模拟结束事务...</span><br><span class="line">After增强：模拟方法结束后的释放资源...</span><br><span class="line">After增强：被织入增强处理的目标方法为：deleteUser</span><br><span class="line">After增强：目标方法的参数为：[1]</span><br><span class="line">After增强：被织入增强处理的目标对象为：org.crazyit.app.service.impl.HelloImpl@128d2484</span><br><span class="line">AfterReturning增强：获取目标方法返回值:null</span><br><span class="line">AfterReturning增强：模拟记录日志功能...</span><br><span class="line">AfterReturning增强：被织入增强处理的目标方法为：deleteUser</span><br><span class="line">AfterReturning增强：目标方法的参数为：[1]</span><br><span class="line">AfterReturning增强：被织入增强处理的目标对象为：org.crazyit.app.service.impl.HelloImpl@128d2484</span><br><span class="line">Around增强：执行目标方法之前，模拟开始事务...</span><br><span class="line">Before增强：模拟执行权限检查</span><br><span class="line">Before增强：被织入增强处理的目标方法为：bar</span><br><span class="line">Before增强：目标方法的参数为：[]</span><br><span class="line">Before增强：被织入增强处理的目标对象为：org.crazyit.app.service.impl.WorldImpl@7cc0cdad</span><br><span class="line">执行World组件的bar()方法</span><br><span class="line">Around增强：执行目标方法之后，模拟结束事务...</span><br><span class="line">After增强：模拟方法结束后的释放资源...</span><br><span class="line">After增强：被织入增强处理的目标方法为：bar</span><br><span class="line">After增强：目标方法的参数为：[]</span><br><span class="line">After增强：被织入增强处理的目标对象为：org.crazyit.app.service.impl.WorldImpl@7cc0cdad</span><br><span class="line">AfterReturning增强：获取目标方法返回值:null</span><br><span class="line">AfterReturning增强：模拟记录日志功能...</span><br><span class="line">AfterReturning增强：被织入增强处理的目标方法为：bar</span><br><span class="line">AfterReturning增强：目标方法的参数为：[]</span><br><span class="line">AfterReturning增强：被织入增强处理的目标对象为：org.crazyit.app.service.impl.WorldImpl@7cc0cdad</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h1 id="织入增强处理的顺序"><a href="#织入增强处理的顺序" class="headerlink" title="织入增强处理的顺序"></a>织入增强处理的顺序</h1><p><code>Spring AOP</code>采用和<code>AspectJ</code>一样的优先顺序来织入增强处理:</p>
<ul>
<li>在”<code>进入</code>“连接点时,具有最高优先级的增强处理将先被织入(所以在给定的两个<code>Before</code>增强处理中,优先级高的那个会<code>先执行</code>)。</li>
<li>在”<code>退出</code>“连接点时,具有最高优先级的增强处理会最后被织入(所以在给定的两个<code>After</code>增强处理中,优先级高的那个会<code>后执行</code>).</li>
</ul>
<p>##不同切面类的增强处理 默认以随机顺序 织入同一个连接点 ##<br>当不同切面里的两个增强处理需要在同一个连接点被织入时, <code>Spring AOP</code>将以随机的顺序来织入这两个增强处理。</p>
<h2 id="通过优先级为-不同切面类的增强处理-设置织入顺序"><a href="#通过优先级为-不同切面类的增强处理-设置织入顺序" class="headerlink" title="通过优先级为 不同切面类的增强处理 设置织入顺序"></a>通过优先级为 不同切面类的增强处理 设置织入顺序</h2><p>如果应用需要指定不同切面类里增强处理的优先级, <code>Spring</code>提供了如下两种解决方案。</p>
<ol>
<li>让切面类实现<code>org.springframework.core.Ordered</code>接口,实现该接口只需实现一个<code>int getOrder()</code>方法,该方法的<code>返回值越小,则优先级越高</code>。</li>
<li>直接使用<code>@Order</code>注解来修饰一个切面类,使用<code>@Order</code>注解时可指定一个<code>int</code>型的<code>value</code>属性,该属性值越小,则优先级越高。</li>
</ol>
<h2 id="同一个切面类例-同类型的-增强处理-默认以随机顺序织入"><a href="#同一个切面类例-同类型的-增强处理-默认以随机顺序织入" class="headerlink" title="同一个切面类例 同类型的 增强处理 默认以随机顺序织入"></a>同一个切面类例 同类型的 增强处理 默认以随机顺序织入</h2><p>同一个切面类里的两个相同类型的增强处理在同一个连接点被织入时, <code>Spring AOP</code>将以随机的顺序来织入这两个增强处理,程序没有办法控制它们的织入顺序。</p>
<p>如果确实需要保证它们以固有的顺序被织入,则可考虑将多个增强处理压缩成一个增强处理;或者将不同的增强处理重构到不同的切面类中,通过在切面类级别上进行排序。</p>
<h1 id="args切入点表达式"><a href="#args切入点表达式" class="headerlink" title="args切入点表达式"></a>args切入点表达式</h1><p>如果只需要访问目标方法的参数, <code>Spring</code>还提供了一种更简单的方法:可以在程序中使用<code>args</code>切入点表达式来绑定目标方法的参数。如果在一个<code>args</code>表达式中指定了一个或多个参数,则该切入点将只匹配具有对应形参的方法,且目标方法的参数值将被传入增强处理方法。</p>
<h2 id="程序示例-1"><a href="#程序示例-1" class="headerlink" title="程序示例"></a>程序示例</h2><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">E:\<span class="title">workspace_QingLiangJiJavaEEQiYeYingYongShiZhang5</span>\<span class="title">Args</span></span></span><br><span class="line"><span class="function">└─<span class="title">src</span>\</span></span><br><span class="line"><span class="function">  ├─<span class="title">beans.xml</span></span></span><br><span class="line"><span class="function">  ├─<span class="title">lee</span>\</span></span><br><span class="line"><span class="function">  │ └─<span class="title">BeanTest.java</span></span></span><br><span class="line"><span class="function">  └─<span class="title">org</span>\</span></span><br><span class="line"><span class="function">    └─<span class="title">crazyit</span>\</span></span><br><span class="line"><span class="function">      └─<span class="title">app</span>\</span></span><br><span class="line"><span class="function">        ├─<span class="title">aspect</span>\</span></span><br><span class="line"><span class="function">        │ └─<span class="title">AccessArgAspect.java</span></span></span><br><span class="line"><span class="function">        └─<span class="title">service</span>\</span></span><br><span class="line"><span class="function">          ├─<span class="title">Hello.java</span></span></span><br><span class="line"><span class="function">          ├─<span class="title">impl</span>\</span></span><br><span class="line"><span class="function">          │ ├─<span class="title">HelloImpl.java</span></span></span><br><span class="line"><span class="function">          │ └─<span class="title">WorldImpl.java</span></span></span><br><span class="line"><span class="function">          └─<span class="title">World.java</span></span></span><br></pre></td></tr></table></figure>
<p>下面定义一个切面类。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.crazyit.app.aspect;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.AfterReturning;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Aspect;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AccessArgAspect</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">// 下面的args(arg0,arg1)会限制目标方法必须有2个形参</span></span><br><span class="line">    <span class="meta">@AfterReturning(</span></span><br><span class="line"><span class="meta">        returning = &quot;rvt&quot;,</span></span><br><span class="line"><span class="meta">        pointcut = &quot;execution(* org.crazyit.app.service.impl.*.*(..)) &amp;&amp; args(arg0,arg1)&quot;)</span></span><br><span class="line">    <span class="comment">// 此处指定arg0、arg1为String类型</span></span><br><span class="line">    <span class="comment">// 则args(arg0,arg1)还要求目标方法的两个形参都是String类型</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">access</span><span class="params">(Object rvt, String arg0, String arg1)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;调用目标方法第1个参数为:&quot;</span> + arg0);</span><br><span class="line">        System.out.println(<span class="string">&quot;调用目标方法第2个参数为:&quot;</span> + arg1);</span><br><span class="line">        System.out.println(<span class="string">&quot;获取目标方法返回值:&quot;</span> + rvt);</span><br><span class="line">        System.out.println(<span class="string">&quot;模拟记录日志功能...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上面程序中的<code>pointcut</code>属性定义了切入点表达式,但该切入点表达式增加了<code>&amp;&amp;args(arg0,arg1)</code>部分,这意味着可以在增强处理方法(<code>access</code>方法)中定义<code>ag0</code>、<code>arg1</code>两个形参,这两个形参的类型可以随意指定,但一旦指定了这两个形参的类型,这样两个形参的类型会用于限制目标方法。<br>例如<code>access</code>方法声明<code>arg0</code>、<code>arg1</code>的类型都是<code>String</code>,<strong>这会限制目标方法必须带两个<code>String</code>类型的参数</strong>。<br>本示例的主程序还是先通过<code>Sprin</code>容器获取<code>HelloImpl</code>和<code>Worldlmpl</code>两个组件,然后调用这两个组件的方法。编译、运行该程序,将看到如下所示的效果。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">执行Hello组件的addUser添加用户：孙悟空</span><br><span class="line">调用目标方法第1个参数为:孙悟空</span><br><span class="line">调用目标方法第2个参数为:7788</span><br><span class="line">获取目标方法返回值:20</span><br><span class="line">模拟记录日志功能...</span><br><span class="line">执行Hello组件的deleteUser删除用户：1</span><br><span class="line">执行World组件的bar()方法</span><br></pre></td></tr></table></figure>
<p>从上述运行结果可以看出,使用<code>args</code>表达式有如下两个作用。</p>
<ol>
<li>提供了一种简单的方式来访问目标方法的参数</li>
<li>对切入表达式增加额外的限制。</li>
</ol>
<p>除此之外,使用<code>args</code>表达式时还可使用如下形式:<code>args(name,age,..)</code>,这表明在增强处理方法中可通过<code>name</code>、<code>age</code>来访问目标方法的参数。注意上面<code>arg</code>表达式括号中的两个点,它表示可匹配更多参数——如果该<code>args</code>表达式对应的增强处理方法签名为:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@AfterReturning(</span></span><br><span class="line"><span class="meta">    returning = &quot;rvt&quot;,</span></span><br><span class="line"><span class="meta">    pointcut = &quot;execution(* org.crazyit.app.service.impl.*.*(..)) &amp;&amp; args(name,age,..)&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doSomething</span><span class="params">(String name,<span class="keyword">int</span> age,Date birth)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这意味着只要目标方法的第一个参数是<code>String</code>类型,第二个参数是<code>int</code>类型,则该方法就可匹配该切入点。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://lanlan2017.github.io/JavaReadingNotes/622db77/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/JavaReadingNotes/images/avatar.gif">
      <meta itemprop="name" content="蓝蓝">
      <meta itemprop="description" content="好好学习，天天向上">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="蓝蓝站点">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/JavaReadingNotes/622db77/" class="post-title-link" itemprop="url">8.4.5 基于注解的 零配置 方式 6. Around增强处理</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-09-04 22:00:28" itemprop="dateCreated datePublished" datetime="2019-09-04T22:00:28+08:00">2019-09-04</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2020-02-07 01:34:58" itemprop="dateModified" datetime="2020-02-07T01:34:58+08:00">2020-02-07</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/2-%E8%BD%BB%E9%87%8F%E7%BA%A7Java-EE%E4%BC%81%E4%B8%9A%E5%BA%94%E7%94%A8%E5%AE%9E%E6%88%98-%E7%AC%AC5%E7%89%88/" itemprop="url" rel="index"><span itemprop="name">2 轻量级Java EE企业应用实战(第5版)</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/2-%E8%BD%BB%E9%87%8F%E7%BA%A7Java-EE%E4%BC%81%E4%B8%9A%E5%BA%94%E7%94%A8%E5%AE%9E%E6%88%98-%E7%AC%AC5%E7%89%88/%E7%AC%AC8%E7%AB%A0-%E6%B7%B1%E5%85%A5%E4%BD%BF%E7%94%A8Spring/" itemprop="url" rel="index"><span itemprop="name">第8章 深入使用Spring</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/2-%E8%BD%BB%E9%87%8F%E7%BA%A7Java-EE%E4%BC%81%E4%B8%9A%E5%BA%94%E7%94%A8%E5%AE%9E%E6%88%98-%E7%AC%AC5%E7%89%88/%E7%AC%AC8%E7%AB%A0-%E6%B7%B1%E5%85%A5%E4%BD%BF%E7%94%A8Spring/8-4-Spring%E7%9A%84AOP/" itemprop="url" rel="index"><span itemprop="name">8.4 Spring的AOP</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/2-%E8%BD%BB%E9%87%8F%E7%BA%A7Java-EE%E4%BC%81%E4%B8%9A%E5%BA%94%E7%94%A8%E5%AE%9E%E6%88%98-%E7%AC%AC5%E7%89%88/%E7%AC%AC8%E7%AB%A0-%E6%B7%B1%E5%85%A5%E4%BD%BF%E7%94%A8Spring/8-4-Spring%E7%9A%84AOP/8-4-5-%E5%9F%BA%E4%BA%8E%E6%B3%A8%E8%A7%A3%E7%9A%84-%E9%9B%B6%E9%85%8D%E7%BD%AE-%E6%96%B9%E5%BC%8F/" itemprop="url" rel="index"><span itemprop="name">8.4.5 基于注解的 零配置 方式</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
    <span class="post-meta-item-icon">
      <i class="far fa-comment"></i>
    </span>
    <span class="post-meta-item-text">Waline：</span>
  
    <a title="waline" href="/JavaReadingNotes/622db77/#waline-comments" itemprop="discussionUrl">
      <span class="post-comments-count waline-comment-count" id="/JavaReadingNotes/622db77/" data-xid="/JavaReadingNotes/622db77/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>2.8k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>3 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="8-4-5-基于注解的-零配置-方式-6-Around增强处理"><a href="#8-4-5-基于注解的-零配置-方式-6-Around增强处理" class="headerlink" title="8.4.5 基于注解的 零配置 方式 6. Around增强处理"></a>8.4.5 基于注解的 零配置 方式 6. Around增强处理</h1><p><code>@Around</code>注解用于修饰<code>Around</code>增强处理, <code>Around</code>增强处理是功能比较强大的增强处理,它<strong>近似等于<code>Before</code>增强处理和<code>AfterReturning</code>增强处理的总和</strong>, <strong><code>Around</code>处理既可在执行目标方法之前织入增强动作,也可在执行目标方法之后织入增强动作</strong>。</p>
<h2 id="Around增强与Before增强和AfterReturning增强的不同"><a href="#Around增强与Before增强和AfterReturning增强的不同" class="headerlink" title="Around增强与Before增强和AfterReturning增强的不同"></a>Around增强与Before增强和AfterReturning增强的不同</h2><p>与<code>Before</code>增强处理、 <code>AfterReturning</code>增强处理不同的是, <code>Around</code>增强处理可以决定目标方法在什么时候执行,如何执行,甚至可以完全阻止目标方法的执行。<br><code>Around</code>增强处理可以改变执行目标方法的参数值,也可以改变执行目标方法之后的返回值。</p>
<h2 id="什么时候适合使用Around增强"><a href="#什么时候适合使用Around增强" class="headerlink" title="什么时候适合使用Around增强"></a>什么时候适合使用Around增强</h2><p><code>Around</code>增强处理的功能虽然强大,但<strong>通常需要在线程安全的环境下使用</strong>。因此,如果使用普通的<code>Before</code>增强处理、<code>Afterreturning</code>增强处理就能解决的问题,则没有必要使用<code>Around</code>增强处理了。<br><strong>如果需要目标方法执行之前和之后共享某种状态数据,则应该考虑使用<code>Around</code>增强处理;尤其是需要改变目标方法的返回值时,则只能使用<code>Around</code>增强处理了</strong>。</p>
<h2 id="使用Value属性指定被织入的切入点"><a href="#使用Value属性指定被织入的切入点" class="headerlink" title="使用Value属性指定被织入的切入点"></a>使用Value属性指定被织入的切入点</h2><p><code>Around</code>增强处理方法应该使用<code>@Around</code>来标注,使用<code>@Around</code>注解时需要指定一个<code>value</code>属性,该属性指定该增强处理被织入的切入点。</p>
<h2 id="第一个形参必须是ProceedingJoinPoint类型"><a href="#第一个形参必须是ProceedingJoinPoint类型" class="headerlink" title="第一个形参必须是ProceedingJoinPoint类型"></a>第一个形参必须是ProceedingJoinPoint类型</h2><p>当定义一个<code>Around</code>增强处理方法时,<strong>该方法至少包含一个形参</strong>,<strong>并且第一个形参必须是<code>ProceedingJoinPoint</code>类型</strong></p>
<h2 id="需要显示调用ProceedingJoinPoint参数的proceed方法来执行目标方法"><a href="#需要显示调用ProceedingJoinPoint参数的proceed方法来执行目标方法" class="headerlink" title="需要显示调用ProceedingJoinPoint参数的proceed方法来执行目标方法"></a>需要显示调用ProceedingJoinPoint参数的proceed方法来执行目标方法</h2><p>在增强处理方法体内,<strong>调用<code>ProceedingJoinPoint</code>参数的<code>proceed</code>方法才会执行目标方法</strong>,这就是<code>Around</code>增强处理可以完全控制目标方法的执行时机、执行方式的关键;<br>如果程序没有调用<code>ProceedingJoinPoint</code>参数的<code>proceed</code>方法,则目标方法不会被执行。</p>
<h2 id="执行目标方法时传入参数"><a href="#执行目标方法时传入参数" class="headerlink" title="执行目标方法时传入参数"></a>执行目标方法时传入参数</h2><p>调用<code>ProceedingJoinPoint</code>参数的<code>proceed</code>方法时,还可以传入一个<code>Object数组</code>作为参数,该数组中的值将被传入目标方法<code>作为执行方法的实参</code>。</p>
<h2 id="程序示例"><a href="#程序示例" class="headerlink" title="程序示例"></a>程序示例</h2><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">E:\<span class="title">workspace_QingLiangJiJavaEEQiYeYingYongShiZhang5</span>\<span class="title">Around</span></span></span><br><span class="line"><span class="function">└─<span class="title">src</span>\</span></span><br><span class="line"><span class="function">  ├─<span class="title">beans.xml</span></span></span><br><span class="line"><span class="function">  ├─<span class="title">lee</span>\</span></span><br><span class="line"><span class="function">  │ └─<span class="title">BeanTest.java</span></span></span><br><span class="line"><span class="function">  └─<span class="title">org</span>\</span></span><br><span class="line"><span class="function">    └─<span class="title">crazyit</span>\</span></span><br><span class="line"><span class="function">      └─<span class="title">app</span>\</span></span><br><span class="line"><span class="function">        ├─<span class="title">aspect</span>\</span></span><br><span class="line"><span class="function">        │ └─<span class="title">TxAspect.java</span></span></span><br><span class="line"><span class="function">        └─<span class="title">service</span>\</span></span><br><span class="line"><span class="function">          ├─<span class="title">Hello.java</span></span></span><br><span class="line"><span class="function">          ├─<span class="title">impl</span>\</span></span><br><span class="line"><span class="function">          │ ├─<span class="title">HelloImpl.java</span></span></span><br><span class="line"><span class="function">          │ └─<span class="title">WorldImpl.java</span></span></span><br><span class="line"><span class="function">          └─<span class="title">World.java</span></span></span><br></pre></td></tr></table></figure>
<p>下面的程序定义了一个<code>Around</code>增强处理。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.crazyit.app.aspect;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.*;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.*;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义一个切面</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TxAspect</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">// 匹配org.crazyit.app.service.impl包下所有类的、</span></span><br><span class="line">    <span class="comment">// 所有方法的执行作为切入点</span></span><br><span class="line">    <span class="meta">@Around(&quot;execution(* org.crazyit.app.service.impl.*.*(..))&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">processTx</span><span class="params">(ProceedingJoinPoint jp)</span> <span class="keyword">throws</span> java.lang.Throwable</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;执行目标方法之前，模拟开始事务...&quot;</span>);</span><br><span class="line">        <span class="comment">// 获取目标方法原始的调用参数</span></span><br><span class="line">        Object[] args = jp.getArgs();</span><br><span class="line">        <span class="keyword">if</span> (args != <span class="keyword">null</span> &amp;&amp; args.length &gt; <span class="number">1</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// 修改目标方法的第一个参数</span></span><br><span class="line">            args[<span class="number">0</span>] = <span class="string">&quot;【增加的前缀】&quot;</span> + args[<span class="number">0</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 以改变后的参数去执行目标方法，并保存目标方法执行后的返回值</span></span><br><span class="line">        Object rvt = jp.proceed(args);</span><br><span class="line">        System.out.println(<span class="string">&quot;执行目标方法之后，模拟结束事务...&quot;</span>);</span><br><span class="line">        <span class="comment">// 如果目标方法的返回值rvt的类型是Integer，将rvt改为它的平方</span></span><br><span class="line">        <span class="keyword">if</span> (rvt != <span class="keyword">null</span> &amp;&amp; rvt <span class="keyword">instanceof</span> Integer)</span><br><span class="line">            rvt = (Integer) rvt * (Integer) rvt;</span><br><span class="line">        <span class="keyword">return</span> rvt;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上面的程序定义了一个<code>TxAspect</code>切面,该切面里包含一个<code>Around</code>增强处理的<code>processTx()</code>方法,该方法中的代码:<code>Object rvt = jp.proceed(args);</code>用于回调目标方法,回调目标方法时传入了一个<code>args</code>数组,但这个<code>args</code>数组是执行目标方法的原始参数被修改后的结果,这样就实现了对调用参数的修改;<code>rvt = (Integer) rvt * (Integer) rvt;</code>这行代码则用于改变目标方法的返回值。<br>本示例程序中依然使用前面的<code>Hellolmpl.java</code>、 <code>World.java</code>类,只是主程序增加了输出<code>addUser()</code>方法返回值的功能。执行主程序,将看到如下效果。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">执行目标方法之前，模拟开始事务...</span><br><span class="line">执行Hello组件的addUser添加用户：【增加的前缀】孙悟空</span><br><span class="line">执行目标方法之后，模拟结束事务...</span><br><span class="line">addUser()的返回值为：400</span><br><span class="line">执行目标方法之前，模拟开始事务...</span><br><span class="line">执行Hello组件的deleteUser删除用户：1</span><br><span class="line">执行目标方法之后，模拟结束事务...</span><br><span class="line">执行目标方法之前，模拟开始事务...</span><br><span class="line">执行World组件的bar()方法</span><br><span class="line">执行目标方法之后，模拟结束事务...</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>从运行结果可以看出,使用<code>Around</code>增强处理可以取得对目标方法最大的控制权,</p>
<ul>
<li>既可完全控制目标方法的执行,</li>
<li>也可改变执行目标方法的参数,</li>
<li>还可改变目标方法的返回值。</li>
</ul>
<h2 id="proceed方法调用目标方法时参数不匹配会出现异常"><a href="#proceed方法调用目标方法时参数不匹配会出现异常" class="headerlink" title="proceed方法调用目标方法时参数不匹配会出现异常"></a>proceed方法调用目标方法时参数不匹配会出现异常</h2><p>当调用<code>ProceedingJoinPoint</code>的<code>proceed</code>方法时,传入的<code>Object数组</code>参数值将作为目标方法的参数,如果传入的<code>Object数组</code>的长度与目标方法所需要参数的个数不相等,或者<code>Object数组</code>元素与目标方法所需参数的类型不匹配,程序就会出现异常。</p>
<p>为了能获取目标方法的参数的个数和类型,需要增强处理方法能访问执行目标方法的参数。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://lanlan2017.github.io/JavaReadingNotes/1ff1bbbc/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/JavaReadingNotes/images/avatar.gif">
      <meta itemprop="name" content="蓝蓝">
      <meta itemprop="description" content="好好学习，天天向上">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="蓝蓝站点">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/JavaReadingNotes/1ff1bbbc/" class="post-title-link" itemprop="url">8.4.5 基于注解的 零配置 方式 5. After增强处理</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-09-04 21:59:23" itemprop="dateCreated datePublished" datetime="2019-09-04T21:59:23+08:00">2019-09-04</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2020-02-07 01:34:58" itemprop="dateModified" datetime="2020-02-07T01:34:58+08:00">2020-02-07</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/2-%E8%BD%BB%E9%87%8F%E7%BA%A7Java-EE%E4%BC%81%E4%B8%9A%E5%BA%94%E7%94%A8%E5%AE%9E%E6%88%98-%E7%AC%AC5%E7%89%88/" itemprop="url" rel="index"><span itemprop="name">2 轻量级Java EE企业应用实战(第5版)</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/2-%E8%BD%BB%E9%87%8F%E7%BA%A7Java-EE%E4%BC%81%E4%B8%9A%E5%BA%94%E7%94%A8%E5%AE%9E%E6%88%98-%E7%AC%AC5%E7%89%88/%E7%AC%AC8%E7%AB%A0-%E6%B7%B1%E5%85%A5%E4%BD%BF%E7%94%A8Spring/" itemprop="url" rel="index"><span itemprop="name">第8章 深入使用Spring</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/2-%E8%BD%BB%E9%87%8F%E7%BA%A7Java-EE%E4%BC%81%E4%B8%9A%E5%BA%94%E7%94%A8%E5%AE%9E%E6%88%98-%E7%AC%AC5%E7%89%88/%E7%AC%AC8%E7%AB%A0-%E6%B7%B1%E5%85%A5%E4%BD%BF%E7%94%A8Spring/8-4-Spring%E7%9A%84AOP/" itemprop="url" rel="index"><span itemprop="name">8.4 Spring的AOP</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/2-%E8%BD%BB%E9%87%8F%E7%BA%A7Java-EE%E4%BC%81%E4%B8%9A%E5%BA%94%E7%94%A8%E5%AE%9E%E6%88%98-%E7%AC%AC5%E7%89%88/%E7%AC%AC8%E7%AB%A0-%E6%B7%B1%E5%85%A5%E4%BD%BF%E7%94%A8Spring/8-4-Spring%E7%9A%84AOP/8-4-5-%E5%9F%BA%E4%BA%8E%E6%B3%A8%E8%A7%A3%E7%9A%84-%E9%9B%B6%E9%85%8D%E7%BD%AE-%E6%96%B9%E5%BC%8F/" itemprop="url" rel="index"><span itemprop="name">8.4.5 基于注解的 零配置 方式</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
    <span class="post-meta-item-icon">
      <i class="far fa-comment"></i>
    </span>
    <span class="post-meta-item-text">Waline：</span>
  
    <a title="waline" href="/JavaReadingNotes/1ff1bbbc/#waline-comments" itemprop="discussionUrl">
      <span class="post-comments-count waline-comment-count" id="/JavaReadingNotes/1ff1bbbc/" data-xid="/JavaReadingNotes/1ff1bbbc/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>1.8k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>2 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="8-4-5-基于注解的-零配置-方式-5-After增强处理"><a href="#8-4-5-基于注解的-零配置-方式-5-After增强处理" class="headerlink" title="8.4.5 基于注解的 零配置 方式 5. After增强处理"></a>8.4.5 基于注解的 零配置 方式 5. After增强处理</h1><p><code>Spring</code>还提供了一个<code>After</code>增强处理,它与<code>AfterReturning</code>增强处理有点相似,但也有区别。</p>
<ol>
<li><code>AfterReturning</code>增强处理只有在目标方法成功执行结束后才会被织入</li>
<li><code>After</code>增强处理<strong>不管目标方法如何结束,它都会被织入</strong>。<code>PS</code>:方法结束包括<code>成功执行结束</code>或<code>遇到异常中止</code>这两种情况。</li>
</ol>
<p>因为<strong>不论一个方法是如何结束的, <code>After</code>增强处理都会被织入</strong>,因此<code>After</code>增强处理必须准备处理<code>正常返回</code>和<code>异常返回</code>两种情况,这种增强处理通常用于释放资源。<code>After</code>增强处理有点类似于<code>finally</code>块。</p>
<p>使用<code>@After</code>注解修饰一个方法,即可将该方法转成<code>After</code>增强处理。使用<code>@After</code>注解时需要指定个<code>value</code>属性,该属性值用于指定该增强处理被织入的切入点,既可是一个已有的切入点,也可直接指定切入点表达式。</p>
<h2 id="程序示例"><a href="#程序示例" class="headerlink" title="程序示例"></a>程序示例</h2><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">E:\<span class="title">workspace_QingLiangJiJavaEEQiYeYingYongShiZhang5</span>\<span class="title">After</span></span></span><br><span class="line"><span class="function">└─<span class="title">src</span>\</span></span><br><span class="line"><span class="function">  ├─<span class="title">beans.xml</span></span></span><br><span class="line"><span class="function">  ├─<span class="title">lee</span>\</span></span><br><span class="line"><span class="function">  │ └─<span class="title">BeanTest.java</span></span></span><br><span class="line"><span class="function">  └─<span class="title">org</span>\</span></span><br><span class="line"><span class="function">    └─<span class="title">crazyit</span>\</span></span><br><span class="line"><span class="function">      └─<span class="title">app</span>\</span></span><br><span class="line"><span class="function">        ├─<span class="title">aspect</span>\</span></span><br><span class="line"><span class="function">        │ └─<span class="title">ReleaseAspect.java</span></span></span><br><span class="line"><span class="function">        └─<span class="title">service</span>\</span></span><br><span class="line"><span class="function">          ├─<span class="title">Hello.java</span></span></span><br><span class="line"><span class="function">          ├─<span class="title">impl</span>\</span></span><br><span class="line"><span class="function">          │ ├─<span class="title">HelloImpl.java</span></span></span><br><span class="line"><span class="function">          │ └─<span class="title">WorldImpl.java</span></span></span><br><span class="line"><span class="function">          └─<span class="title">World.java</span></span></span><br></pre></td></tr></table></figure>
<p>下面的程序将定义一个<code>After</code>增强处理。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.crazyit.app.aspect;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.After;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Aspect;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义一个切面</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ReleaseAspect</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">// 匹配org.crazyit.app.service包下所有类的</span></span><br><span class="line">    <span class="comment">// 所有方法的执行作为切入点</span></span><br><span class="line">    <span class="meta">@After(&quot;execution(* org.crazyit.app.service.*.*(..))&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">release</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;模拟方法结束后的释放资源...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上面程序中的粗体字代码定义了一个<code>After</code>增强处理,不管切入点的目标方法如何结束,该增强处理都会被织入。该示例程序的目标对象依然使用<code>Hellolmpl</code>、 <code>WorldImpl</code>类, <code>HelloImpl</code>组件中的<code>deleteUser()</code>方法会因为抛出异常而结束。<br>主程序依然使用长度<code>-2</code>作为<code>deleteUser()</code>方法的参数,此时将可以看到如图8.3所示的效果。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">执行Hello组件的addUser添加用户：悟空</span><br><span class="line">模拟方法结束后的释放资源...</span><br><span class="line">模拟方法结束后的释放资源...</span><br><span class="line">Exception in thread &quot;main&quot; java.lang.IllegalArgumentException: 被删除用户的id不能小于0：-2</span><br><span class="line">    at org.crazyit.app.service.impl.HelloImpl.deleteUser(HelloImpl.java:14)</span><br><span class="line">    at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)</span><br><span class="line">    at sun.reflect.NativeMethodAccessorImpl.invoke(Unknown Source)</span><br><span class="line">    at sun.reflect.DelegatingMethodAccessorImpl.invoke(Unknown Source)</span><br><span class="line">       ......</span><br></pre></td></tr></table></figure>
<h2 id="After增强特别特别适合用于资源回收"><a href="#After增强特别特别适合用于资源回收" class="headerlink" title="After增强特别特别适合用于资源回收"></a>After增强特别特别适合用于资源回收</h2><p>从图8.13中可以看出,虽然<code>deleteUser</code>方法因为<code>legalArgumentException</code>异常结束,但<code>After</code>增强处理依然被正常织入。由此可见,<code>After</code>增强处理的作用非常类似于异常处理中<code>finally</code>块的作用—无论如何,它总会在方法执行结束之后被织入,因此特别适用于进行资源回收。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://lanlan2017.github.io/JavaReadingNotes/44da435c/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/JavaReadingNotes/images/avatar.gif">
      <meta itemprop="name" content="蓝蓝">
      <meta itemprop="description" content="好好学习，天天向上">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="蓝蓝站点">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/JavaReadingNotes/44da435c/" class="post-title-link" itemprop="url">8.4.5 基于注解的 零配置 方式 4. 定义AfterThrowing增强处理</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-09-04 21:58:07" itemprop="dateCreated datePublished" datetime="2019-09-04T21:58:07+08:00">2019-09-04</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2020-02-07 01:34:58" itemprop="dateModified" datetime="2020-02-07T01:34:58+08:00">2020-02-07</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/2-%E8%BD%BB%E9%87%8F%E7%BA%A7Java-EE%E4%BC%81%E4%B8%9A%E5%BA%94%E7%94%A8%E5%AE%9E%E6%88%98-%E7%AC%AC5%E7%89%88/" itemprop="url" rel="index"><span itemprop="name">2 轻量级Java EE企业应用实战(第5版)</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/2-%E8%BD%BB%E9%87%8F%E7%BA%A7Java-EE%E4%BC%81%E4%B8%9A%E5%BA%94%E7%94%A8%E5%AE%9E%E6%88%98-%E7%AC%AC5%E7%89%88/%E7%AC%AC8%E7%AB%A0-%E6%B7%B1%E5%85%A5%E4%BD%BF%E7%94%A8Spring/" itemprop="url" rel="index"><span itemprop="name">第8章 深入使用Spring</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/2-%E8%BD%BB%E9%87%8F%E7%BA%A7Java-EE%E4%BC%81%E4%B8%9A%E5%BA%94%E7%94%A8%E5%AE%9E%E6%88%98-%E7%AC%AC5%E7%89%88/%E7%AC%AC8%E7%AB%A0-%E6%B7%B1%E5%85%A5%E4%BD%BF%E7%94%A8Spring/8-4-Spring%E7%9A%84AOP/" itemprop="url" rel="index"><span itemprop="name">8.4 Spring的AOP</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/2-%E8%BD%BB%E9%87%8F%E7%BA%A7Java-EE%E4%BC%81%E4%B8%9A%E5%BA%94%E7%94%A8%E5%AE%9E%E6%88%98-%E7%AC%AC5%E7%89%88/%E7%AC%AC8%E7%AB%A0-%E6%B7%B1%E5%85%A5%E4%BD%BF%E7%94%A8Spring/8-4-Spring%E7%9A%84AOP/8-4-5-%E5%9F%BA%E4%BA%8E%E6%B3%A8%E8%A7%A3%E7%9A%84-%E9%9B%B6%E9%85%8D%E7%BD%AE-%E6%96%B9%E5%BC%8F/" itemprop="url" rel="index"><span itemprop="name">8.4.5 基于注解的 零配置 方式</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
    <span class="post-meta-item-icon">
      <i class="far fa-comment"></i>
    </span>
    <span class="post-meta-item-text">Waline：</span>
  
    <a title="waline" href="/JavaReadingNotes/44da435c/#waline-comments" itemprop="discussionUrl">
      <span class="post-comments-count waline-comment-count" id="/JavaReadingNotes/44da435c/" data-xid="/JavaReadingNotes/44da435c/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>3.1k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>3 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="8-4-5-基于注解的-零配置-方式-4-定义AfterThrowing增强处理"><a href="#8-4-5-基于注解的-零配置-方式-4-定义AfterThrowing增强处理" class="headerlink" title="8.4.5 基于注解的 零配置 方式 4. 定义AfterThrowing增强处理"></a>8.4.5 基于注解的 零配置 方式 4. 定义AfterThrowing增强处理</h1><p>使用<code>@AfterThrowing</code>注解可修饰<code>AfterThrowing</code>增强处理, <strong><code>AfterThrowing</code>增强处理主要用于处理程序中未处理的异常</strong>。<br>使用<code>@AfterThrowing</code>注解时可指定如下两个常用属性。</p>
<table>
<thead>
<tr>
<th align="left">属性</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>pointcut或者value</code></td>
<td align="left">这两个属性的作用是一样的,它们都用于<code>指定该切入点对应的切入表达式</code>。样既可是一个已有的切入点,也可直接定义切入点表达式。当指定了<code>pointcut</code>属性值后, <code>value</code>属性值将会被覆盖。</td>
</tr>
<tr>
<td align="left"><code>throwing</code></td>
<td align="left">该属性值指定一个形参名,用于表示<code>Advice</code>方法中可定义与此同名的形参,该形参<strong>可用于访问目标方法抛出的异常</strong>。除此之外,在<code>Advice</code>方法中<strong>定义该形参时如果指定了类型,则会限制目标方法必须是抛出该类型的异常的方法</strong>。</td>
</tr>
</tbody></table>
<h2 id="程序示例"><a href="#程序示例" class="headerlink" title="程序示例"></a>程序示例</h2><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">E:\<span class="title">workspace_QingLiangJiJavaEEQiYeYingYongShiZhang5</span>\<span class="title">AfterThrowing</span></span></span><br><span class="line"><span class="function">└─<span class="title">src</span>\</span></span><br><span class="line"><span class="function">  ├─<span class="title">beans.xml</span></span></span><br><span class="line"><span class="function">  ├─<span class="title">lee</span>\</span></span><br><span class="line"><span class="function">  │ └─<span class="title">BeanTest.java</span></span></span><br><span class="line"><span class="function">  └─<span class="title">org</span>\</span></span><br><span class="line"><span class="function">    └─<span class="title">crazyit</span>\</span></span><br><span class="line"><span class="function">      └─<span class="title">app</span>\</span></span><br><span class="line"><span class="function">        ├─<span class="title">aspect</span>\</span></span><br><span class="line"><span class="function">        │ └─<span class="title">RepairAspect.java</span></span></span><br><span class="line"><span class="function">        └─<span class="title">service</span>\</span></span><br><span class="line"><span class="function">          ├─<span class="title">Hello.java</span></span></span><br><span class="line"><span class="function">          ├─<span class="title">impl</span>\</span></span><br><span class="line"><span class="function">          │ ├─<span class="title">HelloImpl.java</span></span></span><br><span class="line"><span class="function">          │ └─<span class="title">WorldImpl.java</span></span></span><br><span class="line"><span class="function">          └─<span class="title">World.java</span></span></span><br></pre></td></tr></table></figure>
<p>下面的程序定义了一个<code>AfterThrowing</code>增强处理。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.crazyit.app.aspect;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.AfterThrowing;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Aspect;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义一个切面</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RepairAspect</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">// 匹配org.crazyit.app.service.impl包下所有类的所有方法的执行作为切入点</span></span><br><span class="line">    <span class="meta">@AfterThrowing(</span></span><br><span class="line"><span class="meta">        throwing = &quot;ex&quot;, </span></span><br><span class="line"><span class="meta">        pointcut = &quot;execution(* org.crazyit.app.service.impl.*.*(..))&quot;</span></span><br><span class="line"><span class="meta">    )</span></span><br><span class="line">    <span class="comment">// 声明ex时指定的类型会限制目标方法必须抛出指定类型的异常</span></span><br><span class="line">    <span class="comment">// 此处将ex的类型声明为Throwable，意味着对目标方法抛出的异常不加限制</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doRecoveryActions</span><span class="params">(Throwable ex)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;目标方法中抛出的异常:&quot;</span> + ex);</span><br><span class="line">        System.out.println(<span class="string">&quot;模拟Advice对异常的修复...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>正如在上面的程序中看到的,程序中使用<code>@AfterThrowing</code>注解时指定了一个<code>throwing</code>属性,该属性值为<code>ex</code>,这允许在增强处理方法<code>doRecoveryActions</code>中定义名为<code>ex</code>的形参,程序可通<strong>过该形参访问目标方法所抛出的异常</strong>。<br>将前面示例中的<code>HelloImpl.java</code>类做一些修改,用于模拟程序抛出异常,修改后的<code>Hellolmpl.java</code>类的代码如下:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.crazyit.app.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.crazyit.app.service.*;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component(&quot;hello&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloImpl</span> <span class="keyword">implements</span> <span class="title">Hello</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">// 定义一个deleteUser方法，模拟应用中删除用户的方法</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteUser</span><span class="params">(Integer id)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (id &lt; <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">&quot;被删除用户的id不能小于0：&quot;</span> + id);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;执行Hello组件的deleteUser删除用户：&quot;</span> + id);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 定义一个addUser()方法，模拟应用中的添加用户的方法</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">addUser</span><span class="params">(String name , String pass)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;执行Hello组件的addUser添加用户：&quot;</span> + name);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">20</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上面程序中的<code>deleteUser()</code>方法可能抛出异常,当调用<code>deleteUser()</code>方法传入的参数小于0时,<code>deleteUser()</code>方法就会抛出异常,且该异常没有被任何程序所处理,故<code>Spring AOP</code>会对该异常进行处理。<br>该示例的主程序略作改变,将调用<code>deleteUser()</code>方法的参数改为<code>-2</code>。运行该主程序,将看到如下效果。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">执行Hello组件的addUser添加用户：悟空</span><br><span class="line">目标方法中抛出的异常:java.lang.IllegalArgumentException: 被删除用户的id不能小于0：-2</span><br><span class="line">模拟Advice对异常的修复...</span><br><span class="line">Exception in thread &quot;main&quot; java.lang.IllegalArgumentException: 被删除用户的id不能小于0：-2</span><br><span class="line">    at org.crazyit.app.service.impl.HelloImpl.deleteUser(HelloImpl.java:15)</span><br><span class="line">    at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)</span><br><span class="line">    at sun.reflect.NativeMethodAccessorImpl.invoke(Unknown Source)</span><br><span class="line">    ...</span><br></pre></td></tr></table></figure>
<h2 id="throwing属性增强处理方法接收异常的参数"><a href="#throwing属性增强处理方法接收异常的参数" class="headerlink" title="throwing属性增强处理方法接收异常的参数"></a>throwing属性增强处理方法接收异常的参数</h2><p>可以看到的,<code>@AfterThrowing</code>注解的<code>throwing</code>属性中指定的参数名必须与增强处理方法内的一个形参对应。当目标方法抛出一个未处理的异常时,该异常将会传给增强处理方法对应的参数。</p>
<h2 id="使用throwing属性限定触发的异常类型"><a href="#使用throwing属性限定触发的异常类型" class="headerlink" title="使用throwing属性限定触发的异常类型"></a>使用throwing属性限定触发的异常类型</h2><p>使用<code>throwing</code>属性还有一个额外的作用:它可用于限定切入点只匹配指定类型的异常；假如在上面的<code>doRecoveryActions()</code>方法中定义了<code>ex</code>形参的类型是<code>NullPointerException</code>,则该切入点只匹配抛出<code>NullPointerException</code>异常的方法。上面<code>doRecoveryActions</code>方法的<code>ex</code>形参类型是<code>Throwable</code>,这表明该切入点可匹配拋出任何异常的情况。</p>
<h2 id="AOP的AfterThrowing处理与catch语句的不同"><a href="#AOP的AfterThrowing处理与catch语句的不同" class="headerlink" title="AOP的AfterThrowing处理与catch语句的不同"></a>AOP的AfterThrowing处理与catch语句的不同</h2><p><code>AOP</code>的<code>AfterThrowing</code>处理虽然可以对目标方法的异常进行处理,但这种处理与直接使用<code>catch</code>捕捉不同:<br><code>catch</code>捕捉意味着完全处理该异常,如果<code>catch</code>块中没有重新抛出新异常,则该方法可以正常结束;<br><code>AfterThrowing</code>处理虽然处理了该异常,但它不能完全处理该异常,该异常依然会传播到上一级调用者,在本示例程序中异常直接传播到<code>JVM</code>,故导致程序中止。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://lanlan2017.github.io/JavaReadingNotes/6ef87db2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/JavaReadingNotes/images/avatar.gif">
      <meta itemprop="name" content="蓝蓝">
      <meta itemprop="description" content="好好学习，天天向上">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="蓝蓝站点">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/JavaReadingNotes/6ef87db2/" class="post-title-link" itemprop="url">8.4.5 基于注解的 零配置 方式 3. 定义AfterReturning增强处理</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-09-04 21:56:56" itemprop="dateCreated datePublished" datetime="2019-09-04T21:56:56+08:00">2019-09-04</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2020-02-07 01:34:58" itemprop="dateModified" datetime="2020-02-07T01:34:58+08:00">2020-02-07</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/2-%E8%BD%BB%E9%87%8F%E7%BA%A7Java-EE%E4%BC%81%E4%B8%9A%E5%BA%94%E7%94%A8%E5%AE%9E%E6%88%98-%E7%AC%AC5%E7%89%88/" itemprop="url" rel="index"><span itemprop="name">2 轻量级Java EE企业应用实战(第5版)</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/2-%E8%BD%BB%E9%87%8F%E7%BA%A7Java-EE%E4%BC%81%E4%B8%9A%E5%BA%94%E7%94%A8%E5%AE%9E%E6%88%98-%E7%AC%AC5%E7%89%88/%E7%AC%AC8%E7%AB%A0-%E6%B7%B1%E5%85%A5%E4%BD%BF%E7%94%A8Spring/" itemprop="url" rel="index"><span itemprop="name">第8章 深入使用Spring</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/2-%E8%BD%BB%E9%87%8F%E7%BA%A7Java-EE%E4%BC%81%E4%B8%9A%E5%BA%94%E7%94%A8%E5%AE%9E%E6%88%98-%E7%AC%AC5%E7%89%88/%E7%AC%AC8%E7%AB%A0-%E6%B7%B1%E5%85%A5%E4%BD%BF%E7%94%A8Spring/8-4-Spring%E7%9A%84AOP/" itemprop="url" rel="index"><span itemprop="name">8.4 Spring的AOP</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/2-%E8%BD%BB%E9%87%8F%E7%BA%A7Java-EE%E4%BC%81%E4%B8%9A%E5%BA%94%E7%94%A8%E5%AE%9E%E6%88%98-%E7%AC%AC5%E7%89%88/%E7%AC%AC8%E7%AB%A0-%E6%B7%B1%E5%85%A5%E4%BD%BF%E7%94%A8Spring/8-4-Spring%E7%9A%84AOP/8-4-5-%E5%9F%BA%E4%BA%8E%E6%B3%A8%E8%A7%A3%E7%9A%84-%E9%9B%B6%E9%85%8D%E7%BD%AE-%E6%96%B9%E5%BC%8F/" itemprop="url" rel="index"><span itemprop="name">8.4.5 基于注解的 零配置 方式</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
    <span class="post-meta-item-icon">
      <i class="far fa-comment"></i>
    </span>
    <span class="post-meta-item-text">Waline：</span>
  
    <a title="waline" href="/JavaReadingNotes/6ef87db2/#waline-comments" itemprop="discussionUrl">
      <span class="post-comments-count waline-comment-count" id="/JavaReadingNotes/6ef87db2/" data-xid="/JavaReadingNotes/6ef87db2/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>2k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>2 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="8-4-5-基于注解的-零配置-方式-3-定义AfterReturning增强处理"><a href="#8-4-5-基于注解的-零配置-方式-3-定义AfterReturning增强处理" class="headerlink" title="8.4.5 基于注解的 零配置 方式 3. 定义AfterReturning增强处理"></a>8.4.5 基于注解的 零配置 方式 3. 定义AfterReturning增强处理</h1><p>类似于使用<code>@Before</code>注解可修饰<code>Before</code>增强处理,使用<code>@AfterReturning</code>可修饰<code>AfterReturning</code>增强处理, <code>AfterReturning</code>增强处理将在目标方法正常完成后被织入</p>
<h2 id="AfterReturning注解属性"><a href="#AfterReturning注解属性" class="headerlink" title="@AfterReturning注解属性"></a>@AfterReturning注解属性</h2><p>使用<code>@AfterReturning</code>注解可指定如下两个常用属性。</p>
<table>
<thead>
<tr>
<th align="left">属性</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>pointcut或者value</code></td>
<td align="left">这两个属性的作用是一样的,它们都<strong>用于指定该切入点对应的切入表达式</strong>。样既可是一个已有的切入点,也可直接定义切入点表达式。当指定了<code>pointcut</code>属性值后, <code>value</code>属性值将会被覆盖。</td>
</tr>
<tr>
<td align="left"><code>returning</code></td>
<td align="left">该属性值指定一个形参名,用于表示<code>Advice</code>方法中可定义与此同名的形参,**该形参可<code>用于访问目标方法的返回值</code>**。除此之外,在<code>Advice</code>方法中定义该形参(代表目标方法的返回值)时<code>指定具体类型</code>,会限制目标方法<code>必须返回该类型的值</code>。</td>
</tr>
</tbody></table>
<h2 id="程序示例"><a href="#程序示例" class="headerlink" title="程序示例"></a>程序示例</h2><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">E:\<span class="title">workspace_QingLiangJiJavaEEQiYeYingYongShiZhang5</span>\<span class="title">AfterReturning</span></span></span><br><span class="line"><span class="function">└─<span class="title">src</span>\</span></span><br><span class="line"><span class="function">  ├─<span class="title">beans.xml</span></span></span><br><span class="line"><span class="function">  ├─<span class="title">lee</span>\</span></span><br><span class="line"><span class="function">  │ └─<span class="title">BeanTest.java</span></span></span><br><span class="line"><span class="function">  └─<span class="title">org</span>\</span></span><br><span class="line"><span class="function">    └─<span class="title">crazyit</span>\</span></span><br><span class="line"><span class="function">      └─<span class="title">app</span>\</span></span><br><span class="line"><span class="function">        ├─<span class="title">aspect</span>\</span></span><br><span class="line"><span class="function">        │ └─<span class="title">LogAspect.java</span></span></span><br><span class="line"><span class="function">        └─<span class="title">service</span>\</span></span><br><span class="line"><span class="function">          ├─<span class="title">Hello.java</span></span></span><br><span class="line"><span class="function">          ├─<span class="title">impl</span>\</span></span><br><span class="line"><span class="function">          │ ├─<span class="title">HelloImpl.java</span></span></span><br><span class="line"><span class="function">          │ └─<span class="title">WorldImpl.java</span></span></span><br><span class="line"><span class="function">          └─<span class="title">World.java</span></span></span><br></pre></td></tr></table></figure>
<p>下面的程序定义了一个<code>AfterReturning</code>增强处理。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.crazyit.app.aspect;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.AfterReturning;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Aspect;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义一个切面</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LogAspect</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">// 匹配org.crazyit.app.service.impl包下所有类的、</span></span><br><span class="line">    <span class="comment">// 所有方法的执行作为切入点</span></span><br><span class="line">    <span class="meta">@AfterReturning(</span></span><br><span class="line"><span class="meta">        returning = &quot;rvt&quot;, </span></span><br><span class="line"><span class="meta">        pointcut = &quot;execution(* org.crazyit.app.service.impl.*.*(..))&quot;</span></span><br><span class="line"><span class="meta">    )</span></span><br><span class="line">    <span class="comment">// 声明rvt时指定的类型会限制目标方法必须返回指定类型的值或没有返回值</span></span><br><span class="line">    <span class="comment">// 此处将rvt的类型声明为Object，意味着对目标方法的返回值不加限制</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">log</span><span class="params">(Object rvt)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;获取目标方法返回值:&quot;</span> + rvt);</span><br><span class="line">        System.out.println(<span class="string">&quot;模拟记录日志功能...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>正如在上面的程序中看到的,程序中使用<code>@AfterReturning</code>注解时,指定了一个<code>returning</code>属性,该属性值为<code>rvt</code>,这表明允许在<code>Advice</code>方法(<code>log()</code>方法)中定义名为<code>rvt</code>的形参,<strong>程序可通过<code>rvt</code>形参来访问目标方法的返回值</strong>。</p>
<p>运行该应用的主程序,控制台输出如下:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">执行Hello组件的addUser添加用户：孙悟空</span><br><span class="line">获取目标方法返回值:20</span><br><span class="line">模拟记录日志功能...</span><br><span class="line">执行Hello组件的deleteUser删除用户：1</span><br><span class="line">获取目标方法返回值:null</span><br><span class="line">模拟记录日志功能...</span><br><span class="line">执行World组件的bar()方法</span><br><span class="line">获取目标方法返回值:null</span><br><span class="line">模拟记录日志功能...</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="returning属性接收目标方法的返回值"><a href="#returning属性接收目标方法的返回值" class="headerlink" title="returning属性接收目标方法的返回值"></a>returning属性接收目标方法的返回值</h2><p><code>@AfterReturning</code>注解的<code>returning</code>属性所指定的形参名必须对应于增强处理中的一个形参名,<strong>当目标方法执行返回后,返回值作为相应的参数值传入增强处理方法</strong>。</p>
<h2 id="returning属性限制切入点只匹配特定返回值的方法"><a href="#returning属性限制切入点只匹配特定返回值的方法" class="headerlink" title="returning属性限制切入点只匹配特定返回值的方法"></a>returning属性限制切入点只匹配特定返回值的方法</h2><p>使用<code>returning</code>属性还有一个额外的作用:它可<strong>用于限定切入点只匹配具有对应返回值类型的方法</strong>,假如在上面的<code>log()</code>方法中定义<code>rvt</code>形参的类型是<code>String</code>,则该切入点只匹配<code>org.crazyit.appservice.impl</code>包下返回值类型为**<code>String</code>的方法或者没有返回值的方法**。当然,上面<code>log()</code>方法的<code>rvt</code>形参的类型是<code>Object</code>,这表明该切入点可匹配任何返回值类型的方法.</p>
<h2 id="AfterReturning增强不能改变目标方法的返回值"><a href="#AfterReturning增强不能改变目标方法的返回值" class="headerlink" title="AfterReturning增强不能改变目标方法的返回值"></a>AfterReturning增强不能改变目标方法的返回值</h2><p>注意:虽然<code>AfterReturning</code>增强处理可以访问到目标方法的返回值,但它<strong>不可以改变目标方法的返回值</strong></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://lanlan2017.github.io/JavaReadingNotes/b708f5c5/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/JavaReadingNotes/images/avatar.gif">
      <meta itemprop="name" content="蓝蓝">
      <meta itemprop="description" content="好好学习，天天向上">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="蓝蓝站点">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/JavaReadingNotes/b708f5c5/" class="post-title-link" itemprop="url">8.4.5 基于注解的 零配置 方式 2. 定义Before增强处理</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-09-04 21:55:58" itemprop="dateCreated datePublished" datetime="2019-09-04T21:55:58+08:00">2019-09-04</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2020-02-07 01:34:58" itemprop="dateModified" datetime="2020-02-07T01:34:58+08:00">2020-02-07</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/2-%E8%BD%BB%E9%87%8F%E7%BA%A7Java-EE%E4%BC%81%E4%B8%9A%E5%BA%94%E7%94%A8%E5%AE%9E%E6%88%98-%E7%AC%AC5%E7%89%88/" itemprop="url" rel="index"><span itemprop="name">2 轻量级Java EE企业应用实战(第5版)</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/2-%E8%BD%BB%E9%87%8F%E7%BA%A7Java-EE%E4%BC%81%E4%B8%9A%E5%BA%94%E7%94%A8%E5%AE%9E%E6%88%98-%E7%AC%AC5%E7%89%88/%E7%AC%AC8%E7%AB%A0-%E6%B7%B1%E5%85%A5%E4%BD%BF%E7%94%A8Spring/" itemprop="url" rel="index"><span itemprop="name">第8章 深入使用Spring</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/2-%E8%BD%BB%E9%87%8F%E7%BA%A7Java-EE%E4%BC%81%E4%B8%9A%E5%BA%94%E7%94%A8%E5%AE%9E%E6%88%98-%E7%AC%AC5%E7%89%88/%E7%AC%AC8%E7%AB%A0-%E6%B7%B1%E5%85%A5%E4%BD%BF%E7%94%A8Spring/8-4-Spring%E7%9A%84AOP/" itemprop="url" rel="index"><span itemprop="name">8.4 Spring的AOP</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/2-%E8%BD%BB%E9%87%8F%E7%BA%A7Java-EE%E4%BC%81%E4%B8%9A%E5%BA%94%E7%94%A8%E5%AE%9E%E6%88%98-%E7%AC%AC5%E7%89%88/%E7%AC%AC8%E7%AB%A0-%E6%B7%B1%E5%85%A5%E4%BD%BF%E7%94%A8Spring/8-4-Spring%E7%9A%84AOP/8-4-5-%E5%9F%BA%E4%BA%8E%E6%B3%A8%E8%A7%A3%E7%9A%84-%E9%9B%B6%E9%85%8D%E7%BD%AE-%E6%96%B9%E5%BC%8F/" itemprop="url" rel="index"><span itemprop="name">8.4.5 基于注解的 零配置 方式</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
    <span class="post-meta-item-icon">
      <i class="far fa-comment"></i>
    </span>
    <span class="post-meta-item-text">Waline：</span>
  
    <a title="waline" href="/JavaReadingNotes/b708f5c5/#waline-comments" itemprop="discussionUrl">
      <span class="post-comments-count waline-comment-count" id="/JavaReadingNotes/b708f5c5/" data-xid="/JavaReadingNotes/b708f5c5/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>3.8k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>3 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="8-4-5-基于注解的-零配置-方式-2-定义Before增强处理"><a href="#8-4-5-基于注解的-零配置-方式-2-定义Before增强处理" class="headerlink" title="8.4.5 基于注解的 零配置 方式 2. 定义Before增强处理"></a>8.4.5 基于注解的 零配置 方式 2. 定义Before增强处理</h1><p>在一个<code>切面类</code>(用<code>@Aspect</code>修饰的类)里使用<code>@Before</code>来修饰一个方法时,该方法将作为<code>Before</code>增强处理。使用<code>@Before</code>修饰时,通常需要指定一个<code>value</code>属性值,该属性值指定一个<code>切入点表达式</code>,用于指定该增强处理将被织入哪些切入点。(这个<code>切入点表达式</code>既可以是一个已有的切入点,也可以直接定义切入点表达式)</p>
<h2 id="程序示例"><a href="#程序示例" class="headerlink" title="程序示例"></a>程序示例</h2><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">E:\<span class="title">workspace_QingLiangJiJavaEEQiYeYingYongShiZhang5</span>\<span class="title">Before</span></span></span><br><span class="line"><span class="function">└─<span class="title">src</span>\</span></span><br><span class="line"><span class="function">  ├─<span class="title">beans.xml</span></span></span><br><span class="line"><span class="function">  ├─<span class="title">lee</span>\</span></span><br><span class="line"><span class="function">  │ └─<span class="title">BeanTest.java</span></span></span><br><span class="line"><span class="function">  └─<span class="title">org</span>\</span></span><br><span class="line"><span class="function">    └─<span class="title">crazyit</span>\</span></span><br><span class="line"><span class="function">      └─<span class="title">app</span>\</span></span><br><span class="line"><span class="function">        ├─<span class="title">aspect</span>\</span></span><br><span class="line"><span class="function">        │ └─<span class="title">AuthAspect.java</span></span></span><br><span class="line"><span class="function">        └─<span class="title">service</span>\</span></span><br><span class="line"><span class="function">          ├─<span class="title">Hello.java</span></span></span><br><span class="line"><span class="function">          ├─<span class="title">impl</span>\</span></span><br><span class="line"><span class="function">          │ ├─<span class="title">HelloImpl.java</span></span></span><br><span class="line"><span class="function">          │ └─<span class="title">WorldImpl.java</span></span></span><br><span class="line"><span class="function">          └─<span class="title">World.java</span></span></span><br></pre></td></tr></table></figure>
<p>下面的<code>Java</code>类里使用<code>@Before</code>定义了一个<code>Before</code>增强处理。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.crazyit.app.aspect;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Aspect;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Before;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义一个切面</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AuthAspect</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">// 匹配org.crazyit.app.service.impl包下所有类的、</span></span><br><span class="line">    <span class="comment">// 所有方法的执行作为切入点</span></span><br><span class="line">    <span class="meta">@Before(&quot;execution(* org.crazyit.app.service.impl.*.*(..))&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">authority</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;模拟执行权限检查&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上面程序使用<code>@Aspect</code>修饰了<code>AuthAspect</code>类,这表明该类是一个切面类,在该切面里定义了一个<code>authority</code>方法—这个方法本来没有任何特殊之处,但<strong>因为使用了<code>@Before</code>来标注该方法,这就将该方法转换成了一个<code>Before</code>增强处理</strong>。<br>上面程序中使用<code>@Before</code>注解时,直接指定了切入点表达式,指定匹配<code>org.crazyit.app.service.impl</code>包下所有类的所有方法的执行作为切入点。<br>本应用在<code>org.crazyit.app.service.impl</code>包下定义了两个类:<code>HelloImpl</code>和<code>WorldImpl</code>,它们与前面介绍<code>AspectJ</code>时所用的两个业务组件类几乎相同(只是增加实现了一个接口),并使用了<code>@Component</code>注解进行修饰。下面是其中<code>HelloImpl</code>类的代码。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.crazyit.app.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"><span class="keyword">import</span> org.crazyit.app.service.*;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component(&quot;hello&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloImpl</span> <span class="keyword">implements</span> <span class="title">Hello</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">// 定义一个deleteUser方法，模拟应用中删除用户的方法</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteUser</span><span class="params">(Integer id)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;执行Hello组件的deleteUser删除用户：&quot;</span> + id);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 定义一个addUser()方法，模拟应用中的添加用户的方法</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">addUser</span><span class="params">(String name, String pass)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;执行Hello组件的addUser添加用户：&quot;</span> + name);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">20</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>从上面的<code>HelloImpl</code>类代码来看,它是一个如此”纯净”的<code>Java</code>类,它丝毫不知道将被谁来进行增强,也不知道将被进行怎样的增强——但正因为<code>HelloImpl</code>类的这种”无知”,才是<code>AOP</code>的最大魅力:<strong>目标类可以被无限地增强</strong>。<br>在<code>Spring</code>配置文件中配置自动搜索<code>Bean</code>组件、自动搜索切面类, <code>Spring AOP</code>自动对<code>Bean</code>组件进行增强。下面是<code>Spring</code>配置文件代码。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;GBK&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:aop</span>=<span class="string">&quot;http://www.springframework.org/schema/aop&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans </span></span></span><br><span class="line"><span class="string"><span class="tag">    http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">    http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="string"><span class="tag">    http://www.springframework.org/schema/context/spring-context.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">    http://www.springframework.org/schema/aop</span></span></span><br><span class="line"><span class="string"><span class="tag">    http://www.springframework.org/schema/aop/spring-aop.xsd&quot;</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- 指定自动搜索Bean组件、自动搜索切面类 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span></span></span><br><span class="line"><span class="tag">        <span class="attr">base-package</span>=<span class="string">&quot;org.crazyit.app.service,org.crazyit.app.aspect&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">context:include-filter</span> <span class="attr">type</span>=<span class="string">&quot;annotation&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">expression</span>=<span class="string">&quot;org.aspectj.lang.annotation.Aspect&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- 启动@AspectJ支持 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:aspectj-autoproxy</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>主程序非常简单,通过<code>Spring</code>容器获取<code>hello</code>和<code>word</code>这两个<code>Bean</code>,并调用了这两个<code>Bean</code>的业务方法。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> lee;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.context.*;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.support.*;</span><br><span class="line"><span class="keyword">import</span> org.crazyit.app.service.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BeanTest</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// 创建Spring容器</span></span><br><span class="line">        <span class="meta">@SuppressWarnings(&quot;resource&quot;)</span></span><br><span class="line">        ApplicationContext ctx = <span class="keyword">new</span> ClassPathXmlApplicationContext(</span><br><span class="line">                <span class="string">&quot;beans.xml&quot;</span>);</span><br><span class="line">        Hello hello = ctx.getBean(<span class="string">&quot;hello&quot;</span>, Hello.class);</span><br><span class="line">        hello.addUser(<span class="string">&quot;孙悟空&quot;</span>, <span class="string">&quot;7788&quot;</span>);</span><br><span class="line">        hello.deleteUser(<span class="number">1</span>);</span><br><span class="line">        World world = ctx.getBean(<span class="string">&quot;world&quot;</span>, World.class);</span><br><span class="line">        world.bar();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>执行主程序,将在控制台中看到下所示的效果</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">模拟执行权限检查</span><br><span class="line">执行Hello组件的addUser添加用户：孙悟空</span><br><span class="line">模拟执行权限检查</span><br><span class="line">执行Hello组件的deleteUser删除用户：1</span><br><span class="line">模拟执行权限检查</span><br><span class="line">执行World组件的bar()方法</span><br></pre></td></tr></table></figure>
<p>使用<code>Before</code>增强处理只能在目标方法执行之前织入增强,如果<code>Before</code>增强处理没有特殊处理,目标方法总会自动执行,如果<code>Before</code>处理需要阻止目标方法的执行,可通过抛出一个异常来实现。**<code>Before</code>增强处理执行时,目标方法还未获得执行的机会,所以<code>Before</code>增强处理无法访问目标方法的返回值**。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://lanlan2017.github.io/JavaReadingNotes/7003060/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/JavaReadingNotes/images/avatar.gif">
      <meta itemprop="name" content="蓝蓝">
      <meta itemprop="description" content="好好学习，天天向上">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="蓝蓝站点">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/JavaReadingNotes/7003060/" class="post-title-link" itemprop="url">8.4.5 基于注解的 零配置 方式 1. 定义切面Bean</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-09-04 21:54:48" itemprop="dateCreated datePublished" datetime="2019-09-04T21:54:48+08:00">2019-09-04</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2020-02-07 01:34:58" itemprop="dateModified" datetime="2020-02-07T01:34:58+08:00">2020-02-07</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/2-%E8%BD%BB%E9%87%8F%E7%BA%A7Java-EE%E4%BC%81%E4%B8%9A%E5%BA%94%E7%94%A8%E5%AE%9E%E6%88%98-%E7%AC%AC5%E7%89%88/" itemprop="url" rel="index"><span itemprop="name">2 轻量级Java EE企业应用实战(第5版)</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/2-%E8%BD%BB%E9%87%8F%E7%BA%A7Java-EE%E4%BC%81%E4%B8%9A%E5%BA%94%E7%94%A8%E5%AE%9E%E6%88%98-%E7%AC%AC5%E7%89%88/%E7%AC%AC8%E7%AB%A0-%E6%B7%B1%E5%85%A5%E4%BD%BF%E7%94%A8Spring/" itemprop="url" rel="index"><span itemprop="name">第8章 深入使用Spring</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/2-%E8%BD%BB%E9%87%8F%E7%BA%A7Java-EE%E4%BC%81%E4%B8%9A%E5%BA%94%E7%94%A8%E5%AE%9E%E6%88%98-%E7%AC%AC5%E7%89%88/%E7%AC%AC8%E7%AB%A0-%E6%B7%B1%E5%85%A5%E4%BD%BF%E7%94%A8Spring/8-4-Spring%E7%9A%84AOP/" itemprop="url" rel="index"><span itemprop="name">8.4 Spring的AOP</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/2-%E8%BD%BB%E9%87%8F%E7%BA%A7Java-EE%E4%BC%81%E4%B8%9A%E5%BA%94%E7%94%A8%E5%AE%9E%E6%88%98-%E7%AC%AC5%E7%89%88/%E7%AC%AC8%E7%AB%A0-%E6%B7%B1%E5%85%A5%E4%BD%BF%E7%94%A8Spring/8-4-Spring%E7%9A%84AOP/8-4-5-%E5%9F%BA%E4%BA%8E%E6%B3%A8%E8%A7%A3%E7%9A%84-%E9%9B%B6%E9%85%8D%E7%BD%AE-%E6%96%B9%E5%BC%8F/" itemprop="url" rel="index"><span itemprop="name">8.4.5 基于注解的 零配置 方式</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
    <span class="post-meta-item-icon">
      <i class="far fa-comment"></i>
    </span>
    <span class="post-meta-item-text">Waline：</span>
  
    <a title="waline" href="/JavaReadingNotes/7003060/#waline-comments" itemprop="discussionUrl">
      <span class="post-comments-count waline-comment-count" id="/JavaReadingNotes/7003060/" data-xid="/JavaReadingNotes/7003060/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>626</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>1 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="8-4-5-基于注解的-零配置-方式-1-定义切面Bean"><a href="#8-4-5-基于注解的-零配置-方式-1-定义切面Bean" class="headerlink" title="8.4.5 基于注解的 零配置 方式 1. 定义切面Bean"></a>8.4.5 基于注解的 零配置 方式 1. 定义切面Bean</h1><p>当启动了<code>@AspectJ</code>支持后,只要在<code>Spring</code>容器中配置一个带<code>@Aspect</code>注解的<code>Bean</code>,<code>Spring</code>将会自动识别该<code>Bean</code>,并将该<code>Bean</code>作为切面处理。</p>
<h2 id="在Spring容器中配置切面Bean与配置普通Bean一样"><a href="#在Spring容器中配置切面Bean与配置普通Bean一样" class="headerlink" title="在Spring容器中配置切面Bean与配置普通Bean一样"></a>在Spring容器中配置切面Bean与配置普通Bean一样</h2><p>在<code>Spring</code>容器中配置切面<code>Bean</code>(即带<code>@Aspect</code>注解的<code>Bean)</code>与配置普通<code>Bean</code>没有任何区别,一样使用<code>&lt;bean&gt;</code>元素进行配置,一样支持使用依赖注入来配置属性值;如果启动了<code>Spring</code>的”零配置”特性,一样可以让<code>Spring</code>自动搜索,并加载指定路径下的切面<code>Bean</code>。</p>
<p>使用<code>@Aspect</code>标注一个<code>Java</code>类,该<code>Java</code>类将会作为切面<code>Bean</code>,如下面的代码片段所示。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 使用Aspect定义一个切面类</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LogAspect</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">//定义该类的其他内容</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>切面类(用<code>@Aspect</code>修饰的类)和其他类一样可以定义<code>方法</code>、定义<code>成员变量</code>,<strong>还可能包括切入点、增强处理定义</strong>。<br>当使用<code>@Aspect</code>来修饰一个<code>Java</code>类之后, <code>Spring</code>将不会把该<code>Bean</code>当成组件<code>Bean</code>处理,因此负责自动增强的后处理<code>Bean</code>将会略过该<code>Bean</code>,不会对该<code>Bean</code>进行任何增强处理。<br>开发时无须担心使用<code>@Aspect</code>定义的切面类被增强处理,当<code>Spring</code>容器检测到某个<code>Bean</code>类使用了<code>Aspect</code>修饰之后, <code>Spring</code>容器不会对该<code>Bean</code>类进行增强。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://lanlan2017.github.io/JavaReadingNotes/329ff710/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/JavaReadingNotes/images/avatar.gif">
      <meta itemprop="name" content="蓝蓝">
      <meta itemprop="description" content="好好学习，天天向上">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="蓝蓝站点">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/JavaReadingNotes/329ff710/" class="post-title-link" itemprop="url">8.4.5 基于注解的 零配置 方式</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-09-03 23:21:01" itemprop="dateCreated datePublished" datetime="2019-09-03T23:21:01+08:00">2019-09-03</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2020-02-07 01:34:58" itemprop="dateModified" datetime="2020-02-07T01:34:58+08:00">2020-02-07</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/2-%E8%BD%BB%E9%87%8F%E7%BA%A7Java-EE%E4%BC%81%E4%B8%9A%E5%BA%94%E7%94%A8%E5%AE%9E%E6%88%98-%E7%AC%AC5%E7%89%88/" itemprop="url" rel="index"><span itemprop="name">2 轻量级Java EE企业应用实战(第5版)</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/2-%E8%BD%BB%E9%87%8F%E7%BA%A7Java-EE%E4%BC%81%E4%B8%9A%E5%BA%94%E7%94%A8%E5%AE%9E%E6%88%98-%E7%AC%AC5%E7%89%88/%E7%AC%AC8%E7%AB%A0-%E6%B7%B1%E5%85%A5%E4%BD%BF%E7%94%A8Spring/" itemprop="url" rel="index"><span itemprop="name">第8章 深入使用Spring</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/2-%E8%BD%BB%E9%87%8F%E7%BA%A7Java-EE%E4%BC%81%E4%B8%9A%E5%BA%94%E7%94%A8%E5%AE%9E%E6%88%98-%E7%AC%AC5%E7%89%88/%E7%AC%AC8%E7%AB%A0-%E6%B7%B1%E5%85%A5%E4%BD%BF%E7%94%A8Spring/8-4-Spring%E7%9A%84AOP/" itemprop="url" rel="index"><span itemprop="name">8.4 Spring的AOP</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/2-%E8%BD%BB%E9%87%8F%E7%BA%A7Java-EE%E4%BC%81%E4%B8%9A%E5%BA%94%E7%94%A8%E5%AE%9E%E6%88%98-%E7%AC%AC5%E7%89%88/%E7%AC%AC8%E7%AB%A0-%E6%B7%B1%E5%85%A5%E4%BD%BF%E7%94%A8Spring/8-4-Spring%E7%9A%84AOP/8-4-5-%E5%9F%BA%E4%BA%8E%E6%B3%A8%E8%A7%A3%E7%9A%84-%E9%9B%B6%E9%85%8D%E7%BD%AE-%E6%96%B9%E5%BC%8F/" itemprop="url" rel="index"><span itemprop="name">8.4.5 基于注解的 零配置 方式</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
    <span class="post-meta-item-icon">
      <i class="far fa-comment"></i>
    </span>
    <span class="post-meta-item-text">Waline：</span>
  
    <a title="waline" href="/JavaReadingNotes/329ff710/#waline-comments" itemprop="discussionUrl">
      <span class="post-comments-count waline-comment-count" id="/JavaReadingNotes/329ff710/" data-xid="/JavaReadingNotes/329ff710/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>1.6k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>1 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="8-4-5-基于注解的”零配置”方式"><a href="#8-4-5-基于注解的”零配置”方式" class="headerlink" title="8.4.5 基于注解的”零配置”方式"></a>8.4.5 基于注解的”零配置”方式</h1><h2 id="Spring使用AspectJ注解"><a href="#Spring使用AspectJ注解" class="headerlink" title="Spring使用AspectJ注解"></a>Spring使用AspectJ注解</h2><p><code>AspectJ</code>允许使用注解定义<code>切面</code>、<code>切入点</code>和<code>增强处理</code>,而<code>Spring</code>框架则可识别并根据这些注解来生成<code>AOP</code>代理。 <code>Spring</code>只是使用了和<code>AspectJ 5</code>一样的注解,但并没有使用<code>AspectJ</code>的编译器或者织入器,底层依然使用的是<code>Spring AOP</code>,依然是在运行时动态生成<code>AOP</code>代理,并不依赖于<code>AspectJ</code>的编译器或者织入器<br>简单地说, <code>Spring</code>依然采用运行时<code>生成动态代理</code>的方式来增强目标对象,所以它不需要増加额外的编译,也不需要<code>AspectJ</code>的织入器攴持;而<code>AspectJ</code>采用编译时增强,所以<code>AspectJ</code>需要使用自己的编译器来编译<code>Java</code>文件,还需要织入器。</p>
<h1 id="Sping中启用-AspectJ支持"><a href="#Sping中启用-AspectJ支持" class="headerlink" title="Sping中启用@AspectJ支持"></a>Sping中启用@AspectJ支持</h1><h2 id="在Spring配置文件中开启对-AspectJ切面的支持"><a href="#在Spring配置文件中开启对-AspectJ切面的支持" class="headerlink" title="在Spring配置文件中开启对@AspectJ切面的支持"></a>在Spring配置文件中开启对@AspectJ切面的支持</h2><p>为了启用<code>Spring</code>对<code>@AspectJ</code>切面配置的支持,并保证<code>Spring</code>容器中的目标<code>Bean</code>被一个或多个切面<code>自动增强</code>,必须在<code>Spring</code>配置文件中配置如下片段:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;GBK&quot;?&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 1.在beans上.引入aop --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:aop</span>=<span class="string">&quot;http://www.springframework.org/schema/aop&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans </span></span></span><br><span class="line"><span class="string"><span class="tag">    http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">    http://www.springframework.org/schema/aop</span></span></span><br><span class="line"><span class="string"><span class="tag">    http://www.springframework.org/schema/aop/spring-aop.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 2.启动@AspectJ支持 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:aspectj-autoproxy</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>当然,如果希望完全启动<code>Spring</code>的”零配置”功能,则还需要采用如8.2节所示的方式进行配置。</p>
<h3 id="自动增强"><a href="#自动增强" class="headerlink" title="自动增强"></a>自动增强</h3><p>所谓自动增强,指的是<code>Spring</code>会判断一个或多个切面是否需要对指定<code>Bean</code>进行增强,并据此自动生成相应的代理,从而使得增强处理在合适的时候被调用</p>
<h2 id="使用Bean后处理器启用-AspectJ支持"><a href="#使用Bean后处理器启用-AspectJ支持" class="headerlink" title="使用Bean后处理器启用@AspectJ支持"></a>使用Bean后处理器启用@AspectJ支持</h2><p>如果不打算使用<code>Spring</code>的<code>XML Schema</code>配置方式,则应该在<code>Spring</code>配置文件中增加如下片段来启用<code>@AspectJ</code>支持。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 启用@AspectJ支持 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.aop.aspectj.annotation.AnnotationAwareAspectJAutoProxyCreator&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>上面配置文件中的<code>AnnotationAwareAspectJAutoProxyCreator</code>是一个<code>Bean</code>后处理器,该<code>Bean</code>后处理器将会为容器中符合条件的<code>Bean</code>生成<code>AOP</code>代理。</p>
<h2 id="启用-AspectJ支持需要导入的jar包"><a href="#启用-AspectJ支持需要导入的jar包" class="headerlink" title="启用@AspectJ支持需要导入的jar包"></a>启用@AspectJ支持需要导入的jar包</h2><p>为了在<code>Spring</code>应用中启动<code>@AspectJ</code>支持,还需要在应用的类加载路径下增加<code>aspectjweaver.jar</code>和<code>aspectjrt.jar</code>这两个<code>JAR</code>库,这两个<code>jar</code>包位于<code>Aspect</code>安装路径下的<code>lib</code>目录中。<br>除此之外,<code>Spring AOP</code>还需要依赖一个<code>aopalliance.jar</code>.</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/JavaReadingNotes/page/110/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/JavaReadingNotes/">1</a><span class="space">&hellip;</span><a class="page-number" href="/JavaReadingNotes/page/110/">110</a><span class="page-number current">111</span><a class="page-number" href="/JavaReadingNotes/page/112/">112</a><span class="space">&hellip;</span><a class="page-number" href="/JavaReadingNotes/page/188/">188</a><a class="extend next" rel="next" href="/JavaReadingNotes/page/112/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 2018 – 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">蓝蓝</span>
</div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
      <span>站点总字数：</span>
    <span title="站点总字数">5.8m</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span>站点阅读时长 &asymp;</span>
    <span title="站点阅读时长">88:01</span>
  </span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@next-theme/pjax@0.5.0/pjax.min.js" integrity="sha256-3NkoLDrmHLTYj7csHIZSr0MHAFTXth7Ua/DDt4MRUAg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js" integrity="sha256-yt2kYMy0w8AbtF89WXb2P1rfjcP/HTHLT7097U8Y5b8=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/lozad@1.16.0/dist/lozad.min.js" integrity="sha256-mOFREFhqmHeQbXpK2lp4nA3qooVgACfh88fpJftLBbc=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/pangu@4.0.7/dist/browser/pangu.min.js" integrity="sha256-j+yj56cdEY2CwkVtGyz18fNybFGpMGJ8JxG3GSyO2+I=" crossorigin="anonymous"></script>
<script src="/JavaReadingNotes/js/comments.js"></script><script src="/JavaReadingNotes/js/utils.js"></script><script src="/JavaReadingNotes/js/motion.js"></script><script src="/JavaReadingNotes/js/next-boot.js"></script><script src="/JavaReadingNotes/js/bookmark.js"></script><script src="/JavaReadingNotes/js/pjax.js"></script>

  
<script src="https://cdn.jsdelivr.net/npm/hexo-generator-searchdb@1.4.0/dist/search.js" integrity="sha256-vXZMYLEqsROAXkEw93GGIvaB2ab+QW6w3+1ahD9nXXA=" crossorigin="anonymous"></script>
<script src="/JavaReadingNotes/js/third-party/search/local-search.js"></script>



  <script src="/JavaReadingNotes/js/third-party/fancybox.js"></script>

  <script src="/JavaReadingNotes/js/third-party/pace.js"></script>

  




  

  <script class="next-config" data-name="enableMath" type="application/json">false</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"none","js":{"url":"https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js","integrity":"sha256-r+3itOMtGGjap0x+10hu6jW/gZCzxHsoKrOd7gyRSGY="}}</script>
<script src="/JavaReadingNotes/js/third-party/math/mathjax.js"></script>


  <script src="https://cdn.jsdelivr.net/npm/quicklink@2.2.0/dist/quicklink.umd.js" integrity="sha256-4kQf9z5ntdQrzsBC3YSHnEz02Z9C1UeW/E9OgnvlzSY=" crossorigin="anonymous"></script>
  <script class="next-config" data-name="quicklink" type="application/json">{"enable":true,"home":true,"archive":true,"delay":true,"timeout":3000,"priority":true,"url":"https://lanlan2017.github.io/JavaReadingNotes/page/111/"}</script>
  <script src="/JavaReadingNotes/js/third-party/quicklink.js"></script>
<script class="next-config" data-name="waline" type="application/json">{"lang":null,"enable":true,"serverURL":"https://waline-test-mzjszagu6-lanlan2017.vercel.app","placeholder":"填写您的邮箱以便接收回复提醒,填写您个人网站地址以便为您增加访问量","avatar":"mm","pageSize":10,"visitor":false,"comment_count":true,"requiredFields":[],"meta":["nick","mail","link"],"libUrl":"https://cdn.jsdelivr.net/npm/@waline/client/dist/Waline.min.js","el":"#waline-comments","path":"/JavaReadingNotes/page/111/"}</script>
<script>
document.addEventListener('page:loaded', () => {
  NexT.utils.loadComments(CONFIG.waline.el).then(() => 
    NexT.utils.getScript(CONFIG.waline.libUrl, { condition: window.Waline })
  ).then(() => {
    new Waline(CONFIG.waline);
  });
});
</script>
</body>
</html>
