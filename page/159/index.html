<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 6.1.0">

<link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
  <link rel="apple-touch-icon" sizes="180x180" href="/JavaReadingNotes/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/JavaReadingNotes/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/JavaReadingNotes/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/JavaReadingNotes/images/logo.svg" color="#222">
  <meta name="google-site-verification" content="_Sly-yzHYmALHXzjFpPWsodMrjBSphw7bfRbMUH80Qc">
  <meta name="msvalidate.01" content="B1CFD346B8DEBBFE0C983C2AF8955531">
  <meta name="baidu-site-verification" content="vkMTwK56xr">

<link rel="stylesheet" href="/JavaReadingNotes/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css" integrity="sha256-DfWjNxDkM94fVBWx1H5BMMp0Zq7luBlV8QRcSES7s+0=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css" integrity="sha256-Vzbj7sDDS/woiFS3uNKo8eIuni59rjyNGtXfstRzStA=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/themes/blue/pace-theme-minimal.css">
  <script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script>

<script class="next-config" data-name="main" type="application/json">{"hostname":"lanlan2017.github.io","root":"/JavaReadingNotes/","images":"/JavaReadingNotes/images","scheme":"Gemini","darkmode":true,"version":"8.11.0","exturl":false,"sidebar":{"position":"right","display":"post","padding":18,"offset":12},"copycode":true,"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":true,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/JavaReadingNotes/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/JavaReadingNotes/js/config.js"></script>

    <meta name="description" content="好好学习，天天向上">
<meta property="og:type" content="website">
<meta property="og:title" content="蓝蓝站点">
<meta property="og:url" content="https://lanlan2017.github.io/JavaReadingNotes/page/159/index.html">
<meta property="og:site_name" content="蓝蓝站点">
<meta property="og:description" content="好好学习，天天向上">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="蓝蓝">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://lanlan2017.github.io/JavaReadingNotes/page/159/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"page/159/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>蓝蓝站点</title>
  

  <script src="/JavaReadingNotes/js/third-party/analytics/baidu-analytics.js"></script>
  <script async src="https://hm.baidu.com/hm.js?dadeb188eb14ccde0b25a19230c429b5"></script>



<link rel="dns-prefetch" href="https://waline-test-lanlan2017.vercel.app">
  <noscript>
    <link rel="stylesheet" href="/JavaReadingNotes/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/JavaReadingNotes/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">蓝蓝站点</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">Java读书笔记</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/JavaReadingNotes/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-dir"><a href="/JavaReadingNotes/dir/" rel="section"><i class="fa fa-sitemap fa-fw"></i>目录</a></li><li class="menu-item menu-item-categories"><a href="/JavaReadingNotes/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-archives"><a href="/JavaReadingNotes/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li><li class="menu-item menu-item-tags"><a href="/JavaReadingNotes/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="蓝蓝"
      src="/JavaReadingNotes/images/avatar.gif">
  <p class="site-author-name" itemprop="name">蓝蓝</p>
  <div class="site-description" itemprop="description">好好学习，天天向上</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/JavaReadingNotes/archives/">
          <span class="site-state-item-count">1875</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/JavaReadingNotes/categories/">
        <span class="site-state-item-count">630</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://lanlan2017.github.io/todo/" title="todo → https:&#x2F;&#x2F;lanlan2017.github.io&#x2F;todo&#x2F;"><i class="fa fa-check-square fa-fw"></i>todo</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://lanlan2017.github.io/links/" title="links → https:&#x2F;&#x2F;lanlan2017.github.io&#x2F;links&#x2F;"><i class="fa fa-link fa-fw"></i>links</a>
      </span>
  </div>
  <div class="cc-license site-overview-item animated" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" class="cc-opacity" rel="noopener" target="_blank"><img src="https://cdn.jsdelivr.net/npm/@creativecommons/vocabulary@2020.11.3/assets/license_badges/small/by_nc_sa.svg" alt="Creative Commons"></a>
  </div>



        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="返回顶部">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="reading-progress-bar"></div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://lanlan2017.github.io/JavaReadingNotes/baee47ce/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/JavaReadingNotes/images/avatar.gif">
      <meta itemprop="name" content="蓝蓝">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="蓝蓝站点">
      <meta itemprop="description" content="好好学习，天天向上">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 蓝蓝站点">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/JavaReadingNotes/baee47ce/" class="post-title-link" itemprop="url">13.5.2 处理Blob类型数据</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-07-05 11:30:15" itemprop="dateCreated datePublished" datetime="2019-07-05T11:30:15+08:00">2019-07-05</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2020-02-07 01:34:56" itemprop="dateModified" datetime="2020-02-07T01:34:56+08:00">2020-02-07</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/1-%E7%96%AF%E7%8B%82Java%E8%AE%B2%E4%B9%89-%E7%AC%AC4%E7%89%88/" itemprop="url" rel="index"><span itemprop="name">1 疯狂Java讲义 (第4版)</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/1-%E7%96%AF%E7%8B%82Java%E8%AE%B2%E4%B9%89-%E7%AC%AC4%E7%89%88/%E7%AC%AC13%E7%AB%A0-MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%8EJDBC%E7%BC%96%E7%A8%8B/" itemprop="url" rel="index"><span itemprop="name">第13章 MySQL数据库与JDBC编程</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/1-%E7%96%AF%E7%8B%82Java%E8%AE%B2%E4%B9%89-%E7%AC%AC4%E7%89%88/%E7%AC%AC13%E7%AB%A0-MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%8EJDBC%E7%BC%96%E7%A8%8B/13-5-%E7%AE%A1%E7%90%86%E7%BB%93%E6%9E%9C%E9%9B%86/" itemprop="url" rel="index"><span itemprop="name">13.5 管理结果集</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
    <span class="post-meta-item-icon">
      <i class="far fa-comment"></i>
    </span>
    <span class="post-meta-item-text">Waline：</span>
  
    <a title="waline" href="/JavaReadingNotes/baee47ce/#waline-comments" itemprop="discussionUrl">
      <span class="post-comments-count waline-comment-count" id="/JavaReadingNotes/baee47ce/" data-xid="/JavaReadingNotes/baee47ce/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>7.8k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>7 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="13-5-2-处理Blob类型数据"><a href="#13-5-2-处理Blob类型数据" class="headerlink" title="13.5.2 处理Blob类型数据"></a>13.5.2 处理Blob类型数据</h1><p><code>Blob(Binary Long Object)</code>是二进制长对象的意思,<code>Blob</code>列通常用于存储大文件,典型的<code>Blob</code>内容是一张图片或一个声音文件,由于它们的特殊性,必须使用特殊的方式来存储。使用<code>Blob</code>列可以把图片、声音等文件的二进制数据保存在数据库里,并可以从数据库里恢复指定文件。<br>如果需要将图片插入数据库,显然不能直接通过普通的<code>SQL</code>语句来完成,因为有一个关键的问题: <code>Blob</code>常量无法表示。所以将<code>Blob</code>数据插入数据库需要使用<code>PreparedStatement</code>,该对象有一个方法:<code>setBinaryStream(int parameterIndex, InputStream x)</code>,该方法可以为指定参数传入二进制输入流,从而可以实现将<code>Blob</code>数据保存到数据库的功能。<br>当需要从<code>ResultSet</code>里取出<code>Blob</code>数据时,可以调用<code>ResultSet</code>的<code>getBlob( int columnIndex)</code>方法,该方法将返回一个<code>Blob</code>对象,<code>Blob</code>对象提供了<code>getBinaryStream()</code>方法来获取该<code>Blob</code>数据的输入流,也可以使用<code>Blb</code>对象提供的<code>getBytes()</code>方法直接取出该<code>Blob</code>对象封装的二进制数据。<br>为了把图片放入数据库,本程序先使用如下<code>SQL</code>语句来建立一个数据表。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> img_table</span><br><span class="line">(</span><br><span class="line">    img_id <span class="type">int</span> auto_increment <span class="keyword">primary</span> key,</span><br><span class="line">    img_name <span class="type">varchar</span>(<span class="number">255</span>),</span><br><span class="line">    img_data mediumblob</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p>上面<code>SQL</code>语句中的<code>img_data</code>列使用<code>mediumblob</code>类型,而是<code>blob</code>类型。因为<code>MySQL</code>数据库里的<code>blob</code>类型最多只能存储<code>64KB</code>内容,这可能不够满足实际用途。所以使用<code>mediumblob</code>类型,该类型的数据列可以存储<code>16MB</code>内容.<br>下面程序可以实现图片”上传”——实际上就是将图片保存到数据库,并在右边的列表框中显示图片的名字,<br>当用户双击列表框中的图片名时,左边窗口将显示该图片—实质就是根据选中的<code>ID</code>从数据库里查找图片,并将其显示出来。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.sql.*;</span><br><span class="line"><span class="keyword">import</span> javax.swing.*;</span><br><span class="line"><span class="keyword">import</span> java.awt.*;</span><br><span class="line"><span class="keyword">import</span> java.awt.event.*;</span><br><span class="line"><span class="keyword">import</span> java.util.Properties;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> javax.swing.filechooser.FileFilter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BlobTest</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">JFrame</span> <span class="variable">jf</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JFrame</span>(<span class="string">&quot;图片管理程序&quot;</span>);</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Connection conn;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> PreparedStatement insert;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> PreparedStatement query;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> PreparedStatement queryAll;</span><br><span class="line">    <span class="comment">// 定义一个DefaultListModel对象</span></span><br><span class="line">    <span class="keyword">private</span> DefaultListModel&lt;ImageHolder&gt; imageModel = <span class="keyword">new</span> <span class="title class_">DefaultListModel</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">private</span> JList&lt;ImageHolder&gt; imageList = <span class="keyword">new</span> <span class="title class_">JList</span>&lt;&gt;(imageModel);</span><br><span class="line">    <span class="keyword">private</span> <span class="type">JTextField</span> <span class="variable">filePath</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JTextField</span>(<span class="number">26</span>);</span><br><span class="line">    <span class="keyword">private</span> <span class="type">JButton</span> <span class="variable">browserBn</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JButton</span>(<span class="string">&quot;...&quot;</span>);</span><br><span class="line">    <span class="keyword">private</span> <span class="type">JButton</span> <span class="variable">uploadBn</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JButton</span>(<span class="string">&quot;上传&quot;</span>);</span><br><span class="line">    <span class="keyword">private</span> <span class="type">JLabel</span> <span class="variable">imageLabel</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JLabel</span>();</span><br><span class="line">    <span class="comment">// 以当前路径创建文件选择器</span></span><br><span class="line">    <span class="type">JFileChooser</span> <span class="variable">chooser</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JFileChooser</span>(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">    <span class="comment">// 创建文件过滤器</span></span><br><span class="line">    <span class="type">ExtensionFileFilter</span> <span class="variable">filter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ExtensionFileFilter</span>();</span><br><span class="line">    <span class="keyword">static</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">try</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">Properties</span> <span class="variable">props</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Properties</span>();</span><br><span class="line">            props.load(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;mysql.ini&quot;</span>));</span><br><span class="line">            <span class="type">String</span> <span class="variable">driver</span> <span class="operator">=</span> props.getProperty(<span class="string">&quot;driver&quot;</span>);</span><br><span class="line">            <span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> props.getProperty(<span class="string">&quot;url&quot;</span>);</span><br><span class="line">            <span class="type">String</span> <span class="variable">user</span> <span class="operator">=</span> props.getProperty(<span class="string">&quot;user&quot;</span>);</span><br><span class="line">            <span class="type">String</span> <span class="variable">pass</span> <span class="operator">=</span> props.getProperty(<span class="string">&quot;pass&quot;</span>);</span><br><span class="line">            <span class="comment">// 1.加载数据库驱动</span></span><br><span class="line">            Class.forName(driver);</span><br><span class="line">            <span class="comment">// 2.获取数据库连接</span></span><br><span class="line">            conn = DriverManager.getConnection(url, user, pass);</span><br><span class="line">            <span class="comment">// 3.创建执行插入的PreparedStatement对象，</span></span><br><span class="line">            <span class="comment">// 该对象执行插入后可以返回自动生成的主键</span></span><br><span class="line">            insert = conn.prepareStatement(</span><br><span class="line">                    <span class="string">&quot;insert into img_table&quot;</span> + <span class="string">&quot; values(null,?,?)&quot;</span>,</span><br><span class="line">                    Statement.RETURN_GENERATED_KEYS);</span><br><span class="line">            <span class="comment">// 创建两个PreparedStatement对象，用于查询指定图片，查询所有图片</span></span><br><span class="line">            query = conn.prepareStatement(</span><br><span class="line">                    <span class="string">&quot;select img_data from img_table&quot;</span> + <span class="string">&quot; where img_id=?&quot;</span>);</span><br><span class="line">            queryAll = conn.prepareStatement(</span><br><span class="line">                    <span class="string">&quot;select img_id, &quot;</span> + <span class="string">&quot; img_name from img_table&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e)</span><br><span class="line">        &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span> <span class="keyword">throws</span> SQLException</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// -------初始化文件选择器--------</span></span><br><span class="line">        filter.addExtension(<span class="string">&quot;jpg&quot;</span>);</span><br><span class="line">        filter.addExtension(<span class="string">&quot;jpeg&quot;</span>);</span><br><span class="line">        filter.addExtension(<span class="string">&quot;gif&quot;</span>);</span><br><span class="line">        filter.addExtension(<span class="string">&quot;png&quot;</span>);</span><br><span class="line">        filter.setDescription(<span class="string">&quot;图片文件(*.jpg,*.jpeg,*.gif,*.png)&quot;</span>);</span><br><span class="line">        chooser.addChoosableFileFilter(filter);</span><br><span class="line">        <span class="comment">// 禁止“文件类型”下拉列表中显示“所有文件”选项。</span></span><br><span class="line">        chooser.setAcceptAllFileFilterUsed(<span class="literal">false</span>);</span><br><span class="line">        <span class="comment">// ---------初始化程序界面---------</span></span><br><span class="line">        fillListModel();</span><br><span class="line">        filePath.setEditable(<span class="literal">false</span>);</span><br><span class="line">        <span class="comment">// 只能单选</span></span><br><span class="line">        imageList.setSelectionMode(ListSelectionModel.SINGLE_SELECTION);</span><br><span class="line">        <span class="type">JPanel</span> <span class="variable">jp</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JPanel</span>();</span><br><span class="line">        jp.add(filePath);</span><br><span class="line">        jp.add(browserBn);</span><br><span class="line">        browserBn.addActionListener(event -&gt;</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// 显示文件对话框</span></span><br><span class="line">            <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> chooser.showDialog(jf, <span class="string">&quot;浏览图片文件上传&quot;</span>);</span><br><span class="line">            <span class="comment">// 如果用户选择了APPROVE（赞同）按钮，即打开，保存等效按钮</span></span><br><span class="line">            <span class="keyword">if</span> (result == JFileChooser.APPROVE_OPTION)</span><br><span class="line">            &#123;</span><br><span class="line">                filePath.setText(chooser.getSelectedFile().getPath());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        jp.add(uploadBn);</span><br><span class="line">        uploadBn.addActionListener(avt -&gt;</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// 如果上传文件的文本框有内容</span></span><br><span class="line">            <span class="keyword">if</span> (filePath.getText().trim().length() &gt; <span class="number">0</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// 将指定文件保存到数据库</span></span><br><span class="line">                upload(filePath.getText());</span><br><span class="line">                <span class="comment">// 清空文本框内容</span></span><br><span class="line">                filePath.setText(<span class="string">&quot;&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="type">JPanel</span> <span class="variable">left</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JPanel</span>();</span><br><span class="line">        left.setLayout(<span class="keyword">new</span> <span class="title class_">BorderLayout</span>());</span><br><span class="line">        left.add(<span class="keyword">new</span> <span class="title class_">JScrollPane</span>(imageLabel), BorderLayout.CENTER);</span><br><span class="line">        left.add(jp, BorderLayout.SOUTH);</span><br><span class="line">        jf.add(left);</span><br><span class="line">        imageList.setFixedCellWidth(<span class="number">160</span>);</span><br><span class="line">        jf.add(<span class="keyword">new</span> <span class="title class_">JScrollPane</span>(imageList), BorderLayout.EAST);</span><br><span class="line">        imageList.addMouseListener(<span class="keyword">new</span> <span class="title class_">MouseAdapter</span>()</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">mouseClicked</span><span class="params">(MouseEvent e)</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// 如果鼠标双击</span></span><br><span class="line">                <span class="keyword">if</span> (e.getClickCount() &gt;= <span class="number">2</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="comment">// 取出选中的List项</span></span><br><span class="line">                    <span class="type">ImageHolder</span> <span class="variable">cur</span> <span class="operator">=</span> (ImageHolder) imageList</span><br><span class="line">                            .getSelectedValue();</span><br><span class="line">                    <span class="keyword">try</span></span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="comment">// 显示选中项对应的Image</span></span><br><span class="line">                        showImage(cur.getId());</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (SQLException sqle)</span><br><span class="line">                    &#123;</span><br><span class="line">                        sqle.printStackTrace();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        jf.setSize(<span class="number">620</span>, <span class="number">400</span>);</span><br><span class="line">        jf.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);</span><br><span class="line">        jf.setVisible(<span class="literal">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ----------查找img_table填充ListModel----------</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">fillListModel</span><span class="params">()</span> <span class="keyword">throws</span> SQLException</span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> (</span><br><span class="line">                <span class="comment">// 执行查询</span></span><br><span class="line">                <span class="type">ResultSet</span> <span class="variable">rs</span> <span class="operator">=</span> queryAll.executeQuery())</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// 先清除所有元素</span></span><br><span class="line">            imageModel.clear();</span><br><span class="line">            <span class="comment">// 把查询的全部记录添加到ListModel中</span></span><br><span class="line">            <span class="keyword">while</span> (rs.next())</span><br><span class="line">            &#123;</span><br><span class="line">                imageModel.addElement(</span><br><span class="line">                        <span class="keyword">new</span> <span class="title class_">ImageHolder</span>(rs.getInt(<span class="number">1</span>), rs.getString(<span class="number">2</span>)));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ---------将指定图片放入数据库---------</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">upload</span><span class="params">(String fileName)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 截取文件名</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">imageName</span> <span class="operator">=</span> fileName.substring(fileName.lastIndexOf(<span class="string">&#x27;\\&#x27;</span>) + <span class="number">1</span>,</span><br><span class="line">                fileName.lastIndexOf(<span class="string">&#x27;.&#x27;</span>));</span><br><span class="line">        <span class="type">File</span> <span class="variable">f</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(fileName);</span><br><span class="line">        <span class="keyword">try</span> (<span class="type">InputStream</span> <span class="variable">is</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(f))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// 设置图片名参数</span></span><br><span class="line">            insert.setString(<span class="number">1</span>, imageName);</span><br><span class="line">            <span class="comment">// 设置二进制流参数</span></span><br><span class="line">            insert.setBinaryStream(<span class="number">2</span>, is, (<span class="type">int</span>) f.length());</span><br><span class="line">            <span class="type">int</span> <span class="variable">affect</span> <span class="operator">=</span> insert.executeUpdate();</span><br><span class="line">            <span class="keyword">if</span> (affect == <span class="number">1</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// 重新更新ListModel，将会让JList显示最新的图片列表</span></span><br><span class="line">                fillListModel();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e)</span><br><span class="line">        &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ---------根据图片ID来显示图片----------</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">showImage</span><span class="params">(<span class="type">int</span> id)</span> <span class="keyword">throws</span> SQLException</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 设置参数</span></span><br><span class="line">        query.setInt(<span class="number">1</span>, id);</span><br><span class="line">        <span class="keyword">try</span> (</span><br><span class="line">                <span class="comment">// 执行查询</span></span><br><span class="line">                <span class="type">ResultSet</span> <span class="variable">rs</span> <span class="operator">=</span> query.executeQuery())</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (rs.next())</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// 取出Blob列</span></span><br><span class="line">                <span class="type">Blob</span> <span class="variable">imgBlob</span> <span class="operator">=</span> rs.getBlob(<span class="number">1</span>);</span><br><span class="line">                <span class="comment">// 取出Blob列里的数据</span></span><br><span class="line">                <span class="type">ImageIcon</span> <span class="variable">icon</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ImageIcon</span>(</span><br><span class="line">                        imgBlob.getBytes(<span class="number">1L</span>, (<span class="type">int</span>) imgBlob.length()));</span><br><span class="line">                imageLabel.setIcon(icon);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> SQLException</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">BlobTest</span>().init();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 创建FileFilter的子类，用以实现文件过滤功能</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ExtensionFileFilter</span> <span class="keyword">extends</span> <span class="title class_">FileFilter</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">String</span> <span class="variable">description</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> ArrayList&lt;String&gt; extensions = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    <span class="comment">// 自定义方法，用于添加文件扩展名</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addExtension</span><span class="params">(String extension)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (!extension.startsWith(<span class="string">&quot;.&quot;</span>))</span><br><span class="line">        &#123;</span><br><span class="line">            extension = <span class="string">&quot;.&quot;</span> + extension;</span><br><span class="line">            extensions.add(extension.toLowerCase());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 用于设置该文件过滤器的描述文本</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setDescription</span><span class="params">(String aDescription)</span></span><br><span class="line">    &#123;</span><br><span class="line">        description = aDescription;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 继承FileFilter类必须实现的抽象方法，返回该文件过滤器的描述文本</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getDescription</span><span class="params">()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> description;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 继承FileFilter类必须实现的抽象方法，判断该文件过滤器是否接受该文件</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">accept</span><span class="params">(File f)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 如果该文件是路径，接受该文件</span></span><br><span class="line">        <span class="keyword">if</span> (f.isDirectory())</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        <span class="comment">// 将文件名转为小写（全部转为小写后比较，用于忽略文件名大小写）</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> f.getName().toLowerCase();</span><br><span class="line">        <span class="comment">// 遍历所有可接受的扩展名，如果扩展名相同，该文件就可接受。</span></span><br><span class="line">        <span class="keyword">for</span> (String extension : extensions)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (name.endsWith(extension))</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 创建一个ImageHolder类，用于封装图片名、图片ID</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ImageHolder</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 封装图片的ID</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> id;</span><br><span class="line">    <span class="comment">// 封装图片的图片名字</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ImageHolder</span><span class="params">()</span></span><br><span class="line">    &#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ImageHolder</span><span class="params">(<span class="type">int</span> id, String name)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">this</span>.id = id;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// id的setter和getter方法</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setId</span><span class="params">(<span class="type">int</span> id)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getId</span><span class="params">()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.id;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// name的setter和getter方法</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 重写toString方法，返回图片名</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>下面是一个简单的查询执行器,当用户在文本框内输入合法的查询语句并执行成功后,下面的表格将会显示查询结果。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://lanlan2017.github.io/JavaReadingNotes/28ac401c/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/JavaReadingNotes/images/avatar.gif">
      <meta itemprop="name" content="蓝蓝">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="蓝蓝站点">
      <meta itemprop="description" content="好好学习，天天向上">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 蓝蓝站点">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/JavaReadingNotes/28ac401c/" class="post-title-link" itemprop="url">13.5 管理结果集 13.5.1 可滚动,可更新的结果集</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-07-04 23:45:51" itemprop="dateCreated datePublished" datetime="2019-07-04T23:45:51+08:00">2019-07-04</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2020-02-07 01:34:56" itemprop="dateModified" datetime="2020-02-07T01:34:56+08:00">2020-02-07</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/1-%E7%96%AF%E7%8B%82Java%E8%AE%B2%E4%B9%89-%E7%AC%AC4%E7%89%88/" itemprop="url" rel="index"><span itemprop="name">1 疯狂Java讲义 (第4版)</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/1-%E7%96%AF%E7%8B%82Java%E8%AE%B2%E4%B9%89-%E7%AC%AC4%E7%89%88/%E7%AC%AC13%E7%AB%A0-MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%8EJDBC%E7%BC%96%E7%A8%8B/" itemprop="url" rel="index"><span itemprop="name">第13章 MySQL数据库与JDBC编程</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/1-%E7%96%AF%E7%8B%82Java%E8%AE%B2%E4%B9%89-%E7%AC%AC4%E7%89%88/%E7%AC%AC13%E7%AB%A0-MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%8EJDBC%E7%BC%96%E7%A8%8B/13-5-%E7%AE%A1%E7%90%86%E7%BB%93%E6%9E%9C%E9%9B%86/" itemprop="url" rel="index"><span itemprop="name">13.5 管理结果集</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
    <span class="post-meta-item-icon">
      <i class="far fa-comment"></i>
    </span>
    <span class="post-meta-item-text">Waline：</span>
  
    <a title="waline" href="/JavaReadingNotes/28ac401c/#waline-comments" itemprop="discussionUrl">
      <span class="post-comments-count waline-comment-count" id="/JavaReadingNotes/28ac401c/" data-xid="/JavaReadingNotes/28ac401c/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>3.4k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>3 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="13-5-管理结果集"><a href="#13-5-管理结果集" class="headerlink" title="13.5 管理结果集"></a>13.5 管理结果集</h1><p><code>JDBC</code>使用<code>ResultSet</code>来封装执行查询得到的查询结果,然后通过移动<code>ResultSet</code>的记录指针来取出结果集的内容。除此之外,<code>JDBC</code>还允许通过<code>ResultSet</code>来更新记录,并提供了<code>ResultSetMetaData</code>来获得<code>ResultSet</code>对象的相关信息。</p>
<h1 id="13-5-1-可滚动-可更新的结果集"><a href="#13-5-1-可滚动-可更新的结果集" class="headerlink" title="13.5.1 可滚动,可更新的结果集"></a>13.5.1 可滚动,可更新的结果集</h1><p>前面提到, <code>ResultSet</code>定位记录指针的方法有<code>absolute()</code>、 <code>previous()</code>等方法,但前面程序自始至终都只用了<code>next()</code>方法来移动记录指针,实际上也可以使用<code>absolute()</code>、 <code>previous()</code>、 <code>last()</code>等方法来移动记录指针。</p>
<p>可以使用<code>absolute()</code>、 <code>previous()</code>、 <code>afterLast()</code>等方法自由移动记录指针的<code>ResultSet()</code>被称为可滚动的结果集。</p>
<h2 id="Java-5以后-ResultSet-默认可滚动"><a href="#Java-5以后-ResultSet-默认可滚动" class="headerlink" title="Java 5以后 ResultSet 默认可滚动"></a>Java 5以后 ResultSet 默认可滚动</h2><p>在<code>JDK1.4</code>以前,默认打开的<code>ResultSet</code>是不可滚动的,必须在创建<code>Statement</code>或<code>PreparedStatement</code>时传入额外的参数。<strong>从<code>Java 5.0</code>以后,默认打开的<code>ResultSet</code>就是可滚动的,无须传入额外的参数</strong>.</p>
<p>以默认方式打开的<code>ResultSet</code>是不可更新的,如果希望创建可更新的<code>ResultSet</code>,则必须在创建<code>Statement</code>或<code>PreparedStatement</code>时传入额外的参数。</p>
<p><code>Connection</code>在创建<code>Statement</code>或<code>PreparedStatement</code>时还可额外传入如下两个参数。</p>
<ul>
<li><code>resultSetType</code>:控制<code>ResultSet</code>的类型,该参数可以取如下三个值。<ul>
<li><code>ResultSet.TYPE_FOWARD_ONLY</code>:该常量控制记录指针只能向前移动。这是<code>JDK 1.4</code>以前的默认值。</li>
<li><code>ResultSet.TYPE_SCROLL_INSENSITIVE</code>:该常量控制记录指针可以自由移动(可滚动结果集),但底层数据的改变不会影响<code>ResultSet</code>的内容。</li>
<li><code>ResultSet.TYPE_SCROLL_SENSITIVE</code>:该常量控制记录指针可以自由移动(可滚动结果集),而且<strong>底层数据的改变会影响<code>ResultSet</code>的内容</strong>。</li>
</ul>
</li>
<li><code>resultSetConcurrency</code>:控制<code>ResultSet</code>的<code>并发类型</code>,该参数可以接收如下两个值。<ul>
<li><code>ResultSet.CONCUR_READ_ONLY</code>:该常量指示<code>ResultSet</code>是<code>只读</code>的并发模式(默认)。</li>
<li><code>ResultSet.CONCUR_UPDATABLE</code>:该常量指示<code>ResultSet</code>是<code>可更新</code>的并发模式。</li>
</ul>
</li>
</ul>
<p>注意:<code>TYPE_SCROLL_INSENSITIVE</code>、 <code>TYPE_SCROLL_SENSITIVE</code>两个常量的作用需要底层数据库驱动的支持,对于有些数据库驱动来说,这两个常量并没有太大的区别。</p>
<p>下面代码通过这两个参数创建了一个<code>PreparedStatement</code>对象,由该对象生成的<code>ResultSet</code>对象将是可滚动、可更新的结果集。</p>
<p>需要指出的是,可更新的结果集还需要满足如下两个条件。</p>
<ul>
<li>所有数据都应该来自一个表。</li>
<li>选出的数据集必须包含主键列。</li>
</ul>
<p>通过该<code>PreparedStatement</code>创建的<code>ResultSet</code>就是可滚动、可更新的,程序可调用<code>ResultSet</code>的<code>updateXxx(int columnIndex, Xxx value)</code>方法来修改记录指针所指向的行的特定列的值,最后调用<code>ResultSet</code>的<code>updateRow()</code>方法来提交修改。<br><code>Java 8</code>为<code>ResultSet</code>添加了:</p>
<ul>
<li><code>updateObject(String columnLabel,Object x, SQLType targetSqlType)</code>和</li>
<li><code>updateObject(int columnIndex, Object x, SQLType targetsqlType)</code></li>
</ul>
<p>这两个默认方法,这两个方法可以直接用<code>Object</code>来修改记录指针所指记录、特定列的值,其中<code>SQLType</code>用于指定该数据列的类型.但目前最新的<code>MySQL</code>驱动暂不支持该方法。<br>下面程序示范了这种创建可滚动、可更新的结果集的方法。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.sql.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ResultSetTest</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> String driver;</span><br><span class="line">    <span class="keyword">private</span> String url;</span><br><span class="line">    <span class="keyword">private</span> String user;</span><br><span class="line">    <span class="keyword">private</span> String pass;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">initParam</span><span class="params">(String paramFile)</span> <span class="keyword">throws</span> Exception</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 使用Properties类来加载属性文件</span></span><br><span class="line">        <span class="type">Properties</span> <span class="variable">props</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Properties</span>();</span><br><span class="line">        props.load(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(paramFile));</span><br><span class="line">        driver = props.getProperty(<span class="string">&quot;driver&quot;</span>);</span><br><span class="line">        url = props.getProperty(<span class="string">&quot;url&quot;</span>);</span><br><span class="line">        user = props.getProperty(<span class="string">&quot;user&quot;</span>);</span><br><span class="line">        pass = props.getProperty(<span class="string">&quot;pass&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">query</span><span class="params">(String sql)</span> <span class="keyword">throws</span> Exception</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 1.加载驱动</span></span><br><span class="line">        Class.forName(driver);</span><br><span class="line">        <span class="keyword">try</span> (</span><br><span class="line">                <span class="comment">// 2.获取数据库连接</span></span><br><span class="line">                <span class="type">Connection</span> <span class="variable">conn</span> <span class="operator">=</span> DriverManager.getConnection(url, user, pass);</span><br><span class="line">                <span class="comment">// 3.创建Statement对象</span></span><br><span class="line">                <span class="comment">// 使用Connection来创建一个PreparedStatement对象</span></span><br><span class="line">                <span class="comment">// 传入参数使得结果集可滚动,可更新.</span></span><br><span class="line">                <span class="type">PreparedStatement</span> <span class="variable">pstmt</span> <span class="operator">=</span> conn.prepareStatement(sql,</span><br><span class="line">                        ResultSet.TYPE_SCROLL_INSENSITIVE,</span><br><span class="line">                        ResultSet.CONCUR_UPDATABLE);</span><br><span class="line">                <span class="comment">// 4.使用Statement对象操作数据库</span></span><br><span class="line">                <span class="type">ResultSet</span> <span class="variable">rs</span> <span class="operator">=</span> pstmt.executeQuery())</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// 移动记录指针到最后一行</span></span><br><span class="line">            rs.last();</span><br><span class="line">            <span class="comment">// 获取行号</span></span><br><span class="line">            <span class="type">int</span> <span class="variable">rowCount</span> <span class="operator">=</span> rs.getRow();</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> rowCount; i &gt; <span class="number">0</span>; i--)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// 移动行记录指针到第i行</span></span><br><span class="line">                rs.absolute(i);</span><br><span class="line">                <span class="comment">// 从结果集中取出数据列</span></span><br><span class="line">                System.out.println(rs.getString(<span class="number">1</span>) + <span class="string">&quot;\t&quot;</span> + rs.getString(<span class="number">2</span>)</span><br><span class="line">                        + <span class="string">&quot;\t&quot;</span> + rs.getString(<span class="number">3</span>));</span><br><span class="line">                <span class="comment">// 修改记录指针所有记录、第2列的值</span></span><br><span class="line">                rs.updateString(<span class="number">2</span>, <span class="string">&quot;学生名&quot;</span> + i);</span><br><span class="line">                <span class="comment">// 提交修改</span></span><br><span class="line">                rs.updateRow();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">ResultSetTest</span> <span class="variable">rt</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ResultSetTest</span>();</span><br><span class="line">        rt.initParam(<span class="string">&quot;mysql.ini&quot;</span>);</span><br><span class="line">        rt.query(<span class="string">&quot;select * from student_table&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>运行上面程序,将会看到<code>student_table</code>表中的记录被倒过来输出了,因为是从最大记录行开始输出的。而且当程序运行结束后, <code>student_table</code>表中所有记录的<code>student_name</code>列的值都被修改了。<br>运行效果如下:</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">7</span>       赵六    <span class="number">3</span></span><br><span class="line"><span class="number">6</span>       null    <span class="number">2</span></span><br><span class="line"><span class="number">5</span>       _王五   <span class="number">2</span></span><br><span class="line"><span class="number">4</span>       王五    <span class="number">2</span></span><br><span class="line"><span class="number">3</span>       李四    <span class="number">1</span></span><br><span class="line"><span class="number">2</span>       张三    <span class="number">1</span></span><br><span class="line"><span class="number">1</span>       张三    <span class="number">1</span></span><br></pre></td></tr></table></figure>
<p><strong>注意:</strong><br>如果要创建可更新的结果集,则使用查询语句查询的数据通常只能来自于一个数据表,而且查询结果集中的数据列必须包含主键列,否则将会引起更新失败</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://lanlan2017.github.io/JavaReadingNotes/50709bfb/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/JavaReadingNotes/images/avatar.gif">
      <meta itemprop="name" content="蓝蓝">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="蓝蓝站点">
      <meta itemprop="description" content="好好学习，天天向上">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 蓝蓝站点">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/JavaReadingNotes/50709bfb/" class="post-title-link" itemprop="url">13.4.4 使用CallableStatement调用存储过程</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-07-04 23:16:33" itemprop="dateCreated datePublished" datetime="2019-07-04T23:16:33+08:00">2019-07-04</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2020-02-07 01:34:56" itemprop="dateModified" datetime="2020-02-07T01:34:56+08:00">2020-02-07</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/1-%E7%96%AF%E7%8B%82Java%E8%AE%B2%E4%B9%89-%E7%AC%AC4%E7%89%88/" itemprop="url" rel="index"><span itemprop="name">1 疯狂Java讲义 (第4版)</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/1-%E7%96%AF%E7%8B%82Java%E8%AE%B2%E4%B9%89-%E7%AC%AC4%E7%89%88/%E7%AC%AC13%E7%AB%A0-MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%8EJDBC%E7%BC%96%E7%A8%8B/" itemprop="url" rel="index"><span itemprop="name">第13章 MySQL数据库与JDBC编程</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/1-%E7%96%AF%E7%8B%82Java%E8%AE%B2%E4%B9%89-%E7%AC%AC4%E7%89%88/%E7%AC%AC13%E7%AB%A0-MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%8EJDBC%E7%BC%96%E7%A8%8B/13-4-%E6%89%A7%E8%A1%8CSQL%E8%AF%AD%E5%8F%A5%E7%9A%84%E6%96%B9%E5%BC%8F/" itemprop="url" rel="index"><span itemprop="name">13.4 执行SQL语句的方式</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
    <span class="post-meta-item-icon">
      <i class="far fa-comment"></i>
    </span>
    <span class="post-meta-item-text">Waline：</span>
  
    <a title="waline" href="/JavaReadingNotes/50709bfb/#waline-comments" itemprop="discussionUrl">
      <span class="post-comments-count waline-comment-count" id="/JavaReadingNotes/50709bfb/" data-xid="/JavaReadingNotes/50709bfb/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>2.3k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>2 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="13-4-4-使用CallableStatement调用存储过程"><a href="#13-4-4-使用CallableStatement调用存储过程" class="headerlink" title="13.4.4 使用CallableStatement调用存储过程"></a>13.4.4 使用CallableStatement调用存储过程</h1><p>下面的<code>SQL</code>语句可以在<code>MySQL</code>数据库中创建一个简单的存储过程。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">delimiter $$</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">procedure</span> add_pro(a <span class="type">int</span>,b <span class="type">int</span>,<span class="keyword">out</span> sum <span class="type">int</span>)</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line"><span class="keyword">set</span> sum <span class="operator">=</span> a <span class="operator">+</span>b;</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line">$$</span><br></pre></td></tr></table></figure>
<p>上面的<code>SQL</code>语句将<code>MySQL</code>的语句结束符改为双美元符(<code>$$</code>),这样就可以在创建存储过程中使用分号作为分隔符( <code>MySQL</code>默认使用分号作为语句结束符)。上面程序创建了名为<code>add_pro</code>的存储过程,该存储过程包含三个参数:<code>a</code>、<code>b</code>是传入参数,而<code>sum</code>使用<code>out</code>修饰,是传出参数。<br>调用存储过程使用<code>CallableStatement</code>,可以通过<code>Connection</code>的<code>prepareCall()</code>方法来创建<code>CallableStatement</code>对象,创建该对象时需要传入调用存储过程的<code>SQL</code>语句。调用存储过程的<code>SQL</code>语句总是这种格式:<code>&#123;call 过程名 (?,?,?,)&#125;</code>,其中的问号作为存储过程参数的占位符。例如,如下代码就创建了调用上面存储过程的<code>CallableStatement</code>对象。<br><code>cstmt=conn.prepareCall(&quot;&#123;call add_pro(?,?,?)&quot;);</code><br>存储过程的参数既有传入参数,也有传出参数。所谓传入参数就是<code>Java</code>程序必须为这些参数传入值,可以通过<code>CallableStatement</code>的<code>setXxx()</code>方法为传入参数设置值;<br>所谓传出参数就是<code>Java</code>程序可以通过该参数获取存储过程里的值, <code>CallableStatement</code>需要调用<code>registerOutParameter()</code>方法来注册该参数。如下代码所示:<br><code>cstmt.registerOutParameter(3, Types.INTEGER);</code><br>经过上面步骤之后,就可以调用<code>CallableStatement</code>的<code>execute()</code>方法来执行存储过程了,执行结束后通过<code>CallableStatement</code>对象的<code>getXxx(int index)</code>方法来获取指定传出参数的值。下面程序示范了如何来调用该存储过程。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.awt.*;</span><br><span class="line"><span class="keyword">import</span> java.awt.event.*;</span><br><span class="line"><span class="keyword">import</span> javax.swing.*;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.sql.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CallableStatementTest</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> String driver;</span><br><span class="line">    <span class="keyword">private</span> String url;</span><br><span class="line">    <span class="keyword">private</span> String user;</span><br><span class="line">    <span class="keyword">private</span> String pass;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">initParam</span><span class="params">(String paramFile)</span> <span class="keyword">throws</span> Exception</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 使用Properties类来加载属性文件</span></span><br><span class="line">        <span class="type">Properties</span> <span class="variable">props</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Properties</span>();</span><br><span class="line">        props.load(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(paramFile));</span><br><span class="line">        driver = props.getProperty(<span class="string">&quot;driver&quot;</span>);</span><br><span class="line">        url = props.getProperty(<span class="string">&quot;url&quot;</span>);</span><br><span class="line">        user = props.getProperty(<span class="string">&quot;user&quot;</span>);</span><br><span class="line">        pass = props.getProperty(<span class="string">&quot;pass&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">callProcedure</span><span class="params">()</span> <span class="keyword">throws</span> Exception</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 1.加载驱动</span></span><br><span class="line">        Class.forName(driver);</span><br><span class="line">        <span class="keyword">try</span> (</span><br><span class="line">                <span class="comment">// 2.获取数据库连接</span></span><br><span class="line">                <span class="type">Connection</span> <span class="variable">conn</span> <span class="operator">=</span> DriverManager.getConnection(url, user, pass);</span><br><span class="line">                <span class="comment">// 3.使用Connection来创建一个CallableStatment对象</span></span><br><span class="line">                <span class="type">CallableStatement</span> <span class="variable">cstmt</span> <span class="operator">=</span> conn</span><br><span class="line">                        .prepareCall(<span class="string">&quot;&#123;call add_pro(?,?,?)&#125;&quot;</span>))</span><br><span class="line">        &#123;</span><br><span class="line">            cstmt.setInt(<span class="number">1</span>, <span class="number">4</span>);</span><br><span class="line">            cstmt.setInt(<span class="number">2</span>, <span class="number">5</span>);</span><br><span class="line">            <span class="comment">// 4.注册CallableStatement的第三个参数是int类型</span></span><br><span class="line">            cstmt.registerOutParameter(<span class="number">3</span>, Types.INTEGER);</span><br><span class="line">            <span class="comment">// 执行存储过程</span></span><br><span class="line">            cstmt.execute();</span><br><span class="line">            <span class="comment">// 获取，并输出存储过程传出参数的值。</span></span><br><span class="line">            System.out.println(<span class="string">&quot;执行结果是: &quot;</span> + cstmt.getInt(<span class="number">3</span>));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">CallableStatementTest</span> <span class="variable">ct</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CallableStatementTest</span>();</span><br><span class="line">        ct.initParam(<span class="string">&quot;mysql.ini&quot;</span>);</span><br><span class="line">        ct.callProcedure();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>运行上面程序将会看到这个简单存储过程的执行结果,传入参数分别是<code>4</code>、<code>5</code>,执行加法后传出总和<code>9</code>.</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://lanlan2017.github.io/JavaReadingNotes/973ba1f1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/JavaReadingNotes/images/avatar.gif">
      <meta itemprop="name" content="蓝蓝">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="蓝蓝站点">
      <meta itemprop="description" content="好好学习，天天向上">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 蓝蓝站点">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/JavaReadingNotes/973ba1f1/" class="post-title-link" itemprop="url">13.4.3 使用 PreparedStatement执行SQL语句</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-07-04 14:35:37" itemprop="dateCreated datePublished" datetime="2019-07-04T14:35:37+08:00">2019-07-04</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2020-02-07 01:34:56" itemprop="dateModified" datetime="2020-02-07T01:34:56+08:00">2020-02-07</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/1-%E7%96%AF%E7%8B%82Java%E8%AE%B2%E4%B9%89-%E7%AC%AC4%E7%89%88/" itemprop="url" rel="index"><span itemprop="name">1 疯狂Java讲义 (第4版)</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/1-%E7%96%AF%E7%8B%82Java%E8%AE%B2%E4%B9%89-%E7%AC%AC4%E7%89%88/%E7%AC%AC13%E7%AB%A0-MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%8EJDBC%E7%BC%96%E7%A8%8B/" itemprop="url" rel="index"><span itemprop="name">第13章 MySQL数据库与JDBC编程</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/1-%E7%96%AF%E7%8B%82Java%E8%AE%B2%E4%B9%89-%E7%AC%AC4%E7%89%88/%E7%AC%AC13%E7%AB%A0-MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%8EJDBC%E7%BC%96%E7%A8%8B/13-4-%E6%89%A7%E8%A1%8CSQL%E8%AF%AD%E5%8F%A5%E7%9A%84%E6%96%B9%E5%BC%8F/" itemprop="url" rel="index"><span itemprop="name">13.4 执行SQL语句的方式</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
    <span class="post-meta-item-icon">
      <i class="far fa-comment"></i>
    </span>
    <span class="post-meta-item-text">Waline：</span>
  
    <a title="waline" href="/JavaReadingNotes/973ba1f1/#waline-comments" itemprop="discussionUrl">
      <span class="post-comments-count waline-comment-count" id="/JavaReadingNotes/973ba1f1/" data-xid="/JavaReadingNotes/973ba1f1/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>7.1k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>6 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="13-4-3-使用-PreparedStatement执行SQL语句"><a href="#13-4-3-使用-PreparedStatement执行SQL语句" class="headerlink" title="13.4.3 使用 PreparedStatement执行SQL语句"></a>13.4.3 使用 PreparedStatement执行SQL语句</h1><p>如果经常需要反复执行一条结构相似的<code>SQL</code>语句,例如如下两条<code>SQL</code>语句:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> student_table <span class="keyword">values</span>(<span class="keyword">null</span>, <span class="string">&#x27;张三&#x27;</span>, <span class="number">1</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> student_table <span class="keyword">values</span>(<span class="keyword">null</span>, <span class="string">&#x27;李四&#x27;</span>, <span class="number">2</span>);</span><br></pre></td></tr></table></figure>
<p>对于这两条<code>SQL</code>语句而言,它们的结构基本相似,只是执行插入时插入的值不同而已。对于这种情况,可以使用带<code>占位符</code>(<code>?</code>)参数的<code>SQL</code>语句来代替它:<br><code>insert into student_table values(null,?,?);</code><br>但<code>Statement</code>执行<code>SQL</code>语句时不允许使用问号占位符参数,而且这个问号占位符参数必须获得值后以执行。为了满足这种功能,<code>JDBC</code>提供了<code>PreparedStatement</code>接口,它是<code>Statement</code>接口的子接口,它可以预编译<code>SQL</code>语句,<strong>预编译后的<code>SQL</code>语句被存储在<code>PreparedStatement</code>对象中,然后可以使用该对象多次高效地执行该语句</strong>。简而言之,<strong>使用<code>PreparedStatement</code>比使用<code>Statement</code>的效率要高</strong>。<br>创建<code>PreparedStatement</code>对象使用<code>Connection</code>的<code>prepareStatement()</code>方法,该方法需要传入一个<code>SQL</code>字符串,该<code>SQL</code>字符串可以包含<code>占位符</code>参数。如下代码所示:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pstmt=conn.prepareStatement(<span class="string">&quot;insert into student_table values (null,?,1)&quot;</span>);</span><br></pre></td></tr></table></figure>
<p><code>PreparedStatement</code>也提供了<code>execute()</code>、<code>executeUpdate()</code>、<code>executeQuery()</code>三个方法来执行<code>SQL</code>语句,不过这三个方法无须传入参数,因为<code>PreparedStatement</code>已存储了预编译的<code>SQL</code>语句。<br>使用<code>PreparedStatement</code>预编译<code>SQL</code>语句时,该<code>SQL</code>语句可以带<code>占位符</code>参数,因此在执行<code>SQL</code>语句之前必须为这些参数传入参数值, <code>Preparedstatement</code>提供了以下两种方式来传入参数值:</p>
<ul>
<li>如果程序知道预编译<code>SQL</code>语句中各参数的类型(如参数类型为<code>Xxx</code>),则使用<code>setXxx(int index, Xxx value)</code>方法来传入参数值。</li>
<li>如果程序不清楚预编译<code>SQL</code>语句中各参数的类型,则可以使用<code>setObject()</code>方法来传入参数,由<code>PreparedStatement</code>来负责类型转换。</li>
</ul>
<p>下面程序示范了使用<code>Statement</code>和<code>PreparedStatement</code>分别插入100条记录的对比。使用<code>Statement</code>需要传入100条<code>SQL</code>语句,但使用<code>PreparedStatement</code>则只需要传入1条预编译的<code>SQL</code>语句,然后100次为该<code>PreparedStatement</code>的参数设值即可.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.sql.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PreparedStatementTest</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> String driver;</span><br><span class="line">    <span class="keyword">private</span> String url;</span><br><span class="line">    <span class="keyword">private</span> String user;</span><br><span class="line">    <span class="keyword">private</span> String pass;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">initParam</span><span class="params">(String paramFile)</span> <span class="keyword">throws</span> Exception</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 使用Properties类来加载属性文件</span></span><br><span class="line">        <span class="type">Properties</span> <span class="variable">props</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Properties</span>();</span><br><span class="line">        props.load(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(paramFile));</span><br><span class="line">        driver = props.getProperty(<span class="string">&quot;driver&quot;</span>);</span><br><span class="line">        url = props.getProperty(<span class="string">&quot;url&quot;</span>);</span><br><span class="line">        user = props.getProperty(<span class="string">&quot;user&quot;</span>);</span><br><span class="line">        pass = props.getProperty(<span class="string">&quot;pass&quot;</span>);</span><br><span class="line">        <span class="comment">// 1.加载驱动</span></span><br><span class="line">        Class.forName(driver);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">insertUseStatement</span><span class="params">()</span> <span class="keyword">throws</span> Exception</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">long</span> <span class="variable">start</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        <span class="keyword">try</span> (</span><br><span class="line">                <span class="comment">// 2.获取数据库连接</span></span><br><span class="line">                <span class="type">Connection</span> <span class="variable">conn</span> <span class="operator">=</span> DriverManager.getConnection(url, user, pass);</span><br><span class="line">                <span class="comment">// 3.使用Connection来创建一个Statment对象</span></span><br><span class="line">                <span class="type">Statement</span> <span class="variable">stmt</span> <span class="operator">=</span> conn.createStatement())</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// 需要使用100条SQL语句来插入100条记录</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">100</span>; i++)</span><br><span class="line">            &#123;</span><br><span class="line">                stmt.executeUpdate(<span class="string">&quot;insert into student_table values(&quot;</span></span><br><span class="line">                        + <span class="string">&quot; null ,&#x27;姓名&quot;</span> + i + <span class="string">&quot;&#x27; , 1)&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(</span><br><span class="line">                    <span class="string">&quot;使用Statement费时:&quot;</span> + (System.currentTimeMillis() - start));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">insertUsePrepare</span><span class="params">()</span> <span class="keyword">throws</span> Exception</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">long</span> <span class="variable">start</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        <span class="keyword">try</span> (</span><br><span class="line">                <span class="comment">// 2.获取数据库连接</span></span><br><span class="line">                <span class="type">Connection</span> <span class="variable">conn</span> <span class="operator">=</span> DriverManager.getConnection(url, user, pass);</span><br><span class="line">                <span class="comment">// 3.使用Connection来创建一个PreparedStatement对象</span></span><br><span class="line">                <span class="type">PreparedStatement</span> <span class="variable">pstmt</span> <span class="operator">=</span> conn.prepareStatement(</span><br><span class="line">                        <span class="string">&quot;insert into student_table values(null,?,1)&quot;</span>))</span><br><span class="line"></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// 100次为PreparedStatement的参数设值，就可以插入100条记录</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">100</span>; i++)</span><br><span class="line">            &#123;</span><br><span class="line">                pstmt.setString(<span class="number">1</span>, <span class="string">&quot;姓名&quot;</span> + i);</span><br><span class="line">                pstmt.executeUpdate();</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(<span class="string">&quot;使用PreparedStatement费时:&quot;</span></span><br><span class="line">                    + (System.currentTimeMillis() - start));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">PreparedStatementTest</span> <span class="variable">pt</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PreparedStatementTest</span>();</span><br><span class="line">        pt.initParam(<span class="string">&quot;mysql.ini&quot;</span>);</span><br><span class="line">        pt.insertUseStatement();</span><br><span class="line">        pt.insertUsePrepare();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>多次运行上面程序,可以发现使用<code>PreparedStatement</code>插入100条记录所用的时间比使用<code>Statement</code>插入100条记录所用的时间少,这表明**<code>PreparedStatement</code>的执行效率比<code>Statement</code>的执行效率高**。<br>除此之外,使用<code>PreparedStatement</code>还有一个优势——当<code>SQL</code>语句中要使用参数时,无须”拼接<code>SQL</code>字符串。而使用<code>Statement</code>则要”拼接”<code>SQL</code>字符串,这是相当容易出现错误的,尤其是当<code>SQL</code>语句中有多个字符串参数时。使用<code>PreparedStatement</code>则只需要使用问号占位符来代替这些参数即可,降低了编程复杂度。<br>使用<code>PreparedStatement</code>还有一个很好的作用—用于防止<code>SQL</code>注入(<code>SQL</code>注入是一个较常见的<code>Cracker</code>入侵方式,它利用<code>SQL</code>语句的漏洞来入侵)。<br>下面以一个简单的登录窗口为例来介绍这种<code>SQL</code>注入的结果。下面登录窗口包含两个文本框,个用于输入用户名,一个用于输入密码,系统根据用户输入与<code>jdbc_test</code>表里的记录进行匹配,如果找到相应记录则提示登录成功.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> jdbc.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.awt.BorderLayout;</span><br><span class="line"><span class="keyword">import</span> java.io.FileInputStream;</span><br><span class="line"><span class="keyword">import</span> java.sql.Connection;</span><br><span class="line"><span class="keyword">import</span> java.sql.DriverManager;</span><br><span class="line"><span class="keyword">import</span> java.sql.ResultSet;</span><br><span class="line"><span class="keyword">import</span> java.sql.Statement;</span><br><span class="line"><span class="keyword">import</span> java.util.Properties;</span><br><span class="line"><span class="keyword">import</span> javax.swing.JButton;</span><br><span class="line"><span class="keyword">import</span> javax.swing.JFrame;</span><br><span class="line"><span class="keyword">import</span> javax.swing.JOptionPane;</span><br><span class="line"><span class="keyword">import</span> javax.swing.JTextField;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoginFrame</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">PROP_FILE</span> <span class="operator">=</span> <span class="string">&quot;mysql.ini&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> String driver;</span><br><span class="line">    <span class="comment">// url是数据库的服务地址</span></span><br><span class="line">    <span class="keyword">private</span> String url;</span><br><span class="line">    <span class="keyword">private</span> String user;</span><br><span class="line">    <span class="keyword">private</span> String pass;</span><br><span class="line">    <span class="comment">// 登录界面的GUI组件</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">JFrame</span> <span class="variable">jf</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JFrame</span>(<span class="string">&quot;登录&quot;</span>);</span><br><span class="line">    <span class="keyword">private</span> <span class="type">JTextField</span> <span class="variable">userField</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JTextField</span>(<span class="number">20</span>);</span><br><span class="line">    <span class="keyword">private</span> <span class="type">JTextField</span> <span class="variable">passField</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JTextField</span>(<span class="number">20</span>);</span><br><span class="line">    <span class="keyword">private</span> <span class="type">JButton</span> <span class="variable">loginButton</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JButton</span>(<span class="string">&quot;登录&quot;</span>);</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span> <span class="keyword">throws</span> Exception</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">Properties</span> <span class="variable">connProp</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Properties</span>();</span><br><span class="line">        connProp.load(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(PROP_FILE));</span><br><span class="line">        driver = connProp.getProperty(<span class="string">&quot;driver&quot;</span>);</span><br><span class="line">        url = connProp.getProperty(<span class="string">&quot;url&quot;</span>);</span><br><span class="line">        user = connProp.getProperty(<span class="string">&quot;user&quot;</span>);</span><br><span class="line">        pass = connProp.getProperty(<span class="string">&quot;pass&quot;</span>);</span><br><span class="line">        <span class="comment">// 加载驱动</span></span><br><span class="line">        Class.forName(driver);</span><br><span class="line">        <span class="comment">// 为登录按钮添加事件监听器</span></span><br><span class="line">        loginButton.addActionListener(e -&gt;</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// 登录成功则显示“登录成功”</span></span><br><span class="line">            <span class="keyword">if</span> (validate(userField.getText(), passField.getText()))</span><br><span class="line">            &#123;</span><br><span class="line">                JOptionPane.showMessageDialog(jf, <span class="string">&quot;登录成功&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 否则显示“登录失败”</span></span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                JOptionPane.showMessageDialog(jf, <span class="string">&quot;登录失败&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        jf.add(userField, BorderLayout.NORTH);</span><br><span class="line">        jf.add(passField);</span><br><span class="line">        jf.add(loginButton, BorderLayout.SOUTH);</span><br><span class="line">        jf.pack();</span><br><span class="line">        jf.setVisible(<span class="literal">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">validate</span><span class="params">(String userName, String userPass)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 执行查询的SQL语句</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;select * from jdbc_test &quot;</span> + <span class="string">&quot;where jdbc_name=&#x27;&quot;</span> + userName</span><br><span class="line">                + <span class="string">&quot;&#x27; and jdbc_desc=&#x27;&quot;</span> + userPass + <span class="string">&quot;&#x27;&quot;</span>;</span><br><span class="line">        System.out.println(sql);</span><br><span class="line">        <span class="keyword">try</span> (<span class="type">Connection</span> <span class="variable">conn</span> <span class="operator">=</span> DriverManager.getConnection(url, user, pass);</span><br><span class="line">                <span class="type">Statement</span> <span class="variable">stmt</span> <span class="operator">=</span> conn.createStatement();</span><br><span class="line">                <span class="type">ResultSet</span> <span class="variable">rs</span> <span class="operator">=</span> stmt.executeQuery(sql))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// 如果查询的ResultSet里有超过一条的记录，则登录成功</span></span><br><span class="line">            <span class="keyword">if</span> (rs.next())</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e)</span><br><span class="line">        &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// private boolean validate(String userName, String userPass)</span></span><br><span class="line">    <span class="comment">// &#123;</span></span><br><span class="line">    <span class="comment">// try (Connection conn = DriverManager.getConnection(url, user, pass);</span></span><br><span class="line">    <span class="comment">// PreparedStatement pstmt = conn.prepareStatement(</span></span><br><span class="line">    <span class="comment">// &quot;select * from jdbc_test where jdbc_name=? and jdbc_desc=?&quot;))</span></span><br><span class="line">    <span class="comment">// &#123;</span></span><br><span class="line">    <span class="comment">// pstmt.setString(1, userName);</span></span><br><span class="line">    <span class="comment">// pstmt.setString(2, userPass);</span></span><br><span class="line">    <span class="comment">// try (ResultSet rs = pstmt.executeQuery())</span></span><br><span class="line">    <span class="comment">// &#123;</span></span><br><span class="line">    <span class="comment">// // 如果查询的ResultSet里有超过一条的记录，则登录成功</span></span><br><span class="line">    <span class="comment">// if (rs.next())</span></span><br><span class="line">    <span class="comment">// &#123;</span></span><br><span class="line">    <span class="comment">// return true;</span></span><br><span class="line">    <span class="comment">// &#125;</span></span><br><span class="line">    <span class="comment">// &#125;</span></span><br><span class="line">    <span class="comment">// &#125; catch (Exception e)</span></span><br><span class="line">    <span class="comment">// &#123;</span></span><br><span class="line">    <span class="comment">// e.printStackTrace();</span></span><br><span class="line">    <span class="comment">// &#125;</span></span><br><span class="line">    <span class="comment">// return false;</span></span><br><span class="line">    <span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">LoginFrame</span>().init();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>运行上面程序,如果用户正常输入其用户名、密码当然没有问题,输入正确可以正常登录,输入错误将提示输入失败。但如果这个用户是一个<code>Cracker</code>,他可以在文本框中输入<code>&#39; or true or &#39;</code>,这个输入明显是不正确的,但当单击”登录”按钮后也会显示”登录成功”对话框。可以在程序运行的后台看到如下<code>SOL</code>语句:</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from jdbc_test where jdbc_name=&#x27;&#x27; or true or &#x27;&#x27; and jdbc_desc=&#x27;&#x27;</span><br></pre></td></tr></table></figure>
<p>看到这条<code>SQL</code>语句,读者应该不难明白为什么这样输入也可以显示”正常登录”对话框了,因为<code>Cracker</code>直接输入了<code>true</code>,而<code>SQL</code>把这个<code>true</code>当成了直接量。<br>如果把上面的<code>validate()</code>方法注释掉,然后取消另一个<code>validate()</code>方法的注释,换成使用<code>PreparedStatement</code>来执行验证.<br>这样,即使用户输入了:<code>&#39; or true or &#39;</code>,系统一样会显示”登录失败”对话框.<br>总体来看,使用<code>PreparedStatement</code>比使用<code>Statement</code>多了如下三个好处:</p>
<ul>
<li><code>PreparedStatement</code>预编译<code>SQL</code>语句,性能更好。</li>
<li><code>PreparedStatement</code>无须”拼接”<code>SQL</code>语句,编程更简单。</li>
<li><code>PreparedStatement</code>可以防止<code>SQL</code>注入,安全性更好。</li>
</ul>
<p>基于以上三点,通常推荐避免使用<code>Statement</code>来执行<code>SQL</code>语句,改为使用<code>PreparedStatement</code>执行<code>SQL</code>语句.</p>
<h2 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h2><p>使用<code>PreparedStatement</code>执行带占位符参数的<code>SQL</code>语句时,<code>SQL</code>语句中的占位符参数只能代替普通值,不要使用占位符参数代替表名、列名等数据库对象,更不要用占位符参数来代替<code>SQL</code>语句中的<code>Insert</code>、 <code>select</code>等关键字。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://lanlan2017.github.io/JavaReadingNotes/8b945643/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/JavaReadingNotes/images/avatar.gif">
      <meta itemprop="name" content="蓝蓝">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="蓝蓝站点">
      <meta itemprop="description" content="好好学习，天天向上">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 蓝蓝站点">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/JavaReadingNotes/8b945643/" class="post-title-link" itemprop="url">13.4.2 使用execute方法执行SQL语句</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-07-04 14:20:20" itemprop="dateCreated datePublished" datetime="2019-07-04T14:20:20+08:00">2019-07-04</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2020-02-07 01:34:56" itemprop="dateModified" datetime="2020-02-07T01:34:56+08:00">2020-02-07</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/1-%E7%96%AF%E7%8B%82Java%E8%AE%B2%E4%B9%89-%E7%AC%AC4%E7%89%88/" itemprop="url" rel="index"><span itemprop="name">1 疯狂Java讲义 (第4版)</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/1-%E7%96%AF%E7%8B%82Java%E8%AE%B2%E4%B9%89-%E7%AC%AC4%E7%89%88/%E7%AC%AC13%E7%AB%A0-MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%8EJDBC%E7%BC%96%E7%A8%8B/" itemprop="url" rel="index"><span itemprop="name">第13章 MySQL数据库与JDBC编程</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/1-%E7%96%AF%E7%8B%82Java%E8%AE%B2%E4%B9%89-%E7%AC%AC4%E7%89%88/%E7%AC%AC13%E7%AB%A0-MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%8EJDBC%E7%BC%96%E7%A8%8B/13-4-%E6%89%A7%E8%A1%8CSQL%E8%AF%AD%E5%8F%A5%E7%9A%84%E6%96%B9%E5%BC%8F/" itemprop="url" rel="index"><span itemprop="name">13.4 执行SQL语句的方式</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
    <span class="post-meta-item-icon">
      <i class="far fa-comment"></i>
    </span>
    <span class="post-meta-item-text">Waline：</span>
  
    <a title="waline" href="/JavaReadingNotes/8b945643/#waline-comments" itemprop="discussionUrl">
      <span class="post-comments-count waline-comment-count" id="/JavaReadingNotes/8b945643/" data-xid="/JavaReadingNotes/8b945643/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>2.8k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>3 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="13-4-2-使用execute方法执行SQL语句"><a href="#13-4-2-使用execute方法执行SQL语句" class="headerlink" title="13.4.2 使用execute方法执行SQL语句"></a>13.4.2 使用execute方法执行SQL语句</h1><p><strong><code>Statement</code>的<code>execute()</code>方法几乎可以执行任何<code>SQL</code>语句</strong>,但它执行<code>SQL</code>语句时比较麻烦,通常没有必要使用<code>execute()</code>方法来执行<code>SQL</code>语句,使用<code>executeQuery()</code>或<code>executeUpdate()</code>方法更简单。但如果不清楚<code>SQL</code>语句的类型,则只能使用<code>execute</code>方法来执行该<code>SQL</code>语句了。<br>使用<code>execute()</code>方法执行<code>SQL</code>语句的返回值是<code>boolean</code>值,它表明执行该<code>SQL</code>语句是否返回了<code>ResultSet</code>对象。那么如何来获取执行<code>SQL</code>语句后得到的<code>ResultSet</code>对象呢? <code>Statement</code>提供了如下两个方法来获取执行结果。</p>
<table>
<thead>
<tr>
<th align="left">方法</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>getResultSet()</code></td>
<td align="left">获取该<code>Statement</code>执行查询语句所返回的<code>ResultSet</code>对象。</td>
</tr>
<tr>
<td align="left"><code>getUpdateCount()</code></td>
<td align="left">获取该<code>Statement</code>执行<code>DML</code>语句所影响的记录行数</td>
</tr>
</tbody></table>
<p>下面程序示范了使用<code>Statement</code>的<code>execute()</code>方法来执行任意的<code>SQL</code>语句,执行不同的<code>SQL</code>语句时产生不同的输出。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.sql.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ExecuteSQL</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> String driver;</span><br><span class="line">    <span class="keyword">private</span> String url;</span><br><span class="line">    <span class="keyword">private</span> String user;</span><br><span class="line">    <span class="keyword">private</span> String pass;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">initParam</span><span class="params">(String paramFile)</span> <span class="keyword">throws</span> Exception</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 使用Properties类来加载属性文件</span></span><br><span class="line">        <span class="type">Properties</span> <span class="variable">props</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Properties</span>();</span><br><span class="line">        props.load(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(paramFile));</span><br><span class="line">        driver = props.getProperty(<span class="string">&quot;driver&quot;</span>);</span><br><span class="line">        url = props.getProperty(<span class="string">&quot;url&quot;</span>);</span><br><span class="line">        user = props.getProperty(<span class="string">&quot;user&quot;</span>);</span><br><span class="line">        pass = props.getProperty(<span class="string">&quot;pass&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">executeSql</span><span class="params">(String sql)</span> <span class="keyword">throws</span> Exception</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 1.加载驱动</span></span><br><span class="line">        Class.forName(driver);</span><br><span class="line">        <span class="keyword">try</span> (</span><br><span class="line">                <span class="comment">// 2.获取数据库连接</span></span><br><span class="line">                <span class="type">Connection</span> <span class="variable">conn</span> <span class="operator">=</span> DriverManager.getConnection(url, user, pass);</span><br><span class="line">                <span class="comment">// 3.使用Connection来创建一个Statement对象</span></span><br><span class="line">                <span class="type">Statement</span> <span class="variable">stmt</span> <span class="operator">=</span> conn.createStatement())</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// 4.执行SQL,返回boolean值表示是否包含ResultSet</span></span><br><span class="line">            <span class="type">boolean</span> <span class="variable">hasResultSet</span> <span class="operator">=</span> stmt.execute(sql);</span><br><span class="line">            <span class="comment">// 5.如果执行后有ResultSet结果集</span></span><br><span class="line">            <span class="keyword">if</span> (hasResultSet)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">try</span> (</span><br><span class="line">                        <span class="comment">// 获取结果集</span></span><br><span class="line">                        <span class="type">ResultSet</span> <span class="variable">rs</span> <span class="operator">=</span> stmt.getResultSet())</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="comment">// ResultSetMetaData是用于分析结果集的元数据接口</span></span><br><span class="line">                    <span class="type">ResultSetMetaData</span> <span class="variable">rsmd</span> <span class="operator">=</span> rs.getMetaData();</span><br><span class="line">                    <span class="comment">// 获取列数</span></span><br><span class="line">                    <span class="type">int</span> <span class="variable">columnCount</span> <span class="operator">=</span> rsmd.getColumnCount();</span><br><span class="line">                    <span class="comment">// 迭代输出ResultSet对象</span></span><br><span class="line">                    <span class="keyword">while</span> (rs.next())</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="comment">// 依次输出每列的值</span></span><br><span class="line">                        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; columnCount; i++)</span><br><span class="line">                        &#123;</span><br><span class="line">                            System.out.print(rs.getString(i + <span class="number">1</span>) + <span class="string">&quot;\t&quot;</span>);</span><br><span class="line">                        &#125;</span><br><span class="line">                        System.out.print(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                System.out</span><br><span class="line">                        .println(<span class="string">&quot;该SQL语句影响的记录有&quot;</span> + stmt.getUpdateCount() + <span class="string">&quot;条&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">ExecuteSQL</span> <span class="variable">es</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ExecuteSQL</span>();</span><br><span class="line">        es.initParam(<span class="string">&quot;mysql.ini&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;------执行删除表的DDL语句-----&quot;</span>);</span><br><span class="line">        es.executeSql(<span class="string">&quot;drop table if exists my_test&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;------执行建表的DDL语句-----&quot;</span>);</span><br><span class="line">        es.executeSql(<span class="string">&quot;create table my_test&quot;</span></span><br><span class="line">                + <span class="string">&quot;(test_id int auto_increment primary key, &quot;</span></span><br><span class="line">                + <span class="string">&quot;test_name varchar(255))&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;------执行插入数据的DML语句-----&quot;</span>);</span><br><span class="line">        es.executeSql(<span class="string">&quot;insert into my_test(test_name) &quot;</span></span><br><span class="line">                + <span class="string">&quot;select student_name from student_table&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;------执行查询数据的查询语句-----&quot;</span>);</span><br><span class="line">        es.executeSql(<span class="string">&quot;select * from my_test&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>运行上面程序,会看到使用<code>Statement</code>的不同方法执行不同<code>SQL</code>语句的效果。执行<code>DDL</code>语句显示受影响的记录条数为0;执行<code>DML</code>语句显示插入、修改或删除的记录条数;执行查询语句则可以输出查询结果。<br>提示<br>上面程序获得<code>SQL</code>执行结果时没有根据各列的数据类型调用相应的<code>getXxx()</code>方法而是直接使用<code>getString()</code>方法来取得值,这是可以的。 <code>ResultSet</code>的<code>getString()</code>方法几乎可以获取除<code>Blob</code>之外的任意类型列的值,因为所有的数据类型都可以自动转换成字符串类型。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://lanlan2017.github.io/JavaReadingNotes/514ad364/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/JavaReadingNotes/images/avatar.gif">
      <meta itemprop="name" content="蓝蓝">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="蓝蓝站点">
      <meta itemprop="description" content="好好学习，天天向上">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 蓝蓝站点">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/JavaReadingNotes/514ad364/" class="post-title-link" itemprop="url">13.4 执行SQL语句的方式</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-07-04 13:40:00" itemprop="dateCreated datePublished" datetime="2019-07-04T13:40:00+08:00">2019-07-04</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2020-02-07 01:34:56" itemprop="dateModified" datetime="2020-02-07T01:34:56+08:00">2020-02-07</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/1-%E7%96%AF%E7%8B%82Java%E8%AE%B2%E4%B9%89-%E7%AC%AC4%E7%89%88/" itemprop="url" rel="index"><span itemprop="name">1 疯狂Java讲义 (第4版)</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/1-%E7%96%AF%E7%8B%82Java%E8%AE%B2%E4%B9%89-%E7%AC%AC4%E7%89%88/%E7%AC%AC13%E7%AB%A0-MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%8EJDBC%E7%BC%96%E7%A8%8B/" itemprop="url" rel="index"><span itemprop="name">第13章 MySQL数据库与JDBC编程</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/1-%E7%96%AF%E7%8B%82Java%E8%AE%B2%E4%B9%89-%E7%AC%AC4%E7%89%88/%E7%AC%AC13%E7%AB%A0-MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%8EJDBC%E7%BC%96%E7%A8%8B/13-4-%E6%89%A7%E8%A1%8CSQL%E8%AF%AD%E5%8F%A5%E7%9A%84%E6%96%B9%E5%BC%8F/" itemprop="url" rel="index"><span itemprop="name">13.4 执行SQL语句的方式</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
    <span class="post-meta-item-icon">
      <i class="far fa-comment"></i>
    </span>
    <span class="post-meta-item-text">Waline：</span>
  
    <a title="waline" href="/JavaReadingNotes/514ad364/#waline-comments" itemprop="discussionUrl">
      <span class="post-comments-count waline-comment-count" id="/JavaReadingNotes/514ad364/" data-xid="/JavaReadingNotes/514ad364/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>3.6k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>3 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="13-4-执行SQL语句的方式"><a href="#13-4-执行SQL语句的方式" class="headerlink" title="13.4 执行SQL语句的方式"></a>13.4 执行SQL语句的方式</h1><p>前面介绍了<code>JDBC</code>执行查询等示例程序,实际上,<code>JDBC</code>不仅可以执行查询,也可以执行<code>DDLML</code>等<code>SQL</code>语句,从而允许通过<code>JDBC</code>最大限度地控制数据库。</p>
<h2 id="13-4-1-使用executeUpdate方法执行DDL和DML语句"><a href="#13-4-1-使用executeUpdate方法执行DDL和DML语句" class="headerlink" title="13.4.1 使用executeUpdate方法执行DDL和DML语句"></a>13.4.1 使用executeUpdate方法执行DDL和DML语句</h2><p><code>Statement</code>提供了三个方法来执行<code>SQL</code>语句,前面已经介绍了使用<code>executeQuery</code>来执行查询语句,下面将介绍使用<code>executeLargeUpdate()</code>或<code>executeUpdate()</code>来执行<code>DDL</code>和<code>DML</code>语句。使用<code>Statement</code>执行<code>DDL</code>和<code>DML</code>语句的步骤与执行普通查询语句的步骤基本相似,区别在于:</p>
<ul>
<li>执行了<code>DDL</code>语句后返回值为<code>0</code>,</li>
<li>执行了<code>DML</code>语句后返回值为受影响的记录条数。</li>
</ul>
<blockquote>
<p>数据库模式定义语言<code>DDL(Data Definition Language)</code>,主要由<code>create</code>(创建)、<code>alter</code>(修改)、<code>drop</code>(删除)和<code>truncate</code>(删除)四个关键字完成。<br>数据操纵语言(<code>Data Manipulation Language, DML</code>),由<code>insert</code>(插入),<code>update</code>(更新),<code>delete</code>(删除)<br>对于一个表:</p>
</blockquote>
<ul>
<li>当不再需要该表时, 用<code>drop</code>;</li>
<li>当你仍要保留该表,但要删除所有记录时,用<code>truncate</code>;</li>
<li>当你要删除部分记录时,用<code>delete</code>.</li>
</ul>
<h3 id="executeUpdate-方法执行DDL语句"><a href="#executeUpdate-方法执行DDL语句" class="headerlink" title="executeUpdate()方法执行DDL语句"></a>executeUpdate()方法执行DDL语句</h3><p>下面程序示范了使用<code>executeUpdate()</code>方法创建数据表,如果<code>MySQL</code>驱动支持,也可以使用<code>executeLargeUpdate()</code>方法。</p>
<p>下面的实例中没有直接把数据库连接信息写在程序里,而是使用一个<code>mysql.ini</code>文件(就是一个<code>properties</code>文件)来保存数据库连接信息,<code>mysql.ini</code>文件中的那内容如下:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">driver=com.mysql.jdbc.Driver</span><br><span class="line">url=jdbc:mysql://127.0.0.1:3306/select_test</span><br><span class="line">user=root</span><br><span class="line">pass=root</span><br></pre></td></tr></table></figure>
<p>当需要把应用程序从开发环境移植到生产环境时,无须修改源代码,只需要修改<code>mysql.ini</code>配置文件即可.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.sql.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ExecuteDDL</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> String driver;</span><br><span class="line">    <span class="keyword">private</span> String url;</span><br><span class="line">    <span class="keyword">private</span> String user;</span><br><span class="line">    <span class="keyword">private</span> String pass;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">initParam</span><span class="params">(String paramFile)</span> <span class="keyword">throws</span> Exception</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 使用Properties类来加载属性文件</span></span><br><span class="line">        <span class="type">Properties</span> <span class="variable">props</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Properties</span>();</span><br><span class="line">        props.load(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(paramFile));</span><br><span class="line">        driver = props.getProperty(<span class="string">&quot;driver&quot;</span>);</span><br><span class="line">        url = props.getProperty(<span class="string">&quot;url&quot;</span>);</span><br><span class="line">        user = props.getProperty(<span class="string">&quot;user&quot;</span>);</span><br><span class="line">        pass = props.getProperty(<span class="string">&quot;pass&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">createTable</span><span class="params">(String sql)</span> <span class="keyword">throws</span> Exception</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 1.加载驱动</span></span><br><span class="line">        Class.forName(driver);</span><br><span class="line">        <span class="keyword">try</span> (</span><br><span class="line">                <span class="comment">// 2.获取数据库连接</span></span><br><span class="line">                <span class="type">Connection</span> <span class="variable">conn</span> <span class="operator">=</span> DriverManager.getConnection(url, user, pass);</span><br><span class="line">                <span class="comment">// 3.使用Connection来创建一个Statment对象</span></span><br><span class="line">                <span class="type">Statement</span> <span class="variable">stmt</span> <span class="operator">=</span> conn.createStatement())</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// 4.执行DDL,创建数据表</span></span><br><span class="line">            stmt.executeUpdate(sql);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">ExecuteDDL</span> <span class="variable">ed</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ExecuteDDL</span>();</span><br><span class="line">        ed.initParam(<span class="string">&quot;mysql.ini&quot;</span>);</span><br><span class="line">        ed.createTable(<span class="string">&quot;create table jdbc_test &quot;</span></span><br><span class="line">                + <span class="string">&quot;( jdbc_id int auto_increment primary key, &quot;</span></span><br><span class="line">                + <span class="string">&quot;jdbc_name varchar(255), &quot;</span> + <span class="string">&quot;jdbc_desc text);&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;-----建表成功-----&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>运行上面程序,执行成功后会看到<code>select_test</code>数据库中添加了一个<code>jdbc_test</code>数据表,这表明<code>JDBC</code>执行<code>DDL</code>语句成功。</p>
<h3 id="executeUpdate-方法执行DML语句"><a href="#executeUpdate-方法执行DML语句" class="headerlink" title="executeUpdate()方法执行DML语句"></a>executeUpdate()方法执行DML语句</h3><p>使用<code>executeUpdate()</code>执行<code>DML</code>语句与执行<code>DDL</code>语句基本相似,区别是<code>executeUpdate()</code>执行<code>DDL</code>语句后返回<code>0</code>,而执行<code>DML</code>语句后返回受影响的记录条数。<br>下面程序将会执行一条<code>insert</code>语句,这条<code>insert</code>语句会向刚刚建立的<code>jdbc_test</code>数据表中插入几条记录。因为使用了带子查询的<code>insert</code>语句,所以可以一次插入多条语句.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.sql.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ExecuteDML</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> String driver;</span><br><span class="line">    <span class="keyword">private</span> String url;</span><br><span class="line">    <span class="keyword">private</span> String user;</span><br><span class="line">    <span class="keyword">private</span> String pass;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">initParam</span><span class="params">(String paramFile)</span> <span class="keyword">throws</span> Exception</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 使用Properties类来加载属性文件</span></span><br><span class="line">        <span class="type">Properties</span> <span class="variable">props</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Properties</span>();</span><br><span class="line">        props.load(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(paramFile));</span><br><span class="line">        driver = props.getProperty(<span class="string">&quot;driver&quot;</span>);</span><br><span class="line">        url = props.getProperty(<span class="string">&quot;url&quot;</span>);</span><br><span class="line">        user = props.getProperty(<span class="string">&quot;user&quot;</span>);</span><br><span class="line">        pass = props.getProperty(<span class="string">&quot;pass&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">insertData</span><span class="params">(String sql)</span> <span class="keyword">throws</span> Exception</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 1.加载驱动</span></span><br><span class="line">        Class.forName(driver);</span><br><span class="line">        <span class="keyword">try</span> (</span><br><span class="line">                <span class="comment">// 2.获取数据库连接</span></span><br><span class="line">                <span class="type">Connection</span> <span class="variable">conn</span> <span class="operator">=</span> DriverManager.getConnection(url, user, pass);</span><br><span class="line">                <span class="comment">// 3.使用Connection来创建一个Statment对象</span></span><br><span class="line">                <span class="type">Statement</span> <span class="variable">stmt</span> <span class="operator">=</span> conn.createStatement())</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// 4.执行DML,返回受影响的记录条数</span></span><br><span class="line">            <span class="keyword">return</span> stmt.executeUpdate(sql);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">ExecuteDML</span> <span class="variable">ed</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ExecuteDML</span>();</span><br><span class="line">        ed.initParam(<span class="string">&quot;mysql.ini&quot;</span>);</span><br><span class="line">        <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> ed.insertData(<span class="string">&quot;insert into jdbc_test(jdbc_name,jdbc_desc)&quot;</span></span><br><span class="line">                + <span class="string">&quot;select s.student_name , t.teacher_name &quot;</span></span><br><span class="line">                + <span class="string">&quot;from student_table s , teacher_table t &quot;</span></span><br><span class="line">                + <span class="string">&quot;where s.java_teacher = t.teacher_id;&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;--系统中共有&quot;</span> + result + <span class="string">&quot;条记录受影响--&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>运行上面程序,执行成功将会看到<code>jdbc_test</code>数据表中多了几条记录,而且在程序控制台会看到输出有几条记录受影响的信息。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://lanlan2017.github.io/JavaReadingNotes/2ac92d84/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/JavaReadingNotes/images/avatar.gif">
      <meta itemprop="name" content="蓝蓝">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="蓝蓝站点">
      <meta itemprop="description" content="好好学习，天天向上">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 蓝蓝站点">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/JavaReadingNotes/2ac92d84/" class="post-title-link" itemprop="url">13.3.2 JDBC编程步骤</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-07-04 11:52:53" itemprop="dateCreated datePublished" datetime="2019-07-04T11:52:53+08:00">2019-07-04</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2020-02-07 01:34:56" itemprop="dateModified" datetime="2020-02-07T01:34:56+08:00">2020-02-07</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/1-%E7%96%AF%E7%8B%82Java%E8%AE%B2%E4%B9%89-%E7%AC%AC4%E7%89%88/" itemprop="url" rel="index"><span itemprop="name">1 疯狂Java讲义 (第4版)</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/1-%E7%96%AF%E7%8B%82Java%E8%AE%B2%E4%B9%89-%E7%AC%AC4%E7%89%88/%E7%AC%AC13%E7%AB%A0-MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%8EJDBC%E7%BC%96%E7%A8%8B/" itemprop="url" rel="index"><span itemprop="name">第13章 MySQL数据库与JDBC编程</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/1-%E7%96%AF%E7%8B%82Java%E8%AE%B2%E4%B9%89-%E7%AC%AC4%E7%89%88/%E7%AC%AC13%E7%AB%A0-MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%8EJDBC%E7%BC%96%E7%A8%8B/13-3-JDBC%E7%9A%84%E5%85%B8%E5%9E%8B%E7%94%A8%E6%B3%95/" itemprop="url" rel="index"><span itemprop="name">13.3 JDBC的典型用法</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
    <span class="post-meta-item-icon">
      <i class="far fa-comment"></i>
    </span>
    <span class="post-meta-item-text">Waline：</span>
  
    <a title="waline" href="/JavaReadingNotes/2ac92d84/#waline-comments" itemprop="discussionUrl">
      <span class="post-comments-count waline-comment-count" id="/JavaReadingNotes/2ac92d84/" data-xid="/JavaReadingNotes/2ac92d84/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>3.3k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>3 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="13-3-2-JDBC编程步骤"><a href="#13-3-2-JDBC编程步骤" class="headerlink" title="13.3.2 JDBC编程步骤"></a>13.3.2 JDBC编程步骤</h1><p>大致了解了<code>JDBC API</code>的相关接口和类之后,下面就可以进行<code>JDBC</code>编程了,<code>JDBC</code>编程大致按如下步骤进行。</p>
<h2 id="1-加载数据库驱动"><a href="#1-加载数据库驱动" class="headerlink" title="1.加载数据库驱动"></a>1.加载数据库驱动</h2><p>通常使用<code>Class</code>类的<code>forName()</code>静态方法来加载驱动。例如如下代码:<br><code>Class forName(driverClass)</code><br>上面代码中的<code>driverClass</code>就是数据库驱动类所对应的字符串。例如,加载<code>MySQL</code>的驱动采用如下代码:<br><code>Class.forName(&quot;com.mysql.jdbc.Driver&quot;);</code><br>而加载<code>Oracle</code>的驱动则采用如下代码:<br><code>Class.forName(&quot;oracle.jdbc.driver.OracleDriver&quot;);</code><br>从上面代码中可以看出,加载驱动时并不是真正使用数据库的驱动类,只是使用数据库驱动类名的字符串而已。</p>
<h2 id="2-通过DriverManager获取数据库连接"><a href="#2-通过DriverManager获取数据库连接" class="headerlink" title="2.通过DriverManager获取数据库连接"></a>2.通过DriverManager获取数据库连接</h2><p><code>DriverManager</code>提供了如下方法:<br><code>DriverManager getConnection(String url, String user, String password);</code><br>当使用<code>DriverManager</code>获取数据库连接时,通常需要传入三个参数:<strong>数据库<code>URL</code><strong>、</strong>登录数据库的用户名</strong>和<strong>密码</strong>。这三个参数中用户名和密码通常由<code>DBA</code>(数据库管理员)分配,而且该用户还应该具有相应的权限,才可以执行相应的<code>SQL</code>语句<br>数据库<code>URL</code>通常遵循如下写法<br><code>jdbc:subprotocol:other stuff</code><br>上面<code>URL</code>写法中的<code>jdbc</code>是固定的,而<code>subprotocol</code>指定连接到特定数据库的驱动,而后面的<code>other</code>和<code>stuff</code>是不固定的—也没有较强的规律,不同数据库的<code>URL</code>写法可能存在较大差异例如, <code>MySQL</code>数据库的<code>URL</code>写法如下:<br><code>jdbc:mysql://hostName:port/DataBaseName</code><br><code>Oracle</code>数据库的<code>URL</code>写法如下:<br><code>jdbc:oracle:thin:@hostName:port:databaseName</code></p>
<h2 id="3-通过Connection对象创建Statement对象"><a href="#3-通过Connection对象创建Statement对象" class="headerlink" title="3.通过Connection对象创建Statement对象"></a>3.通过Connection对象创建Statement对象</h2><p><code>Connection</code>创建<code>Statement</code>的方法有如下三个。</p>
<table>
<thead>
<tr>
<th align="left">方法</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>createStatement()</code></td>
<td align="left">创建基本的<code>Statement</code>对象。</td>
</tr>
<tr>
<td align="left"><code>prepareStatement(String sql)</code></td>
<td align="left">根据传入的<code>SQL</code>语句创建预编译的<code>Statement</code>对象。</td>
</tr>
<tr>
<td align="left"><code>prepareCall(String sql)</code></td>
<td align="left">根据传入的<code>SQL</code>语句创建<code>Callablestatement</code>对象。</td>
</tr>
</tbody></table>
<h2 id="4-使用Statement执行SQL语句"><a href="#4-使用Statement执行SQL语句" class="headerlink" title="4.使用Statement执行SQL语句"></a>4.使用Statement执行SQL语句</h2><p>所有的<code>Statement</code>都有如下三个方法来执行<code>SQL</code>语句。</p>
<table>
<thead>
<tr>
<th align="left">方法</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>execute()</code></td>
<td align="left">可以执行任何<code>SQL</code>语句,但比较麻烦。</td>
</tr>
<tr>
<td align="left"><code>executeUpdate()</code></td>
<td align="left">主要用于执行<code>DML</code>和<code>DDL</code>语句。执行<code>DML</code>语句返回受<code>SQL</code>语句影响的行数,执行<code>DDL</code>语句返回0</td>
</tr>
<tr>
<td align="left"><code>executeQuery()</code></td>
<td align="left">只能执行查询语句,执行后返回代表查询结果的<code>ResultSet</code>对象。</td>
</tr>
</tbody></table>
<h2 id="5-操作结果集"><a href="#5-操作结果集" class="headerlink" title="5.操作结果集"></a>5.操作结果集</h2><p>如果执行的<code>SQL</code>语句是查询语句,则执行结果将返回一个<code>ResultSet</code>对象,该对象里保存了<code>SQL</code>语句查询的结果。程序可以通过操作该<code>ResultSet</code>对象来取出查询结果。 <code>ResultSet</code>对象主要提供了如下两类方法。</p>
<ul>
<li>移动记录指针的方法:<code>next()</code>、<code>previous()</code>、<code>first()</code>、<code>last()</code>、<code>beforeFirst()</code>、<code>afterLast()</code>、<code>absolute()</code></li>
<li>获取记录指针指向的行中特定列的值:<code>getXxx()</code>方法。该方法既可使用列索引作为参数,也可使用列名作为参数。<ul>
<li>使用列索引作为参数性能更好,</li>
<li>使用列名作为参数可读性更好。</li>
</ul>
</li>
</ul>
<p><code>ResultSet</code>实质是一个査询结果集,在逻辑结构上非常类似于一个表。图13.17显示了<code>ResultSet</code>的逻辑结构,以及操作<code>ResultSet</code>结果集并获取值的方法示意图</p>
<h2 id="6-回收数据库资源"><a href="#6-回收数据库资源" class="headerlink" title="6.回收数据库资源"></a>6.回收数据库资源</h2><p>包括关闭<code>ResultSet</code>、 <code>Statement</code>和<code>Connection</code>等资源。</p>
<h2 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h2><p>下面程序简单示范了<code>JDBC</code>编程,并通过<code>ResultSet</code>获得结果集的过程。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.sql.*;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConnMySql</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 1.加载驱动，使用反射的知识，现在记住这么写。</span></span><br><span class="line">        Class.forName(<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>);</span><br><span class="line">        <span class="keyword">try</span> (</span><br><span class="line">                <span class="comment">// 2.使用DriverManager获取数据库连接,</span></span><br><span class="line">                <span class="comment">// 其中返回的Connection就代表了Java程序和数据库的连接</span></span><br><span class="line">                <span class="comment">// 不同数据库的URL写法需要查驱动文档知道，用户名、密码由DBA分配</span></span><br><span class="line">                <span class="type">Connection</span> <span class="variable">conn</span> <span class="operator">=</span> DriverManager.getConnection(</span><br><span class="line">                        <span class="string">&quot;jdbc:mysql://127.0.0.1:3306/select_test&quot;</span>, <span class="string">&quot;root&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;root&quot;</span>);</span><br><span class="line">                <span class="comment">// 3.使用Connection来创建一个Statment对象</span></span><br><span class="line">                <span class="type">Statement</span> <span class="variable">stmt</span> <span class="operator">=</span> conn.createStatement();</span><br><span class="line">                <span class="comment">// 4.执行SQL语句</span></span><br><span class="line">                <span class="comment">/*</span></span><br><span class="line"><span class="comment">                 * Statement有三种执行sql语句的方法： 1 execute 可执行任何SQL语句。- 返回一个boolean值，</span></span><br><span class="line"><span class="comment">                 * 如果执行后第一个结果是ResultSet，则返回true，否则返回false 2 executeQuery</span></span><br><span class="line"><span class="comment">                 * 执行Select语句 － 返回查询到的结果集 3 executeUpdate 用于执行DML语句。－ 返回一个整数，</span></span><br><span class="line"><span class="comment">                 * 代表被SQL语句影响的记录条数</span></span><br><span class="line"><span class="comment">                 */</span></span><br><span class="line">                <span class="type">ResultSet</span> <span class="variable">rs</span> <span class="operator">=</span> stmt.executeQuery(<span class="string">&quot;select s.* , teacher_name&quot;</span></span><br><span class="line">                        + <span class="string">&quot; from student_table s , teacher_table t&quot;</span></span><br><span class="line">                        + <span class="string">&quot; where t.teacher_id = s.java_teacher&quot;</span>);</span><br><span class="line">            )</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// ResultSet有系列的getXxx(列索引 | 列名)，用于获取记录指针</span></span><br><span class="line">            <span class="comment">// 指向行、特定列的值，不断地使用next()将记录指针下移一行，</span></span><br><span class="line">            <span class="comment">// 如果移动之后记录指针依然指向有效行，则next()方法返回true。</span></span><br><span class="line">            <span class="keyword">while</span> (rs.next())</span><br><span class="line">            &#123;</span><br><span class="line">                System.out.println(rs.getInt(<span class="number">1</span>) + <span class="string">&quot;\t&quot;</span> + rs.getString(<span class="number">2</span>) + <span class="string">&quot;\t&quot;</span></span><br><span class="line">                        + rs.getString(<span class="number">3</span>) + <span class="string">&quot;\t&quot;</span> + rs.getString(<span class="number">4</span>));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上面程序严格按<code>JDBC</code>访问数据库的步骤执行了一条多表连接査询语句,这条连接查询语句就是前面介绍<code>SQL 92</code>连接时所讲的连接查询语句。<br>运行上面程序,会看到如下所示:</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>       张三    <span class="number">1</span>       Yeeku</span><br><span class="line"><span class="number">2</span>       张三    <span class="number">1</span>       Yeeku</span><br><span class="line"><span class="number">3</span>       李四    <span class="number">1</span>       Yeeku</span><br><span class="line"><span class="number">4</span>       王五    <span class="number">2</span>       Leegang</span><br><span class="line"><span class="number">5</span>       _王五   <span class="number">2</span>       Leegang</span><br><span class="line"><span class="number">6</span>       null    <span class="number">2</span>       Leegang</span><br><span class="line"><span class="number">7</span>       赵六    <span class="number">3</span>       Martine</span><br></pre></td></tr></table></figure>
<p>与前面介绍的步骤略有区别的是,本程序采用了自动关闭资源的<code>try</code>语句来关闭各种数据库资源,<code>Java 7</code>改写了<code>Connection</code>、<code>Statement</code>、 <code>ResultSet</code>等接口,它们都继承了<code>AutoCloseable</code>接口,因此它们都可以由<code>try</code>语句来关闭。</p>
<h2 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h2><p><code>JDBC</code>编程大致按如下步骤进行</p>
<ul>
<li>1.加载数据库驱动</li>
<li>2.通过<code>DriverManager</code>获取数据库连接</li>
<li>3.通过<code>Connection</code>对象创建<code>Statement</code>对象</li>
<li>4.使用<code>Statement</code>执行<code>SQL</code>语句</li>
<li>5.操作结果集</li>
<li>6.回收数据库资源</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://lanlan2017.github.io/JavaReadingNotes/2940dac4/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/JavaReadingNotes/images/avatar.gif">
      <meta itemprop="name" content="蓝蓝">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="蓝蓝站点">
      <meta itemprop="description" content="好好学习，天天向上">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 蓝蓝站点">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/JavaReadingNotes/2940dac4/" class="post-title-link" itemprop="url">13.3 JDBC的典型用法 13.3.1 JDBC4.2常用接口和类简介</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-07-03 00:07:25" itemprop="dateCreated datePublished" datetime="2019-07-03T00:07:25+08:00">2019-07-03</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2020-02-07 01:34:56" itemprop="dateModified" datetime="2020-02-07T01:34:56+08:00">2020-02-07</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/1-%E7%96%AF%E7%8B%82Java%E8%AE%B2%E4%B9%89-%E7%AC%AC4%E7%89%88/" itemprop="url" rel="index"><span itemprop="name">1 疯狂Java讲义 (第4版)</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/1-%E7%96%AF%E7%8B%82Java%E8%AE%B2%E4%B9%89-%E7%AC%AC4%E7%89%88/%E7%AC%AC13%E7%AB%A0-MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%8EJDBC%E7%BC%96%E7%A8%8B/" itemprop="url" rel="index"><span itemprop="name">第13章 MySQL数据库与JDBC编程</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/1-%E7%96%AF%E7%8B%82Java%E8%AE%B2%E4%B9%89-%E7%AC%AC4%E7%89%88/%E7%AC%AC13%E7%AB%A0-MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%8EJDBC%E7%BC%96%E7%A8%8B/13-3-JDBC%E7%9A%84%E5%85%B8%E5%9E%8B%E7%94%A8%E6%B3%95/" itemprop="url" rel="index"><span itemprop="name">13.3 JDBC的典型用法</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
    <span class="post-meta-item-icon">
      <i class="far fa-comment"></i>
    </span>
    <span class="post-meta-item-text">Waline：</span>
  
    <a title="waline" href="/JavaReadingNotes/2940dac4/#waline-comments" itemprop="discussionUrl">
      <span class="post-comments-count waline-comment-count" id="/JavaReadingNotes/2940dac4/" data-xid="/JavaReadingNotes/2940dac4/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>3.7k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>3 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="13-3-JDBC的典型用法"><a href="#13-3-JDBC的典型用法" class="headerlink" title="13.3 JDBC的典型用法"></a>13.3 JDBC的典型用法</h1><h2 id="13-3-1-JDBC4-2常用接口和类简介"><a href="#13-3-1-JDBC4-2常用接口和类简介" class="headerlink" title="13.3.1 JDBC4.2常用接口和类简介"></a>13.3.1 JDBC4.2常用接口和类简介</h2><p><code>Java 8</code>支持<code>JDBC4.2</code>标准,<code>JDBC4.2</code>在原有<code>JDBC</code>标准上增加了一些新特性。下面介绍这些<code>JDBC API</code>时会提到<code>Java 8</code>新增的功能.</p>
<h3 id="DriverManager"><a href="#DriverManager" class="headerlink" title="DriverManager"></a>DriverManager</h3><p><code>DriverManager</code>:用于管理<code>JDBC</code>驱动的服务类。程序中使用该类的主要功能是获取<code>Connection</code>对象,该类包含如下方法。</p>
<ul>
<li><code>public static synchronized Connection getConnection(String url, String user, String pass) throws SQLException</code>:该方法可以获得<code>url</code>对应数据库的连接。</li>
</ul>
<h3 id="Connection"><a href="#Connection" class="headerlink" title="Connection"></a>Connection</h3><p><code>Connection</code>:代表数据库连接对象,每个<code>Connection</code>代表一个物理连接会话。<strong>要想访问数据库必须先获得数据库连接</strong>。该接口的常用方法如下。</p>
<h4 id="1-获取Statement对象的方法"><a href="#1-获取Statement对象的方法" class="headerlink" title="1.获取Statement对象的方法"></a>1.获取Statement对象的方法</h4><table>
<thead>
<tr>
<th align="left">方法</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>Statement createStatement() throws SQLExcetpion</code></td>
<td align="left">该方法返回一个<code>Statement</code>对象。</td>
</tr>
<tr>
<td align="left"><code>PreparedStatement prepareStatement(String sql) throws SQLExcetpion</code></td>
<td align="left">该方法返回预编译的<code>Statement</code>对象,即将<code>SQL</code>语句提交到数据库进行预编译。</td>
</tr>
<tr>
<td align="left"><code>CallableStatement prepareCall(String sql) throws SQLExcetpion</code></td>
<td align="left">该方法返回<code>CallableStatement</code>对象,该对象用于调用存储过程。</td>
</tr>
</tbody></table>
<p>上面三个方法都返回用于执行<code>SQL</code>语句的<code>Statement</code>对象, <code>PreparedStatement</code>、 <code>CallableStatement</code>是<code>Statement</code>的子类,只有获得了<code>Statement</code>之后才可执行<code>SQL</code>语句。</p>
<p>除此之外, <code>Connection</code>还有如下几个用于控制事务的方法。</p>
<h4 id="2-控制事务的方法"><a href="#2-控制事务的方法" class="headerlink" title="2.控制事务的方法"></a>2.控制事务的方法</h4><table>
<thead>
<tr>
<th align="left">方法</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>Savepoint setSavepoint()</code></td>
<td align="left">创建一个保存点。</td>
</tr>
<tr>
<td align="left"><code>Savepoint setSavepoint(String name)</code></td>
<td align="left">以指定名字来创建一个保存点</td>
</tr>
<tr>
<td align="left"><code>void setTransactionIsolation(int level)</code></td>
<td align="left">设置事务的隔离级别。</td>
</tr>
<tr>
<td align="left"><code>void rollback()</code></td>
<td align="left">回滚事务。</td>
</tr>
<tr>
<td align="left"><code>void rollback(Savepoint savepoint)</code></td>
<td align="left">将事务回滚到指定的保存点。</td>
</tr>
<tr>
<td align="left"><code>void setAutoCommit(boolean autoCommit)</code></td>
<td align="left">关闭自动提交,打开事务。</td>
</tr>
<tr>
<td align="left"><code>void commit()</code></td>
<td align="left">提交事务。</td>
</tr>
</tbody></table>
<h4 id="3-Java-7中Connection新增方法"><a href="#3-Java-7中Connection新增方法" class="headerlink" title="3.Java 7中Connection新增方法"></a>3.Java 7中Connection新增方法</h4><p><code>Java 7</code>为<code>Connection</code>新增了<code>setSchema(String schema)</code>、 <code>getSchema()</code>两个方法,这两个方法用于控制该<code>Connection</code>访问的数据库<code>Schema</code><br><code>Java 7</code>还为<code>Connection</code>新增了<code>setNetworkTimeou(Executor executor,int milliseconds)</code>、 <code>getNetworkTimeout()</code>两个方法来控制数据库连接的超时行为。</p>
<h3 id="Statement"><a href="#Statement" class="headerlink" title="Statement"></a>Statement</h3><p><code>Statement</code>:<strong>用于执行<code>SQL</code>语句的工具接口</strong>。该对象既可用于执行<code>DDL</code>、<code>DCL</code>语句,也可用于执行<code>DML</code>语句,还可用于执行<code>SQL</code>查询。当执行<code>SQL</code>査询时,返回查询到的结果集。它的常用方法如下。</p>
<table>
<thead>
<tr>
<th align="left">方法</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>ResultSet executeQuery(String sql) throws SQLException</code></td>
<td align="left">该方法用于执行查询语句,并返回查询结果对应的 <code>ResultSet</code>对象。该方法只能用于执行查询语句.</td>
</tr>
<tr>
<td align="left"><code>int executeUpdate(String sql) ) throws SQLExcetion</code></td>
<td align="left">该方法用于执行<code>DML</code>语句,并返回受影响的行数;该方法也可用于执行<code>DDL</code>语句,执行<code>DDL</code>语句将返回0。</td>
</tr>
<tr>
<td align="left"><code>boolean execute(String sql) ) throws SQLException</code></td>
<td align="left">该方法可执行任何<code>SQL</code>语句。如果执行后第一个结果为 <code>ResultSet</code>对象,则返回<code>true</code>;如果执行后第一个结果为受影响的行数或没有任何结果,则返回 <code>false</code></td>
</tr>
</tbody></table>
<h4 id="Java-7新增方法"><a href="#Java-7新增方法" class="headerlink" title="Java 7新增方法"></a>Java 7新增方法</h4><p><code>Java 7</code>为<code>Statement</code>新增了<code>closeOnCompletion()</code>方法,如果<code>Statement</code>执行了该方法,则当所有依赖于该<code>Statement</code>的<code>ResultSet</code>关闭时,该<code>Statement</code>会自动关闭。<br><code>Java7</code>还为<code>Statement</code>提供了一个<code>isCloseOnCompletion()</code>方法,该方法用于判断该<code>Statement</code>是否打开了” <code>closeOn Completion</code>“功能。</p>
<h4 id="Java-8新增方法"><a href="#Java-8新增方法" class="headerlink" title="Java 8新增方法"></a>Java 8新增方法</h4><p><code>Java 8</code>为<code>Statement</code>新增了多个重载的<code>executeLargeUpdate()</code>方法,这些方法相当于增强版的<code>executeUpdate()</code>方法,返回值类型为<code>long</code>——也就是说,当<code>DML</code>语句影响的记录条数超过<code>Integer.MAX_VALUE</code>时,就应该使用<code>executeLargeUpdate()</code>方法.</p>
<h3 id="PreparedStatement"><a href="#PreparedStatement" class="headerlink" title="PreparedStatement"></a>PreparedStatement</h3><p><code>PreparedStatement</code>:预编译的<code>Statement</code>对象。 <code>PreparedStatement</code>是<code>Statement</code>的子接口,它允许数据库预编译<code>SQL</code>语句(这些<code>SQL</code>语句通常带有参数),<strong>以后每次只改变<code>SQL</code>命令的参数,避免数据库每次都需要编译<code>SQL</code>语句,因此性能更好</strong>。相对于<code>Statement</code>而言,使用<code>PreparedStatement</code>执行<code>SQL</code>语句时,无须再传入<code>SQL</code>语句,只要为预编译的<code>SQL</code>语句传入参数值即可。所以它比<code>Statement</code>多了如下方法:</p>
<ul>
<li><code>void setXxx(int parameterIndex,Xxx value)</code>:该方法根据传入参数值的类型不同,需要使用不同的方法。传入的值根据索引传给<code>SQL</code>语句中指定位置的参数。</li>
</ul>
<p><strong>注意</strong><br><code>PreparedStatement</code>同样有<code>executeUpdate()</code>、 <code>executeQuery()</code>和<code>execute()</code>三个方法,只是这三个方法无须接收<code>SQL</code>字符串,因为<code>PreparedStatement</code>对象已经预编译了<code>SQL</code>命令,只要为这些命令传入参数即可。</p>
<p><code>Java 8</code>还为<code>PreparedStatement</code>增加了不带参数的<code>executeLargeUpdate()</code>方法—执行<code>DML</code>语句影响的记录条数可能超过<code>Integer.MAX_VALUE</code>时,就应该使用<code>executeLargeUpdate()</code>方法。</p>
<h3 id="ResultSet"><a href="#ResultSet" class="headerlink" title="ResultSet"></a>ResultSet</h3><p><code>ResultSet</code>:结果集对象。该对象包含访问查询结果的方法, <code>ResultSet</code>可以通过列索引或列名获得列数据。它包含了如下常用方法来移动记录指针。</p>
<table>
<thead>
<tr>
<th align="left">方法</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>void close()</code></td>
<td align="left">释放<code>ResultSet</code>对象。</td>
</tr>
<tr>
<td align="left"><code>boolean absolute(int row)</code></td>
<td align="left">将结果集的记录指针移动到第<code>row</code>行,如果<code>row</code>是负数,则移动到倒数第<code>row</code>行。如果移动后的记录指针指向一条有效记录,则该方法返回<code>true</code></td>
</tr>
<tr>
<td align="left"><code>void beforeFirst()</code></td>
<td align="left">将<code>ResultSet</code>的记录指针定位到首行之前,这是<code>ResultSet</code>结果集记录指针的初始状态(记录指针的起始位置位于第一行之前)</td>
</tr>
<tr>
<td align="left"><code>boolean previous()</code></td>
<td align="left">将<code>ResultSet</code>的记录指针定位到上一行。如果移动后的记录指针指向一条有效记录,则该方法返回<code>true</code></td>
</tr>
<tr>
<td align="left"><code>boolean next()</code></td>
<td align="left">将<code>ResultSet</code>的记录指针定位到下一行,如果移动后的记录指针指向一条有效记录,则该方法返回<code>true</code></td>
</tr>
<tr>
<td align="left"><code>boolean last()</code></td>
<td align="left">将<code>ResultSet</code>的记录指针定位到最后一行,如果移动后的记录指针指向一条有效记录,则该方法返回<code>true</code></td>
</tr>
<tr>
<td align="left"><code>void afterLast()</code></td>
<td align="left">将<code>ResultSet</code>的记录指针定位到最后一行之后</td>
</tr>
</tbody></table>
<h4 id="支持的Java版本"><a href="#支持的Java版本" class="headerlink" title="支持的Java版本"></a>支持的Java版本</h4><p>在<code>JDK1.4</code>以前,采用默认方法创建的<code>Statement</code>所查询得到的<code>ResultSet</code>不支持<code>absolute()</code>、 <code>previous()</code>等移动记录指针的方法,它只支持<code>next()</code>这个移动记录指针的方法,即<code>ResultSet</code>的记录指针只能向下移动,而且每次只能移动一格。<br>从<code>Java5.0</code>以后就避免了这个问题,程序采用默认方法创建的<code>Statement</code>所查询得到的<code>ResultSet</code>也支持<code>absolute</code>、<code>previous</code>等方法</p>
<p>当把记录指针移动到指定行之后, <code>ResultSet</code>可通过<code>getXxx(int columnIndex)</code>或<code>getXx(Stringcolumn Label)</code>方法来获取当前行、指定列的值,前者根据列索引获取值,后者根据列名获取值。</p>
<p><code>Java 7</code>新增了<code>&lt;T&gt; T getObject(int columnIndex, Class&lt;T&gt; type)</code>和<br><code>&lt;T&gt; T getObject(String columnLabel,Class&lt;T&gt;type)</code>两个泛型方法,它们可以获取任意类型的值</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://lanlan2017.github.io/JavaReadingNotes/eb1322da/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/JavaReadingNotes/images/avatar.gif">
      <meta itemprop="name" content="蓝蓝">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="蓝蓝站点">
      <meta itemprop="description" content="好好学习，天天向上">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 蓝蓝站点">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/JavaReadingNotes/eb1322da/" class="post-title-link" itemprop="url">13.2.14 集合运算</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-07-02 23:28:48" itemprop="dateCreated datePublished" datetime="2019-07-02T23:28:48+08:00">2019-07-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2020-02-07 01:34:56" itemprop="dateModified" datetime="2020-02-07T01:34:56+08:00">2020-02-07</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/1-%E7%96%AF%E7%8B%82Java%E8%AE%B2%E4%B9%89-%E7%AC%AC4%E7%89%88/" itemprop="url" rel="index"><span itemprop="name">1 疯狂Java讲义 (第4版)</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/1-%E7%96%AF%E7%8B%82Java%E8%AE%B2%E4%B9%89-%E7%AC%AC4%E7%89%88/%E7%AC%AC13%E7%AB%A0-MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%8EJDBC%E7%BC%96%E7%A8%8B/" itemprop="url" rel="index"><span itemprop="name">第13章 MySQL数据库与JDBC编程</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/1-%E7%96%AF%E7%8B%82Java%E8%AE%B2%E4%B9%89-%E7%AC%AC4%E7%89%88/%E7%AC%AC13%E7%AB%A0-MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%8EJDBC%E7%BC%96%E7%A8%8B/13-2-SQL%E8%AF%AD%E6%B3%95/" itemprop="url" rel="index"><span itemprop="name">13.2 SQL语法</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
    <span class="post-meta-item-icon">
      <i class="far fa-comment"></i>
    </span>
    <span class="post-meta-item-text">Waline：</span>
  
    <a title="waline" href="/JavaReadingNotes/eb1322da/#waline-comments" itemprop="discussionUrl">
      <span class="post-comments-count waline-comment-count" id="/JavaReadingNotes/eb1322da/" data-xid="/JavaReadingNotes/eb1322da/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>2.8k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>3 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="13-2-14-集合运算"><a href="#13-2-14-集合运算" class="headerlink" title="13.2.14 集合运算"></a>13.2.14 集合运算</h1><p><code>select</code>语句查询的结果是一个包含多条数据的结果集,类似于数学里的集合,可以进行交( <code>Intersect</code>)、并( <code>union</code>)和差( <code>minus</code>)运算, <code>select</code>查询得到的结果集也可能需要进行这三种运算.<br>为了对两个结果集进行集合运算,这两个结果集必须满足如下条件。</p>
<ul>
<li>两个结果集所包含的数据列的数量必须相等。</li>
<li>两个结果集所包含的数据列的数据类型也必须一一对应。</li>
</ul>
<h2 id="1-union运算"><a href="#1-union运算" class="headerlink" title="1. union运算"></a>1. union运算</h2><p><code>unIon</code>运算的语法格式如下:<br><code>select语句 union select语句</code><br>下面的<code>SQL</code>语句查询出所有教师的信息和主键小于4的学生信息。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> teacher_table</span><br><span class="line"><span class="keyword">union</span></span><br><span class="line"><span class="keyword">select</span> student_id,student_name <span class="keyword">from</span> student_table;</span><br></pre></td></tr></table></figure>
<p>运行效果:</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from teacher_table</span><br><span class="line">union</span><br><span class="line">select student_id,student_name from student_table;</span><br><span class="line">+------------+--------------+</span><br><span class="line">| teacher_id | teacher_name |</span><br><span class="line">+------------+--------------+</span><br><span class="line">|          <span class="number">1</span> | Yeeku        |</span><br><span class="line">|          <span class="number">2</span> | Leegang      |</span><br><span class="line">|          <span class="number">3</span> | Martine      |</span><br><span class="line">|          <span class="number">1</span> | 张三         |</span><br><span class="line">|          <span class="number">2</span> | 张三         |</span><br><span class="line">|          <span class="number">3</span> | 李四         |</span><br><span class="line">|          <span class="number">4</span> | 王五         |</span><br><span class="line">|          <span class="number">5</span> | _王五        |</span><br><span class="line">|          <span class="number">6</span> | NULL         |</span><br><span class="line">|          <span class="number">7</span> | 赵六         |</span><br><span class="line">+------------+--------------+</span><br><span class="line"><span class="number">10</span> rows <span class="keyword">in</span> <span class="built_in">set</span></span><br></pre></td></tr></table></figure>
<h2 id="2-minus运算"><a href="#2-minus运算" class="headerlink" title="2. minus运算"></a>2. minus运算</h2><p><code>minus</code>运算的语法格式如下:<br><code>select语句 minus select语句</code><br>上面的语法格式十分简单,不过很遗憾,<strong><code>MySQL</code>并不支持使用<code>minus</code>运算符</strong>,因此只能借助于子查询来实现上面的<code>minus</code>运算。<br>假如想从所有学生记录中”减去”与老师记录的<code>ID</code>相同、姓名相同的记录,则可进行如下的<code>minus</code>运算:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> student_id,student_name <span class="keyword">from</span> student_table</span><br><span class="line">minus</span><br><span class="line"><span class="keyword">select</span> teacher_id,teacher_name <span class="keyword">from</span> teacher_table;</span><br></pre></td></tr></table></figure>
<p>不过, <code>MySQL</code>并不支持这种运算。但可以通过如下子查询来实现上面运算</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> student_id,student_name <span class="keyword">from</span> student_table</span><br><span class="line"><span class="keyword">where</span> (student_id,student_name)</span><br><span class="line"><span class="keyword">not</span> <span class="keyword">in</span></span><br><span class="line">(</span><br><span class="line">    <span class="keyword">select</span> teacher_id,teacher_name <span class="keyword">from</span> teacher_table</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p>运行效果:</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from student_table;</span><br><span class="line">+------------+--------------+--------------+</span><br><span class="line">| student_id | student_name | java_teacher |</span><br><span class="line">+------------+--------------+--------------+</span><br><span class="line">|          <span class="number">1</span> | 张三         |            <span class="number">1</span> |</span><br><span class="line">|          <span class="number">2</span> | 张三         |            <span class="number">1</span> |</span><br><span class="line">|          <span class="number">3</span> | 李四         |            <span class="number">1</span> |</span><br><span class="line">|          <span class="number">4</span> | 王五         |            <span class="number">2</span> |</span><br><span class="line">|          <span class="number">5</span> | _王五        |            <span class="number">2</span> |</span><br><span class="line">|          <span class="number">6</span> | NULL         |            <span class="number">2</span> |</span><br><span class="line">|          <span class="number">7</span> | 赵六         |            <span class="number">3</span> |</span><br><span class="line">+------------+--------------+--------------+</span><br><span class="line"><span class="number">7</span> rows <span class="keyword">in</span> <span class="built_in">set</span></span><br><span class="line"></span><br><span class="line">mysql&gt; select * from teacher_table;</span><br><span class="line">+------------+--------------+</span><br><span class="line">| teacher_id | teacher_name |</span><br><span class="line">+------------+--------------+</span><br><span class="line">|          <span class="number">1</span> | Yeeku        |</span><br><span class="line">|          <span class="number">2</span> | Leegang      |</span><br><span class="line">|          <span class="number">3</span> | Martine      |</span><br><span class="line">+------------+--------------+</span><br><span class="line"><span class="number">3</span> rows <span class="keyword">in</span> <span class="built_in">set</span></span><br><span class="line"></span><br><span class="line">mysql&gt; select student_id,student_name from student_table</span><br><span class="line">where (student_id,student_name)</span><br><span class="line"><span class="keyword">not</span> <span class="keyword">in</span></span><br><span class="line">(</span><br><span class="line">    select teacher_id,teacher_name from teacher_table</span><br><span class="line">);</span><br><span class="line">+------------+--------------+</span><br><span class="line">| student_id | student_name |</span><br><span class="line">+------------+--------------+</span><br><span class="line">|          <span class="number">1</span> | 张三         |</span><br><span class="line">|          <span class="number">2</span> | 张三         |</span><br><span class="line">|          <span class="number">3</span> | 李四         |</span><br><span class="line">|          <span class="number">4</span> | 王五         |</span><br><span class="line">|          <span class="number">5</span> | _王五        |</span><br><span class="line">|          <span class="number">6</span> | NULL         |</span><br><span class="line">|          <span class="number">7</span> | 赵六         |</span><br><span class="line">+------------+--------------+</span><br><span class="line"><span class="number">7</span> rows <span class="keyword">in</span> <span class="built_in">set</span></span><br><span class="line"></span><br><span class="line">mysql&gt; </span><br></pre></td></tr></table></figure>
<h2 id="3-intersect运算"><a href="#3-intersect运算" class="headerlink" title="3. intersect运算"></a>3. intersect运算</h2><p><code>intersect</code>运算的语法格式如下:<br><code>select语句 intersect select语句</code><br>上面的语法格式十分简单,不过很遗憾, <code>MySQL</code>并不支持使用<code>intersect</code>运算符,因此只能借助于多表连接查询来实现上面的<code>intersect</code>运算。<br>假如想找出学生记录中与老师记录中的ID相同、姓名相同的记录,则可进行如下的<code>intersect</code>运算:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> student_id,student_name <span class="keyword">from</span> student_table</span><br><span class="line"><span class="keyword">intersect</span></span><br><span class="line"><span class="keyword">select</span> teacher_id,teacher_name <span class="keyword">from</span> teacher_table;</span><br></pre></td></tr></table></figure>
<p>不过, <code>MySQL</code>并不支持这种运算。但可以通过如下多表连接查询来实现上面运算。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> student_id,student_name <span class="keyword">from</span> student_table</span><br><span class="line"><span class="keyword">join</span> teacher_table</span><br><span class="line"><span class="keyword">on</span> (student_id<span class="operator">=</span>teacher_id <span class="keyword">and</span> student_name<span class="operator">=</span>teacher_name);</span><br></pre></td></tr></table></figure>
<p>需要指出的是,如果进行<code>intersect</code>运算的两个<code>select</code>子句中都包括了<code>where</code>条件,那么将<code>intersect</code>运算改写成多表连接査询后还需要将两个<code>where</code>条件进行<code>and</code>运算。假如有如下<code>Intersect</code>运算的<code>SQL</code>语句:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> student_id,student_name <span class="keyword">from</span> student_table <span class="keyword">where</span> student_id<span class="operator">&lt;</span><span class="number">4</span></span><br><span class="line"><span class="keyword">intersect</span></span><br><span class="line"><span class="keyword">select</span> teacher_id,teacher_name <span class="keyword">from</span> teacher_table <span class="keyword">where</span> teacher_name <span class="keyword">like</span> <span class="string">&#x27;李%&#x27;</span>;</span><br></pre></td></tr></table></figure>
<p>上面语句改写如下:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> student_id,student_name <span class="keyword">from</span> student_table</span><br><span class="line"><span class="keyword">join</span></span><br><span class="line">teacher_table</span><br><span class="line"><span class="keyword">on</span>(student_id<span class="operator">=</span>teacher_id <span class="keyword">and</span> student_name<span class="operator">=</span>teacher_name)</span><br><span class="line"><span class="keyword">where</span> student_id<span class="operator">&lt;</span><span class="number">4</span> <span class="keyword">and</span> teacher_name <span class="keyword">like</span> <span class="string">&#x27;李%&#x27;</span>;</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://lanlan2017.github.io/JavaReadingNotes/49cdd72f/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/JavaReadingNotes/images/avatar.gif">
      <meta itemprop="name" content="蓝蓝">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="蓝蓝站点">
      <meta itemprop="description" content="好好学习，天天向上">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 蓝蓝站点">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/JavaReadingNotes/49cdd72f/" class="post-title-link" itemprop="url">13.2.13 子查询</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-07-02 22:21:22" itemprop="dateCreated datePublished" datetime="2019-07-02T22:21:22+08:00">2019-07-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2020-02-07 01:34:56" itemprop="dateModified" datetime="2020-02-07T01:34:56+08:00">2020-02-07</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/1-%E7%96%AF%E7%8B%82Java%E8%AE%B2%E4%B9%89-%E7%AC%AC4%E7%89%88/" itemprop="url" rel="index"><span itemprop="name">1 疯狂Java讲义 (第4版)</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/1-%E7%96%AF%E7%8B%82Java%E8%AE%B2%E4%B9%89-%E7%AC%AC4%E7%89%88/%E7%AC%AC13%E7%AB%A0-MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%8EJDBC%E7%BC%96%E7%A8%8B/" itemprop="url" rel="index"><span itemprop="name">第13章 MySQL数据库与JDBC编程</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/1-%E7%96%AF%E7%8B%82Java%E8%AE%B2%E4%B9%89-%E7%AC%AC4%E7%89%88/%E7%AC%AC13%E7%AB%A0-MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%8EJDBC%E7%BC%96%E7%A8%8B/13-2-SQL%E8%AF%AD%E6%B3%95/" itemprop="url" rel="index"><span itemprop="name">13.2 SQL语法</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
    <span class="post-meta-item-icon">
      <i class="far fa-comment"></i>
    </span>
    <span class="post-meta-item-text">Waline：</span>
  
    <a title="waline" href="/JavaReadingNotes/49cdd72f/#waline-comments" itemprop="discussionUrl">
      <span class="post-comments-count waline-comment-count" id="/JavaReadingNotes/49cdd72f/" data-xid="/JavaReadingNotes/49cdd72f/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>6.6k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>6 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="13-2-13-子查询"><a href="#13-2-13-子查询" class="headerlink" title="13.2.13 子查询"></a>13.2.13 子查询</h1><p>下面是本文用到的测试数据:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">Navicat MySQL Data Transfer</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">Source Server         : localhost_3306</span></span><br><span class="line"><span class="comment">Source Server Version : 50508</span></span><br><span class="line"><span class="comment">Source Host           : localhost:3306</span></span><br><span class="line"><span class="comment">Source Database       : select_test</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">Target Server Type    : MYSQL</span></span><br><span class="line"><span class="comment">Target Server Version : 50508</span></span><br><span class="line"><span class="comment">File Encoding         : 65001</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">Date: 2019-07-02 22:42:04</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SET</span> FOREIGN_KEY_CHECKS<span class="operator">=</span><span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> `emp_table`;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `emp_table` (</span><br><span class="line">  `emp_id` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  `emp_name` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `manager_id` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`emp_id`),</span><br><span class="line">  KEY `manager_id` (`manager_id`),</span><br><span class="line">  <span class="keyword">CONSTRAINT</span> `emp_table_ibfk_1` <span class="keyword">FOREIGN</span> KEY (`manager_id`) <span class="keyword">REFERENCES</span> `emp_table` (`emp_id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB AUTO_INCREMENT<span class="operator">=</span><span class="number">5</span> <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8;</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `emp_table` <span class="keyword">VALUES</span> (<span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;唐僧&#x27;</span>, <span class="keyword">null</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `emp_table` <span class="keyword">VALUES</span> (<span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;孙悟空&#x27;</span>, <span class="string">&#x27;1&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `emp_table` <span class="keyword">VALUES</span> (<span class="string">&#x27;3&#x27;</span>, <span class="string">&#x27;猪八戒&#x27;</span>, <span class="string">&#x27;1&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `emp_table` <span class="keyword">VALUES</span> (<span class="string">&#x27;4&#x27;</span>, <span class="string">&#x27;沙僧&#x27;</span>, <span class="string">&#x27;1&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> `student_table`;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `student_table` (</span><br><span class="line">  `student_id` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  `student_name` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `java_teacher` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`student_id`),</span><br><span class="line">  KEY `java_teacher` (`java_teacher`),</span><br><span class="line">  <span class="keyword">CONSTRAINT</span> `student_table_ibfk_1` <span class="keyword">FOREIGN</span> KEY (`java_teacher`) <span class="keyword">REFERENCES</span> `teacher_table` (`teacher_id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB AUTO_INCREMENT<span class="operator">=</span><span class="number">8</span> <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8;</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `student_table` <span class="keyword">VALUES</span> (<span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;张三&#x27;</span>, <span class="string">&#x27;1&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `student_table` <span class="keyword">VALUES</span> (<span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;张三&#x27;</span>, <span class="string">&#x27;1&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `student_table` <span class="keyword">VALUES</span> (<span class="string">&#x27;3&#x27;</span>, <span class="string">&#x27;李四&#x27;</span>, <span class="string">&#x27;1&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `student_table` <span class="keyword">VALUES</span> (<span class="string">&#x27;4&#x27;</span>, <span class="string">&#x27;王五&#x27;</span>, <span class="string">&#x27;2&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `student_table` <span class="keyword">VALUES</span> (<span class="string">&#x27;5&#x27;</span>, <span class="string">&#x27;_王五&#x27;</span>, <span class="string">&#x27;2&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `student_table` <span class="keyword">VALUES</span> (<span class="string">&#x27;6&#x27;</span>, <span class="keyword">null</span>, <span class="string">&#x27;2&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `student_table` <span class="keyword">VALUES</span> (<span class="string">&#x27;7&#x27;</span>, <span class="string">&#x27;赵六&#x27;</span>, <span class="string">&#x27;3&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> `teacher_table`;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `teacher_table` (</span><br><span class="line">  `teacher_id` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  `teacher_name` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`teacher_id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB AUTO_INCREMENT<span class="operator">=</span><span class="number">4</span> <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8;</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `teacher_table` <span class="keyword">VALUES</span> (<span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;Yeeku&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `teacher_table` <span class="keyword">VALUES</span> (<span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;Leegang&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `teacher_table` <span class="keyword">VALUES</span> (<span class="string">&#x27;3&#x27;</span>, <span class="string">&#x27;Martine&#x27;</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>子查询就是指在査询语句中嵌套另一个査询</strong>,子査询可以支持多层嵌套。对于一个普通的查询语句而言,子查询可以出现在两个位置:</p>
<ul>
<li>出现在<code>from</code>语句后,此时子查询的结果可以看成一个数据表,这种用法也被称为行内视图,因为该子查询的实质就是一个临时视图。</li>
<li>出现在<code>where</code>条件后作为过滤条件的值。<br>使用子查询时要注意如下几点。</li>
<li>子查询要用括号括起来。</li>
<li>把子查询当成数据表时(出现在<code>from</code>之后),可以为该子查询起别名,尤其是作为前缀来限定数据列时,必须给子查询起别名。</li>
</ul>
<p>对于把子查询当做数据表来用,只是把之前的表名变成子查询(也可为子查询起别名),其他部分与普通查询没有任何区别。下面的<code>SQL</code>语句示范了把子查询当成数据表的用法。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> </span><br><span class="line"><span class="keyword">from</span> (<span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> student_table) t</span><br><span class="line"><span class="keyword">where</span> t.java_teacher<span class="operator">&gt;</span><span class="number">1</span>;</span><br></pre></td></tr></table></figure>
<p>运行效果:</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * </span><br><span class="line">from (select * from student_table) t</span><br><span class="line">where t.java_teacher&gt;<span class="number">1</span>;</span><br><span class="line">+------------+--------------+--------------+</span><br><span class="line">| student_id | student_name | java_teacher |</span><br><span class="line">+------------+--------------+--------------+</span><br><span class="line">|          <span class="number">4</span> | 王五         |            <span class="number">2</span> |</span><br><span class="line">|          <span class="number">5</span> | _王五        |            <span class="number">2</span> |</span><br><span class="line">|          <span class="number">6</span> | NULL         |            <span class="number">2</span> |</span><br><span class="line">|          <span class="number">7</span> | 赵六         |            <span class="number">3</span> |</span><br><span class="line">+------------+--------------+--------------+</span><br><span class="line"><span class="number">4</span> rows <span class="keyword">in</span> <span class="built_in">set</span></span><br></pre></td></tr></table></figure>

<p>把子查询当成数据表的用法更准确地说是当成视图,可以把上面的<code>SQL</code>语句理解成在执行查询时创建了一个临时视图,该视图名为<code>t</code>,所以这种临时创建的视图也被称为<code>行内视图</code>。<br>还有一种情形:把子查询当成<code>where</code>条件中的值,如果子查询返回单行、单列值,则被当成一个标量值使用,也就可以使用单行记录比较运算符。例如如下<code>SQL</code>语句:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> student_table</span><br><span class="line"><span class="keyword">where</span> java_teacher <span class="operator">&gt;</span> </span><br><span class="line">(</span><br><span class="line">    <span class="keyword">select</span> teacher_id <span class="keyword">from</span> teacher_table</span><br><span class="line">    <span class="keyword">where</span> teacher_name <span class="operator">=</span> <span class="string">&#x27;Yeeku&#x27;</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p>运行结果:</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from student_table;</span><br><span class="line">+------------+--------------+--------------+</span><br><span class="line">| student_id | student_name | java_teacher |</span><br><span class="line">+------------+--------------+--------------+</span><br><span class="line">|          <span class="number">1</span> | 张三         |            <span class="number">1</span> |</span><br><span class="line">|          <span class="number">2</span> | 张三         |            <span class="number">1</span> |</span><br><span class="line">|          <span class="number">3</span> | 李四         |            <span class="number">1</span> |</span><br><span class="line">|          <span class="number">4</span> | 王五         |            <span class="number">2</span> |</span><br><span class="line">|          <span class="number">5</span> | _王五        |            <span class="number">2</span> |</span><br><span class="line">|          <span class="number">6</span> | NULL         |            <span class="number">2</span> |</span><br><span class="line">|          <span class="number">7</span> | 赵六         |            <span class="number">3</span> |</span><br><span class="line">+------------+--------------+--------------+</span><br><span class="line"><span class="number">7</span> rows <span class="keyword">in</span> <span class="built_in">set</span></span><br><span class="line"></span><br><span class="line">mysql&gt; select * from teacher_table;</span><br><span class="line">+------------+--------------+</span><br><span class="line">| teacher_id | teacher_name |</span><br><span class="line">+------------+--------------+</span><br><span class="line">|          <span class="number">1</span> | Yeeku        |</span><br><span class="line">|          <span class="number">2</span> | Leegang      |</span><br><span class="line">|          <span class="number">3</span> | Martine      |</span><br><span class="line">+------------+--------------+</span><br><span class="line"><span class="number">3</span> rows <span class="keyword">in</span> <span class="built_in">set</span></span><br><span class="line"></span><br><span class="line">mysql&gt; select * from student_table</span><br><span class="line">where java_teacher &gt; </span><br><span class="line">(</span><br><span class="line">    select teacher_id from teacher_table</span><br><span class="line">    where teacher_name = &#x27;Yeeku&#x27;</span><br><span class="line">);</span><br><span class="line">+------------+--------------+--------------+</span><br><span class="line">| student_id | student_name | java_teacher |</span><br><span class="line">+------------+--------------+--------------+</span><br><span class="line">|          <span class="number">4</span> | 王五         |            <span class="number">2</span> |</span><br><span class="line">|          <span class="number">5</span> | _王五        |            <span class="number">2</span> |</span><br><span class="line">|          <span class="number">6</span> | NULL         |            <span class="number">2</span> |</span><br><span class="line">|          <span class="number">7</span> | 赵六         |            <span class="number">3</span> |</span><br><span class="line">+------------+--------------+--------------+</span><br><span class="line"><span class="number">4</span> rows <span class="keyword">in</span> <span class="built_in">set</span></span><br><span class="line"></span><br><span class="line">mysql&gt; </span><br></pre></td></tr></table></figure>
<p>上面查询语句中的子査询将返回一个<code>单行</code>、<code>单列</code>的值(该值就是<code>1</code>),如果把上面查询语句的括号部分换成<code>1</code>,那么这条语句就再简单不过了,相同功能的查询结果如下所示:</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from student_table</span><br><span class="line">where java_teacher &gt; <span class="number">1</span>;</span><br><span class="line">+------------+--------------+--------------+</span><br><span class="line">| student_id | student_name | java_teacher |</span><br><span class="line">+------------+--------------+--------------+</span><br><span class="line">|          <span class="number">4</span> | 王五         |            <span class="number">2</span> |</span><br><span class="line">|          <span class="number">5</span> | _王五        |            <span class="number">2</span> |</span><br><span class="line">|          <span class="number">6</span> | NULL         |            <span class="number">2</span> |</span><br><span class="line">|          <span class="number">7</span> | 赵六         |            <span class="number">3</span> |</span><br><span class="line">+------------+--------------+--------------+</span><br><span class="line"><span class="number">4</span> rows <span class="keyword">in</span> <span class="built_in">set</span></span><br><span class="line"></span><br><span class="line">mysql&gt; </span><br></pre></td></tr></table></figure>
<p>放在<code>Where</code>子句的子查询会把单行,单列的返回值当成标量处理.</p>
<p>如果子査询返回多个值,则需要使用<code>in</code>、<code>any</code>和<code>all</code>等关键字,<code>in</code>可以单独使用,与前面介绍比较运算符时所讲的<code>in</code>完全一样,此时可以把子查询返回的多个值当成一个值列表。如下<code>SQL</code>语句所示:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">from</span> student_table</span><br><span class="line"><span class="keyword">where</span> student_id <span class="keyword">in</span></span><br><span class="line">(</span><br><span class="line">    <span class="keyword">select</span> teacher_id <span class="keyword">from</span> teacher_table</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p>运行效果:</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from student_table;</span><br><span class="line">+------------+--------------+--------------+</span><br><span class="line">| student_id | student_name | java_teacher |</span><br><span class="line">+------------+--------------+--------------+</span><br><span class="line">|          <span class="number">1</span> | 张三         |            <span class="number">1</span> |</span><br><span class="line">|          <span class="number">2</span> | 张三         |            <span class="number">1</span> |</span><br><span class="line">|          <span class="number">3</span> | 李四         |            <span class="number">1</span> |</span><br><span class="line">|          <span class="number">4</span> | 王五         |            <span class="number">2</span> |</span><br><span class="line">|          <span class="number">5</span> | _王五        |            <span class="number">2</span> |</span><br><span class="line">|          <span class="number">6</span> | NULL         |            <span class="number">2</span> |</span><br><span class="line">|          <span class="number">7</span> | 赵六         |            <span class="number">3</span> |</span><br><span class="line">+------------+--------------+--------------+</span><br><span class="line"><span class="number">7</span> rows <span class="keyword">in</span> <span class="built_in">set</span></span><br><span class="line">mysql&gt; select * from teacher_table;</span><br><span class="line">+------------+--------------+</span><br><span class="line">| teacher_id | teacher_name |</span><br><span class="line">+------------+--------------+</span><br><span class="line">|          <span class="number">1</span> | Yeeku        |</span><br><span class="line">|          <span class="number">2</span> | Leegang      |</span><br><span class="line">|          <span class="number">3</span> | Martine      |</span><br><span class="line">+------------+--------------+</span><br><span class="line"><span class="number">3</span> rows <span class="keyword">in</span> <span class="built_in">set</span></span><br><span class="line">mysql&gt; select *</span><br><span class="line">from student_table</span><br><span class="line">where student_id <span class="keyword">in</span></span><br><span class="line">(</span><br><span class="line">    select teacher_id from teacher_table</span><br><span class="line">);</span><br><span class="line">+------------+--------------+--------------+</span><br><span class="line">| student_id | student_name | java_teacher |</span><br><span class="line">+------------+--------------+--------------+</span><br><span class="line">|          <span class="number">1</span> | 张三         |            <span class="number">1</span> |</span><br><span class="line">|          <span class="number">2</span> | 张三         |            <span class="number">1</span> |</span><br><span class="line">|          <span class="number">3</span> | 李四         |            <span class="number">1</span> |</span><br><span class="line">+------------+--------------+--------------+</span><br><span class="line"><span class="number">3</span> rows <span class="keyword">in</span> <span class="built_in">set</span></span><br><span class="line">mysql&gt; </span><br></pre></td></tr></table></figure>
<p>上面查询语句中的子查询将返回多个值,这多个值将被当成一个值列表,只要<code>student_id</code>与该值列表中的任意一个值相等,就可以选出这条记录。<br><code>any</code>和<code>all</code>可以与<code>&gt;</code>、<code>≥</code>、<code>&lt;</code>、<code>&lt;</code>、<code>&lt;&gt;</code>、<code>=</code>等运算符结合使用,与<code>any</code>结合使用分别表示大于、大于等于、小于、<code>小于等于</code>、<code>不等于</code>、<code>等于</code><strong>其中任意一个值</strong>;<br>与叫<code>all</code>结合使用分别表示大于、大于等于、小于、小于等于、不等于、等于<strong>全部值</strong>。从上面介绍中可以看出,<code>=any</code>的作用与<code>in</code>的作用相同。如下<code>SQL</code>语句使用<code>=any</code>来代替上面的<code>in</code>:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> student_table</span><br><span class="line"><span class="keyword">where</span> student_id <span class="operator">=</span> <span class="keyword">any</span></span><br><span class="line">(</span><br><span class="line">    <span class="keyword">select</span> teacher_id <span class="keyword">from</span> teacher_table</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p>运行结果:</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from student_table</span><br><span class="line">where student_id = any</span><br><span class="line">(</span><br><span class="line">    select teacher_id from teacher_table</span><br><span class="line">);</span><br><span class="line">+------------+--------------+--------------+</span><br><span class="line">| student_id | student_name | java_teacher |</span><br><span class="line">+------------+--------------+--------------+</span><br><span class="line">|          <span class="number">1</span> | 张三         |            <span class="number">1</span> |</span><br><span class="line">|          <span class="number">2</span> | 张三         |            <span class="number">1</span> |</span><br><span class="line">|          <span class="number">3</span> | 李四         |            <span class="number">1</span> |</span><br><span class="line">+------------+--------------+--------------+</span><br><span class="line"><span class="number">3</span> rows <span class="keyword">in</span> <span class="built_in">set</span></span><br></pre></td></tr></table></figure>
<ul>
<li><code>&lt;ANY</code>只要小于值列表中的最大值即可,</li>
<li><code>&gt;ANY</code>只要大于值列表中的最小值即可。</li>
<li><code>&lt;all</code>要求小于值列表中的最小值,</li>
<li><code>&gt;all</code>要求大于值列表中的最大值<br>下面的<code>SQL</code>语句选出<code>student_table</code>表中<code>student_id</code>大于<code>teacher_table</code>表中所有<code>teacher_id</code>的记录。<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">from</span> student_table</span><br><span class="line"><span class="keyword">where</span> student_id <span class="operator">&gt;</span></span><br><span class="line"><span class="keyword">all</span> (</span><br><span class="line"> <span class="keyword">select</span> teacher_id <span class="keyword">from</span> teacher_table</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
还有一种子查询可以返回多行、多列,此时<code>where</code>子句中应该有对应的数据列,并使用圆括号将多个数据列组合起来。如下<code>SQL</code>语句所示:<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> student_table</span><br><span class="line"><span class="keyword">where</span> (student_id,student_name) <span class="operator">=</span> <span class="keyword">any</span></span><br><span class="line">(<span class="keyword">select</span> teacher_id,teacher_name <span class="keyword">from</span> teacher_table);</span><br></pre></td></tr></table></figure></li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/JavaReadingNotes/page/158/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/JavaReadingNotes/">1</a><span class="space">&hellip;</span><a class="page-number" href="/JavaReadingNotes/page/158/">158</a><span class="page-number current">159</span><a class="page-number" href="/JavaReadingNotes/page/160/">160</a><span class="space">&hellip;</span><a class="page-number" href="/JavaReadingNotes/page/188/">188</a><a class="extend next" rel="next" href="/JavaReadingNotes/page/160/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 2018 – 
  <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">蓝蓝</span>
  <!--博客朗读功能开始-->
  <script>
const java_generic_descriptor_regexp = new RegExp('\\<[a-zA-Z?& ,]+\\>');
const modifierRegExp = '([a-z]+)';
const returnValueRegExp = '([a-zA-Z0-9<>,&? \\[\\]]+)';
const methodNameRegExp = '([a-zA-Z0-9]+)';
const parameterRegExp = '([a-zA-Z0-9<>,&? ]+)';
const constructorRegExp = '([A-Z][a-zA-Z0-9_]+)';
const constructor_parameterless_regexp = new RegExp('^' + constructorRegExp + '\\(\\)$');
const constructor_parameterless_replace = '$1无参数构造方法';
const constructor_parameter_regexp = new RegExp('^' + constructorRegExp + '\\(' + parameterRegExp + '\\)$');
const constructor_parameter_replace = '$1构造方法，参数列表$2。';
const return_name_parameterless_regexp = new RegExp('^' + returnValueRegExp + ' ' + methodNameRegExp + '\\(\\)$');
const return_name_parameterless_replace = '$2方法，无参数，返回值$1。';
const modifier_return_name_parameterless_regexp = new RegExp('^' + modifierRegExp + ' ' + returnValueRegExp + ' ' + methodNameRegExp + '\\(\\)$');
const modifier_return_name_parameterless_replace = '$3方法，无参数，返回值$2，修饰符$1。';
const return_name_parameter_regexp = new RegExp('^' + returnValueRegExp + ' ' + methodNameRegExp + '\\(' + parameterRegExp + '\\)' + '$');
const return_name_parameter_replace = '$2方法，参数列表：$3，返回值：$1。';
const modifier_return_name_parameter_regexp = new RegExp('^' + modifierRegExp + ' ' + returnValueRegExp + ' ' + methodNameRegExp + '\\(' + parameterRegExp + '\\)' + '$');
const modifier_return_name_parameter_replace = '$3方法，参数列表：$4，返回值：$2，修饰符：$1。';
function fixTuoFengSplit(javaMethodCode, code) {
    var wrongCode = code.replace(/(?<=[A-Z])(?=[A-Z])/g, " ");
    if (javaMethodCode.search(wrongCode) > -1) {
        javaMethodCode = javaMethodCode.replaceAll(wrongCode, code);
    }
    return javaMethodCode;
}
function javaTuoFengLangDu(javaMethodCode) {
    javaMethodCode = javaMethodCode.replace(/(?<=[a-zA-Z])(?=[A-Z])/g, " ");
    var wrongSplit = ['UNIX', 'WEST', 'NORTH', 'SOUTH', 'EAST', 'RIGHT', 'CENTER', 'LEFT', 'CLASSPATH', 'PATH'];
    wrongSplit = wrongSplit.sort(function (a, b) {
        return b.length - a.length;
    })
    for (var i = 0, len = wrongSplit.length; i < len; i++) {
        javaMethodCode = fixTuoFengSplit(javaMethodCode, wrongSplit[i]);
    }
    return javaMethodCode;
}
function readPunctuation(text) {
    text = text.replaceAll("<", "");
    text = text.replaceAll(">", "");
    text = text.replaceAll(".", "点");
    text = text.replaceAll(":", "冒号");
    text = text.replaceAll("?", "问号");
    return text.replaceAll("**", "");
}
function readKeywords(text) {
    text = text.replaceAll("instanceof", "instance of");
    text = text.replaceAll("C#", "C sharp");
    text = text.replaceAll("javac", "java c");
    return text;
}
function remove_colon_Period_AtTheEndOfTheLine(text) {
    if (text.endsWith(".") || text.endsWith(":")) {
        text = text.substring(0, text.length - 1);
    }
    return text;
}
function readJavaStaticConstants(text) {
    const regexp = /(\.[A-Z_]+)/g;
    const matches = text.matchAll(regexp);
    for (const match of matches) {
        const goup1 = RegExp.$1;
        const goup1Lower = goup1.toLowerCase();
        text = text.replace(goup1, goup1Lower);
    }
    return text;
}
function removeReadingBtnTag(text) {
    text = text.replace(/\n朗读\n/g, '');
    text = text.replace(/^\d+$\n/mg, '');
    text = text.replace(/朗读$/mg, '');
    return text;
}
function preprocessingText(text) {
    text = remove_colon_Period_AtTheEndOfTheLine(text);
    text = readJavaStaticConstants(text);
    text = readPunctuation(text);
    text = readKeywords(text);
    text = javaTuoFengLangDu(text);
    text = removeReadingBtnTag(text);
    return text;
}
function methondReading(text) {
    while (java_generic_descriptor_regexp.test(text)) {
        text = text.replace(java_generic_descriptor_regexp, '');
    }
    console.log("     删除泛型后：" + text);
    text = text.replace('[]', '数组');
    text = text.replace(/\, ?/g, " 和 ");
    text = text.replace(/([a-zA-Z<>]+) ([a-zA-Z]+)/g, "$1类型的参数$2")
    text = javaTuoFengLangDu(text);
    return text;
}
function speak(text, parentElement) {
    const to_speak = new window.SpeechSynthesisUtterance();
    to_speak.text = text;
    to_speak.rate = 7.0;
    const oldColor = parentElement.style.backgroundColor;
    window.speechSynthesis.speak(to_speak);
    parentElement.style.backgroundColor = 'LightCyan';
    to_speak.onstart = function () {
        parentElement.style.backgroundColor = 'LightSkyBlue';
        parentElement.scrollIntoView({
            behavior: "smooth"
        });
    }
    to_speak.onend = function () {
        parentElement.style.backgroundColor = oldColor;
    }
}
function isMethod(text) {
    const modifierCode = 2;
    const returnCode = 3;
    const methodNameCode = 5;
    const parameterCode = 7;
    const constructorCode = 11;
    if (modifier_return_name_parameter_regexp.test(text)) {
        return modifierCode * returnCode * methodNameCode * parameterCode;
    }
    else if (return_name_parameter_regexp.test(text)) {
        return returnCode * methodNameCode * parameterCode;
    } else if (modifier_return_name_parameterless_regexp.test(text)) {
        return modifierCode * returnCode * methodNameCode;
    }
    else if (return_name_parameterless_regexp.test(text)) {
        return returnCode * methodNameCode;
    }
    else if (constructor_parameter_regexp.test(text)) {
        return constructorCode * methodNameCode;
    }
    else if (constructor_parameterless_regexp.test(text)) {
        return constructorCode;
    }
    return -1;
}
function addSpeckBtn(element, number) {
    let i = 0;
    for (; i < element.length; i++) {
        let speakBtn = document.createElement('button');
        speakBtn.innerText = "朗读";
        setButtonStyle(speakBtn);
        speakBtn.id = "speak_btn_" + (i + number);
        speakBtn.className = "speak_btn";
        speakBtn.onclick = function (e) {
            e.target.style.backgroundColor = '#979696';
            const btn = document.getElementById(e.target.id);
            parentElement = btn.parentElement;
            let text = parentElement.innerText;
            text = text.substring(0, text.lastIndexOf(e.target.innerText));
            text = text.replaceAll('​', '');
            console.log(text);
            const methodCode = isMethod(text);
            if (methodCode > 0) {
                console.log("是方法！编号:" + methodCode);
                if (methodCode === 210) {
                    console.log("    修饰符 返回值 方法名 参数列表")
                    text = text.replace(modifier_return_name_parameter_regexp, modifier_return_name_parameter_replace);
                } else if (methodCode === 105) {
                    console.log("    返回值 方法名 参数列表");
                    text = text.replace(return_name_parameter_regexp, return_name_parameter_replace);
                } else if (methodCode === 15) {
                    console.log("    返回值 方法名 没有参数列表")
                    text = text.replace(return_name_parameterless_regexp, return_name_parameterless_replace);
                } else if (methodCode === 30) {
                    console.log("    修饰符 返回值 方法名 没有参数列表");
                    text = text.replace(modifier_return_name_parameterless_regexp, modifier_return_name_parameterless_replace);
                } else if (methodCode === 55) {
                    console.log("    构造器 参数列表");
                    text = text.replace(constructor_parameter_regexp, constructor_parameter_replace);
                } else if (methodCode === 11) {
                    console.log("    构造器 无参数");
                    text = text.replace(constructor_parameterless_regexp, constructor_parameterless_replace);
                }
                text = methondReading(text);
            } else {
                console.log("不是方法")
                text = preprocessingText(text);
            }
            console.log(text + '\n');
            speak(text, parentElement);
        }
        element[i].append(speakBtn);
    }
    return (i + number);
}
function setButtonStyle(button) {
    if (button.innerText.startsWith('朗读')) {
        button.style.fontSize = '12px';
        button.style.backgroundColor = '#008CBA';
    } else {
        button.style.fontSize = '0.8em';
        if (button.innerText == '显示' || button.innerText == '隐藏') {
            button.style.backgroundColor = '#d54b4b';
        } else {
            button.style.backgroundColor = '#25d37c';
        }
        button.style.display = 'block';
    }
    button.style.border = 'none';
    button.style.marginTop = '0.5em';
    button.style.borderRadius = '2px';
}
window.onload = function () {
    const article_div = document.querySelector('body > main > div> div> article');
    const p_ul_ol_h = article_div.querySelectorAll('p:not(.image-caption,:has(img)),div:not(.post-copyright)>ul,div>ol,div>pre,h1:not(.post-title),h2,h3,h4,h5,h6');
    let number = addSpeckBtn(p_ul_ol_h, 0);
    const table_td = article_div.querySelectorAll('div > table tr > th,td:not(.code,.gutter)');
    addSpeckBtn(table_td, number);
    const readAllBtn = document.createElement('button');
    readAllBtn.innerText = "开始";
    setButtonStyle(readAllBtn);
    readAllBtn.onclick = function () {
        const sttButtonS = document.querySelectorAll('button.speak_btn');
        console.log(sttButtonS);
        for (let i = 0; i < sttButtonS.length; i++) {
            sttButtonS[i].click();
        }
    }
    const reloadBtn = document.createElement('button');
    reloadBtn.innerText = "刷新";
    setButtonStyle(reloadBtn);
    reloadBtn.onclick = function () {
        location.reload();
        window.scrollTo(0, 0);
    }
    const pauseBtn = document.createElement('button');
    pauseBtn.innerText = "暂停";
    setButtonStyle(pauseBtn);
    pauseBtn.onclick = function () {
        if (pauseBtn.innerText === "暂停") {
            window.speechSynthesis.pause();
            pauseBtn.innerText = "继续";
        } else if (pauseBtn.innerText === "继续") {
            window.speechSynthesis.resume();
            pauseBtn.innerText = "暂停";
        }
    }
    const readStopBtn = document.createElement('button');
    readStopBtn.innerText = "停止";
    setButtonStyle(readStopBtn);
    readStopBtn.onclick = function () {
        window.speechSynthesis.cancel()
        const sttButtonS = document.querySelectorAll('button.speak_btn');
        for (let i = 0; i < sttButtonS.length; i++) {
            sttButtonS[i].parentElement.style.backgroundColor = '#fff';
        }
    }
    const divTop = document.createElement('div');
    divTop.id = 'blog_reading_control_div';
    divTop.style.position = 'fixed';
    divTop.style.zIndex = '9999';
    divTop.style.textAlign = 'center';
    divTop.style.bottom = '1em';
    divTop.style.left = '0em';
    divTop.style.lineHeight = '1.15';
    const controlDiv = document.createElement('div');
    const showHideBtn = document.createElement('button');
    showHideBtn.innerText = '隐藏';
    showHideBtn.onclick = function (ev) {
        if (showHideBtn.innerText === '隐藏') {
            controlDiv.style.display = 'none';
            showHideBtn.innerText = '显示';
        } else if (showHideBtn.innerText === '显示') {
            controlDiv.style.display = 'block';
            showHideBtn.innerText = '隐藏';
        }
    }
    setButtonStyle(showHideBtn);
    controlDiv.append(reloadBtn);
    controlDiv.append(readAllBtn);
    controlDiv.append(pauseBtn);
    controlDiv.append(readStopBtn);
    divTop.append(controlDiv);
    divTop.append(showHideBtn);
    document.body.appendChild(divTop);
}
  </script>
  <!--博客朗读功能结束-->
</div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
      <span>站点总字数：</span>
    <span title="站点总字数">5.9m</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span>站点阅读时长 &asymp;</span>
    <span title="站点阅读时长">88:42</span>
  </span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@next-theme/pjax@0.5.0/pjax.min.js" integrity="sha256-3NkoLDrmHLTYj7csHIZSr0MHAFTXth7Ua/DDt4MRUAg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js" integrity="sha256-yt2kYMy0w8AbtF89WXb2P1rfjcP/HTHLT7097U8Y5b8=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/lozad@1.16.0/dist/lozad.min.js" integrity="sha256-mOFREFhqmHeQbXpK2lp4nA3qooVgACfh88fpJftLBbc=" crossorigin="anonymous"></script>
<script src="/JavaReadingNotes/js/comments.js"></script><script src="/JavaReadingNotes/js/utils.js"></script><script src="/JavaReadingNotes/js/motion.js"></script><script src="/JavaReadingNotes/js/next-boot.js"></script><script src="/JavaReadingNotes/js/pjax.js"></script>

  
<script src="https://cdn.jsdelivr.net/npm/hexo-generator-searchdb@1.4.0/dist/search.js" integrity="sha256-vXZMYLEqsROAXkEw93GGIvaB2ab+QW6w3+1ahD9nXXA=" crossorigin="anonymous"></script>
<script src="/JavaReadingNotes/js/third-party/search/local-search.js"></script>



  <script src="/JavaReadingNotes/js/third-party/fancybox.js"></script>

  <script src="/JavaReadingNotes/js/third-party/pace.js"></script>

  




  

  <script class="next-config" data-name="enableMath" type="application/json">false</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"none","js":{"url":"https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js","integrity":"sha256-r+3itOMtGGjap0x+10hu6jW/gZCzxHsoKrOd7gyRSGY="}}</script>
<script src="/JavaReadingNotes/js/third-party/math/mathjax.js"></script>


  <script src="https://cdn.jsdelivr.net/npm/quicklink@2.2.0/dist/quicklink.umd.js" integrity="sha256-4kQf9z5ntdQrzsBC3YSHnEz02Z9C1UeW/E9OgnvlzSY=" crossorigin="anonymous"></script>
  <script class="next-config" data-name="quicklink" type="application/json">{"enable":true,"home":true,"archive":true,"delay":true,"timeout":3000,"priority":true,"url":"https://lanlan2017.github.io/JavaReadingNotes/page/159/"}</script>
  <script src="/JavaReadingNotes/js/third-party/quicklink.js"></script>
<script class="next-config" data-name="waline" type="application/json">{"lang":null,"enable":true,"serverURL":"https://waline-test-lanlan2017.vercel.app","placeholder":"填写邮箱可接收回复通知 填写个人网址可为您引流","avatar":"mm","pageSize":10,"visitor":false,"comment_count":true,"requiredFields":[],"meta":["nick","mail","link"],"libUrl":"https://cdn.jsdelivr.net/npm/@waline/client/dist/Waline.min.js","el":"#waline-comments","path":"/JavaReadingNotes/page/159/"}</script>
<script>
document.addEventListener('page:loaded', () => {
  NexT.utils.loadComments(CONFIG.waline.el).then(() => 
    NexT.utils.getScript(CONFIG.waline.libUrl, { condition: window.Waline })
  ).then(() => {
    new Waline(CONFIG.waline);
  });
});
</script>
</body>
</html>
