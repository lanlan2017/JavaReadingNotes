<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 6.1.0">

<link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
  <link rel="apple-touch-icon" sizes="180x180" href="/JavaReadingNotes/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/JavaReadingNotes/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/JavaReadingNotes/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/JavaReadingNotes/images/logo.svg" color="#222">
  <meta name="google-site-verification" content="_Sly-yzHYmALHXzjFpPWsodMrjBSphw7bfRbMUH80Qc">
  <meta name="msvalidate.01" content="B1CFD346B8DEBBFE0C983C2AF8955531">
  <meta name="baidu-site-verification" content="vkMTwK56xr">

<link rel="stylesheet" href="/JavaReadingNotes/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css" integrity="sha256-DfWjNxDkM94fVBWx1H5BMMp0Zq7luBlV8QRcSES7s+0=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css" integrity="sha256-Vzbj7sDDS/woiFS3uNKo8eIuni59rjyNGtXfstRzStA=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/themes/blue/pace-theme-minimal.css">
  <script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script>

<script class="next-config" data-name="main" type="application/json">{"hostname":"lanlan2017.github.io","root":"/JavaReadingNotes/","images":"/JavaReadingNotes/images","scheme":"Gemini","darkmode":true,"version":"8.11.0","exturl":false,"sidebar":{"position":"right","display":"post","padding":18,"offset":12},"copycode":true,"bookmark":{"enable":true,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":true,"pangu":true,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/JavaReadingNotes/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/JavaReadingNotes/js/config.js"></script>

    <meta name="description" content="好好学习，天天向上">
<meta property="og:type" content="website">
<meta property="og:title" content="蓝蓝站点">
<meta property="og:url" content="https://lanlan2017.github.io/JavaReadingNotes/page/86/index.html">
<meta property="og:site_name" content="蓝蓝站点">
<meta property="og:description" content="好好学习，天天向上">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="蓝蓝">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://lanlan2017.github.io/JavaReadingNotes/page/86/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"page/86/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>蓝蓝站点</title>
  

  <script src="/JavaReadingNotes/js/third-party/analytics/baidu-analytics.js"></script>
  <script async src="https://hm.baidu.com/hm.js?dadeb188eb14ccde0b25a19230c429b5"></script>



<link rel="dns-prefetch" href="https://waline-test-lanlan2017.vercel.app">
  <noscript>
    <link rel="stylesheet" href="/JavaReadingNotes/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/JavaReadingNotes/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">蓝蓝站点</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">Java读书笔记</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/JavaReadingNotes/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-dir"><a href="/JavaReadingNotes/dir/" rel="section"><i class="fa fa-sitemap fa-fw"></i>目录</a></li><li class="menu-item menu-item-categories"><a href="/JavaReadingNotes/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-archives"><a href="/JavaReadingNotes/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li><li class="menu-item menu-item-tags"><a href="/JavaReadingNotes/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="蓝蓝"
      src="/JavaReadingNotes/images/avatar.gif">
  <p class="site-author-name" itemprop="name">蓝蓝</p>
  <div class="site-description" itemprop="description">好好学习，天天向上</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/JavaReadingNotes/archives/">
          <span class="site-state-item-count">1871</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/JavaReadingNotes/categories/">
        <span class="site-state-item-count">626</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://lanlan2017.github.io/todo/" title="todo → https:&#x2F;&#x2F;lanlan2017.github.io&#x2F;todo&#x2F;"><i class="fa fa-check-square fa-fw"></i>todo</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://lanlan2017.github.io/links/" title="links → https:&#x2F;&#x2F;lanlan2017.github.io&#x2F;links&#x2F;"><i class="fa fa-link fa-fw"></i>links</a>
      </span>
  </div>
  <div class="cc-license site-overview-item animated" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" class="cc-opacity" rel="noopener" target="_blank"><img src="https://cdn.jsdelivr.net/npm/@creativecommons/vocabulary@2020.11.3/assets/license_badges/small/by_nc_sa.svg" alt="Creative Commons"></a>
  </div>



        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="返回顶部">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="reading-progress-bar"></div>
  <a role="button" class="book-mark-link book-mark-link-fixed"></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://lanlan2017.github.io/JavaReadingNotes/7ee502ff/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/JavaReadingNotes/images/avatar.gif">
      <meta itemprop="name" content="蓝蓝">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="蓝蓝站点">
      <meta itemprop="description" content="好好学习，天天向上">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 蓝蓝站点">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/JavaReadingNotes/7ee502ff/" class="post-title-link" itemprop="url">16.6.2 使用Condition控制线程通信</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-01-08 08:39:59" itemprop="dateCreated datePublished" datetime="2020-01-08T08:39:59+08:00">2020-01-08</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2020-03-26 03:28:26" itemprop="dateModified" datetime="2020-03-26T03:28:26+08:00">2020-03-26</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/1-%E7%96%AF%E7%8B%82Java%E8%AE%B2%E4%B9%89-%E7%AC%AC4%E7%89%88/" itemprop="url" rel="index"><span itemprop="name">1 疯狂Java讲义 (第4版)</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/1-%E7%96%AF%E7%8B%82Java%E8%AE%B2%E4%B9%89-%E7%AC%AC4%E7%89%88/%E7%AC%AC16%E7%AB%A0-%E5%A4%9A%E7%BA%BF%E7%A8%8B/" itemprop="url" rel="index"><span itemprop="name">第16章 多线程</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/1-%E7%96%AF%E7%8B%82Java%E8%AE%B2%E4%B9%89-%E7%AC%AC4%E7%89%88/%E7%AC%AC16%E7%AB%A0-%E5%A4%9A%E7%BA%BF%E7%A8%8B/16-6-%E7%BA%BF%E7%A8%8B%E9%80%9A%E4%BF%A1/" itemprop="url" rel="index"><span itemprop="name">16.6 线程通信</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
    <span class="post-meta-item-icon">
      <i class="far fa-comment"></i>
    </span>
    <span class="post-meta-item-text">Waline：</span>
  
    <a title="waline" href="/JavaReadingNotes/7ee502ff/#waline-comments" itemprop="discussionUrl">
      <span class="post-comments-count waline-comment-count" id="/JavaReadingNotes/7ee502ff/" data-xid="/JavaReadingNotes/7ee502ff/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>3.9k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>4 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="16-6-2-使用Condition控制线程通信"><a href="#16-6-2-使用Condition控制线程通信" class="headerlink" title="16.6.2 使用Condition控制线程通信"></a>16.6.2 使用Condition控制线程通信</h1><h2 id="synchronized同步的-使用同步监视器进行通信"><a href="#synchronized同步的-使用同步监视器进行通信" class="headerlink" title="synchronized同步的 使用同步监视器进行通信"></a>synchronized同步的 使用同步监视器进行通信</h2><p>如果程序不使用<code>synchronized</code>关键字来保证同步,而是直接使用<code>Lock</code>对象来保证同步,则系统中不存在隐式的同步监视器,也就不能使用<code>wait()</code>、<code>notify()</code>、<code>notifyAll()</code>方法进行线程通信了。</p>
<h2 id="Lock对象同步的使用Condition对象通信"><a href="#Lock对象同步的使用Condition对象通信" class="headerlink" title="Lock对象同步的使用Condition对象通信"></a>Lock对象同步的使用Condition对象通信</h2><p>当使用<code>Lock</code>对象来保证同步时,<code>Java</code>提供了一个<code>Condition</code>类来保持协调,<strong>使用<code>Condition</code>可以让那些已经得到<code>Lock</code>对象却无法继续执行的线程释放<code>Lock</code>对象</strong>,<strong><code>Condition</code>对象也可以唤醒其他处于等待的线程</strong></p>
<p><code>Condition</code>将同步监视器方法(<code>wait()</code>、<code>notify()</code>和<code>notifyAll()</code>)分解成截然不同的对象,以便通过将这些对象与<code>Lock</code>对象组合使用,为每个对象提供多个等待集(<code>wait-set</code>)。<br>在这种情况下,</p>
<ul>
<li><strong><code>Lock</code>替代了同步方法或同步代码块</strong>,</li>
<li><strong><code>Condition</code>替代了同步监视器的功能</strong></li>
</ul>
<h2 id="如何创建Condition实例"><a href="#如何创建Condition实例" class="headerlink" title="如何创建Condition实例"></a>如何创建<code>Condition</code>实例</h2><p><code>Condition</code>实例被绑定在一个<code>Lock</code>对象上。要<strong>获得特定<code>Lock</code>实例的<code>Condition</code>实例,调用<code>Lock</code>对象的<code>newCondition</code>方法即可</strong>。</p>
<p><code>Condition</code>类提供了如下三个方法。</p>
<table>
<thead>
<tr>
<th align="left">方法</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>void await()</code></td>
<td align="left">类似于隐式同步监视器上的<code>wait()</code>方法,导致当前线程等待,直到其他线程调用该<code>Condition</code>的<code>signal()</code>方法或<code>signalAll()</code>方法来唤醒该线程</td>
</tr>
<tr>
<td align="left"><code>void signal()</code></td>
<td align="left">唤醒在此<code>Lock</code>对象上等待的单个线程。如果所有线程都在该<code>Lock</code>对象上等待,则会选择唤醒其中一个线程。选择是仼意性的。只有当前线程放弃对该<code>Lock</code>对象的锁定后(使用<code>await</code>方法),才可以执行被唤醒的线程。</td>
</tr>
<tr>
<td align="left"><code>void signalAll()</code></td>
<td align="left">唤醒在此<code>Lock</code>对象上等待的所有线程。只有当前线程放弃对该<code>Lock</code>对象的锁定后才可以执行被唤醒的线程。</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th align="left">await方法变体</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>boolean await(long time, TimeUnit unit)</code></td>
<td align="left">Causes the current thread to wait until it is signalled or interrupted, or the specified waiting time elapses.</td>
</tr>
<tr>
<td align="left"><code>long awaitNanos(long nanosTimeout)</code></td>
<td align="left">Causes the current thread to wait until it is signalled or interrupted, or the specified waiting time elapses.</td>
</tr>
<tr>
<td align="left"><code>void awaitUninterruptibly()</code></td>
<td align="left">Causes the current thread to wait until it is signalled.</td>
</tr>
<tr>
<td align="left"><code>boolean awaitUntil(Date deadline)</code></td>
<td align="left">Causes the current thread to wait until it is signalled or interrupted, or the specified deadline elapses.</td>
</tr>
</tbody></table>
<h2 id="程序-使用Lock同步-使用Condition通信"><a href="#程序-使用Lock同步-使用Condition通信" class="headerlink" title="程序 使用Lock同步 使用Condition通信"></a>程序 使用Lock同步 使用Condition通信</h2><h3 id="账户类"><a href="#账户类" class="headerlink" title="账户类"></a>账户类</h3><p>下面程序中<code>Account</code>使用<code>Lock</code>对象来控制同步,并使用<code>Condition</code>对象来控制线程的协调运行</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.locks.Condition;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.locks.Lock;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.locks.ReentrantLock;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Account</span> &#123;</span><br><span class="line">    <span class="comment">// 显式定义Lock对象</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">Lock</span> <span class="variable">lock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReentrantLock</span>();</span><br><span class="line">    <span class="comment">// 获得指定Lock对象对应的Condition</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">Condition</span> <span class="variable">cond</span> <span class="operator">=</span> lock.newCondition();</span><br><span class="line">    <span class="comment">// 封装账户编号、账户余额的两个成员变量</span></span><br><span class="line">    <span class="keyword">private</span> String accountNo;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">double</span> balance;</span><br><span class="line">    <span class="comment">// 标识账户中是否已有存款的旗标</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="variable">flag</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Account</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 构造器</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Account</span><span class="params">(String accountNo, <span class="type">double</span> balance)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.accountNo = accountNo;</span><br><span class="line">        <span class="built_in">this</span>.balance = balance;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// accountNo的setter和getter方法</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setAccountNo</span><span class="params">(String accountNo)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.accountNo = accountNo;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getAccountNo</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.accountNo;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 因此账户余额不允许随便修改，所以只为balance提供getter方法，</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">double</span> <span class="title function_">getBalance</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.balance;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 取钱</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">draw</span><span class="params">(<span class="type">double</span> drawAmount)</span> &#123;</span><br><span class="line">        <span class="comment">// 加锁</span></span><br><span class="line">        lock.lock();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 如果flag为假，表明账户中还没有人存钱进去，取钱方法阻塞</span></span><br><span class="line">            <span class="keyword">if</span> (!flag) &#123;</span><br><span class="line">                cond.await();</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">// 执行取钱</span></span><br><span class="line">                System.out.println(Thread.currentThread().getName() + <span class="string">&quot; 取钱:&quot;</span> + drawAmount);</span><br><span class="line">                balance -= drawAmount;</span><br><span class="line">                System.out.println(<span class="string">&quot;账户余额为：&quot;</span> + balance);</span><br><span class="line">                <span class="comment">// 将标识账户是否已有存款的旗标设为false。</span></span><br><span class="line">                flag = <span class="literal">false</span>;</span><br><span class="line">                <span class="comment">// 唤醒其他线程</span></span><br><span class="line">                cond.signalAll();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException ex) &#123;</span><br><span class="line">            ex.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 使用finally块来释放锁</span></span><br><span class="line">        <span class="keyword">finally</span> &#123;</span><br><span class="line">            lock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 存钱</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deposit</span><span class="params">(<span class="type">double</span> depositAmount)</span> &#123;</span><br><span class="line">        lock.lock();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 如果flag为真，表明账户中已有人存钱进去，则存钱方法阻塞</span></span><br><span class="line">            <span class="keyword">if</span> (flag) <span class="comment">// ①</span></span><br><span class="line">            &#123;</span><br><span class="line">                cond.await();</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">// 执行存款</span></span><br><span class="line">                System.out.println(Thread.currentThread().getName() + <span class="string">&quot; 存款:&quot;</span> + depositAmount);</span><br><span class="line">                balance += depositAmount;</span><br><span class="line">                System.out.println(<span class="string">&quot;账户余额为：&quot;</span> + balance);</span><br><span class="line">                <span class="comment">// 将表示账户是否已有存款的旗标设为true</span></span><br><span class="line">                flag = <span class="literal">true</span>;</span><br><span class="line">                <span class="comment">// 唤醒其他线程</span></span><br><span class="line">                cond.signalAll();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException ex) &#123;</span><br><span class="line">            ex.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 使用finally块来释放锁</span></span><br><span class="line">        <span class="keyword">finally</span> &#123;</span><br><span class="line">            lock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 下面两个方法根据accountNo来重写hashCode()和equals()方法</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">hashCode</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> accountNo.hashCode();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">equals</span><span class="params">(Object obj)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span> == obj)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">if</span> (obj != <span class="literal">null</span> &amp;&amp; obj.getClass() == Account.class) &#123;</span><br><span class="line">            <span class="type">Account</span> <span class="variable">target</span> <span class="operator">=</span> (Account) obj;</span><br><span class="line">            <span class="keyword">return</span> target.getAccountNo().equals(accountNo);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>用该程序与上一节的<code>Account.java</code>进行对比,不难发现这两个程序的逻辑基本相似,只是现在显式地<strong>使用<code>Lock</code>对象来充当同步监视器</strong>,然后需要<strong>使用<code>Condition</code>对象来暂停、唤醒指定线程</strong>。<br>该示例程序的其他类与前一个示例程序的其他类完全一样,该程序的运行效果与前一个示例程序的运行效果完全一样.</p>
<h2 id="使用管道流进行线程通信"><a href="#使用管道流进行线程通信" class="headerlink" title="使用管道流进行线程通信"></a>使用管道流进行线程通信</h2><p>本书第1版还介绍了一种使用管道流进行线程通信的情形,但实际上<strong>由于两个线程属于同一个进程,它们可以非常方便地共享数据,因此很少需要使用管道流进行通信</strong>,故此处不再介绍那种烦琐的方式。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://lanlan2017.github.io/JavaReadingNotes/f9427fe5/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/JavaReadingNotes/images/avatar.gif">
      <meta itemprop="name" content="蓝蓝">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="蓝蓝站点">
      <meta itemprop="description" content="好好学习，天天向上">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 蓝蓝站点">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/JavaReadingNotes/f9427fe5/" class="post-title-link" itemprop="url">15.11 本章小结</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-01-07 08:19:53" itemprop="dateCreated datePublished" datetime="2020-01-07T08:19:53+08:00">2020-01-07</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2020-03-15 08:15:11" itemprop="dateModified" datetime="2020-03-15T08:15:11+08:00">2020-03-15</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/1-%E7%96%AF%E7%8B%82Java%E8%AE%B2%E4%B9%89-%E7%AC%AC4%E7%89%88/" itemprop="url" rel="index"><span itemprop="name">1 疯狂Java讲义 (第4版)</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/1-%E7%96%AF%E7%8B%82Java%E8%AE%B2%E4%B9%89-%E7%AC%AC4%E7%89%88/%E7%AC%AC15%E7%AB%A0-%E8%BE%93%E5%85%A5%E8%BE%93%E5%87%BA/" itemprop="url" rel="index"><span itemprop="name">第15章 输入输出</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/1-%E7%96%AF%E7%8B%82Java%E8%AE%B2%E4%B9%89-%E7%AC%AC4%E7%89%88/%E7%AC%AC15%E7%AB%A0-%E8%BE%93%E5%85%A5%E8%BE%93%E5%87%BA/15-11-%E6%9C%AC%E7%AB%A0%E5%B0%8F%E7%BB%93/" itemprop="url" rel="index"><span itemprop="name">15.11 本章小结</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
    <span class="post-meta-item-icon">
      <i class="far fa-comment"></i>
    </span>
    <span class="post-meta-item-text">Waline：</span>
  
    <a title="waline" href="/JavaReadingNotes/f9427fe5/#waline-comments" itemprop="discussionUrl">
      <span class="post-comments-count waline-comment-count" id="/JavaReadingNotes/f9427fe5/" data-xid="/JavaReadingNotes/f9427fe5/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>720</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>1 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="15-11-本章小结"><a href="#15-11-本章小结" class="headerlink" title="15.11 本章小结"></a>15.11 本章小结</h1><p>本章主要介绍了<code>Java</code>输入输出体系的相关知识。本章介绍了如何使用<code>File</code>来访问本地文件系统,以及<code>JavaIo</code>流的三种分类方式。本章重点讲解了o流的处理模型,以及如何使用⑩o流来读取物理存储节点中的数据,归纳了<code>Java</code>不同<code>Io</code>流的功能,并介绍了几种典型<code>Io</code>流的用法。本章也介绍了<code>RandomAccessFile</code>类的用法,通过<code>RandomAccessFile</code>允许程序自由地移动文件指针,任意访问文件的指定位置。<br>本章也介绍了<code>Java</code>对象序列化的相关知识,程序通过序列化把<code>Java</code>对象转换成二进制字节流,然后就可以把二进制字节流写入网络或者永久存储器。本章还介绍了<code>Java</code>提供的新<code>IO</code>支持,使用新<code>IO</code>能以更高效的方式来进行输入、输出操作。本章最后介绍了<code>Java7</code>提供的<code>NO.2</code>的文件<code>IO</code>和文件系统访问支持2极大地增强了<code>JavaIo</code>的功能</p>
<h1 id="疯狂java讲义4-第15章-练习"><a href="#疯狂java讲义4-第15章-练习" class="headerlink" title="疯狂java讲义4 第15章 练习"></a>疯狂java讲义4 第15章 练习</h1><ol>
<li>定义一个工具类,该类要求用户运行该程序时输入一个路径。该工具类会将该路径下(及其子目录下)的所有文件列出来。</li>
<li>定义一个工具类,该类要求用户运行该程序时输入一个路径。该工具类会将该路径下的文件、文件夹的数量统计出来。</li>
<li>定义一个工具类,该工具类可实现<code>copy</code>功能(不允许使用<code>Files</code>类)。如果被<code>copy</code>的对象是文件,程序将指定文件复制到指定目录下;如果被<code>copy</code>的对象是目录,程序应该将该目录及其目录下的所有文件复制到指定目录下。</li>
<li>编写仿<code>Windows</code>记事本的小程序。</li>
<li>编写一个命令行工具,这个命令行工具就像<code>window</code>提供的<code>cmd</code>命令一样,可以执行各种常见的命令,如<code>dir</code>、<code>md</code>、<code>copy</code>、<code>move</code>等。</li>
<li><strong>完善第12章的仿<code>Editplus</code>的编辑器,提供文件的打开、保存等功能</strong>。</li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://lanlan2017.github.io/JavaReadingNotes/46580092/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/JavaReadingNotes/images/avatar.gif">
      <meta itemprop="name" content="蓝蓝">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="蓝蓝站点">
      <meta itemprop="description" content="好好学习，天天向上">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 蓝蓝站点">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/JavaReadingNotes/46580092/" class="post-title-link" itemprop="url">15.10.4 访问文件属性</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-01-07 04:04:50" itemprop="dateCreated datePublished" datetime="2020-01-07T04:04:50+08:00">2020-01-07</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2020-03-15 08:15:11" itemprop="dateModified" datetime="2020-03-15T08:15:11+08:00">2020-03-15</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/1-%E7%96%AF%E7%8B%82Java%E8%AE%B2%E4%B9%89-%E7%AC%AC4%E7%89%88/" itemprop="url" rel="index"><span itemprop="name">1 疯狂Java讲义 (第4版)</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/1-%E7%96%AF%E7%8B%82Java%E8%AE%B2%E4%B9%89-%E7%AC%AC4%E7%89%88/%E7%AC%AC15%E7%AB%A0-%E8%BE%93%E5%85%A5%E8%BE%93%E5%87%BA/" itemprop="url" rel="index"><span itemprop="name">第15章 输入输出</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/1-%E7%96%AF%E7%8B%82Java%E8%AE%B2%E4%B9%89-%E7%AC%AC4%E7%89%88/%E7%AC%AC15%E7%AB%A0-%E8%BE%93%E5%85%A5%E8%BE%93%E5%87%BA/15-10-Java7%E7%9A%84NIO-2/" itemprop="url" rel="index"><span itemprop="name">15.10 Java7的NIO.2</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
    <span class="post-meta-item-icon">
      <i class="far fa-comment"></i>
    </span>
    <span class="post-meta-item-text">Waline：</span>
  
    <a title="waline" href="/JavaReadingNotes/46580092/#waline-comments" itemprop="discussionUrl">
      <span class="post-comments-count waline-comment-count" id="/JavaReadingNotes/46580092/" data-xid="/JavaReadingNotes/46580092/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>5.5k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>5 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="15-10-4-访问文件属性"><a href="#15-10-4-访问文件属性" class="headerlink" title="15.10.4 访问文件属性"></a>15.10.4 访问文件属性</h1><p>早期的<code>Java</code>提供的<code>File</code>类可以访问一些简单的文件属性,比如文件大小、修改时间、文件是否隐藏、是文件还是目录等。如果程序需要获取或修改更多的文件属性,则必须利用运行所在平台的特定代码来实现,这是一件非常困难的事情。</p>
<h2 id="文件属性工具类"><a href="#文件属性工具类" class="headerlink" title="文件属性工具类"></a>文件属性工具类</h2><p><code>Java7</code>的<code>NIO.2</code>在<code>java.nio.file.attribute</code>包下提供了大量的工具类,通过这些工具类,开发者可以非常简单地读取、修改文件属性。这些工具类主要分为如下两类</p>
<table>
<thead>
<tr>
<th align="left">类</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>XxxAttributeView</code></td>
<td align="left">代表某种文件属性的“视图”</td>
</tr>
<tr>
<td align="left"><code>XxxAttributes</code></td>
<td align="left">代表某种文件属性的“集合”,程序一般通过<code>XxxAttributeView</code>对象来获取<code>XxxAttributes</code>。</td>
</tr>
</tbody></table>
<h2 id="FileAttributeView"><a href="#FileAttributeView" class="headerlink" title="FileAttributeView"></a>FileAttributeView</h2><p>在这些工具类中,<code>FileAttributeView</code>是其他<code>XxxAttributeView</code>的父接口,下面简单介绍一下这些<code>XxxAttributeView</code>。</p>
<h3 id="AclFileAttributeView"><a href="#AclFileAttributeView" class="headerlink" title="AclFileAttributeView"></a>AclFileAttributeView</h3><p>通过<code>AclFileAttributeView</code>,开发者可以为特定文件设置<code>ACL</code>(<code>Access Control List)</code>及文件所有者属性。它的<code>getAcl()</code>方法返回<code>List&lt;AclEntry&gt;</code>对象,该返回值代表了该文件的<strong>权限集</strong>。通过<code>setAcl(List)</code>方法可以修改该文件的<code>ACL</code></p>
<table>
<thead>
<tr>
<th align="left">方法</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>List&lt;AclEntry&gt; getAcl()</code></td>
<td align="left">Reads the access control list.</td>
</tr>
<tr>
<td align="left"><code>String name()</code></td>
<td align="left">Returns the name of the attribute view.</td>
</tr>
<tr>
<td align="left"><code>void setAcl(List&lt;AclEntry&gt; acl)</code></td>
<td align="left">Updates (replace) the access control list.</td>
</tr>
</tbody></table>
<h3 id="BasicFileAttributeView"><a href="#BasicFileAttributeView" class="headerlink" title="BasicFileAttributeView"></a>BasicFileAttributeView</h3><p>它可以<strong>获取或修改文件的基本属性</strong>,包括文件的<strong>最后修改时间</strong>、<strong>最后访问时间</strong>、<strong>创建时间</strong>、<strong>大小</strong>、<strong>是否为目录</strong>、<strong>是否为符号链接</strong>等。它的<code>readAttributes()</code>方法返回一个<code>BasicFileAttributes</code>对象,对<code>文件夹</code>基本属性的修改是通过<code>BasicFileAttributes</code>对象完成的。</p>
<table>
<thead>
<tr>
<th align="left">BasicFileAttributeView的readAttributes方法</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>BasicFileAttributes readAttributes()</code></td>
<td align="left">Reads the basic file attributes as a bulk operation.</td>
</tr>
</tbody></table>
<h4 id="BasicFileAttributes"><a href="#BasicFileAttributes" class="headerlink" title="BasicFileAttributes"></a>BasicFileAttributes</h4><table>
<thead>
<tr>
<th align="left">BasicFileAttributes接口方法</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>FileTime creationTime()</code></td>
<td align="left">Returns the creation time.</td>
</tr>
<tr>
<td align="left"><code>Object fileKey()</code></td>
<td align="left">Returns an object that uniquely identifies the given file, or null if a file key is not available.</td>
</tr>
<tr>
<td align="left"><code>boolean isDirectory()</code></td>
<td align="left">Tells whether the file is a directory.</td>
</tr>
<tr>
<td align="left"><code>boolean isOther()</code></td>
<td align="left">Tells whether the file is something other than a regular file, directory, or symbolic link.</td>
</tr>
<tr>
<td align="left"><code>boolean isRegularFile()</code></td>
<td align="left">Tells whether the file is a regular file with opaque content.</td>
</tr>
<tr>
<td align="left"><code>boolean isSymbolicLink()</code></td>
<td align="left">Tells whether the file is a symbolic link.</td>
</tr>
<tr>
<td align="left"><code>FileTime lastAccessTime()</code></td>
<td align="left">Returns the time of last access.</td>
</tr>
<tr>
<td align="left"><code>FileTime lastModifiedTime()</code></td>
<td align="left">Returns the time of last modification.</td>
</tr>
<tr>
<td align="left"><code>long size()</code></td>
<td align="left">Returns the size of the file (in bytes).</td>
</tr>
</tbody></table>
<h3 id="DosFileAttributeView"><a href="#DosFileAttributeView" class="headerlink" title="DosFileAttributeView"></a>DosFileAttributeView</h3><p>它主要用于获取或修改文件**<code>DOS</code>相关属性**,比如文件<strong>是否只读</strong>、<strong>是否隐藏</strong>、<strong>是否为系统文件</strong>、<strong>是否是存档文件</strong>等。它的<code>readAttributes</code>方法返回一个<code>DosFileAttributes</code>对象,对这些属性的修改其实是由<code>DosFileAttributes</code>对象来完成的|</p>
<h4 id="DosFileAttributes"><a href="#DosFileAttributes" class="headerlink" title="DosFileAttributes"></a>DosFileAttributes</h4><table>
<thead>
<tr>
<th align="left"><code>DosFileAttributes</code>接口方法</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>boolean isArchive()</code></td>
<td align="left">Returns the value of the archive attribute.</td>
</tr>
<tr>
<td align="left"><code>boolean isHidden()</code></td>
<td align="left">Returns the value of the hidden attribute.</td>
</tr>
<tr>
<td align="left"><code>boolean isReadOnly()</code></td>
<td align="left">Returns the value of the read-only attribute.</td>
</tr>
<tr>
<td align="left"><code>boolean isSystem()</code></td>
<td align="left">Returns the value of the system attribute.</td>
</tr>
</tbody></table>
<h3 id="FileOwnerAttributeView"><a href="#FileOwnerAttributeView" class="headerlink" title="FileOwnerAttributeView"></a>FileOwnerAttributeView</h3><p>它主要<strong>用于获取或修改文件的所有者</strong>。它的<code>getOwner()</code>方法返回一个<code>UserPrincipal</code>对象来代表文件所有者;也可调用<code>setOwner(UserPrincipal owner)</code>方法来改变文件的所有者</p>
<table>
<thead>
<tr>
<th align="left"><code>FileOwnerAttributeView</code>方法</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>UserPrincipal getOwner()</code></td>
<td align="left">Read the file owner.</td>
</tr>
<tr>
<td align="left"><code>void setOwner(UserPrincipal owner)</code></td>
<td align="left">Updates the file owner.</td>
</tr>
</tbody></table>
<h3 id="PosixFileAttributeView"><a href="#PosixFileAttributeView" class="headerlink" title="PosixFileAttributeView"></a>PosixFileAttributeView</h3><p>它主要<strong>用于获取或修改<code>POSX</code>(<code>Portable Operating System Interface of INIX</code>)属性</strong>,它的<code>readAttributes()</code>方法返回一个<code>PosixFileAttributes</code>对象,该对象可用于获取或修改文件的<strong>所有者</strong>、<strong>组所有者</strong>、<strong>访问权限信息</strong>(就是<code>UNIX</code>的<code>chmod</code>命令负责干的事情)。<strong>这个<code>view</code>只在<code>UNNX</code>、<code>Linux</code>等系统上有用</strong>。</p>
<table>
<thead>
<tr>
<th align="left">PosixFileAttributeView方法</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>PosixFileAttributes readAttributes()</code></td>
<td align="left">Reads the basic file attributes as a bulk operation.</td>
</tr>
</tbody></table>
<h4 id="PosixFileAttributes"><a href="#PosixFileAttributes" class="headerlink" title="PosixFileAttributes"></a>PosixFileAttributes</h4><table>
<thead>
<tr>
<th align="left">PosixFileAttributes接口方法</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>GroupPrincipal group()</code></td>
<td align="left">Returns the group owner of the file.</td>
</tr>
<tr>
<td align="left"><code>UserPrincipal owner()</code></td>
<td align="left">Returns the owner of the file.</td>
</tr>
<tr>
<td align="left"><code>Set&lt;PosixFilePermission&gt; permissions()</code></td>
<td align="left">Returns the permissions of the file.</td>
</tr>
</tbody></table>
<h3 id="UserDefinedFileAttributeView"><a href="#UserDefinedFileAttributeView" class="headerlink" title="UserDefinedFileAttributeView"></a>UserDefinedFileAttributeView</h3><p>它可以让开发者为文件设置一些自定义属性。</p>
<h2 id="程序-读取-修改文件属性"><a href="#程序-读取-修改文件属性" class="headerlink" title="程序 读取 修改文件属性"></a>程序 读取 修改文件属性</h2><p>下面程序示范了如何读取、修改文件的属性。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.nio.ByteBuffer;</span><br><span class="line"><span class="keyword">import</span> java.nio.charset.Charset;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.FileSystems;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Files;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Path;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Paths;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.attribute.BasicFileAttributeView;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.attribute.BasicFileAttributes;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.attribute.DosFileAttributeView;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.attribute.FileOwnerAttributeView;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.attribute.UserDefinedFileAttributeView;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.attribute.UserPrincipal;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AttributeViewTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">// 获取将要操作的文件</span></span><br><span class="line">        <span class="type">Path</span> <span class="variable">testPath</span> <span class="operator">=</span> Paths.get(<span class="string">&quot;AttributeViewTest.java&quot;</span>);</span><br><span class="line">        <span class="comment">// 获取访问基本属性的BasicFileAttributeView</span></span><br><span class="line">        <span class="type">BasicFileAttributeView</span> <span class="variable">basicView</span> <span class="operator">=</span> </span><br><span class="line">            Files.getFileAttributeView(testPath, BasicFileAttributeView.class);</span><br><span class="line">        <span class="comment">// 获取访问基本属性的BasicFileAttributes</span></span><br><span class="line">        <span class="type">BasicFileAttributes</span> <span class="variable">basicAttribs</span> <span class="operator">=</span> basicView.readAttributes();</span><br><span class="line">        <span class="comment">// 访问文件的基本属性</span></span><br><span class="line">        System.out.println(<span class="string">&quot;创建时间：&quot;</span> + <span class="keyword">new</span> <span class="title class_">Date</span>(basicAttribs.creationTime().toMillis()));</span><br><span class="line">        System.out.println(<span class="string">&quot;最后访问时间：&quot;</span> + <span class="keyword">new</span> <span class="title class_">Date</span>(basicAttribs.lastAccessTime().toMillis()));</span><br><span class="line">        System.out.println(<span class="string">&quot;最后修改时间：&quot;</span> + <span class="keyword">new</span> <span class="title class_">Date</span>(basicAttribs.lastModifiedTime().toMillis()));</span><br><span class="line">        System.out.println(<span class="string">&quot;文件大小：&quot;</span> + basicAttribs.size());</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获取访问文件属主信息的FileOwnerAttributeView</span></span><br><span class="line">        <span class="type">FileOwnerAttributeView</span> <span class="variable">ownerView</span> <span class="operator">=</span></span><br><span class="line">            Files.getFileAttributeView(testPath, FileOwnerAttributeView.class);</span><br><span class="line">        <span class="comment">// 获取该文件所属的用户</span></span><br><span class="line">        System.out.println(ownerView.getOwner());</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 获取系统中guest对应的用户</span></span><br><span class="line">        <span class="type">UserPrincipal</span> <span class="variable">user</span> <span class="operator">=</span> FileSystems.getDefault().getUserPrincipalLookupService().lookupPrincipalByName(<span class="string">&quot;guest&quot;</span>);</span><br><span class="line">        <span class="comment">// 修改用户</span></span><br><span class="line">        ownerView.setOwner(user);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获取访问自定义属性的FileOwnerAttributeView</span></span><br><span class="line">        <span class="type">UserDefinedFileAttributeView</span> <span class="variable">userView</span> <span class="operator">=</span> Files.getFileAttributeView(testPath,</span><br><span class="line">                UserDefinedFileAttributeView.class);</span><br><span class="line">        List&lt;String&gt; attrNames = userView.list();</span><br><span class="line">        <span class="comment">// 遍历所有的自定义属性</span></span><br><span class="line">        <span class="keyword">for</span> (String name : attrNames) &#123;</span><br><span class="line">            <span class="type">ByteBuffer</span> <span class="variable">buf</span> <span class="operator">=</span> ByteBuffer.allocate(userView.size(name));</span><br><span class="line">            userView.read(name, buf);</span><br><span class="line">            buf.flip();</span><br><span class="line">            <span class="type">String</span> <span class="variable">value</span> <span class="operator">=</span> Charset.defaultCharset().decode(buf).toString();</span><br><span class="line">            System.out.println(name + <span class="string">&quot;---&gt;&quot;</span> + value);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 添加一个自定义属性</span></span><br><span class="line">        userView.write(<span class="string">&quot;发行者&quot;</span>, Charset.defaultCharset().encode(<span class="string">&quot;疯狂Java联盟&quot;</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获取访问DOS属性的DosFileAttributeView</span></span><br><span class="line">        <span class="type">DosFileAttributeView</span> <span class="variable">dosView</span> <span class="operator">=</span> Files.getFileAttributeView(testPath, DosFileAttributeView.class);</span><br><span class="line">        <span class="comment">// 将文件设置隐藏、只读</span></span><br><span class="line">        dosView.setHidden(<span class="literal">true</span>);</span><br><span class="line">        dosView.setReadOnly(<span class="literal">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上面程序中的分别访问了4种不同类型的文件属性,关于读取、修改文件属性的说明,程序中的代码已有详细说明,因此不再过多地解释。第二次运行该程序(记住第一次运行后<code>AttributeViewTestJava</code>文件变成隐藏、只读文件,因此第二次运行之前一定要先取消只读属性)</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://lanlan2017.github.io/JavaReadingNotes/535e0b1a/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/JavaReadingNotes/images/avatar.gif">
      <meta itemprop="name" content="蓝蓝">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="蓝蓝站点">
      <meta itemprop="description" content="好好学习，天天向上">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 蓝蓝站点">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/JavaReadingNotes/535e0b1a/" class="post-title-link" itemprop="url">15.10.3 使用WatchService监控文件变化</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-01-07 03:00:31" itemprop="dateCreated datePublished" datetime="2020-01-07T03:00:31+08:00">2020-01-07</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2020-03-15 08:15:11" itemprop="dateModified" datetime="2020-03-15T08:15:11+08:00">2020-03-15</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/1-%E7%96%AF%E7%8B%82Java%E8%AE%B2%E4%B9%89-%E7%AC%AC4%E7%89%88/" itemprop="url" rel="index"><span itemprop="name">1 疯狂Java讲义 (第4版)</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/1-%E7%96%AF%E7%8B%82Java%E8%AE%B2%E4%B9%89-%E7%AC%AC4%E7%89%88/%E7%AC%AC15%E7%AB%A0-%E8%BE%93%E5%85%A5%E8%BE%93%E5%87%BA/" itemprop="url" rel="index"><span itemprop="name">第15章 输入输出</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/1-%E7%96%AF%E7%8B%82Java%E8%AE%B2%E4%B9%89-%E7%AC%AC4%E7%89%88/%E7%AC%AC15%E7%AB%A0-%E8%BE%93%E5%85%A5%E8%BE%93%E5%87%BA/15-10-Java7%E7%9A%84NIO-2/" itemprop="url" rel="index"><span itemprop="name">15.10 Java7的NIO.2</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
    <span class="post-meta-item-icon">
      <i class="far fa-comment"></i>
    </span>
    <span class="post-meta-item-text">Waline：</span>
  
    <a title="waline" href="/JavaReadingNotes/535e0b1a/#waline-comments" itemprop="discussionUrl">
      <span class="post-comments-count waline-comment-count" id="/JavaReadingNotes/535e0b1a/" data-xid="/JavaReadingNotes/535e0b1a/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>2.1k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>2 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="15-10-3-使用WatchService监控文件变化"><a href="#15-10-3-使用WatchService监控文件变化" class="headerlink" title="15.10.3 使用WatchService监控文件变化"></a>15.10.3 使用WatchService监控文件变化</h1><p>在以前的<code>Java</code>版本中,如果程序需要监控文件的变化,则可以考虑启动一条后台线程,这条后线程每隔一段时间去“遍历”一次指定目录的文件,如果发现此次遍历结果与上次遍历结果不同,则认为文件发生了变化。但这种方式不仅十分烦琐,而且性能也不好。</p>
<h2 id="Path类监听文件系统的方法"><a href="#Path类监听文件系统的方法" class="headerlink" title="Path类监听文件系统的方法"></a>Path类监听文件系统的方法</h2><p><code>NIO.2</code>的<code>Path</code>类提供了如下一个方法来监听文件系统的变化。</p>
<table>
<thead>
<tr>
<th align="left"><code>Path</code>类的<code>register</code>方法</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>default WatchKey register(WatchService watcher, WatchEvent.Kind&lt;?&gt;... events)</code></td>
<td align="left">用<code>watcher</code>监听该<code>path</code>代表的目录下的文件变化。<code>events</code>参数指定要监听哪些类型的事件。</td>
</tr>
<tr>
<td align="left"><code>WatchKey register(WatchService watcher, WatchEvent.Kind&lt;?&gt;[] events, WatchEvent.Modifier... modifiers)</code></td>
<td align="left">Registers the file located by this path with a watch service.</td>
</tr>
</tbody></table>
<p>在这个方法中<code>WatchService</code>代表一个<strong>文件系统监听服务</strong>,它负责监听<code>path</code>代表的目录下的文件变化。</p>
<h2 id="WatchService"><a href="#WatchService" class="headerlink" title="WatchService"></a>WatchService</h2><p>一旦使用<code>register</code>方法完成注册之后,接下来就可调用<code>WatchService</code>的如下三个方法来获取被监听目录的文件变化事件</p>
<table>
<thead>
<tr>
<th align="left"><code>WatchService</code>方法</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>WatchKey poll()</code></td>
<td align="left">获取下一个<code>LatchKey</code>,如果没有<code>LatchKey</code>发生就立即返回<code>null</code></td>
</tr>
<tr>
<td align="left"><code>WatchKey poll(long timeout, TimeUnit unit)</code></td>
<td align="left">尝试等待<code>timeout</code>时间去获取下一个<code>LatchKey</code></td>
</tr>
<tr>
<td align="left"><code>WatchKey take()</code></td>
<td align="left">获取下一个<code>LatchKey</code>,如果没有<code>LatchKey</code>发生就一直等待。</td>
</tr>
</tbody></table>
<ul>
<li>如果程序需要一直监控,则应该选择使用<code>take()</code>方法;</li>
<li>如果程序只需要监控指定时间,则可考虑使用<code>poll()</code>方法。</li>
</ul>
<h2 id="程序WatchService监控文件变化"><a href="#程序WatchService监控文件变化" class="headerlink" title="程序WatchService监控文件变化"></a>程序WatchService监控文件变化</h2><p>下面程序示范了使用<code>WatchService</code>来监控<code>D</code>盘根路径下文件的变化</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.nio.file.FileSystems;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Paths;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.StandardWatchEventKinds;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.WatchEvent;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.WatchKey;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.WatchService;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WatchServiceTest</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span></span><br><span class="line">        <span class="keyword">throws</span> Exception</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 获取文件系统的WatchService对象</span></span><br><span class="line">        <span class="type">WatchService</span> <span class="variable">watchService</span> <span class="operator">=</span> FileSystems.getDefault()</span><br><span class="line">            .newWatchService();</span><br><span class="line">        <span class="comment">// 为D:盘根路径注册监听</span></span><br><span class="line">        Paths.get(<span class="string">&quot;D:/&quot;</span>).register(watchService</span><br><span class="line">            , StandardWatchEventKinds.ENTRY_CREATE</span><br><span class="line">            , StandardWatchEventKinds.ENTRY_MODIFY</span><br><span class="line">            , StandardWatchEventKinds.ENTRY_DELETE);</span><br><span class="line">        <span class="keyword">while</span>(<span class="literal">true</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// 获取下一个文件改动事件</span></span><br><span class="line">            <span class="type">WatchKey</span> <span class="variable">key</span> <span class="operator">=</span> watchService.take();    <span class="comment">//①</span></span><br><span class="line">            <span class="keyword">for</span> (WatchEvent&lt;?&gt; event : key.pollEvents())</span><br><span class="line">            &#123;</span><br><span class="line">                System.out.println(event.context() +<span class="string">&quot; 文件发生了 &quot;</span></span><br><span class="line">                    + event.kind()+ <span class="string">&quot;事件！&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 重设WatchKey</span></span><br><span class="line">            <span class="type">boolean</span> <span class="variable">valid</span> <span class="operator">=</span> key.reset();</span><br><span class="line">            <span class="comment">// 如果重设失败，退出监听</span></span><br><span class="line">            <span class="keyword">if</span> (!valid)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上面程序使用了一个死循环重复获取<strong>D盘</strong>根路径下文件的变化,程序在①号代码处试图获取下一个<code>LatchKey</code>,如果没有发生就等待。因此<strong>D盘根路径下每次文件的变化都会被该程序监听到</strong>。<br>运行该程序,然后在D:盘下新建一个文件,再删除该文件,将看到如下的输出。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">新建文本文档.txt 文件发生了 ENTRY_CREATE事件！</span><br><span class="line">新建文本文档.txt 文件发生了 ENTRY_DELETE事件！</span><br><span class="line">test.txt 文件发生了 ENTRY_CREATE事件！</span><br><span class="line">test.txt 文件发生了 ENTRY_DELETE事件！</span><br></pre></td></tr></table></figure>
<p>通过使用<code>WatchService</code>可以非常优雅地监控指定目录下文件的变化,至于文件发生变化后,程序应该进行哪些处理,这就取决于程序的业务需要了</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://lanlan2017.github.io/JavaReadingNotes/5599d3e6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/JavaReadingNotes/images/avatar.gif">
      <meta itemprop="name" content="蓝蓝">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="蓝蓝站点">
      <meta itemprop="description" content="好好学习，天天向上">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 蓝蓝站点">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/JavaReadingNotes/5599d3e6/" class="post-title-link" itemprop="url">15.10.2 使用FileVisitor遍历文件和目录</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-01-06 11:08:42" itemprop="dateCreated datePublished" datetime="2020-01-06T11:08:42+08:00">2020-01-06</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2020-03-15 08:15:11" itemprop="dateModified" datetime="2020-03-15T08:15:11+08:00">2020-03-15</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/1-%E7%96%AF%E7%8B%82Java%E8%AE%B2%E4%B9%89-%E7%AC%AC4%E7%89%88/" itemprop="url" rel="index"><span itemprop="name">1 疯狂Java讲义 (第4版)</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/1-%E7%96%AF%E7%8B%82Java%E8%AE%B2%E4%B9%89-%E7%AC%AC4%E7%89%88/%E7%AC%AC15%E7%AB%A0-%E8%BE%93%E5%85%A5%E8%BE%93%E5%87%BA/" itemprop="url" rel="index"><span itemprop="name">第15章 输入输出</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/1-%E7%96%AF%E7%8B%82Java%E8%AE%B2%E4%B9%89-%E7%AC%AC4%E7%89%88/%E7%AC%AC15%E7%AB%A0-%E8%BE%93%E5%85%A5%E8%BE%93%E5%87%BA/15-10-Java7%E7%9A%84NIO-2/" itemprop="url" rel="index"><span itemprop="name">15.10 Java7的NIO.2</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
    <span class="post-meta-item-icon">
      <i class="far fa-comment"></i>
    </span>
    <span class="post-meta-item-text">Waline：</span>
  
    <a title="waline" href="/JavaReadingNotes/5599d3e6/#waline-comments" itemprop="discussionUrl">
      <span class="post-comments-count waline-comment-count" id="/JavaReadingNotes/5599d3e6/" data-xid="/JavaReadingNotes/5599d3e6/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>2.5k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>2 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="15-10-2-使用FileVisitor遍历文件和目录"><a href="#15-10-2-使用FileVisitor遍历文件和目录" class="headerlink" title="15.10.2 使用FileVisitor遍历文件和目录"></a>15.10.2 使用FileVisitor遍历文件和目录</h1><p>在以前的<code>Java</code>版本中,如果程序要遍历指定目录下的所有文件和子目录,则只能使用递归进行遍历,但这种方式不仅复杂,而且灵活性也不高。<br>有了<code>Files</code>工具类的帮助,现在可以用更优雅的方式来遍历文件和子目录。</p>
<h2 id="walkFileTree方法"><a href="#walkFileTree方法" class="headerlink" title="walkFileTree方法"></a>walkFileTree方法</h2><p><code>Files</code>类提供了如下两个方法来遍历文件和子目录</p>
<table>
<thead>
<tr>
<th align="left"><code>Files</code>类的<code>walkFileTree</code>方法</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>static Path walkFileTree(Path start, FileVisitor&lt;? super Path&gt; visitor)</code></td>
<td align="left">遍历<code>start</code>路径下的所有文件和子目录。</td>
</tr>
<tr>
<td align="left"><code>static Path walkFileTree(Path start, Set&lt;FileVisitOption&gt; options, int maxDepth, FileVisitor&lt;? super Path&gt; visitor)</code></td>
<td align="left">与上一个方法的功能类似。该方法最多遍历<code>maxDepth</code>深度的文件。</td>
</tr>
</tbody></table>
<h2 id="文件访问器FileVisitor"><a href="#文件访问器FileVisitor" class="headerlink" title="文件访问器FileVisitor"></a>文件访问器FileVisitor</h2><p>上面两个方法都需要<code>FileVisitor</code>参数,<code>FileVisitor</code>代表一个<strong>文件访问器</strong>,<code>walkFileTree()</code>方法会自动遍历<code>start</code>路径下的所有文件和子目录,遍历文件和子目录都会“触发”<code>FileVisitor</code>中相应的方法。</p>
<h2 id="FileVisitor接口方法"><a href="#FileVisitor接口方法" class="headerlink" title="FileVisitor接口方法"></a>FileVisitor接口方法</h2><p><code>FileVisitor</code>接口中定义了如下4个方法。</p>
<table>
<thead>
<tr>
<th align="left"><code>FileVisitor</code>方法</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>FileVisitResult postVisitDirectory(T dir, IOException exc)</code></td>
<td align="left"><strong>访问子目录之后</strong>触发该方法</td>
</tr>
<tr>
<td align="left"><code>FileVisitResult preVisitDirectory(T dir, BasicFileAttributes attrs)</code></td>
<td align="left"><strong>访问子目录之前</strong>触发该方法</td>
</tr>
<tr>
<td align="left"><code>FileVisitResult visitFile(T file, BasicFileAttributes attrs)</code></td>
<td align="left"><strong>访问<code>file</code>文件时</strong>触发该方法</td>
</tr>
<tr>
<td align="left"><code>FileVisitResult visitFileFailed(T file, IOException exc)</code></td>
<td align="left"><strong>访问<code>file</code>文件失败时</strong>触发该方法</td>
</tr>
</tbody></table>
<h2 id="FileVisitResult枚举"><a href="#FileVisitResult枚举" class="headerlink" title="FileVisitResult枚举"></a>FileVisitResult枚举</h2><p>上面4个方法都返回一个<code>FileVisitResult</code>对象,<strong><code>FileVisitResult</code>是一个枚举类,代表了访问之后的后续行为</strong></p>
<table>
<thead>
<tr>
<th align="left"><code>FileVisitResult</code>枚举值</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>CONTINUE</code></td>
<td align="left">代表“继续访问”的后续行为</td>
</tr>
<tr>
<td align="left"><code>SKIP_SIBLINGS</code></td>
<td align="left">代表“继续访问”的后续行为,但不访问该文件或目录的<code>兄弟</code>文件或目录</td>
</tr>
<tr>
<td align="left"><code>SKIP_SUBTREE</code></td>
<td align="left">代表“继续访问”的后续行为,但不访问该文件或目录的<code>子目录</code>树。</td>
</tr>
<tr>
<td align="left"><code>TERMINATE</code></td>
<td align="left">代表“中止访问”的后续行为</td>
</tr>
</tbody></table>
<h2 id="SimpleFileVisitor实现类"><a href="#SimpleFileVisitor实现类" class="headerlink" title="SimpleFileVisitor实现类"></a>SimpleFileVisitor实现类</h2><p>实际编程时没必要为<code>FileVisitor</code>的4个方法都提供实现,可以通过继承<code>FileVisitor</code>的实现类<code>SimpleFileVisitor</code>来实现自己的“文件访问器”,这样就根据需要、选择性地重写指定方法了。</p>
<h2 id="程序-使用FileVisitor遍历目录-查找指定文件"><a href="#程序-使用FileVisitor遍历目录-查找指定文件" class="headerlink" title="程序 使用FileVisitor遍历目录 查找指定文件"></a>程序 使用FileVisitor遍历目录 查找指定文件</h2><p>如下程序示范了使用<code>FileVisitor</code>来遍历文件和子目录。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.*;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.attribute.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FileVisitorTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">// 遍历 G:\Desktop\随书源码\疯狂Java讲义(第4版)光盘\codes\15\ 目录下的所有文件和子目录</span></span><br><span class="line">        Files.walkFileTree(Paths.get(<span class="string">&quot;G:&quot;</span>, <span class="string">&quot;Desktop&quot;</span>, <span class="string">&quot;随书源码&quot;</span>, <span class="string">&quot;疯狂Java讲义(第4版)光盘&quot;</span>, <span class="string">&quot;codes&quot;</span>, <span class="string">&quot;15&quot;</span>),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">SimpleFileVisitor</span>&lt;Path&gt;() &#123;</span><br><span class="line">                    <span class="comment">// 访问文件时候触发该方法</span></span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="keyword">public</span> FileVisitResult <span class="title function_">visitFile</span><span class="params">(Path file, BasicFileAttributes attrs)</span> </span><br><span class="line">                            <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">                        System.out.println(<span class="string">&quot;正在访问--文件:&quot;</span> + file);</span><br><span class="line">                        <span class="comment">// 找到了FileInputStreamTest.java文件</span></span><br><span class="line">                        <span class="keyword">if</span> (file.endsWith(<span class="string">&quot;FileInputStreamTest.java&quot;</span>)) &#123;</span><br><span class="line">                            System.out.println(<span class="string">&quot;--已经找到目标文件--&quot;</span>);</span><br><span class="line">                            <span class="comment">// 停止</span></span><br><span class="line">                            <span class="keyword">return</span> FileVisitResult.TERMINATE;</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="comment">// 继续</span></span><br><span class="line">                        <span class="keyword">return</span> FileVisitResult.CONTINUE;</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    <span class="comment">// 开始访问目录时触发该方法</span></span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="keyword">public</span> FileVisitResult <span class="title function_">preVisitDirectory</span><span class="params">(Path dir, BasicFileAttributes attrs)</span> </span><br><span class="line">                            <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">                        System.out.println(<span class="string">&quot;正在访问  路径:&quot;</span> + dir);</span><br><span class="line">                        <span class="comment">// 继续</span></span><br><span class="line">                        <span class="keyword">return</span> FileVisitResult.CONTINUE;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上面程序中使用了<code>Files</code>工具类的<code>walkFileTree()</code>方法来遍历<code>G:\Desktop\随书源码\疯狂Java讲义(第4版)光盘\codes\15\</code>目录下的所有文件和子目录,如果找到的文件以“<code>FileInputStreamTest.java</code>”结尾,则程序停止遍历:这就<strong>实现了对指定目录进行搜索,直到找到指定文件为止</strong>。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://lanlan2017.github.io/JavaReadingNotes/4261f404/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/JavaReadingNotes/images/avatar.gif">
      <meta itemprop="name" content="蓝蓝">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="蓝蓝站点">
      <meta itemprop="description" content="好好学习，天天向上">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 蓝蓝站点">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/JavaReadingNotes/4261f404/" class="post-title-link" itemprop="url">15.10 Java7的NIO.2 15.10.1 Path Paths和Files核心API</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-01-06 10:34:37" itemprop="dateCreated datePublished" datetime="2020-01-06T10:34:37+08:00">2020-01-06</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2020-03-15 08:15:11" itemprop="dateModified" datetime="2020-03-15T08:15:11+08:00">2020-03-15</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/1-%E7%96%AF%E7%8B%82Java%E8%AE%B2%E4%B9%89-%E7%AC%AC4%E7%89%88/" itemprop="url" rel="index"><span itemprop="name">1 疯狂Java讲义 (第4版)</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/1-%E7%96%AF%E7%8B%82Java%E8%AE%B2%E4%B9%89-%E7%AC%AC4%E7%89%88/%E7%AC%AC15%E7%AB%A0-%E8%BE%93%E5%85%A5%E8%BE%93%E5%87%BA/" itemprop="url" rel="index"><span itemprop="name">第15章 输入输出</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/1-%E7%96%AF%E7%8B%82Java%E8%AE%B2%E4%B9%89-%E7%AC%AC4%E7%89%88/%E7%AC%AC15%E7%AB%A0-%E8%BE%93%E5%85%A5%E8%BE%93%E5%87%BA/15-10-Java7%E7%9A%84NIO-2/" itemprop="url" rel="index"><span itemprop="name">15.10 Java7的NIO.2</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
    <span class="post-meta-item-icon">
      <i class="far fa-comment"></i>
    </span>
    <span class="post-meta-item-text">Waline：</span>
  
    <a title="waline" href="/JavaReadingNotes/4261f404/#waline-comments" itemprop="discussionUrl">
      <span class="post-comments-count waline-comment-count" id="/JavaReadingNotes/4261f404/" data-xid="/JavaReadingNotes/4261f404/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>12k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>11 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="15-10-Java7的NIO-2"><a href="#15-10-Java7的NIO-2" class="headerlink" title="15.10 Java7的NIO.2"></a>15.10 Java7的NIO.2</h1><p><code>Java7</code>对原有的<code>NIO</code>进行了重大改进,改进主要包括如下两方面的内容。</p>
<ul>
<li>提供了全面的文件<code>IO</code>和文件系统访问支持。</li>
<li>基于异步<code>Channel</code>的<code>IO</code>。</li>
</ul>
<p>第一个改进表现为<code>Java7</code>新增的<code>java.nio.file</code>包及各个子包;<br>第二个改进表现为<code>Java7</code>在<code>java.nio.channels</code>包下增加了多个以<code>Asynchronous</code>开头的<code>Channel</code>接口和类。<code>Java7</code>把这种改进称为<code>NIO.2</code>,本章先详细介绍<code>NIO</code>的第二个改进。</p>
<h1 id="15-1-0-1-Path-Paths和Files核心API"><a href="#15-1-0-1-Path-Paths和Files核心API" class="headerlink" title="15.1.0.1 Path Paths和Files核心API"></a>15.1.0.1 Path Paths和Files核心API</h1><p>早期的<code>Java</code>只提供了一个<code>File</code>类来访问文件系统,但<code>File</code>类的功能比较有限,它不能利用特定文件系统的特性,<code>File</code>所提供的方法的性能也不高。而且,其大多数方法在出错时仅返回失败,并不会提供异常信息</p>
<h2 id="Path接口"><a href="#Path接口" class="headerlink" title="Path接口"></a>Path接口</h2><p><code>NIO.2</code>为了弥补这种不足,引入了一个<code>Path</code>接口,<strong><code>Path</code>接口代表一个平台无关的平台路径</strong>。</p>
<h3 id="Path接口方法"><a href="#Path接口方法" class="headerlink" title="Path接口方法"></a>Path接口方法</h3><table>
<thead>
<tr>
<th align="left">方法</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>Path getRoot()</code></td>
<td align="left">Returns the root component of this path as a Path object, or null if this path does not have a root component.</td>
</tr>
<tr>
<td align="left"><code>Path toAbsolutePath()</code></td>
<td align="left">Returns a Path object representing the absolute path of this path.</td>
</tr>
<tr>
<td align="left"><code>Path getName(int index)</code></td>
<td align="left">Returns a name element of this path as a Path object.</td>
</tr>
<tr>
<td align="left"><code>int getNameCount()</code></td>
<td align="left">返回<code>Path</code>路径所包含的路径名的数量,例如<code>g:\publishl\codes</code>调用该方法就会返回3。</td>
</tr>
</tbody></table>
<h2 id="工具类"><a href="#工具类" class="headerlink" title="工具类"></a>工具类</h2><p>除此之外,<code>NIO.2</code>还提供了<code>Files</code>、<code>Paths</code>两个工具类,其中</p>
<ul>
<li><code>Files</code>包含了大量静态的工具方法来操作文件;</li>
<li><code>Paths</code>则包含了两个返回<code>Path</code>的静态工厂方法。</li>
</ul>
<h3 id="工具类命名规则"><a href="#工具类命名规则" class="headerlink" title="工具类命名规则"></a>工具类命名规则</h3><p><code>Files</code>和<code>Paths</code>两个工具类非常符合<code>Java</code>一贯的命名风格,比如前面介绍的操作数组的工具类为<code>Arrays</code>,操作集合的工具类为<code>Collections</code>,这种一致的命名风格可以让读者快速了解这些工具类的用途。</p>
<h2 id="Paths工具类方法"><a href="#Paths工具类方法" class="headerlink" title="Paths工具类方法"></a>Paths工具类方法</h2><table>
<thead>
<tr>
<th align="left"><code>Paths</code>接口方法</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>static Path get(String first, String... more)</code></td>
<td align="left">Converts a path string, or a sequence of strings that when joined form a path string, to a Path.</td>
</tr>
<tr>
<td align="left"><code>static Path get(URI uri)</code></td>
<td align="left">Converts the given URI to a Path object.</td>
</tr>
</tbody></table>
<p>第一个<code>get</code>方法会将给定的多个字符串连缀成路径,比如<code>Paths.get(&quot;g:&quot;,&quot;publish&quot;,&quot;codes&quot;)</code>就返回<code>g:\publish\codes</code>路径。</p>
<h2 id="程序-Path接口Paths工具类示例"><a href="#程序-Path接口Paths工具类示例" class="headerlink" title="程序 Path接口Paths工具类示例"></a>程序 Path接口Paths工具类示例</h2><p>下面程序简单示范了<code>Path</code>接口的功能和用法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.nio.file.Path;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Paths;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PathTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">// 以当前路径来创建Path对象</span></span><br><span class="line">        <span class="type">Path</span> <span class="variable">path</span> <span class="operator">=</span> Paths.get(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;path里包含的路径数量：&quot;</span> + path.getNameCount());</span><br><span class="line">        System.out.println(<span class="string">&quot;path的根路径：&quot;</span> + path.getRoot());</span><br><span class="line">        <span class="comment">// 获取path对应的绝对路径。</span></span><br><span class="line">        <span class="type">Path</span> <span class="variable">absolutePath</span> <span class="operator">=</span> path.toAbsolutePath();</span><br><span class="line">        System.out.println(absolutePath);</span><br><span class="line">        <span class="comment">// 获取绝对路径的根路径</span></span><br><span class="line">        System.out.println(<span class="string">&quot;absolutePath的根路径：&quot;</span> + absolutePath.getRoot());</span><br><span class="line">        <span class="comment">// 获取绝对路径所包含的路径数量</span></span><br><span class="line">        System.out.println(<span class="string">&quot;absolutePath里包含的路径数量：&quot;</span> + absolutePath.getNameCount());</span><br><span class="line">        System.out.println(absolutePath.getName(<span class="number">3</span>));</span><br><span class="line">        <span class="comment">// 以多个String来构建Path对象</span></span><br><span class="line">        <span class="type">Path</span> <span class="variable">path2</span> <span class="operator">=</span> Paths.get(<span class="string">&quot;g:&quot;</span>, <span class="string">&quot;publish&quot;</span>, <span class="string">&quot;codes&quot;</span>);</span><br><span class="line">        System.out.println(path2);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Files工具类"><a href="#Files工具类" class="headerlink" title="Files工具类"></a>Files工具类</h2><p><code>Files</code>类是一个高度封装的工具类,它提供了大量的工具方法来完成文件<strong>复制</strong>、<strong>读取文件内容</strong>、<strong>写入文件内容</strong>等功能,这些原本需要程序员通过<code>IO</code>操作才能完成的功能,现在<code>Files</code>类只要一个工具方法即可。读者应该熟练掌握<code>Files</code>工具类的用法,它所包含的工具方法可以大大地简化文件<code>IO</code>。</p>
<h3 id="流操作"><a href="#流操作" class="headerlink" title="流操作"></a>流操作</h3><p><code>Java8</code>进一步增强了<code>Files</code>工具类的功能,允许开发者使用<code>Stream API</code>来操作文件目录和文件内容。</p>
<h3 id="copy方法"><a href="#copy方法" class="headerlink" title="copy方法"></a>copy方法</h3><table>
<thead>
<tr>
<th align="left">方法</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>static long copy(InputStream in, Path target, CopyOption... options)</code></td>
<td align="left">Copies all bytes from an input stream to a file.</td>
</tr>
<tr>
<td align="left"><code>static long copy(Path source, OutputStream out)</code></td>
<td align="left">Copies all bytes from a file to an output stream.</td>
</tr>
<tr>
<td align="left"><code>static Path copy(Path source, Path target, CopyOption... options)</code></td>
<td align="left">Copy a file to a target file.</td>
</tr>
</tbody></table>
<h3 id="判断方法"><a href="#判断方法" class="headerlink" title="判断方法"></a>判断方法</h3><h4 id="是否可读可写可执行"><a href="#是否可读可写可执行" class="headerlink" title="是否可读可写可执行"></a>是否可读可写可执行</h4><table>
<thead>
<tr>
<th align="left">方法</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>static boolean isReadable(Path path)</code></td>
<td align="left">Tests whether a file is readable.</td>
</tr>
<tr>
<td align="left"><code>static boolean isWritable(Path path)</code></td>
<td align="left">Tests whether a file is writable.</td>
</tr>
<tr>
<td align="left"><code>static boolean isExecutable(Path path)</code></td>
<td align="left">Tests whether a file is executable.</td>
</tr>
</tbody></table>
<h4 id="是否隐藏-是否符号链接"><a href="#是否隐藏-是否符号链接" class="headerlink" title="是否隐藏 是否符号链接"></a>是否隐藏 是否符号链接</h4><table>
<thead>
<tr>
<th align="left">方法</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>static boolean isHidden(Path path)</code></td>
<td align="left">Tells whether or not a file is considered hidden.</td>
</tr>
<tr>
<td align="left"><code>static boolean isSymbolicLink(Path path)</code></td>
<td align="left">Tests whether a file is a symbolic link.</td>
</tr>
</tbody></table>
<h4 id="是否文件-是否目录-是否同一个文件"><a href="#是否文件-是否目录-是否同一个文件" class="headerlink" title="是否文件 是否目录 是否同一个文件"></a>是否文件 是否目录 是否同一个文件</h4><table>
<thead>
<tr>
<th align="left">方法</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>static boolean isDirectory(Path path, LinkOption... options)</code></td>
<td align="left">Tests whether a file is a directory.</td>
</tr>
<tr>
<td align="left"><code>static boolean isRegularFile(Path path, LinkOption... options)</code></td>
<td align="left">Tests whether a file is a regular file with opaque content.</td>
</tr>
<tr>
<td align="left"><code>static boolean isSameFile(Path path, Path path2)</code></td>
<td align="left">Tests if two paths locate the same file.</td>
</tr>
</tbody></table>
<h4 id="是否存在"><a href="#是否存在" class="headerlink" title="是否存在"></a>是否存在</h4><table>
<thead>
<tr>
<th align="left">方法</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>static boolean exists(Path path, LinkOption... options)</code></td>
<td align="left">Tests whether a file exists.</td>
</tr>
<tr>
<td align="left"><code>static boolean notExists(Path path, LinkOption... options)</code></td>
<td align="left">Tests whether the file located by this path does not exist.</td>
</tr>
</tbody></table>
<h3 id="read方法"><a href="#read方法" class="headerlink" title="read方法"></a>read方法</h3><h4 id="得到字节数组"><a href="#得到字节数组" class="headerlink" title="得到字节数组"></a>得到字节数组</h4><table>
<thead>
<tr>
<th align="left">方法</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>static byte[] readAllBytes(Path path)</code></td>
<td align="left">Reads all the bytes from a file.</td>
</tr>
</tbody></table>
<h4 id="得到字符串"><a href="#得到字符串" class="headerlink" title="得到字符串"></a>得到字符串</h4><table>
<thead>
<tr>
<th align="left">方法</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>static String readString(Path path)</code></td>
<td align="left">Reads all content from a file into a string, decoding from bytes to characters using the UTF-8 charset.</td>
</tr>
<tr>
<td align="left"><code>static String readString(Path path, Charset cs)</code></td>
<td align="left">Reads all characters from a file into a string, decoding from bytes to characters using the specified charset.</td>
</tr>
</tbody></table>
<h4 id="得到所有行"><a href="#得到所有行" class="headerlink" title="得到所有行"></a>得到所有行</h4><table>
<thead>
<tr>
<th align="left">方法</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>static List&lt;String&gt; readAllLines(Path path)</code></td>
<td align="left">Read all lines from a file.</td>
</tr>
<tr>
<td align="left"><code>static List&lt;String&gt; readAllLines(Path path, Charset cs)</code></td>
<td align="left">Read all lines from a file.</td>
</tr>
</tbody></table>
<h4 id="得到其他"><a href="#得到其他" class="headerlink" title="得到其他"></a>得到其他</h4><table>
<thead>
<tr>
<th align="left">方法</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>static &lt;A extends BasicFileAttributes&gt; A readAttributes(Path path, Class&lt;A&gt; type, LinkOption... options)</code></td>
<td align="left">Reads a file’s attributes as a bulk operation.</td>
</tr>
<tr>
<td align="left"><code>static Map&lt;String,​Object&gt; readAttributes(Path path, String attributes, LinkOption... options)</code></td>
<td align="left">Reads a set of file attributes as a bulk operation.</td>
</tr>
<tr>
<td align="left"><code>static Path readSymbolicLink(Path link)</code></td>
<td align="left">Reads the target of a symbolic link (optional operation).</td>
</tr>
</tbody></table>
<h3 id="create方法"><a href="#create方法" class="headerlink" title="create方法"></a>create方法</h3><h4 id="创建目录"><a href="#创建目录" class="headerlink" title="创建目录"></a>创建目录</h4><table>
<thead>
<tr>
<th align="left">方法</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>static Path createDirectories(Path dir, FileAttribute&lt;?&gt;... attrs)</code></td>
<td align="left">Creates a directory by creating all nonexistent parent directories first.</td>
</tr>
<tr>
<td align="left"><code>static Path createDirectory(Path dir, FileAttribute&lt;?&gt;... attrs)</code></td>
<td align="left">Creates a new directory.</td>
</tr>
</tbody></table>
<h4 id="创建文件"><a href="#创建文件" class="headerlink" title="创建文件"></a>创建文件</h4><table>
<thead>
<tr>
<th align="left">方法</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>static Path createFile(Path path, FileAttribute&lt;?&gt;... attrs)</code></td>
<td align="left">Creates a new and empty file, failing if the file already exists.</td>
</tr>
</tbody></table>
<h4 id="创建链接"><a href="#创建链接" class="headerlink" title="创建链接"></a>创建链接</h4><table>
<thead>
<tr>
<th align="left">方法</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>static Path createLink(Path link, Path existing)</code></td>
<td align="left">Creates a new link (directory entry) for an existing file (optional operation).</td>
</tr>
<tr>
<td align="left"><code>static Path createSymbolicLink(Path link, Path target, FileAttribute&lt;?&gt;... attrs)</code></td>
<td align="left">Creates a symbolic link to a target (optional operation).</td>
</tr>
</tbody></table>
<h4 id="创建临时目录"><a href="#创建临时目录" class="headerlink" title="创建临时目录"></a>创建临时目录</h4><table>
<thead>
<tr>
<th align="left">方法</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>static Path createTempDirectory(String prefix, FileAttribute&lt;?&gt;... attrs)</code></td>
<td align="left">Creates a new directory in the default temporary-file directory, using the given prefix to generate its name.</td>
</tr>
<tr>
<td align="left"><code>static Path createTempDirectory(Path dir, String prefix, FileAttribute&lt;?&gt;... attrs)</code></td>
<td align="left">Creates a new directory in the specified directory, using the given prefix to generate its name.</td>
</tr>
</tbody></table>
<h4 id="创建临时文件"><a href="#创建临时文件" class="headerlink" title="创建临时文件"></a>创建临时文件</h4><table>
<thead>
<tr>
<th align="left">方法</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>static Path createTempFile(String prefix, String suffix, FileAttribute&lt;?&gt;... attrs)</code></td>
<td align="left">Creates an empty file in the default temporary-file directory, using the given prefix and suffix to generate its name.</td>
</tr>
<tr>
<td align="left"><code>static Path createTempFile(Path dir, String prefix, String suffix, FileAttribute&lt;?&gt;... attrs)</code></td>
<td align="left">Creates a new empty file in the specified directory, using the given prefix and suffix strings to generate its name.</td>
</tr>
</tbody></table>
<h3 id="delete方法"><a href="#delete方法" class="headerlink" title="delete方法"></a>delete方法</h3><table>
<thead>
<tr>
<th align="left">方法</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>static void delete(Path path)</code></td>
<td align="left">Deletes a file.</td>
</tr>
<tr>
<td align="left"><code>static boolean deleteIfExists(Path path)</code></td>
<td align="left">Deletes a file if it exists.</td>
</tr>
</tbody></table>
<h3 id="set方法"><a href="#set方法" class="headerlink" title="set方法"></a>set方法</h3><table>
<thead>
<tr>
<th align="left">方法</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>static Path setAttribute(Path path, String attribute, Object value, LinkOption... options)</code></td>
<td align="left">Sets the value of a file attribute.</td>
</tr>
<tr>
<td align="left"><code>static Path setLastModifiedTime(Path path, FileTime time)</code></td>
<td align="left">Updates a file’s last modified time attribute.</td>
</tr>
<tr>
<td align="left"><code>static Path setOwner(Path path, UserPrincipal owner)</code></td>
<td align="left">Updates the file owner.</td>
</tr>
<tr>
<td align="left"><code>static Path setPosixFilePermissions(Path path, Set&lt;PosixFilePermission&gt; perms)</code></td>
<td align="left">Sets a file’s POSIX permissions.</td>
</tr>
</tbody></table>
<h3 id="get方法"><a href="#get方法" class="headerlink" title="get方法"></a>get方法</h3><table>
<thead>
<tr>
<th align="left">方法</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>static Object getAttribute(Path path, String attribute, LinkOption... options)</code></td>
<td align="left">Reads the value of a file attribute.</td>
</tr>
<tr>
<td align="left"><code>static FileTime getLastModifiedTime(Path path, LinkOption... options)</code></td>
<td align="left">Returns a file’s last modified time.</td>
</tr>
<tr>
<td align="left"><code>static UserPrincipal getOwner(Path path, LinkOption... options)</code></td>
<td align="left">Returns the owner of a file.</td>
</tr>
<tr>
<td align="left"><code>static Set&lt;PosixFilePermission&gt; getPosixFilePermissions(Path path, LinkOption... options)</code></td>
<td align="left">Returns a file’s POSIX file permissions.</td>
</tr>
<tr>
<td align="left"><code>static &lt;V extends FileAttributeView&gt; V getFileAttributeView(Path path, Class&lt;V&gt; type, LinkOption... options)</code></td>
<td align="left">Returns a file attribute view of a given type.</td>
</tr>
<tr>
<td align="left"><code>static FileStore getFileStore(Path path)</code></td>
<td align="left">Returns the FileStore representing the file store where a file is located.</td>
</tr>
</tbody></table>
<h3 id="new方法"><a href="#new方法" class="headerlink" title="new方法"></a>new方法</h3><h4 id="newBufferedReader"><a href="#newBufferedReader" class="headerlink" title="newBufferedReader"></a>newBufferedReader</h4><table>
<thead>
<tr>
<th align="left">方法</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>static BufferedReader newBufferedReader(Path path)</code></td>
<td align="left">Opens a file for reading, returning a BufferedReader to read text from the file in an efficient manner.</td>
</tr>
<tr>
<td align="left"><code>static BufferedReader newBufferedReader(Path path, Charset cs)</code></td>
<td align="left">Opens a file for reading, returning a BufferedReader that may be used to read text from the file in an efficient manner.</td>
</tr>
</tbody></table>
<h4 id="newBufferedWriter"><a href="#newBufferedWriter" class="headerlink" title="newBufferedWriter"></a>newBufferedWriter</h4><table>
<thead>
<tr>
<th align="left">方法</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>static BufferedWriter newBufferedWriter(Path path, Charset cs, OpenOption... options)</code></td>
<td align="left">Opens or creates a file for writing, returning a BufferedWriter that may be used to write text to the file in an efficient manner.</td>
</tr>
<tr>
<td align="left"><code>static BufferedWriter newBufferedWriter(Path path, OpenOption... options)</code></td>
<td align="left">Opens or creates a file for writing, returning a BufferedWriter to write text to the file in an efficient manner.</td>
</tr>
</tbody></table>
<h4 id="newByteChannel"><a href="#newByteChannel" class="headerlink" title="newByteChannel"></a>newByteChannel</h4><table>
<thead>
<tr>
<th align="left">方法</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>static SeekableByteChannel newByteChannel(Path path, OpenOption... options)</code></td>
<td align="left">Opens or creates a file, returning a seekable byte channel to access the file.</td>
</tr>
<tr>
<td align="left"><code>static SeekableByteChannel newByteChannel(Path path, Set&lt;? extends OpenOption&gt; options, FileAttribute&lt;?&gt;... attrs)</code></td>
<td align="left">Opens or creates a file, returning a seekable byte channel to access the file.</td>
</tr>
</tbody></table>
<h4 id="newDirectoryStream"><a href="#newDirectoryStream" class="headerlink" title="newDirectoryStream"></a>newDirectoryStream</h4><table>
<thead>
<tr>
<th align="left">方法</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>static DirectoryStream&lt;Path&gt; newDirectoryStream(Path dir)</code></td>
<td align="left">Opens a directory, returning a DirectoryStream to iterate over all entries in the directory.</td>
</tr>
<tr>
<td align="left"><code>static DirectoryStream&lt;Path&gt; newDirectoryStream(Path dir, String glob)</code></td>
<td align="left">Opens a directory, returning a DirectoryStream to iterate over the entries in the directory.</td>
</tr>
<tr>
<td align="left"><code>static DirectoryStream&lt;Path&gt; newDirectoryStream(Path dir, DirectoryStream.Filter&lt;? super Path&gt; filter)</code></td>
<td align="left">Opens a directory, returning a DirectoryStream to iterate over the entries in the directory.</td>
</tr>
</tbody></table>
<h4 id="newInputStream"><a href="#newInputStream" class="headerlink" title="newInputStream"></a>newInputStream</h4><table>
<thead>
<tr>
<th align="left">方法</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>static InputStream newInputStream(Path path, OpenOption... options)</code></td>
<td align="left">Opens a file, returning an input stream to read from the file.</td>
</tr>
<tr>
<td align="left"><code>static OutputStream newOutputStream(Path path, OpenOption... options)</code></td>
<td align="left">Opens or creates a file, returning an output stream that may be used to write bytes to the file.</td>
</tr>
</tbody></table>
<h3 id="write方法"><a href="#write方法" class="headerlink" title="write方法"></a>write方法</h3><h4 id="write"><a href="#write" class="headerlink" title="write"></a>write</h4><table>
<thead>
<tr>
<th align="left">方法</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>static Path write(Path path, byte[] bytes, OpenOption... options)</code></td>
<td align="left">Writes bytes to a file.</td>
</tr>
<tr>
<td align="left"><code>static Path write(Path path, Iterable&lt;? extends CharSequence&gt; lines, Charset cs, OpenOption... options)</code></td>
<td align="left">Write lines of text to a file.</td>
</tr>
<tr>
<td align="left"><code>static Path write(Path path, Iterable&lt;? extends CharSequence&gt; lines, OpenOption... options)</code></td>
<td align="left">Write lines of text to a file.</td>
</tr>
</tbody></table>
<h4 id="writeString"><a href="#writeString" class="headerlink" title="writeString"></a>writeString</h4><table>
<thead>
<tr>
<th align="left">方法</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>static Path writeString(Path path, CharSequence csq, Charset cs, OpenOption... options)</code></td>
<td align="left">Write a CharSequence to a file.</td>
</tr>
<tr>
<td align="left"><code>static Path writeString(Path path, CharSequence csq, OpenOption... options)</code></td>
<td align="left">Write a CharSequence to a file.</td>
</tr>
</tbody></table>
<h3 id="walk方法"><a href="#walk方法" class="headerlink" title="walk方法"></a>walk方法</h3><h4 id="walk"><a href="#walk" class="headerlink" title="walk"></a>walk</h4><table>
<thead>
<tr>
<th align="left">方法</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>static Stream&lt;Path&gt; walk(Path start, int maxDepth, FileVisitOption... options)</code></td>
<td align="left">Return a Stream that is lazily populated with Path by walking the file tree rooted at a given starting file.</td>
</tr>
<tr>
<td align="left"><code>static Stream&lt;Path&gt; walk(Path start, FileVisitOption... options)</code></td>
<td align="left">Return a Stream that is lazily populated with Path by walking the file tree rooted at a given starting file.</td>
</tr>
</tbody></table>
<h4 id="walkFileTree"><a href="#walkFileTree" class="headerlink" title="walkFileTree"></a>walkFileTree</h4><table>
<thead>
<tr>
<th align="left">方法</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>static Path walkFileTree(Path start, FileVisitor&lt;? super Path&gt; visitor)</code></td>
<td align="left">Walks a file tree.</td>
</tr>
<tr>
<td align="left"><code>static Path walkFileTree(Path start, Set&lt;FileVisitOption&gt; options, int maxDepth, FileVisitor&lt;? super Path&gt; visitor)</code></td>
<td align="left">Walks a file tree.</td>
</tr>
</tbody></table>
<h3 id="返回流的方法"><a href="#返回流的方法" class="headerlink" title="返回流的方法"></a>返回流的方法</h3><h4 id="walk-1"><a href="#walk-1" class="headerlink" title="walk"></a>walk</h4><table>
<thead>
<tr>
<th align="left">方法</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>static Stream&lt;Path&gt; walk(Path start, int maxDepth, FileVisitOption... options)</code></td>
<td align="left">Return a Stream that is lazily populated with Path by walking the file tree rooted at a given starting file.</td>
</tr>
<tr>
<td align="left"><code>static Stream&lt;Path&gt; walk(Path start, FileVisitOption... options)</code></td>
<td align="left">Return a Stream that is lazily populated with Path by walking the file tree rooted at a given starting file.</td>
</tr>
</tbody></table>
<h4 id="find"><a href="#find" class="headerlink" title="find"></a>find</h4><table>
<thead>
<tr>
<th align="left">方法</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>static Stream&lt;Path&gt; find(Path start, int maxDepth, BiPredicate&lt;Path,​BasicFileAttributes&gt; matcher, FileVisitOption... options)</code></td>
<td align="left">Return a Stream that is lazily populated with Path by searching for files in a file tree rooted at a given starting file.</td>
</tr>
</tbody></table>
<h4 id="lines"><a href="#lines" class="headerlink" title="lines"></a>lines</h4><table>
<thead>
<tr>
<th align="left">方法</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>static Stream&lt;String&gt; lines(Path path)</code></td>
<td align="left">Read all lines from a file as a Stream.</td>
</tr>
<tr>
<td align="left"><code>static Stream&lt;String&gt; lines(Path path, Charset cs)</code></td>
<td align="left">Read all lines from a file as a Stream.</td>
</tr>
</tbody></table>
<h4 id="list方法"><a href="#list方法" class="headerlink" title="list方法"></a>list方法</h4><table>
<thead>
<tr>
<th align="left">方法</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>static Stream&lt;Path&gt; list(Path dir)</code></td>
<td align="left">Return a lazily populated Stream, the elements of which are the entries in the directory.</td>
</tr>
</tbody></table>
<h3 id="其他方法"><a href="#其他方法" class="headerlink" title="其他方法"></a>其他方法</h3><table>
<thead>
<tr>
<th align="left">方法</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>static Path move(Path source, Path target, CopyOption... options)</code></td>
<td align="left">Move or rename a file to a target file.</td>
</tr>
<tr>
<td align="left"><code>static String probeContentType(Path path)</code></td>
<td align="left">Probes the content type of a file.</td>
</tr>
<tr>
<td align="left"><code>static long size(Path path)</code></td>
<td align="left">Returns the size of a file (in bytes).</td>
</tr>
</tbody></table>
<h2 id="程序-Files工具类示例"><a href="#程序-Files工具类示例" class="headerlink" title="程序 Files工具类示例"></a>程序 Files工具类示例</h2><p><code>Files</code>是一个操作文件的工具类,它提供了大量便捷的工具方法,下面程序简单示范了<code>Files</code>类的用法。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.nio.file.*;</span><br><span class="line"><span class="keyword">import</span> java.nio.charset.*;</span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FilesTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">// 复制文件</span></span><br><span class="line">        Files.copy(Paths.get(<span class="string">&quot;FilesTest.java&quot;</span>), <span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;a.txt&quot;</span>));</span><br><span class="line">        <span class="comment">// 判断FilesTest.java文件是否为隐藏文件</span></span><br><span class="line">        System.out.println(<span class="string">&quot;FilesTest.java是否为隐藏文件：&quot;</span> </span><br><span class="line">            + Files.isHidden(Paths.get(<span class="string">&quot;FilesTest.java&quot;</span>)));</span><br><span class="line">        <span class="comment">// 一次性读取FilesTest.java文件的所有行</span></span><br><span class="line">        List&lt;String&gt; lines = Files.readAllLines(Paths.get(<span class="string">&quot;FilesTest.java&quot;</span>), Charset.forName(<span class="string">&quot;gbk&quot;</span>));</span><br><span class="line">        System.out.println(lines);</span><br><span class="line">        <span class="comment">// 判断指定文件的大小</span></span><br><span class="line">        System.out.println(<span class="string">&quot;FilesTest.java的大小为：&quot;</span> + Files.size(Paths.get(<span class="string">&quot;FilesTest.java&quot;</span>)));</span><br><span class="line">        List&lt;String&gt; poem = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        poem.add(<span class="string">&quot;水晶潭底银鱼跃&quot;</span>);</span><br><span class="line">        poem.add(<span class="string">&quot;清徐风中碧竿横&quot;</span>);</span><br><span class="line">        <span class="comment">// 直接将多个字符串内容写入指定文件中</span></span><br><span class="line">        Files.write(Paths.get(<span class="string">&quot;pome.txt&quot;</span>), poem, Charset.forName(<span class="string">&quot;gbk&quot;</span>));</span><br><span class="line">        <span class="comment">// 使用Java 8新增的Stream API列出当前目录下所有文件和子目录</span></span><br><span class="line">        Files.list(Paths.get(<span class="string">&quot;.&quot;</span>)).forEach(path -&gt; System.out.println(path));</span><br><span class="line">        <span class="comment">// 使用Java 8新增的Stream API读取文件内容</span></span><br><span class="line">        Files.lines(Paths.get(<span class="string">&quot;FilesTest.java&quot;</span>), Charset.forName(<span class="string">&quot;gbk&quot;</span>))</span><br><span class="line">            .forEach(line -&gt; System.out.println(line));</span><br><span class="line">        <span class="type">FileStore</span> <span class="variable">cStore</span> <span class="operator">=</span> Files.getFileStore(Paths.get(<span class="string">&quot;C:&quot;</span>));</span><br><span class="line">        <span class="comment">// 判断C盘的总空间，可用空间</span></span><br><span class="line">        System.out.println(<span class="string">&quot;C:共有空间：&quot;</span> + cStore.getTotalSpace());</span><br><span class="line">        System.out.println(<span class="string">&quot;C:可用空间：&quot;</span> + cStore.getUsableSpace());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上面程序简单示范了<code>Files</code>工具类的用法。</p>
<p>上面示例程序中①号代码使用<code>Stream API</code>列出了指定路径下的所有文件和目录;②号代码则使用了<code>Stream API</code>读取文件内容。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://lanlan2017.github.io/JavaReadingNotes/3b9051b1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/JavaReadingNotes/images/avatar.gif">
      <meta itemprop="name" content="蓝蓝">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="蓝蓝站点">
      <meta itemprop="description" content="好好学习，天天向上">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 蓝蓝站点">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/JavaReadingNotes/3b9051b1/" class="post-title-link" itemprop="url">15.9.5 文件锁</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-01-06 09:59:23" itemprop="dateCreated datePublished" datetime="2020-01-06T09:59:23+08:00">2020-01-06</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2020-03-15 08:15:12" itemprop="dateModified" datetime="2020-03-15T08:15:12+08:00">2020-03-15</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/1-%E7%96%AF%E7%8B%82Java%E8%AE%B2%E4%B9%89-%E7%AC%AC4%E7%89%88/" itemprop="url" rel="index"><span itemprop="name">1 疯狂Java讲义 (第4版)</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/1-%E7%96%AF%E7%8B%82Java%E8%AE%B2%E4%B9%89-%E7%AC%AC4%E7%89%88/%E7%AC%AC15%E7%AB%A0-%E8%BE%93%E5%85%A5%E8%BE%93%E5%87%BA/" itemprop="url" rel="index"><span itemprop="name">第15章 输入输出</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/1-%E7%96%AF%E7%8B%82Java%E8%AE%B2%E4%B9%89-%E7%AC%AC4%E7%89%88/%E7%AC%AC15%E7%AB%A0-%E8%BE%93%E5%85%A5%E8%BE%93%E5%87%BA/15-9-NIO/" itemprop="url" rel="index"><span itemprop="name">15.9 NIO</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
    <span class="post-meta-item-icon">
      <i class="far fa-comment"></i>
    </span>
    <span class="post-meta-item-text">Waline：</span>
  
    <a title="waline" href="/JavaReadingNotes/3b9051b1/#waline-comments" itemprop="discussionUrl">
      <span class="post-comments-count waline-comment-count" id="/JavaReadingNotes/3b9051b1/" data-xid="/JavaReadingNotes/3b9051b1/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>2.1k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>2 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="15-9-5-文件锁"><a href="#15-9-5-文件锁" class="headerlink" title="15.9.5 文件锁"></a>15.9.5 文件锁</h1><p>文件锁在操作系统中是很平常的事情,如果多个运行的程序需要并发修改同一个文件时,程序之间需要某种机制来进行通信,<strong>使用文件锁可以有效地阻止多个进程并发修改同一个文件</strong>,所以现在的大部分操作系统都提供了文件锁的功能。<br>文件锁控制文件的全部或部分字节的访问,但文件锁在不同的操作系统中差别较大,所以早期的<code>JDK</code>版本并未提供文件锁的支持。<strong>从<code>JDK1.4</code>的<code>NIO</code>开始,<code>Java</code>开始提供文件锁的支持</strong>。</p>
<h2 id="FileLock"><a href="#FileLock" class="headerlink" title="FileLock"></a>FileLock</h2><p>在<code>NIO</code>中,<code>Java</code>提供了<code>FileLock</code>来支持文件锁定功能。</p>
<h2 id="如何获取FileLock"><a href="#如何获取FileLock" class="headerlink" title="如何获取FileLock"></a>如何获取FileLock</h2><h3 id="无参的lock和tryLock方法"><a href="#无参的lock和tryLock方法" class="headerlink" title="无参的lock和tryLock方法"></a>无参的lock和tryLock方法</h3><p>在<code>FileChannel</code>中提供的<code>lock()</code>和<code>tryLock()</code>两个方法可以获得文件锁<code>FileLock</code>对象,从而锁定文件。</p>
<table>
<thead>
<tr>
<th align="left"><code>FileChannel</code>获取<code>FileLock</code>的方法</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>FileLock lock()</code></td>
<td align="left">获取FileChannel对应的<strong>排它锁</strong></td>
</tr>
<tr>
<td align="left"><code>FileLock tryLock()</code></td>
<td align="left">获取FileChannel对应的<strong>排它锁</strong></td>
</tr>
</tbody></table>
<h3 id="lock方法和tryLock方法的区别"><a href="#lock方法和tryLock方法的区别" class="headerlink" title="lock方法和tryLock方法的区别"></a>lock方法和tryLock方法的区别</h3><p><code>lock()</code>和<code>tryLock()</code>方法存在区别:</p>
<ul>
<li>当<code>lock()</code>试图锁定某个文件时,如果无法得到文件锁,程序将一直阻塞;</li>
<li>而<code>tryLock()</code>是尝试锁定文件,它将直接返回而不是阻塞,如果获得了文件锁,该方法则返回该文件锁,否则将返回<code>null</code></li>
</ul>
<h3 id="部分锁定"><a href="#部分锁定" class="headerlink" title="部分锁定"></a>部分锁定</h3><p>如果<code>FileChannel</code>只想锁定文件的部分内容,而不是锁定全部内容,则可以使用如下的<code>lock()</code>或<code>tryLock()</code>方法。</p>
<table>
<thead>
<tr>
<th align="left">方法</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>abstract FileLock lock(long position, long size, boolean shared)</code></td>
<td align="left">Acquires a lock on the given region of this channel’s file.</td>
</tr>
<tr>
<td align="left"><code>abstract FileLock tryLock(long position, long size, boolean shared)</code></td>
<td align="left">Attempts to acquire a lock on the given region of this channel’s file.</td>
</tr>
</tbody></table>
<h3 id="共享锁"><a href="#共享锁" class="headerlink" title="共享锁"></a>共享锁</h3><p>带参数的<code>lock</code>和<code>tryLock</code>方法的参数<code>shared</code>为<code>true</code>时,表明该锁是一个<strong>共享锁</strong>,它将**允许多个进程来读取该文件,但阻止其他进程获得对该文件的<mark>排他锁</mark>**。(<strong>共享锁:别人可读不可写</strong>)</p>
<h3 id="排他锁"><a href="#排他锁" class="headerlink" title="排他锁"></a>排他锁</h3><p>带参数的<code>lock</code>和<code>tryLock</code>方法的参数<code>shared</code>为<code>false</code>时,表明该锁是一个<strong>排他锁</strong>,它将锁住对该文件的<strong>读写</strong>。(<strong>排它锁:别人不可读,也不可写</strong>)</p>
<p><strong>直接使用<code>lock()</code>或<code>tryLock()</code>方法获取的文件锁是排他锁</strong></p>
<h3 id="判断是否是共享锁"><a href="#判断是否是共享锁" class="headerlink" title="判断是否是共享锁"></a>判断是否是共享锁</h3><p>程序可以通过调用<code>FileLock</code>的<code>isShared()</code>方法来判断它获得的锁是否为共享锁。</p>
<table>
<thead>
<tr>
<th align="left"><code>FileLock</code>的<code>isShared</code>方法</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>boolean isShared()</code></td>
<td align="left">Tells whether this lock is shared.</td>
</tr>
</tbody></table>
<h2 id="释放文件锁"><a href="#释放文件锁" class="headerlink" title="释放文件锁"></a>释放文件锁</h2><p>处理完文件后通过<code>FileLock</code>的<code>release()</code>方法释放文件锁。</p>
<table>
<thead>
<tr>
<th align="left"><code>FileLock</code>的<code>release</code>方法</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>abstract void release()</code></td>
<td align="left">Releases this lock.</td>
</tr>
</tbody></table>
<h2 id="程序-使用FileLock"><a href="#程序-使用FileLock" class="headerlink" title="程序 使用FileLock"></a>程序 使用FileLock</h2><p>下面程序示范了使用<code>FileLock</code>锁定文件的示例。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.nio.channels.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FileLockTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> (</span><br><span class="line">                <span class="comment">// 使用FileOutputStream获取FileChannel</span></span><br><span class="line">                <span class="type">FileChannel</span> <span class="variable">channel</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;a.txt&quot;</span>).getChannel()) &#123;</span><br><span class="line">            <span class="comment">// 使用非阻塞式方式对指定文件加锁</span></span><br><span class="line">            <span class="type">FileLock</span> <span class="variable">lock</span> <span class="operator">=</span> channel.tryLock();</span><br><span class="line">            <span class="comment">// 程序暂停10s</span></span><br><span class="line">            Thread.sleep(<span class="number">10000</span>);</span><br><span class="line">            <span class="comment">// 释放锁</span></span><br><span class="line">            lock.release();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上面程序中的代码:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">FileLock</span> <span class="variable">lock</span> <span class="operator">=</span> channel.tryLock();</span><br></pre></td></tr></table></figure>
<p>用于对指定文件加锁,接着程序调用<code>Thread.sleep(10000)</code>暂停了10秒后才释放文件锁,<strong>因此在这10秒之内,其他程序无法对<code>a.txt</code>文件进行修改</strong>。<br><strong>文件锁虽然可以用于控制并发访问,但对于高并发访问的情形,还是推荐使用数据库来保存程序信息,而不是使用文件</strong>。</p>
<h2 id="文件锁需要注点的地方"><a href="#文件锁需要注点的地方" class="headerlink" title="文件锁需要注点的地方"></a>文件锁需要注点的地方</h2><p>关于文件锁还需要指出如下几点。</p>
<ul>
<li>在某些平台上,文件锁仅仅是建议性的,并不是强制性的。这意味着<strong>即使一个程序不能获得文件锁,它也可以对该文件进行读写</strong>。</li>
<li>在某些平台上,不能同步地锁定一个文件并把它映射到内存中</li>
<li>文件锁是由<code>Java</code>虚拟机所持有的,如果两个<code>Java</code>程序使用同一个<code>Java</code>虚拟机运行,则它们不能对同一个文件进行加锁。</li>
<li>在某些平台上关闭<code>FileChannel</code>时,会释放<code>Java</code>虚拟机在该文件上的所有锁,因此应该避免对同一个被锁定的文件打开多个<code>FileChannel</code>。</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://lanlan2017.github.io/JavaReadingNotes/d06315c7/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/JavaReadingNotes/images/avatar.gif">
      <meta itemprop="name" content="蓝蓝">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="蓝蓝站点">
      <meta itemprop="description" content="好好学习，天天向上">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 蓝蓝站点">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/JavaReadingNotes/d06315c7/" class="post-title-link" itemprop="url">15.9.4 字符集和Charset</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-01-06 09:22:38" itemprop="dateCreated datePublished" datetime="2020-01-06T09:22:38+08:00">2020-01-06</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2020-03-15 08:15:12" itemprop="dateModified" datetime="2020-03-15T08:15:12+08:00">2020-03-15</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/1-%E7%96%AF%E7%8B%82Java%E8%AE%B2%E4%B9%89-%E7%AC%AC4%E7%89%88/" itemprop="url" rel="index"><span itemprop="name">1 疯狂Java讲义 (第4版)</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/1-%E7%96%AF%E7%8B%82Java%E8%AE%B2%E4%B9%89-%E7%AC%AC4%E7%89%88/%E7%AC%AC15%E7%AB%A0-%E8%BE%93%E5%85%A5%E8%BE%93%E5%87%BA/" itemprop="url" rel="index"><span itemprop="name">第15章 输入输出</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/1-%E7%96%AF%E7%8B%82Java%E8%AE%B2%E4%B9%89-%E7%AC%AC4%E7%89%88/%E7%AC%AC15%E7%AB%A0-%E8%BE%93%E5%85%A5%E8%BE%93%E5%87%BA/15-9-NIO/" itemprop="url" rel="index"><span itemprop="name">15.9 NIO</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
    <span class="post-meta-item-icon">
      <i class="far fa-comment"></i>
    </span>
    <span class="post-meta-item-text">Waline：</span>
  
    <a title="waline" href="/JavaReadingNotes/d06315c7/#waline-comments" itemprop="discussionUrl">
      <span class="post-comments-count waline-comment-count" id="/JavaReadingNotes/d06315c7/" data-xid="/JavaReadingNotes/d06315c7/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>4.4k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>4 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="15-9-4-字符集和Charset"><a href="#15-9-4-字符集和Charset" class="headerlink" title="15.9.4 字符集和Charset"></a>15.9.4 字符集和Charset</h2><p>前面已经提到:计算机里的文件、数据、图片文件只是一种表面现象,所有文件在底层都是二进制文件,即全部都是字节码。<br>图片、音乐文件暂时先不说,对于文本文件而言,<strong>之所以可以看到一个个的字符,是因为系统将底层的二进制序列转换成字符的缘故</strong>。<br>在这个过程中涉及两个概念:编码<code>Encode</code>)和解码(<code>Decode</code>).</p>
<h2 id="编码解码"><a href="#编码解码" class="headerlink" title="编码解码"></a>编码解码</h2><h3 id="编码"><a href="#编码" class="headerlink" title="编码"></a>编码</h3><p>把<strong>明文的字符序列</strong>转换成计算机理解的<strong>二进制序列</strong>称为<strong>编码</strong></p>
<h3 id="解码"><a href="#解码" class="headerlink" title="解码"></a>解码</h3><p>把<strong>二进制序列</strong>转换成普通人能看懂的<strong>明文字符串序列</strong>称为<strong>解码</strong></p>
<h3 id="编码解码示意图"><a href="#编码解码示意图" class="headerlink" title="编码解码示意图"></a>编码解码示意图</h3><p>如图15.21所示<br><img data-src="https://raw.githubusercontent.com/lanlan2017/images/master/CrazyJavaHandout4/Chapter/15/15.9.4/1.png" alt="这里有一张图片"></p>
<h2 id="Encode和Decode术语起源"><a href="#Encode和Decode术语起源" class="headerlink" title="Encode和Decode术语起源"></a>Encode和Decode术语起源</h2><p><code>Encode</code>和<code>Decode</code>两个专业术语来自于早期的电报、情报等。</p>
<ul>
<li>把明文的消息转换成普通人看不懂的电码(或密码)的过程就是<code>Encode</code>,</li>
<li>将电码(或密码)翻译成明文的消息则被称为<code>Decode</code>。</li>
</ul>
<p>后来计算机也采用了这两个概念,其作用已经发生了变化</p>
<p>计算机底层是没有文本文件、图片文件之分的,它只是忠实地记录每个文件的二进制序列而已。</p>
<ul>
<li>当需要保存文本文件时,程序必须先把文件中的每个字符翻译成二进制序列;</li>
<li>当需要读取文本文件时,程序必须把二进制序列转换为一个个的字符。</li>
</ul>
<p><code>Java</code>默认使用<code>Unicode</code>字符集,但很多操作系统并不使用<code>Unicode</code>字符集,那么当从系统中读取数据到<code>Java</code>程序中时,就可能出现乱码等问题</p>
<h2 id="Charset类方法"><a href="#Charset类方法" class="headerlink" title="Charset类方法"></a>Charset类方法</h2><p><strong><code>JDK1.4</code>提供了<code>Charset</code>来处理<mark>字节序列</mark>和<mark>字符序列(字符串)</mark>之间的转换关系</strong>,该类包含了用于创建解码器和编码器的方法,还提供了获取<code>Charset</code>所支持字符集的方法,<code>Charset</code>类是不可变的</p>
<h3 id="获取JDK支持的全部字符集"><a href="#获取JDK支持的全部字符集" class="headerlink" title="获取JDK支持的全部字符集"></a>获取JDK支持的全部字符集</h3><p><code>Charset</code>类提供了一个<code>availableCharsets()</code>静态方法来获取当前<code>JDK</code>所支持的所有字符集。</p>
<table>
<thead>
<tr>
<th align="left">方法</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>static SortedMap&lt;String,​Charset&gt; availableCharsets()</code></td>
<td align="left">Constructs a sorted map from canonical charset names to charset objects.</td>
</tr>
</tbody></table>
<h3 id="获取本地系统的文件编码格式"><a href="#获取本地系统的文件编码格式" class="headerlink" title="获取本地系统的文件编码格式"></a>获取本地系统的文件编码格式</h3><p>可以使用<code>System</code>类的<code>getProperty()</code>方法来访问本地系统的文件编码格式,文件编码格式的属性名为<code>file.encoding</code>。</p>
<h3 id="程序-获取JDK支持的全部字符集"><a href="#程序-获取JDK支持的全部字符集" class="headerlink" title="程序 获取JDK支持的全部字符集"></a>程序 获取JDK支持的全部字符集</h3><p>所以程序可以使用如下程序来获取该<code>JDK</code>所支持的全部字符集。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.nio.charset.*;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CharsetTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 获取Java支持的全部字符集</span></span><br><span class="line">        SortedMap&lt;String, Charset&gt; map = Charset.availableCharsets();</span><br><span class="line">        <span class="keyword">for</span> (String alias : map.keySet()) &#123;</span><br><span class="line">            <span class="comment">// 输出字符集的别名和对应的Charset对象</span></span><br><span class="line">            System.out.println(alias + <span class="string">&quot;-----&gt;&quot;</span> + map.get(alias));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 输出本地系统的文件编码格式</span></span><br><span class="line">        System.out.println(System.getProperty(<span class="string">&quot;file.encoding&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上面程序中的获取了当前<code>Java</code>所支持的全部字符集,并使用遍历方式打印了所有字符集的别名(字符集的字符串名称)和<code>Charset</code>对象。<br>从上面程序可以看出,<strong>每个字符集都有一个字符串名称,也被称为字符串别名</strong>。</p>
<h3 id="中国常用字符集的字符串别名"><a href="#中国常用字符集的字符串别名" class="headerlink" title="中国常用字符集的字符串别名"></a>中国常用字符集的字符串别名</h3><p>对于中国的程序员而言,下面几个字符串别名是常用的。</p>
<table>
<thead>
<tr>
<th align="left">字符集</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>GBK</code></td>
<td align="left">简体中文字符集。</td>
</tr>
<tr>
<td align="left"><code>BIG5</code></td>
<td align="left">繁体中文字符集。</td>
</tr>
<tr>
<td align="left"><code>ISO-8859-1</code></td>
<td align="left"><code>ISO</code>拉丁字母表<code>No.1</code>,也叫做<code>ISO-LATIN-1</code>。</td>
</tr>
<tr>
<td align="left"><code>UTF-8</code></td>
<td align="left"><code>8</code>位<code>UCS</code>转换格式。</td>
</tr>
<tr>
<td align="left"><code>UTF-16BE</code></td>
<td align="left"><code>16</code>位<code>UCS</code>转换格式,<code>Big-endian</code>(最低地址存放高位字节)字节顺序。</td>
</tr>
<tr>
<td align="left"><code>UTF-16LE</code></td>
<td align="left"><code>16</code>位<code>UCS</code>转换格式,<code>Little-endian</code>(最高地址存放低位字节)字节顺序。</td>
</tr>
<tr>
<td align="left"><code>UTF-16</code></td>
<td align="left"><code>16</code>位<code>UCS</code>转换格式,字节顺序由可选的字节顺序标记来标识。</td>
</tr>
</tbody></table>
<h3 id="创建Charset对象-forName方法"><a href="#创建Charset对象-forName方法" class="headerlink" title="创建Charset对象 forName方法"></a>创建Charset对象 forName方法</h3><p>一旦知道了字符集的别名之后,程序就可以调用<code>Charset</code>的<code>forName()</code>方法:</p>
<table>
<thead>
<tr>
<th align="left">方法</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>static Charset forName(String charsetName)</code></td>
<td align="left">Returns a charset object for the named charset.</td>
</tr>
</tbody></table>
<p>来创建对应的<code>Charset</code>对象,<code>forName</code>方法的参数就是相应字符集的别名。<br>例如如下代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Charset</span> <span class="variable">gbk</span> <span class="operator">=</span> Charset.forName(<span class="string">&quot;GBK&quot;</span>);</span><br><span class="line"><span class="type">Charset</span> <span class="variable">iso88591</span> <span class="operator">=</span> Charset.forName(<span class="string">&quot;ISO-8859-1&quot;</span>);</span><br></pre></td></tr></table></figure>
<h3 id="StandardCharsets类获取Charset对象"><a href="#StandardCharsets类获取Charset对象" class="headerlink" title="StandardCharsets类获取Charset对象"></a>StandardCharsets类获取Charset对象</h3><p><code>Java7</code>新增了一个<code>StandardCharsets</code>类,该类里包含了<code>ISO_8859_1</code>、<code>UTF_8</code>、<code>UTF_16</code>等类变量,这些类变量代表了最常用的字符集对应的<code>Charset</code>对象:</p>
<table>
<thead>
<tr>
<th align="left"><code>StandardCharsets</code>的类变量</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>static Charset ISO_8859_1</code></td>
<td align="left">ISO Latin Alphabet No. 1, a.k.a.</td>
</tr>
<tr>
<td align="left"><code>static Charset US_ASCII</code></td>
<td align="left">Seven-bit ASCII, a.k.a.</td>
</tr>
<tr>
<td align="left"><code>static Charset UTF_16</code></td>
<td align="left">Sixteen-bit UCS Transformation Format,<br> byte order identified by an optional byte-order mark</td>
</tr>
<tr>
<td align="left"><code>static Charset UTF_16BE</code></td>
<td align="left">Sixteen-bit UCS Transformation Format, big-endian byte order</td>
</tr>
<tr>
<td align="left"><code>static Charset UTF_16LE</code></td>
<td align="left">Sixteen-bit UCS Transformation Format, little-endian byte order</td>
</tr>
<tr>
<td align="left"><code>static Charset UTF_8</code></td>
<td align="left">Eight-bit UCS Transformation Format</td>
</tr>
</tbody></table>
<h3 id="获取解码器-编码器"><a href="#获取解码器-编码器" class="headerlink" title="获取解码器 编码器"></a>获取解码器 编码器</h3><p>获得了<code>Charset</code>对象之后,就可以通过该对象的<code>newDecoder()</code>、<code>newEncoder()</code>这两个方法分别返回该<code>Charset</code>的解码器<code>CharsetDecoder</code>和编码器<code>CharsetEncoder</code>对象。</p>
<table>
<thead>
<tr>
<th align="left">方法</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>abstract CharsetDecoder newDecoder()</code></td>
<td align="left">Constructs a new decoder for this charset.</td>
</tr>
<tr>
<td align="left"><code>abstract CharsetEncoder newEncoder()</code></td>
<td align="left">Constructs a new encoder for this charset.</td>
</tr>
</tbody></table>
<h3 id="字符序列-转-字节序列-编码"><a href="#字符序列-转-字节序列-编码" class="headerlink" title="字符序列 转 字节序列(编码)"></a>字符序列 转 字节序列(编码)</h3><p>调用编码器<code>CharsetEncoder</code>的<code>encode()</code>方法就可以将<code>CharBuffer</code>或<code>String</code>(字符序列)转换成<code>ByteBuffer</code>(字节序列)。</p>
<h3 id="字节序列-转-字符序列-解码"><a href="#字节序列-转-字符序列-解码" class="headerlink" title="字节序列 转 字符序列(解码)"></a>字节序列 转 字符序列(解码)</h3><p>调用解码器<code>CharsetDecoder</code>的<code>decode()</code>方法就可以将<code>ByteBuffer</code>(字节序列)转换成<code>CharBuffer</code>(字符序列),</p>
<h3 id="程序-ByteBuffer转CharBuffer-CharBuffer转ByteBuffer"><a href="#程序-ByteBuffer转CharBuffer-CharBuffer转ByteBuffer" class="headerlink" title="程序 ByteBuffer转CharBuffer CharBuffer转ByteBuffer"></a>程序 ByteBuffer转CharBuffer CharBuffer转ByteBuffer</h3><p>如下程序使用了<code>CharsetEncoder</code>和<code>CharsetDecoder</code>完成了<code>ByteBuffer</code>和<code>CharBuffer</code>之间的转换</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.nio.*;</span><br><span class="line"><span class="keyword">import</span> java.nio.charset.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CharsetTransform</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">// 创建简体中文对应的Charset</span></span><br><span class="line">        <span class="type">Charset</span> <span class="variable">cn</span> <span class="operator">=</span> Charset.forName(<span class="string">&quot;GBK&quot;</span>);</span><br><span class="line">        <span class="comment">// 获取cn对象对应的编码器和解码器</span></span><br><span class="line">        <span class="type">CharsetEncoder</span> <span class="variable">cnEncoder</span> <span class="operator">=</span> cn.newEncoder();</span><br><span class="line">        <span class="type">CharsetDecoder</span> <span class="variable">cnDecoder</span> <span class="operator">=</span> cn.newDecoder();</span><br><span class="line">        <span class="comment">// 创建一个CharBuffer对象</span></span><br><span class="line">        <span class="type">CharBuffer</span> <span class="variable">cbuff</span> <span class="operator">=</span> CharBuffer.allocate(<span class="number">8</span>);</span><br><span class="line">        <span class="comment">// 写入Buffer</span></span><br><span class="line">        cbuff.put(<span class="string">&#x27;孙&#x27;</span>);</span><br><span class="line">        cbuff.put(<span class="string">&#x27;悟&#x27;</span>);</span><br><span class="line">        cbuff.put(<span class="string">&#x27;空&#x27;</span>);</span><br><span class="line">        <span class="comment">// 准备读取Buffer</span></span><br><span class="line">        cbuff.flip();</span><br><span class="line">        <span class="comment">// 解码 将CharBuffer中的字符序列转换成字节序列</span></span><br><span class="line">        <span class="type">ByteBuffer</span> <span class="variable">bbuff</span> <span class="operator">=</span> cnEncoder.encode(cbuff);</span><br><span class="line">        <span class="comment">// 循环访问ByteBuffer中的每个字节</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; bbuff.capacity(); i++) &#123;</span><br><span class="line">            System.out.print(bbuff.get(i) + <span class="string">&quot; &quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 编码 将ByteBuffer的数据解码成字符序列</span></span><br><span class="line">        System.out.println(<span class="string">&quot;\n&quot;</span> + cnDecoder.decode(bbuff));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上面程序中的分别实现了将<code>CharBuffer</code>转换成<code>ByteBuffer</code>,将<code>ByteBuffer</code>转换成<code>CharBuffer</code>的功能。</p>
<h3 id="Charset中编码和解码的快捷方法"><a href="#Charset中编码和解码的快捷方法" class="headerlink" title="Charset中编码和解码的快捷方法"></a>Charset中编码和解码的快捷方法</h3><p>实际上,<code>Charset</code>类也提供了如下三个方法。</p>
<table>
<thead>
<tr>
<th align="left">方法</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>CharBuffer decode(ByteBuffer bb)</code></td>
<td align="left">将<code>ByteBuffer</code>中的<strong>字节序列</strong>转换成<strong>字符序列</strong>的便捷方法。</td>
</tr>
<tr>
<td align="left"><code>ByteBuffer encode(String str)</code></td>
<td align="left">将<code>CharBuffer</code>中的<strong>字符序列</strong>转换成<strong>字节序列</strong>的便捷方法。</td>
</tr>
<tr>
<td align="left"><code>ByteBuffer encode(CharBuffer cb)</code></td>
<td align="left">将<code>String</code>中的<strong>字符序列</strong>转换成<strong>字节序列</strong>的便捷方法。</td>
</tr>
</tbody></table>
<p>也就是说,获取了<code>Charset</code>对象后,如果仅仅需要进行简单的编码、解码操作,其实无须创建<code>CharsetEncoder</code>和<code>CharsetDecoder</code>对象,直接调用<code>Charset</code>的<code>encode()</code>和<code>decode()</code>方法进行编码、解码即可。</p>
<h2 id="String类-字符串-转-字节序列-编码"><a href="#String类-字符串-转-字节序列-编码" class="headerlink" title="String类 字符串 转 字节序列(编码)"></a>String类 字符串 转 字节序列(编码)</h2><p>在<code>String</code>类里也提供了一个<code>getBytes(String charset)</code>方法,该方法返回**<code>byte</code>数组**,该方法也是使用指定的字符集将<strong>字符串</strong>转换成<strong>字节序列</strong></p>
<!-- CrazyJavaHandout4/Chapter/15/15.9.4/ -->

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://lanlan2017.github.io/JavaReadingNotes/233df632/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/JavaReadingNotes/images/avatar.gif">
      <meta itemprop="name" content="蓝蓝">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="蓝蓝站点">
      <meta itemprop="description" content="好好学习，天天向上">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 蓝蓝站点">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/JavaReadingNotes/233df632/" class="post-title-link" itemprop="url">15.9.3 使用Channel</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-01-06 08:07:48" itemprop="dateCreated datePublished" datetime="2020-01-06T08:07:48+08:00">2020-01-06</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2020-03-15 08:15:12" itemprop="dateModified" datetime="2020-03-15T08:15:12+08:00">2020-03-15</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/1-%E7%96%AF%E7%8B%82Java%E8%AE%B2%E4%B9%89-%E7%AC%AC4%E7%89%88/" itemprop="url" rel="index"><span itemprop="name">1 疯狂Java讲义 (第4版)</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/1-%E7%96%AF%E7%8B%82Java%E8%AE%B2%E4%B9%89-%E7%AC%AC4%E7%89%88/%E7%AC%AC15%E7%AB%A0-%E8%BE%93%E5%85%A5%E8%BE%93%E5%87%BA/" itemprop="url" rel="index"><span itemprop="name">第15章 输入输出</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/1-%E7%96%AF%E7%8B%82Java%E8%AE%B2%E4%B9%89-%E7%AC%AC4%E7%89%88/%E7%AC%AC15%E7%AB%A0-%E8%BE%93%E5%85%A5%E8%BE%93%E5%87%BA/15-9-NIO/" itemprop="url" rel="index"><span itemprop="name">15.9 NIO</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
    <span class="post-meta-item-icon">
      <i class="far fa-comment"></i>
    </span>
    <span class="post-meta-item-text">Waline：</span>
  
    <a title="waline" href="/JavaReadingNotes/233df632/#waline-comments" itemprop="discussionUrl">
      <span class="post-comments-count waline-comment-count" id="/JavaReadingNotes/233df632/" data-xid="/JavaReadingNotes/233df632/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>5.2k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>5 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="15-9-3-使用Channel"><a href="#15-9-3-使用Channel" class="headerlink" title="15.9.3 使用Channel"></a>15.9.3 使用Channel</h1><h2 id="Channel与流对象的区别"><a href="#Channel与流对象的区别" class="headerlink" title="Channel与流对象的区别"></a>Channel与流对象的区别</h2><p><strong><code>Channel</code>类似于传统的流对象</strong>,但与传统的流对象有两个主要区别。</p>
<ol>
<li><strong><code>Channel</code>可以直接将指定文件的部分或全部直接映射成<code>Buffer</code></strong></li>
<li><strong>程序不能直接访问<code>Channel</code>中的数据</strong>,包括读取、写入都不行,<strong><code>Channel</code>只能与<code>Buffer</code>进行交互</strong>。也就是说:<ul>
<li><strong>如果要从<code>Channel</code>中取得数据,必须先用<code>Buffer</code>从<code>Channel</code>中取出一些数据,然后让程序从<code>Buffer</code>中取出这些数据</strong>;</li>
<li><strong>如果要将程序中的数据写入<code>Channel</code>,一样先让程序将数据放入<code>Buffer</code>中,程序再将<code>Buffer</code>里的数据写入<code>Channe</code>中</strong>。</li>
</ul>
</li>
</ol>
<h2 id="Channel分类"><a href="#Channel分类" class="headerlink" title="Channel分类"></a>Channel分类</h2><p><code>Java</code>为<code>Channel</code>接口提供了<code>DatagramChannel</code>、<code>FileChannel</code>、<code>Pipe.SinkChannel</code>、<code>Pipe.SourceChannel</code>、<code>SelectableChannel</code>、<code>ServerSocketChannel</code>、<code>SocketChannel</code>等实现类,本节主要介绍<code>FileChannel</code>的用法。<br><strong>根据这些<code>Channel</code>的名字不难发现,新<code>IO</code>里的<code>Channel</code>是按功能来划分的</strong>,例如</p>
<ul>
<li><code>Pipe.SinkChannel</code>、<code>Pipe.SourceChannel</code>是用于支持<strong>线程之间通信</strong>的管道<code>Channel</code>;</li>
<li><code>ServerSocketChannel</code>、<code>SocketChannel</code>是用于支持**<code>TCP</code>网络通信**的<code>Channel</code>;</li>
<li><code>DatagramChannel</code>则是用于支持**<code>UDP</code>网络通信**的<code>Channel</code></li>
</ul>
<p>本书将会在第17章介绍网络通信编程的详细内容,如果需要掌握<code>ServerSocketChannel</code>,<code>SocketChannel</code>等<code>Channel</code>的用法,可以参考本书第17章。</p>
<h2 id="如何创建Channel"><a href="#如何创建Channel" class="headerlink" title="如何创建Channel"></a>如何创建Channel</h2><p><strong>所有的<code>Channel</code>都不应该通过构造器来直接创建,而是通过传统的节点<code>InputStream</code>、<code>OutputStream</code>的<code>getChannel()</code>方法来返回对应的<code>Channel</code></strong>,不同的节点流获得的<code>Channel</code>不一样。例如:</p>
<ul>
<li><code>FileInputStream</code>、<code>FileOutputStream</code>的<code>getChannel()</code>方法返回的是<code>FileChannel</code>,</li>
<li><code>PipedInputStream</code>和<code>PipedOutputStream</code>的<code>getChannel()</code>方法返回的是<code>Pipe.SinkChannel</code>、<code>Pipe.SourceChannel</code></li>
</ul>
<h2 id="Channel常用方法"><a href="#Channel常用方法" class="headerlink" title="Channel常用方法"></a>Channel常用方法</h2><p><code>Channel</code>中最常用的三类方法是<code>map()</code>、<code>read()</code>和<code>write()</code>,其中</p>
<ul>
<li><code>map()</code>方法用于将<code>Channel</code>对应的部分或全部数据映射成<code>ByteBuffer</code>;</li>
<li><code>read</code>或<code>write</code>方法都有一系列重载形式,这些方法用于从<code>Buffer</code>中读取数据或向<code>Buffer</code>中写入数据。</li>
</ul>
<h3 id="FileChannel的map方法"><a href="#FileChannel的map方法" class="headerlink" title="FileChannel的map方法"></a>FileChannel的map方法</h3><p><code>map()</code>方法的方法签名为:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">abstract</span> MappedByteBuffer <span class="title function_">map</span><span class="params">(FileChannel.MapMode mode, <span class="type">long</span> position, <span class="type">long</span> size)</span></span><br></pre></td></tr></table></figure>
<ul>
<li>第一个参数执行映射时的模式,分别有只读、读写等模式</li>
<li>而第二个、第三个参数用于控制将<code>Channel</code>的哪些数据映射成<code>ByteBuffer</code></li>
</ul>
<h2 id="程序-FileChannel示例"><a href="#程序-FileChannel示例" class="headerlink" title="程序 FileChannel示例"></a>程序 FileChannel示例</h2><p>下面程序示范了直接将<code>FileChannel</code>的全部数据映射成<code>ByteBuffer</code>的效果。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.nio.*;</span><br><span class="line"><span class="keyword">import</span> java.nio.channels.*;</span><br><span class="line"><span class="keyword">import</span> java.nio.charset.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FileChannelTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">File</span> <span class="variable">f</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;FileChannelTest.java&quot;</span>);</span><br><span class="line">        <span class="keyword">try</span> (</span><br><span class="line">                <span class="comment">// 创建FileInputStream，以该文件输入流创建FileChannel</span></span><br><span class="line">                <span class="type">FileChannel</span> <span class="variable">inChannel</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(f).getChannel();</span><br><span class="line">                <span class="comment">// 以文件输出流创建FileBuffer，用以控制输出</span></span><br><span class="line">                <span class="type">FileChannel</span> <span class="variable">outChannel</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;a.txt&quot;</span>).getChannel()) &#123;</span><br><span class="line">            <span class="comment">// 将FileChannel里的全部数据映射成ByteBuffer</span></span><br><span class="line">            <span class="type">MappedByteBuffer</span> <span class="variable">buffer</span> <span class="operator">=</span> </span><br><span class="line">                inChannel.map(FileChannel.MapMode.READ_ONLY, <span class="number">0</span>, f.length()); <span class="comment">// ①</span></span><br><span class="line">            <span class="comment">// 使用GBK的字符集来创建解码器</span></span><br><span class="line">            <span class="comment">// Charset charset = Charset.forName(&quot;GBK&quot;);</span></span><br><span class="line">            <span class="type">Charset</span> <span class="variable">charset</span> <span class="operator">=</span> Charset.forName(<span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line">            <span class="comment">// 直接将buffer里的数据全部输出到outChannel中</span></span><br><span class="line">            outChannel.write(buffer); <span class="comment">// ②</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">// 再次调用buffer的clear()方法，复原limit、position的位置,准备再次读取Buffer</span></span><br><span class="line">            buffer.clear();</span><br><span class="line">            <span class="comment">// 创建解码器(CharsetDecoder)对象</span></span><br><span class="line">            <span class="type">CharsetDecoder</span> <span class="variable">decoder</span> <span class="operator">=</span> charset.newDecoder();</span><br><span class="line">            <span class="comment">// 使用解码器将ByteBuffer转换成CharBuffer</span></span><br><span class="line">            <span class="type">CharBuffer</span> <span class="variable">charBuffer</span> <span class="operator">=</span> decoder.decode(buffer);</span><br><span class="line">            <span class="comment">// CharBuffer的toString方法可以获取对应的字符串</span></span><br><span class="line">            System.out.println(charBuffer);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException ex) &#123;</span><br><span class="line">            ex.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上面程序中分别使用<code>FileInputStream</code>、<code>FileOutputStream</code>来获取<code>FileChannel</code>,虽然<code>FileChannel</code>既可以读取也可以写入,</p>
<ul>
<li>但**<code>FileInputStream</code>获取的<code>FileChannel</code>只能读**,</li>
<li>而**<code>FileOutputStream</code>获取的<code>FileChannel</code>只能写**。</li>
</ul>
<p>程序中①号代码:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">MappedByteBuffer</span> <span class="variable">buffer</span> <span class="operator">=</span> </span><br><span class="line">    inChannel.map(FileChannel.MapMode.READ_ONLY, <span class="number">0</span>, f.length()); <span class="comment">// ①</span></span><br></pre></td></tr></table></figure>
<p>直接将指定<code>Channel</code>中的全部数据映射成<code>ByteBuffer</code>.<br>然后程序中②号代码:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">outChannel.write(buffer); <span class="comment">// ②</span></span><br></pre></td></tr></table></figure>
<p>直接将整个<code>ByteBuffer</code>的全部数据写入一个输出<code>FileChannel</code>中,这就完成了文件的复制.<br>程序后面部分为了能将<code>FileChannelTest.java</code>文件里的内容打印出来,使用了<code>Charset</code>类和<code>CharsetDecoder</code>类将<code>ByteBuffer</code>转换成<code>CharBuffer</code>关于<code>Charset</code>和<code>CharsetDecoder</code>下一节将会有更详细的介绍。</p>
<h2 id="程序-RandomAccessFile获取的Channel"><a href="#程序-RandomAccessFile获取的Channel" class="headerlink" title="程序 RandomAccessFile获取的Channel"></a>程序 RandomAccessFile获取的Channel</h2><p>不仅<code>InputStream</code>、<code>OutputStream</code>包含了<code>getChannel()</code>方法,在<code>RandomAccessFile</code>中也包含了一个<code>getChannel()</code>方法,<strong><code>RandomAccessFile</code>返回的<code>FileChannel</code>是只读的还是读写的,则取决于<code>RandomAccessFile</code>打开文件的模式</strong>。<br>例如,下面程序将会对<code>a.txt</code>文件的内容进行复制,追加在该文件后面。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.nio.*;</span><br><span class="line"><span class="keyword">import</span> java.nio.channels.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RandomFileChannelTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">File</span> <span class="variable">f</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;a.txt&quot;</span>);</span><br><span class="line">        <span class="keyword">try</span> (</span><br><span class="line">                <span class="comment">// 创建一个RandomAccessFile对象</span></span><br><span class="line">                <span class="type">RandomAccessFile</span> <span class="variable">raf</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RandomAccessFile</span>(f, <span class="string">&quot;rw&quot;</span>);</span><br><span class="line">                <span class="comment">// 获取RandomAccessFile对应的Channel</span></span><br><span class="line">                <span class="type">FileChannel</span> <span class="variable">randomChannel</span> <span class="operator">=</span> raf.getChannel()) &#123;</span><br><span class="line">            <span class="comment">// 将Channel中所有数据映射成ByteBuffer</span></span><br><span class="line">            <span class="type">ByteBuffer</span> <span class="variable">buffer</span> <span class="operator">=</span> randomChannel.map(FileChannel.MapMode.READ_ONLY, <span class="number">0</span>, f.length());</span><br><span class="line">            <span class="comment">// 把Channel的记录指针移动到最后</span></span><br><span class="line">            <span class="comment">// 代码1</span></span><br><span class="line">            randomChannel.position(f.length());</span><br><span class="line">            <span class="comment">// 将buffer中所有数据输出</span></span><br><span class="line">            randomChannel.write(buffer);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上面程序中的<strong>代码1</strong>:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">randomChannel.position(f.length());</span><br></pre></td></tr></table></figure>
<p>可以将<code>Channel</code>的记录指针移动到该<code>Channel</code>的最后,从而可以让程序将指定<code>ByteBuffer</code>的数据追加到该<code>Channel</code>的后面。每次运行上面程序,都会把<code>a.txt</code>文件的内容复制份,并将全部内容追加到该文件的后面。</p>
<h2 id="像传统IO那样使用Channel和Buffer读写文件"><a href="#像传统IO那样使用Channel和Buffer读写文件" class="headerlink" title="像传统IO那样使用Channel和Buffer读写文件"></a>像传统IO那样使用Channel和Buffer读写文件</h2><p>如果读者习惯了传统<code>IO</code>的“用竹筒多次重复取水”的过程,或者担心<code>Channel</code>对应的文件过大,使用<code>map()</code>方法一次将所有的文件内容映射到内存中引起性能下降,也可以使用<code>Channel</code>和<code>Buffer</code>传统的“用竹筒多次重复取水”的方式。<br>如下程序所示。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.nio.*;</span><br><span class="line"><span class="keyword">import</span> java.nio.channels.*;</span><br><span class="line"><span class="keyword">import</span> java.nio.charset.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ReadFile</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="keyword">try</span> (</span><br><span class="line">                <span class="comment">// 创建文件输入流</span></span><br><span class="line">                <span class="type">FileInputStream</span> <span class="variable">fis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;ReadFile.java&quot;</span>);</span><br><span class="line">                <span class="comment">// 创建一个FileChannel</span></span><br><span class="line">                <span class="type">FileChannel</span> <span class="variable">fcin</span> <span class="operator">=</span> fis.getChannel()) &#123;</span><br><span class="line">            <span class="comment">// 定义一个ByteBuffer对象，用于重复取水</span></span><br><span class="line">            <span class="type">ByteBuffer</span> <span class="variable">bbuff</span> <span class="operator">=</span> ByteBuffer.allocate(<span class="number">256</span>);</span><br><span class="line">            <span class="comment">// 将FileChannel中数据读取到ByteBuffer中</span></span><br><span class="line">            <span class="keyword">while</span> (fcin.read(bbuff) != -<span class="number">1</span>) &#123;</span><br><span class="line">                <span class="comment">// 准备读取Buffer中的数据</span></span><br><span class="line">                bbuff.flip();</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 创建Charset对象</span></span><br><span class="line">                <span class="comment">// Charset charset = Charset.forName(&quot;GBK&quot;);</span></span><br><span class="line">                <span class="type">Charset</span> <span class="variable">charset</span> <span class="operator">=</span> Charset.forName(<span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line">                <span class="comment">// 创建解码器(CharsetDecoder)对象</span></span><br><span class="line">                <span class="type">CharsetDecoder</span> <span class="variable">decoder</span> <span class="operator">=</span> charset.newDecoder();</span><br><span class="line">                <span class="comment">// 将ByteBuffer的内容转码</span></span><br><span class="line">                <span class="type">CharBuffer</span> <span class="variable">cbuff</span> <span class="operator">=</span> decoder.decode(bbuff);</span><br><span class="line">                System.out.print(cbuff);</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 将Buffer初始化，为下一次读取数据做准备</span></span><br><span class="line">                bbuff.clear();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上面代码虽然使用<code>FileChannel</code>和<code>Buffer</code>来读取文件,但处理方式和使用<code>InputStream</code>、<code>byte[]</code>来读取文件的方式几乎一样,都是采用“用竹筒多次重复取水”的方式。但因为<code>Buffer</code>提供了<code>fip()</code>和<code>clear()</code>两个方法,所以程序处理起来比较方便</p>
<h3 id="类似传统方式使用NIO步骤"><a href="#类似传统方式使用NIO步骤" class="headerlink" title="类似传统方式使用NIO步骤"></a>类似传统方式使用NIO步骤</h3><ul>
<li>读取数据到<code>Buffer</code>中</li>
<li><strong>每次读取数据后调用<code>fip()</code>方法</strong>将没有数据的区域“封印”起来,避免程序从<code>Buffer</code>中取出<code>null</code>值;</li>
<li>从<code>Buffer</code>中取出数据</li>
<li>数据取出后立即调用<code>clear()</code>方法将<code>Buffer</code>的<code>position</code>设0,为下次读取数据做准备。</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://lanlan2017.github.io/JavaReadingNotes/d63ba950/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/JavaReadingNotes/images/avatar.gif">
      <meta itemprop="name" content="蓝蓝">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="蓝蓝站点">
      <meta itemprop="description" content="好好学习，天天向上">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 蓝蓝站点">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/JavaReadingNotes/d63ba950/" class="post-title-link" itemprop="url">15.9.2 使用Buffer</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-01-06 04:35:02" itemprop="dateCreated datePublished" datetime="2020-01-06T04:35:02+08:00">2020-01-06</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2020-03-15 08:15:12" itemprop="dateModified" datetime="2020-03-15T08:15:12+08:00">2020-03-15</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/1-%E7%96%AF%E7%8B%82Java%E8%AE%B2%E4%B9%89-%E7%AC%AC4%E7%89%88/" itemprop="url" rel="index"><span itemprop="name">1 疯狂Java讲义 (第4版)</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/1-%E7%96%AF%E7%8B%82Java%E8%AE%B2%E4%B9%89-%E7%AC%AC4%E7%89%88/%E7%AC%AC15%E7%AB%A0-%E8%BE%93%E5%85%A5%E8%BE%93%E5%87%BA/" itemprop="url" rel="index"><span itemprop="name">第15章 输入输出</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/JavaReadingNotes/categories/1-%E7%96%AF%E7%8B%82Java%E8%AE%B2%E4%B9%89-%E7%AC%AC4%E7%89%88/%E7%AC%AC15%E7%AB%A0-%E8%BE%93%E5%85%A5%E8%BE%93%E5%87%BA/15-9-NIO/" itemprop="url" rel="index"><span itemprop="name">15.9 NIO</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
    <span class="post-meta-item-icon">
      <i class="far fa-comment"></i>
    </span>
    <span class="post-meta-item-text">Waline：</span>
  
    <a title="waline" href="/JavaReadingNotes/d63ba950/#waline-comments" itemprop="discussionUrl">
      <span class="post-comments-count waline-comment-count" id="/JavaReadingNotes/d63ba950/" data-xid="/JavaReadingNotes/d63ba950/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>7.8k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>7 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="15-9-2-使用Buffer"><a href="#15-9-2-使用Buffer" class="headerlink" title="15.9.2 使用Buffer"></a>15.9.2 使用Buffer</h1><p>从内部结构上来看,<code>Buffer</code>就像一个数组,它可以保存多个类型相同的数据。<code>Buffer</code>是一个抽象类,其最常用的子类是<code>ByteBuffer</code>,它可以在底层字节数组上进行<code>get/set</code>操作。除<code>ByteBuffer</code>之外,对应于其他基本数据类型(<code>boolean</code>除外)都有相应的<code>Buffer</code>类:<code>CharBuffer</code>、<code>ShortBuffer</code>、<code>IntBuffer</code>、<code>LongBuffer</code>、<code>FloatBuffer</code>、<code>DoubleBuffer</code>。</p>
<h2 id="创建Buffer对象"><a href="#创建Buffer对象" class="headerlink" title="创建Buffer对象"></a>创建Buffer对象</h2><p>上面这些<code>Buffer</code>类,除<code>ByteBuffer</code>之外,它们都采用相同或相似的方法来管理数据,只是各自管理的数据类型不同而已。这些<code>Buffer</code>类都没有提供构造器,通过使用如下方法来得到一个<code>Buffer</code>对象。</p>
<table>
<thead>
<tr>
<th align="left">方法</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>static XxxBuffer allocate(int capacity)</code></td>
<td align="left">创建一个容量为<code>capacity</code>的<code>XxX Buffer</code>对象。</td>
</tr>
</tbody></table>
<details><summary>展开/折叠</summary>

<table>
<thead>
<tr>
<th align="left">方法</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>static ByteBuffer allocate(int capacity)</code></td>
<td align="left">Allocates a new byte buffer.</td>
</tr>
<tr>
<td align="left"><code>static ShortBuffer allocate(int capacity)</code></td>
<td align="left">Allocates a new short buffer.</td>
</tr>
<tr>
<td align="left"><code>static IntBuffer allocate(int capacity)</code></td>
<td align="left">Allocates a new int buffer.</td>
</tr>
<tr>
<td align="left"><code>static LongBuffer allocate(int capacity)</code></td>
<td align="left">Allocates a new long buffer.</td>
</tr>
<tr>
<td align="left"><code>static CharBuffer allocate(int capacity)</code></td>
<td align="left">Allocates a new char buffer.</td>
</tr>
<tr>
<td align="left"><code>static FloatBuffer allocate(int capacity)</code></td>
<td align="left">Allocates a new float buffer.</td>
</tr>
<tr>
<td align="left"><code>static DoubleBuffer allocate(int capacity)</code></td>
<td align="left">Allocates a new double buffer.</td>
</tr>
</tbody></table>
</details>

<p>但实际使用较多的是<code>ByteBuffer</code>和<code>CharBuffer</code>,其他<code>Buffer</code>子类则较少用到。</p>
<h2 id="MappedByteBuffer"><a href="#MappedByteBuffer" class="headerlink" title="MappedByteBuffer"></a>MappedByteBuffer</h2><p>其中<code>ByteBuffer</code>类还有一个子类:<code>MappedByteBuffer</code>,<strong><code>MappedByteBuffer</code>用于表示<code>Channel</code>将磁盘文件的部分或全部内容映射到内存中后得到的<mark>结果</mark></strong>,通常<code>MappedByteBuffer</code>对象由<code>Channel</code>的<code>map()</code>方法返回。</p>
<h2 id="容量-界限-位置"><a href="#容量-界限-位置" class="headerlink" title="容量 界限 位置"></a>容量 界限 位置</h2><p>在<code>Buffer</code>中有三个重要的概念:容量(<code>capacity</code>)、界限(<code>limit</code>)和位置(<code>position</code>)</p>
<ul>
<li><strong>容量(<code>capacity</code>)</strong>:<ul>
<li>缓冲区的容量(<code>capacity</code>)表示该<code>Buffer</code>的最大数据容量,即<strong>最多可以存储多少数据</strong>。<strong>缓冲区的容量不可能为负值,创建后不能改变</strong>。</li>
</ul>
</li>
<li><strong>界限(<code>limit</code>)</strong>:<ul>
<li><strong>第一个不应该被读出或者写入的缓冲区位置索引</strong>。也就是说,<strong>位于<code>limit</code>后的数据既不可被读,也不可被写</strong>。</li>
</ul>
</li>
<li><strong>位置(<code>position</code>)</strong>:<ul>
<li>用于指明<strong>下一个可以被读出的或者写入的缓冲区位置索引</strong>(类似于<code>IO</code>流中的记录指针)。<strong>当使用<code>Buffer</code>从<code>Channel</code>中读取数据时,<code>position</code>的<mark>值</mark>恰好等于已经读到了多少数据</strong>:</li>
<li>当刚刚新建一个<code>Buffer</code>对象时,其<code>position</code>为0,也就是<strong>第1个位置的索引为0</strong>;</li>
<li>如果从<code>Channel</code>中读取了2个数据到该<code>Buffer</code>中,则<code>position</code>为2,指向<code>Buffer</code>中第3个位置</li>
</ul>
</li>
</ul>
<h2 id="标记"><a href="#标记" class="headerlink" title="标记"></a>标记</h2><p>除此之外,<code>Buffer</code>里还支持一个可选的标记(<code>mark</code>),类似于传统<code>IO</code>流中的<code>mark()</code>,<strong><code>Buffer</code>允许直接将<code>position</code>定位到该<code>mark</code>处</strong>。这些值满足如下关系:<br><strong>0≤mark≤position≤limit≤capacity</strong><br>图15.16显示了某个<code>Buffer</code>读入了一些数据后的示意图<br><img data-src="https://raw.githubusercontent.com/lanlan2017/images/master/CrazyJavaHandout4/Chapter/15/15.9.2/1.png" alt="这里有一张图片"></p>
<h2 id="Buffer的作用"><a href="#Buffer的作用" class="headerlink" title="Buffer的作用"></a>Buffer的作用</h2><p><strong><code>Buffer</code>的主要作用就是装入数据,然后输出数据</strong>(其作用类似于前面介绍的取水的“竹筒”),<strong>开始时<code>Buffer</code>的<code>position</code>为0,<code>limit</code>为<code>capacity</code></strong></p>
<h2 id="装入数据-put方法"><a href="#装入数据-put方法" class="headerlink" title="装入数据 put方法"></a>装入数据 put方法</h2><p><strong>程序可通过<code>put()</code>方法向<code>Buffer</code>中放入一些数据</strong>(或者从<code>Channel</code>中获取一些数据),<strong>每放入一些数据,<code>Buffer</code>的<code>position</code>相应地向后移动一些位置</strong>。</p>
<h3 id="ByteBuffer的put方法"><a href="#ByteBuffer的put方法" class="headerlink" title="ByteBuffer的put方法"></a>ByteBuffer的put方法</h3><details><summary>展开/折叠</summary>

<table>
<thead>
<tr>
<th align="left"><code>ByteBuffer</code>的<code>put</code>方法</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>abstract ByteBuffer put(byte b)</code></td>
<td align="left">Relative put method (optional operation).</td>
</tr>
<tr>
<td align="left"><code>ByteBuffer put(byte[] src)</code></td>
<td align="left">Relative bulk put method (optional operation).</td>
</tr>
<tr>
<td align="left"><code>ByteBuffer put(byte[] src, int offset, int length)</code></td>
<td align="left">Relative bulk put method (optional operation).</td>
</tr>
<tr>
<td align="left"><code>abstract ByteBuffer put(int index, byte b)</code></td>
<td align="left">Absolute put method (optional operation).</td>
</tr>
<tr>
<td align="left"><code>ByteBuffer put(ByteBuffer src)</code></td>
<td align="left">Relative bulk put method (optional operation).</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th align="left">方法</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>abstract ByteBuffer putChar(char value)</code></td>
<td align="left">Relative put method for writing a char value (optional operation).</td>
</tr>
<tr>
<td align="left"><code>abstract ByteBuffer putChar(int index, char value)</code></td>
<td align="left">Absolute put method for writing a char value (optional operation).</td>
</tr>
<tr>
<td align="left"><code>abstract ByteBuffer putDouble(double value)</code></td>
<td align="left">Relative put method for writing a double value (optional operation).</td>
</tr>
<tr>
<td align="left"><code>abstract ByteBuffer putDouble(int index, double value)</code></td>
<td align="left">Absolute put method for writing a double value (optional operation).</td>
</tr>
<tr>
<td align="left"><code>abstract ByteBuffer putFloat(float value)</code></td>
<td align="left">Relative put method for writing a float value (optional operation).</td>
</tr>
<tr>
<td align="left"><code>abstract ByteBuffer putFloat(int index, float value)</code></td>
<td align="left">Absolute put method for writing a float value (optional operation).</td>
</tr>
<tr>
<td align="left"><code>abstract ByteBuffer putInt(int value)</code></td>
<td align="left">Relative put method for writing an int value (optional operation).</td>
</tr>
<tr>
<td align="left"><code>abstract ByteBuffer putInt(int index, int value)</code></td>
<td align="left">Absolute put method for writing an int value (optional operation).</td>
</tr>
<tr>
<td align="left"><code>abstract ByteBuffer putLong(int index, long value)</code></td>
<td align="left">Absolute put method for writing a long value (optional operation).</td>
</tr>
<tr>
<td align="left"><code>abstract ByteBuffer putLong(long value)</code></td>
<td align="left">Relative put method for writing a long value (optional operation).</td>
</tr>
<tr>
<td align="left"><code>abstract ByteBuffer putShort(int index, short value)</code></td>
<td align="left">Absolute put method for writing a short value (optional operation).</td>
</tr>
<tr>
<td align="left"><code>abstract ByteBuffer putShort(short value)</code></td>
<td align="left">Relative put method for writing a short value (optional operation).</td>
</tr>
</tbody></table>
</details>

<h3 id="CharBuffer的put方法"><a href="#CharBuffer的put方法" class="headerlink" title="CharBuffer的put方法"></a>CharBuffer的put方法</h3><details><summary>展开/折叠</summary>

<table>
<thead>
<tr>
<th align="left">方法</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>abstract CharBuffer put(char c)</code></td>
<td align="left">Relative put method (optional operation).</td>
</tr>
<tr>
<td align="left"><code>CharBuffer put(char[] src)</code></td>
<td align="left">Relative bulk put method (optional operation).</td>
</tr>
<tr>
<td align="left"><code>CharBuffer put(char[] src, int offset, int length)</code></td>
<td align="left">Relative bulk put method (optional operation).</td>
</tr>
<tr>
<td align="left"><code>abstract CharBuffer put(int index, char c)</code></td>
<td align="left">Absolute put method (optional operation).</td>
</tr>
<tr>
<td align="left"><code>CharBuffer put(String src)</code></td>
<td align="left">Relative bulk put method (optional operation).</td>
</tr>
<tr>
<td align="left"><code>CharBuffer put(String src, int start, int end)</code></td>
<td align="left">Relative bulk put method (optional operation).</td>
</tr>
<tr>
<td align="left"><code>CharBuffer put(CharBuffer src)</code></td>
<td align="left">Relative bulk put method (optional operation).</td>
</tr>
</tbody></table>
</details>

<h2 id="准备输出数据-flip方法"><a href="#准备输出数据-flip方法" class="headerlink" title="准备输出数据 flip方法"></a>准备输出数据 flip方法</h2><p>当<code>Buffer</code>装入数据结束后,调用<code>Buffer</code>的<code>flip()</code>方法,<strong>该方法将<code>limit</code>设置为<code>position</code>所在位置,并将<code>position</code>设为0,这就使得<code>Buffer</code>的读写指针又移到了开始位置。</strong></p>
<h3 id="需要读取Buffer中的数据时调用flip方法"><a href="#需要读取Buffer中的数据时调用flip方法" class="headerlink" title="需要读取Buffer中的数据时调用flip方法"></a>需要读取Buffer中的数据时调用flip方法</h3><p>也就是说,<strong><code>Buffer</code>调用<code>flip()</code>方法之后,<code>Buffer</code><mark>为输出数据做好了准备</mark></strong>;</p>
<table>
<thead>
<tr>
<th align="left">Buffer类的flip方法</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>Buffer flip()</code></td>
<td align="left">Flips this buffer.</td>
</tr>
</tbody></table>
<h2 id="准备再次装入数据-clear方法"><a href="#准备再次装入数据-clear方法" class="headerlink" title="准备再次装入数据 clear方法"></a>准备再次装入数据 clear方法</h2><p>当<code>Buffer</code>输出数据结束后,<code>Buffer</code>调用<code>clear()</code>方法,<code>clear</code>方法不是清空<code>Buffer</code>的数据,它仅仅<strong>将<code>position</code>置为0,将<code>limit</code>置为<code>capacity</code></strong>,这样<strong>为再次向<code>Buffer</code>中装入数据做好准备</strong>。</p>
<table>
<thead>
<tr>
<th align="left">Buffer类的clear方法</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>Buffer clear()</code></td>
<td align="left">Clears this buffer.</td>
</tr>
</tbody></table>
<h2 id="取出flip-再次装入clear"><a href="#取出flip-再次装入clear" class="headerlink" title="取出flip 再次装入clear"></a>取出flip 再次装入clear</h2><p><code>Buffer</code>中包含两个重要的方法,即<code>flip()</code>和<code>clear()</code>,</p>
<ul>
<li><code>flip</code>为从<code>Buffer</code>中取出数据做好准备,</li>
<li><code>clear</code>为再次向<code>Buffer</code>中装入数据做好准备</li>
</ul>
<h2 id="Buffer其他常用方法"><a href="#Buffer其他常用方法" class="headerlink" title="Buffer其他常用方法"></a>Buffer其他常用方法</h2><p>除此之外,<code>Buffer</code>还包含如下一些常用的方法。</p>
<table>
<thead>
<tr>
<th align="left">方法</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>int capacity()</code></td>
<td align="left">返回<code>Buffer</code>的<code>capacity</code>大小。</td>
</tr>
<tr>
<td align="left"><code>boolean hasRemaining()</code></td>
<td align="left">判断当前位置(<code>position</code>)和界限(<code>limit</code>)之间是否还有元素可供处理</td>
</tr>
<tr>
<td align="left"><code>int limit()</code></td>
<td align="left">返回<code>Buffer</code>的界限(<code>limit</code>)的位置。</td>
</tr>
<tr>
<td align="left"><code>Buffer limit(int newLimit)</code></td>
<td align="left">重新设置界限(<code>limit</code>)的值,并返回一个具有新的<code>limit</code>的缓冲区对象</td>
</tr>
<tr>
<td align="left"><code>Buffer mark()</code></td>
<td align="left">设置<code>Buffer</code>的<code>mark</code>位置,它只能在0和位置(<code>position</code>)之间做<code>mark</code>。</td>
</tr>
<tr>
<td align="left"><code>int position()</code></td>
<td align="left">返回<code>Buffer</code>中的<code>position</code>值</td>
</tr>
<tr>
<td align="left"><code>Buffer position(int newPosition)</code></td>
<td align="left">设置<code>Buffer</code>的<code>position</code>,并返回<code>position</code>被修改后的<code>Buffer</code>对象</td>
</tr>
<tr>
<td align="left"><code>int remaining()</code></td>
<td align="left">返回当前位置和界限(<code>limit</code>)之间的元素个数</td>
</tr>
<tr>
<td align="left"><code>Buffer reset()</code></td>
<td align="left">将位置(<code>position</code>)转到<code>mark</code>所在的位置。</td>
</tr>
<tr>
<td align="left"><code>Buffer rewind()</code></td>
<td align="left">将位置(<code>position</code>)设置成0,取消设置的<code>mark</code></td>
</tr>
</tbody></table>
<h2 id="放入-取出"><a href="#放入-取出" class="headerlink" title="放入 取出"></a>放入 取出</h2><p>除这些移动<code>position</code>、<code>limit</code>、<code>mark</code>的方法之外,<code>Buffer</code>的所有子类还提供了两个重要的方法:<code>put()</code>和<code>get()</code>方法,用于向<code>Buffer</code>中放入数据和从<code>Buffer</code>中取出数据。<strong>当使用<code>put()</code>和<code>get()</code>方法放入、取出数据时,<code>Buffer</code>既支持对单个数据的访问,也支持对批量数据的访问</strong>(以数组作为参数)。</p>
<h3 id="相对-绝对"><a href="#相对-绝对" class="headerlink" title="相对 绝对"></a>相对 绝对</h3><p>当使用<code>put()</code>和<code>get()</code>来访问<code>Buffer</code>中的数据时,分为相对和绝对两种。</p>
<ul>
<li><strong>相对(<code>Relative</code>)</strong>:<ul>
<li>从<code>Buffer</code>的当前<code>position</code>处开始读取或写入数据,然后将位置(<code>position</code>)的值按处理元素的个数增加</li>
</ul>
</li>
<li><strong>绝对(<code>Absolute</code>)</strong>:<ul>
<li>直接**<mark>根据索引</mark>向<code>Buffer</code>中读取或写入数据**,<strong>使用绝对方式访问<code>Buffer</code>里的数据时,并不会影响位置(<code>position</code>)的值</strong>。</li>
</ul>
</li>
</ul>
<h2 id="程序示例"><a href="#程序示例" class="headerlink" title="程序示例"></a>程序示例</h2><p>下面程序示范了<code>Buffer</code>的一些常规操作。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.nio.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BufferTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 创建Buffer</span></span><br><span class="line">        <span class="type">CharBuffer</span> <span class="variable">buff</span> <span class="operator">=</span> CharBuffer.allocate(<span class="number">8</span>); <span class="comment">// ①</span></span><br><span class="line">        System.out.println(<span class="string">&quot;capacity: &quot;</span> + buff.capacity());</span><br><span class="line">        System.out.println(<span class="string">&quot;limit: &quot;</span> + buff.limit());</span><br><span class="line">        System.out.println(<span class="string">&quot;position: &quot;</span> + buff.position());</span><br><span class="line">        <span class="comment">// 放入元素</span></span><br><span class="line">        buff.put(<span class="string">&#x27;a&#x27;</span>);</span><br><span class="line">        buff.put(<span class="string">&#x27;b&#x27;</span>);</span><br><span class="line">        buff.put(<span class="string">&#x27;c&#x27;</span>); <span class="comment">// ②</span></span><br><span class="line">        System.out.println(<span class="string">&quot;加入三个元素后，position = &quot;</span> + buff.position());</span><br><span class="line">        <span class="comment">// 调用flip()方法 准备取出数据</span></span><br><span class="line">        buff.flip(); <span class="comment">// ③</span></span><br><span class="line">        System.out.println(<span class="string">&quot;执行flip()后，limit = &quot;</span> + buff.limit());</span><br><span class="line">        System.out.println(<span class="string">&quot;position = &quot;</span> + buff.position());</span><br><span class="line">        <span class="comment">// 取出第一个元素</span></span><br><span class="line">        System.out.println(<span class="string">&quot;第一个元素(position=0)：&quot;</span> + buff.get()); <span class="comment">// ④</span></span><br><span class="line">        System.out.println(<span class="string">&quot;取出一个元素后，position = &quot;</span> + buff.position());</span><br><span class="line">        <span class="comment">// 调用clear方法 准备再次放入数据</span></span><br><span class="line">        buff.clear(); <span class="comment">// ⑤</span></span><br><span class="line">        System.out.println(<span class="string">&quot;执行clear()后，limit = &quot;</span> + buff.limit());</span><br><span class="line">        System.out.println(<span class="string">&quot;执行clear()后，position = &quot;</span> + buff.position());</span><br><span class="line">        System.out.println(<span class="string">&quot;执行clear()后，缓冲区内容并没有被清除：&quot;</span> +</span><br><span class="line">            <span class="string">&quot;第三个元素为：&quot;</span> + buff.get(<span class="number">2</span>)); <span class="comment">// ⑥</span></span><br><span class="line">        System.out.println(<span class="string">&quot;执行绝对读取后，position = &quot;</span> + buff.position());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在上面程序的①号代码处:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">CharBuffer</span> <span class="variable">buff</span> <span class="operator">=</span> CharBuffer.allocate(<span class="number">8</span>); <span class="comment">// ①</span></span><br></pre></td></tr></table></figure>
<p>通过<code>CharBuffer</code>的一个静态方法<code>allocate()</code>创建了一个<code>capacity</code>为8的<code>CharBuffer</code>,此时该<code>Buffer</code>的<code>limit</code>和<code>capacity</code>为8,<code>position</code>为0,如图15.17所示<br><img data-src="https://raw.githubusercontent.com/lanlan2017/images/master/CrazyJavaHandout4/Chapter/15/15.9.2/2.png" alt="这里有一张图片"><br>接下来程序执行到②号代码处:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">buff.put(<span class="string">&#x27;a&#x27;</span>);</span><br><span class="line">buff.put(<span class="string">&#x27;b&#x27;</span>);</span><br><span class="line">buff.put(<span class="string">&#x27;c&#x27;</span>); <span class="comment">// ②</span></span><br></pre></td></tr></table></figure>
<p>程序向<code>CharBuffer</code>中放入3个数值,放入3个数值后的<code>CharBuffer</code>效果如图15.18所示。<br><img data-src="https://raw.githubusercontent.com/lanlan2017/images/master/CrazyJavaHandout4/Chapter/15/15.9.2/3.png" alt="这里有一张图片"><br>程序执行到③号代码处:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">buff.flip(); <span class="comment">// ③</span></span><br></pre></td></tr></table></figure>
<p>调用了<code>Buffer</code>的<code>flip()</code>方法,该方法将把<code>limit</code>设为<code>position</code>处,把<code>position</code>设为0,如图15.19所示。<br><img data-src="https://raw.githubusercontent.com/lanlan2017/images/master/CrazyJavaHandout4/Chapter/15/15.9.2/4.png" alt="这里有一张图片"><br>从图15.19中可以看出,当<code>Buffer</code>调用了<code>flip()</code>方法之后,<code>limit</code>就移到了原来<code>position</code>所在位置,这样<strong>相当于把<code>Buffer</code>中<code>没有数据的存储空间“封印”起来</code>,从而避免读取<code>Buffer</code>数据时读到<code>null</code>值</strong>。</p>
<h3 id="无参get方法会使得position加一"><a href="#无参get方法会使得position加一" class="headerlink" title="无参get方法会使得position加一"></a>无参get方法会使得position加一</h3><p>接下来程序在④号代码处:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">System.out.println(<span class="string">&quot;第一个元素(position=0)：&quot;</span> + buff.get()); <span class="comment">// ④</span></span><br></pre></td></tr></table></figure>
<p>取出一个元素,<strong>取出一个元素后<code>position</code>向后移动一位</strong>,也就是该<code>Buffer</code>的<code>position</code>等于1。<br>程序执行到⑤号代码处:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">buff.clear(); <span class="comment">// ⑤</span></span><br></pre></td></tr></table></figure>
<p><code>Buffer</code>调用<code>clear()</code>方法将<code>position</code>设为0,将<code>limit</code>设为与<code>capacity</code>相等。执行<code>clear()</code>方法后的<code>Buffer</code>示意图如图15.20所示。<br><img data-src="https://raw.githubusercontent.com/lanlan2017/images/master/CrazyJavaHandout4/Chapter/15/15.9.2/5.png" alt="这里有一张图片"></p>
<h3 id="根据索引获取值的get方法不会影响position"><a href="#根据索引获取值的get方法不会影响position" class="headerlink" title="根据索引获取值的get方法不会影响position"></a>根据索引获取值的get方法不会影响position</h3><p>从图15.20中可以看出,对<code>Buffer</code>执行<code>clear</code>方法后,该<code>Buffer</code>对象里的数据依然存在,所以程序在⑥号代码处依然可以取出位置为2的值,也就是字符c。因为⑥号代码:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">System.out.println(<span class="string">&quot;执行clear()后，缓冲区内容并没有被清除：&quot;</span> +</span><br><span class="line">    <span class="string">&quot;第三个元素为：&quot;</span> + buff.get(<span class="number">2</span>)); <span class="comment">// ⑥</span></span><br></pre></td></tr></table></figure>
<p>采用的是<strong>根据索引来取值的方式</strong>,所以该方法不会影响<code>Buffer</code>的<code>position</code>.</p>
<h2 id="普通Buffer-直接Buffer"><a href="#普通Buffer-直接Buffer" class="headerlink" title="普通Buffer 直接Buffer"></a>普通Buffer 直接Buffer</h2><p>通过<code>allocate</code>方法创建的<code>Buffer</code>对象是<strong>普通<code>Buffer</code></strong>.<br><code>ByteBuffer</code>还提供了一个<code>allocateDirect()</code>方法来创建<strong>直接<code>Buffer</code><strong>。</strong>直接<code>Buffer</code>的创建成本比普通<code>Buffer</code>的创建成本高,但直接<code>Buffer</code>的读取效率更高</strong>。</p>
<h3 id="只有在ByteBuffer级别上才能创建直接Buffer"><a href="#只有在ByteBuffer级别上才能创建直接Buffer" class="headerlink" title="只有在ByteBuffer级别上才能创建直接Buffer"></a>只有在<code>ByteBuffer</code>级别上才能创建直接<code>Buffer</code></h3><p>由于直接<code>Buffer</code>的创建成本很高,所以**直接<code>Buffer</code>只适用于长生存期的<code>Buffer</code>,而不适用于短生存期、一次用完就丢弃的<code>Buffer</code><strong>。而且只有<code>ByteBuffer</code>才提供了<code>allocateDirect()</code>方法,所以</strong>只有在<code>ByteBuffer</code>级别上才能创建直接<code>Buffer</code><strong>。如果希望使用其他类型,则应该将该</strong>直接<code>Buffer</code>**转换成其他类型的<code>Buffer</code>。</p>
<table>
<thead>
<tr>
<th align="left">方法</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>static ByteBuffer allocateDirect(int capacity)</code></td>
<td align="left">Allocates a new direct byte buffer.</td>
</tr>
</tbody></table>
<!-- CrazyJavaHandout4/Chapter/15/15.9.2/ -->

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/JavaReadingNotes/page/85/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/JavaReadingNotes/">1</a><span class="space">&hellip;</span><a class="page-number" href="/JavaReadingNotes/page/85/">85</a><span class="page-number current">86</span><a class="page-number" href="/JavaReadingNotes/page/87/">87</a><span class="space">&hellip;</span><a class="page-number" href="/JavaReadingNotes/page/188/">188</a><a class="extend next" rel="next" href="/JavaReadingNotes/page/87/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 2018 – 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">蓝蓝</span>
</div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
      <span>站点总字数：</span>
    <span title="站点总字数">5.8m</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span>站点阅读时长 &asymp;</span>
    <span title="站点阅读时长">88:07</span>
  </span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@next-theme/pjax@0.5.0/pjax.min.js" integrity="sha256-3NkoLDrmHLTYj7csHIZSr0MHAFTXth7Ua/DDt4MRUAg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js" integrity="sha256-yt2kYMy0w8AbtF89WXb2P1rfjcP/HTHLT7097U8Y5b8=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/lozad@1.16.0/dist/lozad.min.js" integrity="sha256-mOFREFhqmHeQbXpK2lp4nA3qooVgACfh88fpJftLBbc=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/pangu@4.0.7/dist/browser/pangu.min.js" integrity="sha256-j+yj56cdEY2CwkVtGyz18fNybFGpMGJ8JxG3GSyO2+I=" crossorigin="anonymous"></script>
<script src="/JavaReadingNotes/js/comments.js"></script><script src="/JavaReadingNotes/js/utils.js"></script><script src="/JavaReadingNotes/js/motion.js"></script><script src="/JavaReadingNotes/js/next-boot.js"></script><script src="/JavaReadingNotes/js/bookmark.js"></script><script src="/JavaReadingNotes/js/pjax.js"></script>

  
<script src="https://cdn.jsdelivr.net/npm/hexo-generator-searchdb@1.4.0/dist/search.js" integrity="sha256-vXZMYLEqsROAXkEw93GGIvaB2ab+QW6w3+1ahD9nXXA=" crossorigin="anonymous"></script>
<script src="/JavaReadingNotes/js/third-party/search/local-search.js"></script>



  <script src="/JavaReadingNotes/js/third-party/fancybox.js"></script>

  <script src="/JavaReadingNotes/js/third-party/pace.js"></script>

  




  

  <script class="next-config" data-name="enableMath" type="application/json">false</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"none","js":{"url":"https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js","integrity":"sha256-r+3itOMtGGjap0x+10hu6jW/gZCzxHsoKrOd7gyRSGY="}}</script>
<script src="/JavaReadingNotes/js/third-party/math/mathjax.js"></script>


  <script src="https://cdn.jsdelivr.net/npm/quicklink@2.2.0/dist/quicklink.umd.js" integrity="sha256-4kQf9z5ntdQrzsBC3YSHnEz02Z9C1UeW/E9OgnvlzSY=" crossorigin="anonymous"></script>
  <script class="next-config" data-name="quicklink" type="application/json">{"enable":true,"home":true,"archive":true,"delay":true,"timeout":3000,"priority":true,"url":"https://lanlan2017.github.io/JavaReadingNotes/page/86/"}</script>
  <script src="/JavaReadingNotes/js/third-party/quicklink.js"></script>
<script class="next-config" data-name="waline" type="application/json">{"lang":null,"enable":true,"serverURL":"https://waline-test-lanlan2017.vercel.app","placeholder":"填写邮箱可接收回复通知 填写个人网址可为您引流","avatar":"mm","pageSize":10,"visitor":false,"comment_count":true,"requiredFields":[],"meta":["nick","mail","link"],"libUrl":"https://cdn.jsdelivr.net/npm/@waline/client/dist/Waline.min.js","el":"#waline-comments","path":"/JavaReadingNotes/page/86/"}</script>
<script>
document.addEventListener('page:loaded', () => {
  NexT.utils.loadComments(CONFIG.waline.el).then(() => 
    NexT.utils.getScript(CONFIG.waline.libUrl, { condition: window.Waline })
  ).then(() => {
    new Waline(CONFIG.waline);
  });
});
</script>
</body>
</html>
